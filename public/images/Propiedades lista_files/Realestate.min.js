/*!
 * typeahead.js 1.3.1
 * https://github.com/corejavascript/typeahead.js
 * Copyright 2013-2020 Twitter, Inc. and other contributors; Licensed MIT
 */
function googleAnalyticsMultipleEvent(n){if(Array.isArray(n)&&n.length)for(index=0;index<n.length;++index)googleAnalyticsEvent(n[index])}function googleAnalyticsEvent(n){isEmptyObject(n)||(n.Additional?gtag(n.Command,n.Parameter,n.Additional):gtag(n.Command,n.Parameter))}function renderBtnContacts(){gapi.signin2.render("googleSignInBtn",{scope:"https://www.googleapis.com/auth/contacts",longtitle:!0,theme:"dark",onsuccess:onSignInContacts,onfailure:onFailure})}function renderBtnCalendar(){gapi.signin2.render("googleSignInBtn",{scope:"https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/calendar.readonly",longtitle:!0,theme:"dark",onsuccess:onSignInCalendar,onfailure:onFailure})}function renderBtnYouTube(){gapi.signin2.render("googleSignInBtnYoutube",{scope:"https://www.googleapis.com/auth/youtube.upload https://www.googleapis.com/auth/youtube",longtitle:!0,theme:"dark",onsuccess:onSignInYoutube,onfailure:onFailure})}function onSignInContacts(n){gapi.load("client",function(){gapi.auth2.getAuthInstance().then(function(){return gapi.client.request({path:"https://people.googleapis.com/v1/contactGroups"})}).then(function(t){var i=n.getBasicProfile();ajaxRequest(null,Urls.get(Urls.keys.ContactsGAuthOnSignInAction),"POST",Requests.get(Requests.keys.GoogleJSON)+"="+JSON.stringify(t.result)+"&"+Requests.get(Requests.keys.Emails)+"="+i.getEmail()+"&"+Requests.get(Requests.keys.GoogleIDToken)+"="+GoogleSync.getIdToken())},function(){GoogleSync.googleSignOut()})})}function onSignInCalendar(n){gapi.load("client",function(){gapi.auth2.getAuthInstance().then(function(){var t=n.getBasicProfile();ajaxRequest(null,Urls.get(Urls.keys.CalendarGAuthOnSignInAction),"POST",Requests.get(Requests.keys.Emails)+"="+t.getEmail()+"&"+Requests.get(Requests.keys.GoogleAccessToken)+"="+GoogleSync.getAccessToken()+"&"+Requests.get(Requests.keys.GoogleIDToken)+"="+GoogleSync.getIdToken())},function(){GoogleSync.googleSignOut()})})}function onSignInYoutube(n){gapi.load("client",function(){gapi.auth2.getAuthInstance().then(function(){var t=n.getBasicProfile();YoutubeExporter.authorization.checkAuth(Urls.get(Urls.keys.YoutubeCheckAuthenticationAction),Requests.get(Requests.keys.Emails)+"="+t.getEmail()+"&"+Requests.get(Requests.keys.GoogleAccessToken)+"="+GoogleSync.getAccessToken()+"&"+Requests.get(Requests.keys.GoogleIDToken)+"="+GoogleSync.getIdToken())},function(){GoogleSync.googleSignOut()})})}function onFailure(){Popup.close()}var Email,Location,Reports,Permissions,User,__errorPool;(function(n,t){typeof define=="function"&&define.amd?define(["jquery"],function(i){return n.Bloodhound=t(i)}):typeof module=="object"&&module.exports?module.exports=t(require("jquery")):n.Bloodhound=t(n.jQuery)})(this,function(n){var t=function(){"use strict";return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(n){return!n||/^\s*$/.test(n)},escapeRegExChars:function(n){return n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(n){return typeof n=="string"},isNumber:function(n){return typeof n=="number"},isArray:n.isArray,isFunction:n.isFunction,isObject:n.isPlainObject,isUndefined:function(n){return typeof n=="undefined"},isElement:function(n){return!!(n&&n.nodeType===1)},isJQuery:function(t){return t instanceof n},toStr:function(n){return t.isUndefined(n)||n===null?"":n+""},bind:n.proxy,each:function(t,i){function r(n,t){return i(t,n)}n.each(t,r)},map:n.map,filter:n.grep,every:function(t,i){var r=!0;return t?(n.each(t,function(n,u){if(!(r=i.call(null,u,n,t)))return!1}),!!r):r},some:function(t,i){var r=!1;return t?(n.each(t,function(n,u){if(r=i.call(null,u,n,t))return!1}),!!r):r},mixin:n.extend,identity:function(n){return n},clone:function(t){return n.extend(!0,{},t)},getIdGenerator:function(){var n=0;return function(){return n++}},templatify:function(t){function i(){return String(t)}return n.isFunction(t)?t:i},defer:function(n){setTimeout(n,0)},debounce:function(n,t,i){var r,u;return function(){var f=this,e=arguments,o,s;return o=function(){r=null;i||(u=n.apply(f,e))},s=i&&!r,clearTimeout(r),r=setTimeout(o,t),s&&(u=n.apply(f,e)),u}},throttle:function(n,t){var u,f,i,e,r,o;return r=0,o=function(){r=new Date;i=null;e=n.apply(u,f)},function(){var s=new Date,h=t-(s-r);return u=this,f=arguments,h<=0?(clearTimeout(i),i=null,r=s,e=n.apply(u,f)):i||(i=setTimeout(o,h)),e}},stringify:function(n){return t.isString(n)?n:JSON.stringify(n)},guid:function(){function n(n){var t=(Math.random().toString(16)+"000000000").substr(2,8);return n?"-"+t.substr(0,4)+"-"+t.substr(4,4):t}return"tt-"+n()+n(!0)+n(!0)+n()},noop:function(){}}}(),u="1.3.1",f=function(){"use strict";function i(n){return n=t.toStr(n),n?n.split(/\s+/):[]}function r(n){return n=t.toStr(n),n?n.split(/\W+/):[]}function u(n){n=t.toStr(n);var r=[],i="";return t.each(n.split(""),function(n){n.match(/\s+/)?i="":(r.push(i+n),i+=n)}),r}function n(n){return function(i){return i=t.isArray(i)?i:[].slice.call(arguments,0),function(r){var u=[];return t.each(i,function(i){u=u.concat(n(t.toStr(r[i])))}),u}}}return{nonword:r,whitespace:i,ngram:u,obj:{nonword:n(r),whitespace:n(i),ngram:n(u)}}}(),i=function(){"use strict";function i(i){this.maxSize=t.isNumber(i)?i:100;this.reset();this.maxSize<=0&&(this.set=this.get=n.noop)}function r(){this.head=this.tail=null}function u(n,t){this.key=n;this.val=t;this.prev=this.next=null}return t.mixin(i.prototype,{set:function(n,t){var r=this.list.tail,i;this.size>=this.maxSize&&(this.list.remove(r),delete this.hash[r.key],this.size--);(i=this.hash[n])?(i.val=t,this.list.moveToFront(i)):(i=new u(n,t),this.list.add(i),this.hash[n]=i,this.size++)},get:function(n){var t=this.hash[n];if(t)return this.list.moveToFront(t),t.val},reset:function(){this.size=0;this.hash={};this.list=new r}}),t.mixin(r.prototype,{add:function(n){this.head&&(n.next=this.head,this.head.prev=n);this.head=n;this.tail=this.tail||n},remove:function(n){n.prev?n.prev.next=n.next:this.head=n.next;n.next?n.next.prev=n.prev:this.tail=n.prev},moveToFront:function(n){this.remove(n);this.add(n)}}),i}(),e=function(){"use strict";function r(n,r){this.prefix=["__",n,"__"].join("");this.ttlKey="__ttl__";this.keyMatcher=new RegExp("^"+t.escapeRegExChars(this.prefix));this.ls=r||i;this.ls||this._noop()}function u(){return(new Date).getTime()}function f(n){return JSON.stringify(t.isUndefined(n)?null:n)}function e(t){return n.parseJSON(t)}function o(n){for(var r,u=[],f=i.length,t=0;t<f;t++)(r=i.key(t)).match(n)&&u.push(r.replace(n,""));return u}var i;try{i=window.localStorage;i.setItem("~~~","!");i.removeItem("~~~")}catch(s){i=null}return t.mixin(r.prototype,{_prefix:function(n){return this.prefix+n},_ttlKey:function(n){return this._prefix(n)+this.ttlKey},_noop:function(){this.get=this.set=this.remove=this.clear=this.isExpired=t.noop},_safeSet:function(n,t){try{this.ls.setItem(n,t)}catch(i){i.name==="QuotaExceededError"&&(this.clear(),this._noop())}},get:function(n){return this.isExpired(n)&&this.remove(n),e(this.ls.getItem(this._prefix(n)))},set:function(n,i,r){return t.isNumber(r)?this._safeSet(this._ttlKey(n),f(u()+r)):this.ls.removeItem(this._ttlKey(n)),this._safeSet(this._prefix(n),f(i))},remove:function(n){return this.ls.removeItem(this._ttlKey(n)),this.ls.removeItem(this._prefix(n)),this},clear:function(){for(var t=o(this.keyMatcher),n=t.length;n--;)this.remove(t[n]);return this},isExpired:function(n){var i=e(this.ls.getItem(this._ttlKey(n)));return t.isNumber(i)&&u()>i?!0:!1}}),r}(),r=function(){"use strict";function r(n){n=n||{};this.maxPendingRequests=n.maxPendingRequests||6;this.cancelled=!1;this.lastReq=null;this._send=n.transport;this._get=n.limiter?n.limiter(this._get):this._get;this._cache=n.cache===!1?new i(0):e}var u=0,f={},e=new i(10);return r.setMaxPendingRequests=function(n){this.maxPendingRequests=n},r.resetCache=function(){e.reset()},t.mixin(r.prototype,{_fingerprint:function(t){return t=t||{},t.url+t.type+n.param(t.data||{})},_get:function(n,t){function o(n){t(null,n);i._cache.set(r,n)}function s(){t(!0)}function h(){u--;delete f[r];i.onDeckRequestArgs&&(i._get.apply(i,i.onDeckRequestArgs),i.onDeckRequestArgs=null)}var i=this,r,e;(r=this._fingerprint(n),this.cancelled||r!==this.lastReq)||((e=f[r])?e.done(o).fail(s):u<this.maxPendingRequests?(u++,f[r]=this._send(n).done(o).fail(s).always(h)):this.onDeckRequestArgs=[].slice.call(arguments,0))},get:function(i,r){var f,u;r=r||n.noop;i=t.isString(i)?{url:i}:i||{};u=this._fingerprint(i);this.cancelled=!1;this.lastReq=u;(f=this._cache.get(u))?r(null,f):this._get(i,r)},cancel:function(){this.cancelled=!0}}),r}(),o=window.SearchIndex=function(){"use strict";function u(i){i=i||{};i.datumTokenizer&&i.queryTokenizer||n.error("datumTokenizer and queryTokenizer are both required");this.identify=i.identify||t.stringify;this.datumTokenizer=i.datumTokenizer;this.queryTokenizer=i.queryTokenizer;this.matchAnyQueryToken=i.matchAnyQueryToken;this.reset()}function f(n){return n=t.filter(n,function(n){return!!n}),t.map(n,function(n){return n.toLowerCase()})}function e(){var n={};return n[r]=[],n[i]={},n}function o(n){for(var i={},r=[],t=0,u=n.length;t<u;t++)i[n[t]]||(i[n[t]]=!0,r.push(n[t]));return r}function s(n,t){var i=0,r=0,u=[],f,e;for(n=n.sort(),t=t.sort(),f=n.length,e=t.length;i<f&&r<e;)n[i]<t[r]?i++:n[i]>t[r]?r++:(u.push(n[i]),i++,r++);return u}var i="c",r="i";return t.mixin(u.prototype,{bootstrap:function(n){this.datums=n.datums;this.trie=n.trie},add:function(n){var u=this;n=t.isArray(n)?n:[n];t.each(n,function(n){var o,s;u.datums[o=u.identify(n)]=n;s=f(u.datumTokenizer(n));t.each(s,function(n){for(var f,t=u.trie,s=n.split("");f=s.shift();)t=t[i][f]||(t[i][f]=e()),t[r].push(o)})})},get:function(n){var i=this;return t.map(n,function(n){return i.datums[n]})},search:function(n){var e=this,h,u;return h=f(this.queryTokenizer(n)),t.each(h,function(n){var t,f,h,o;if(u&&u.length===0&&!e.matchAnyQueryToken)return!1;for(t=e.trie,f=n.split("");t&&(h=f.shift());)t=t[i][h];if(t&&f.length===0)o=t[r].slice(0),u=u?s(u,o):o;else if(!e.matchAnyQueryToken)return u=[],!1}),u?t.map(o(u),function(n){return e.datums[n]}):[]},all:function(){var n=[];for(var t in this.datums)n.push(this.datums[t]);return n},reset:function(){this.datums={};this.trie=e()},serialize:function(){return{datums:this.datums,trie:this.trie}}}),u}(),s=function(){"use strict";function i(n){this.url=n.url;this.ttl=n.ttl;this.cache=n.cache;this.prepare=n.prepare;this.transform=n.transform;this.transport=n.transport;this.thumbprint=n.thumbprint;this.storage=new e(n.cacheKey)}var n;return n={data:"data",protocol:"protocol",thumbprint:"thumbprint"},t.mixin(i.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},store:function(t){this.cache&&(this.storage.set(n.data,t,this.ttl),this.storage.set(n.protocol,location.protocol,this.ttl),this.storage.set(n.thumbprint,this.thumbprint,this.ttl))},fromCache:function(){var t={},i;return this.cache?(t.data=this.storage.get(n.data),t.protocol=this.storage.get(n.protocol),t.thumbprint=this.storage.get(n.thumbprint),i=t.thumbprint!==this.thumbprint||t.protocol!==location.protocol,t.data&&!i?t.data:null):null},fromNetwork:function(n){function r(){n(!0)}function u(t){n(null,i.transform(t))}var i=this,t;n&&(t=this.prepare(this._settings()),this.transport(t).fail(r).done(u))},clear:function(){return this.storage.clear(),this}}),i}(),h=function(){"use strict";function n(n){this.url=n.url;this.prepare=n.prepare;this.transform=n.transform;this.indexResponse=n.indexResponse;this.transport=new r({cache:n.cache,limiter:n.limiter,transport:n.transport,maxPendingRequests:n.maxPendingRequests})}return t.mixin(n.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},get:function(n,t){function u(n,i){n?t([]):t(r.transform(i))}var r=this,i;if(t)return n=n||"",i=this.prepare(n,this._settings()),this.transport.get(i,u)},cancelLastRequest:function(){this.transport.cancel()}}),n}(),c=function(){"use strict";function r(r){var f;return r?(f={url:null,ttl:864e5,cache:!0,cacheKey:null,thumbprint:"",prepare:t.identity,transform:t.identity,transport:null},r=t.isString(r)?{url:r}:r,r=t.mixin(f,r),r.url||n.error("prefetch requires url to be set"),r.transform=r.filter||r.transform,r.cacheKey=r.cacheKey||r.url,r.thumbprint=u+r.thumbprint,r.transport=r.transport?i(r.transport):n.ajax,r):null}function f(r){var u;if(r)return u={url:null,cache:!0,prepare:null,replace:null,wildcard:null,limiter:null,rateLimitBy:"debounce",rateLimitWait:300,transform:t.identity,transport:null},r=t.isString(r)?{url:r}:r,r=t.mixin(u,r),r.url||n.error("remote requires url to be set"),r.transform=r.filter||r.transform,r.prepare=e(r),r.limiter=o(r),r.transport=r.transport?i(r.transport):n.ajax,delete r.replace,delete r.wildcard,delete r.rateLimitBy,delete r.rateLimitWait,r}function e(n){function u(n,t){return t.url=i(t.url,n),t}function f(n,t){return t.url=t.url.replace(r,encodeURIComponent(n)),t}function e(n,t){return t}var t,i,r;return(t=n.prepare,i=n.replace,r=n.wildcard,t)?t:i?u:n.wildcard?f:e}function o(n){function f(n){return function(i){return t.debounce(i,n)}}function e(n){return function(i){return t.throttle(i,n)}}var i,u,r;return i=n.limiter,u=n.rateLimitBy,r=n.rateLimitWait,i||(i=/^throttle$/i.test(u)?e(r):f(r)),i}function i(i){return function(r){function f(n){t.defer(function(){u.resolve(n)})}function e(n){t.defer(function(){u.reject(n)})}var u=n.Deferred();return i(r,f,e),u}}return function(i){var e,u;return e={initialize:!0,identify:t.stringify,datumTokenizer:null,queryTokenizer:null,matchAnyQueryToken:!1,sufficient:5,indexRemote:!1,sorter:null,local:[],prefetch:null,remote:null},i=t.mixin(e,i||{}),i.datumTokenizer||n.error("datumTokenizer is required"),i.queryTokenizer||n.error("queryTokenizer is required"),u=i.sorter,i.sorter=u?function(n){return n.sort(u)}:t.identity,i.local=t.isFunction(i.local)?i.local():i.local,i.prefetch=r(i.prefetch),i.remote=f(i.remote),i}}();return function(){"use strict";function i(n){n=c(n);this.sorter=n.sorter;this.identify=n.identify;this.sufficient=n.sufficient;this.indexRemote=n.indexRemote;this.local=n.local;this.remote=n.remote?new h(n.remote):null;this.prefetch=n.prefetch?new s(n.prefetch):null;this.index=new o({identify:this.identify,datumTokenizer:n.datumTokenizer,queryTokenizer:n.queryTokenizer});n.initialize!==!1&&this.initialize()}var u;return u=window&&window.Bloodhound,i.noConflict=function(){return window&&(window.Bloodhound=u),i},i.tokenizers=f,t.mixin(i.prototype,{__ttAdapter:function(){function t(t,i,r){return n.search(t,i,r)}function i(t,i){return n.search(t,i)}var n=this;return this.remote?t:i},_loadPrefetch:function(){function u(n,r){if(n)return t.reject();i.add(r);i.prefetch.store(i.index.serialize());t.resolve()}var i=this,t,r;return t=n.Deferred(),this.prefetch?(r=this.prefetch.fromCache())?(this.index.bootstrap(r),t.resolve()):this.prefetch.fromNetwork(u):t.resolve(),t.promise()},_initialize:function(){function t(){n.add(n.local)}var n=this;return this.clear(),(this.initPromise=this._loadPrefetch()).done(t),this.initPromise},initialize:function(n){return!this.initPromise||n?this._initialize():this.initPromise},add:function(n){return this.index.add(n),this},get:function(n){return n=t.isArray(n)?n:[].slice.call(arguments),this.index.get(n)},search:function(n,i,r){function e(n){var i=[];t.each(n,function(n){t.some(u,function(t){return f.identify(n)===f.identify(t)})||i.push(n)});f.indexRemote&&f.add(i);r(i)}var f=this,u;return i=i||t.noop,r=r||t.noop,u=this.sorter(this.index.search(n)),i(this.remote?u.slice():u),this.remote&&u.length<this.sufficient?this.remote.get(n,e):this.remote&&this.remote.cancelLastRequest(),this},all:function(){return this.index.all()},clear:function(){return this.index.reset(),this},clearPrefetchCache:function(){return this.prefetch&&this.prefetch.clear(),this},clearRemoteCache:function(){return r.resetCache(),this},ttAdapter:function(){return this.__ttAdapter()}}),i}()}),function(n,t){typeof define=="function"&&define.amd?define(["jquery"],function(n){return t(n)}):typeof module=="object"&&module.exports?module.exports=t(require("jquery")):t(n.jQuery)}(this,function(n){var t=function(){"use strict";return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(n){return!n||/^\s*$/.test(n)},escapeRegExChars:function(n){return n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(n){return typeof n=="string"},isNumber:function(n){return typeof n=="number"},isArray:n.isArray,isFunction:n.isFunction,isObject:n.isPlainObject,isUndefined:function(n){return typeof n=="undefined"},isElement:function(n){return!!(n&&n.nodeType===1)},isJQuery:function(t){return t instanceof n},toStr:function(n){return t.isUndefined(n)||n===null?"":n+""},bind:n.proxy,each:function(t,i){function r(n,t){return i(t,n)}n.each(t,r)},map:n.map,filter:n.grep,every:function(t,i){var r=!0;return t?(n.each(t,function(n,u){if(!(r=i.call(null,u,n,t)))return!1}),!!r):r},some:function(t,i){var r=!1;return t?(n.each(t,function(n,u){if(r=i.call(null,u,n,t))return!1}),!!r):r},mixin:n.extend,identity:function(n){return n},clone:function(t){return n.extend(!0,{},t)},getIdGenerator:function(){var n=0;return function(){return n++}},templatify:function(t){function i(){return String(t)}return n.isFunction(t)?t:i},defer:function(n){setTimeout(n,0)},debounce:function(n,t,i){var r,u;return function(){var f=this,e=arguments,o,s;return o=function(){r=null;i||(u=n.apply(f,e))},s=i&&!r,clearTimeout(r),r=setTimeout(o,t),s&&(u=n.apply(f,e)),u}},throttle:function(n,t){var u,f,i,e,r,o;return r=0,o=function(){r=new Date;i=null;e=n.apply(u,f)},function(){var s=new Date,h=t-(s-r);return u=this,f=arguments,h<=0?(clearTimeout(i),i=null,r=s,e=n.apply(u,f)):i||(i=setTimeout(o,h)),e}},stringify:function(n){return t.isString(n)?n:JSON.stringify(n)},guid:function(){function n(n){var t=(Math.random().toString(16)+"000000000").substr(2,8);return n?"-"+t.substr(0,4)+"-"+t.substr(4,4):t}return"tt-"+n()+n(!0)+n(!0)+n()},noop:function(){}}}(),e=function(){"use strict";function i(i){var e,o;return o=t.mixin({},n,i),e={css:f(),classes:o,html:r(o),selectors:u(o)},{css:e.css,html:e.html,classes:e.classes,selectors:e.selectors,mixin:function(n){t.mixin(n,e)}}}function r(n){return{wrapper:'<span class="'+n.wrapper+'"><\/span>',menu:'<div role="listbox" class="'+n.menu+'"><\/div>'}}function u(n){var i={};return t.each(n,function(n,t){i[t]="."+n}),i}function f(){var n={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},menu:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};return t.isMsie()&&t.mixin(n.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}),n}var n={wrapper:"twitter-typeahead",input:"tt-input",hint:"tt-hint",menu:"tt-menu",dataset:"tt-dataset",suggestion:"tt-suggestion",selectable:"tt-selectable",empty:"tt-empty",open:"tt-open",cursor:"tt-cursor",highlight:"tt-highlight"};return i}(),o=function(){"use strict";function u(t){t&&t.el||n.error("EventBus initialized without el");this.$el=n(t.el)}var i,r;return i="typeahead:",r={render:"rendered",cursorchange:"cursorchanged",select:"selected",autocomplete:"autocompleted"},t.mixin(u.prototype,{_trigger:function(t,r){var u=n.Event(i+t);return this.$el.trigger.call(this.$el,u,r||[]),u},before:function(n){var t,i;return t=[].slice.call(arguments,1),i=this._trigger("before"+n,t),i.isDefaultPrevented()},trigger:function(n){var t;this._trigger(n,[].slice.call(arguments,1));(t=r[n])&&this._trigger(t,[].slice.call(arguments,1))}}),u}(),r=function(){"use strict";function t(t,i,r,u){var f;if(!r)return this;for(i=i.split(n),r=u?h(r,u):r,this._callbacks=this._callbacks||{};f=i.shift();)this._callbacks[f]=this._callbacks[f]||{sync:[],async:[]},this._callbacks[f][t].push(r);return this}function u(n,i,r){return t.call(this,"async",n,i,r)}function f(n,i,r){return t.call(this,"sync",n,i,r)}function e(t){var i;if(!this._callbacks)return this;for(t=t.split(n);i=t.shift();)delete this._callbacks[i];return this}function o(t){var u,f,e,o,s;if(!this._callbacks)return this;for(t=t.split(n),e=[].slice.call(arguments,1);(u=t.shift())&&(f=this._callbacks[u]);)o=i(f.sync,this,[u].concat(e)),s=i(f.async,this,[u].concat(e)),o()&&r(s);return this}function i(n,t,i){function r(){for(var r,u=0,f=n.length;!r&&u<f;u+=1)r=n[u].apply(t,i)===!1;return!r}return r}function s(){return window.setImmediate?function(n){setImmediate(function(){n()})}:function(n){setTimeout(function(){n()},0)}}function h(n,t){return n.bind?n.bind(t):function(){n.apply(t,[].slice.call(arguments,0))}}var n=/\s+/,r=s();return{onSync:f,onAsync:u,off:e,trigger:o}}(),s=function(n){"use strict";function u(n){return r[n.toUpperCase()]||n}function f(n,i,r,f){for(var e,o=[],s,h=0,c=n.length;h<c;h++)e=t.escapeRegExChars(n[h]),f&&(e=e.replace(/\S/g,u)),o.push(e);return s=r?"\\b("+o.join("|")+")\\b":"("+o.join("|")+")",i?new RegExp(s):new RegExp(s,"i")}var i={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1,diacriticInsensitive:!1},r={A:"[AaªÀ-Åà-åĀ-ąǍǎȀ-ȃȦȧᴬᵃḀḁẚẠ-ảₐ℀℁℻⒜Ⓐⓐ㍱-㍴㎀-㎄㎈㎉㎩-㎯㏂㏊㏟㏿Ａａ]",B:"[BbᴮᵇḂ-ḇℬ⒝Ⓑⓑ㍴㎅-㎇㏃㏈㏔㏝Ｂｂ]",C:"[CcÇçĆ-čᶜ℀ℂ℃℅℆ℭⅭⅽ⒞Ⓒⓒ㍶㎈㎉㎝㎠㎤㏄-㏇Ｃｃ]",D:"[DdĎďǄ-ǆǱ-ǳᴰᵈḊ-ḓⅅⅆⅮⅾ⒟Ⓓⓓ㋏㍲㍷-㍹㎗㎭-㎯㏅㏈Ｄｄ]",E:"[EeÈ-Ëè-ëĒ-ěȄ-ȇȨȩᴱᵉḘ-ḛẸ-ẽₑ℡ℯℰⅇ⒠Ⓔⓔ㉐㋍㋎Ｅｅ]",F:"[FfᶠḞḟ℉ℱ℻⒡Ⓕⓕ㎊-㎌㎙ﬀ-ﬄＦｆ]",G:"[GgĜ-ģǦǧǴǵᴳᵍḠḡℊ⒢Ⓖⓖ㋌㋍㎇㎍-㎏㎓㎬㏆㏉㏒㏿Ｇｇ]",H:"[HhĤĥȞȟʰᴴḢ-ḫẖℋ-ℎ⒣Ⓗⓗ㋌㍱㎐-㎔㏊㏋㏗Ｈｈ]",I:"[IiÌ-Ïì-ïĨ-İĲĳǏǐȈ-ȋᴵᵢḬḭỈ-ịⁱℐℑℹⅈⅠ-ⅣⅥ-ⅨⅪⅫⅰ-ⅳⅵ-ⅸⅺⅻ⒤Ⓘⓘ㍺㏌㏕ﬁﬃＩｉ]",J:"[JjĲ-ĵǇ-ǌǰʲᴶⅉ⒥ⒿⓙⱼＪｊ]",K:"[KkĶķǨǩᴷᵏḰ-ḵK⒦Ⓚⓚ㎄㎅㎉㎏㎑㎘㎞㎢㎦㎪㎸㎾㏀㏆㏍-㏏Ｋｋ]",L:"[LlĹ-ŀǇ-ǉˡᴸḶḷḺ-ḽℒℓ℡Ⅼⅼ⒧Ⓛⓛ㋏㎈㎉㏐-㏓㏕㏖㏿ﬂﬄＬｌ]",M:"[MmᴹᵐḾ-ṃ℠™ℳⅯⅿ⒨Ⓜⓜ㍷-㍹㎃㎆㎎㎒㎖㎙-㎨㎫㎳㎷㎹㎽㎿㏁㏂㏎㏐㏔-㏖㏘㏙㏞㏟Ｍｍ]",N:"[NnÑñŃ-ŉǊ-ǌǸǹᴺṄ-ṋⁿℕ№⒩Ⓝⓝ㎁㎋㎚㎱㎵㎻㏌㏑Ｎｎ]",O:"[OoºÒ-Öò-öŌ-őƠơǑǒǪǫȌ-ȏȮȯᴼᵒỌ-ỏₒ℅№ℴ⒪Ⓞⓞ㍵㏇㏒㏖Ｏｏ]",P:"[PpᴾᵖṔ-ṗℙ⒫Ⓟⓟ㉐㍱㍶㎀㎊㎩-㎬㎰㎴㎺㏋㏗-㏚Ｐｐ]",Q:"[Qqℚ⒬Ⓠⓠ㏃Ｑｑ]",R:"[RrŔ-řȐ-ȓʳᴿᵣṘ-ṛṞṟ₨ℛ-ℝ⒭Ⓡⓡ㋍㍴㎭-㎯㏚㏛Ｒｒ]",S:"[SsŚ-šſȘșˢṠ-ṣ₨℁℠⒮Ⓢⓢ㎧㎨㎮-㎳㏛㏜ﬆＳｓ]",T:"[TtŢ-ťȚțᵀᵗṪ-ṱẗ℡™⒯Ⓣⓣ㉐㋏㎔㏏ﬅﬆＴｔ]",U:"[UuÙ-Üù-üŨ-ųƯưǓǔȔ-ȗᵁᵘᵤṲ-ṷỤ-ủ℆⒰Ⓤⓤ㍳㍺Ｕｕ]",V:"[VvᵛᵥṼ-ṿⅣ-Ⅷⅳ-ⅷ⒱Ⓥⓥⱽ㋎㍵㎴-㎹㏜㏞Ｖｖ]",W:"[WwŴŵʷᵂẀ-ẉẘ⒲Ⓦⓦ㎺-㎿㏝Ｗｗ]",X:"[XxˣẊ-ẍₓ℻Ⅸ-Ⅻⅸ-ⅻ⒳Ⓧⓧ㏓Ｘｘ]",Y:"[YyÝýÿŶ-ŸȲȳʸẎẏẙỲ-ỹ⒴Ⓨⓨ㏉Ｙｙ]",Z:"[ZzŹ-žǱ-ǳᶻẐ-ẕℤℨ⒵Ⓩⓩ㎐-㎔Ｚｚ]"};return function(r){function o(t){var i,f,e;return(i=u.exec(t.data))&&(e=n.createElement(r.tagName),r.className&&(e.className=r.className),f=t.splitText(i.index),f.splitText(i[0].length),e.appendChild(f.cloneNode(!0)),t.parentNode.replaceChild(e,f)),!!i}function e(n,t){for(var i,r=0;r<n.childNodes.length;r++)i=n.childNodes[r],i.nodeType===3?r+=t(i)?1:0:e(i,t)}var u;(r=t.mixin({},i,r),r.node&&r.pattern)&&(r.pattern=t.isArray(r.pattern)?r.pattern:[r.pattern],u=f(r.pattern,r.caseSensitive,r.wordsOnly,r.diacriticInsensitive),e(r.node,o))}}(window.document),u=function(){"use strict";function i(i,r){var u;i=i||{};i.input||n.error("input is missing");r.mixin(this);this.$hint=n(i.hint);this.$input=n(i.input);this.$menu=n(i.menu);u=this.$input.attr("id")||t.guid();this.$menu.attr("id",u+"_listbox");this.$hint.attr({"aria-hidden":!0});this.$input.attr({"aria-owns":u+"_listbox",role:"combobox","aria-autocomplete":"list","aria-expanded":!1});this.query=this.$input.val();this.queryWhenFocused=this.hasFocus()?this.query:null;this.$overflowHelper=e(this.$input);this._checkLanguageDirection();this.$hint.length===0&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=t.noop);this.onSync("cursorchange",this._updateDescendent)}function e(t){return n('<pre aria-hidden="true"><\/pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:t.css("font-family"),fontSize:t.css("font-size"),fontStyle:t.css("font-style"),fontVariant:t.css("font-variant"),fontWeight:t.css("font-weight"),wordSpacing:t.css("word-spacing"),letterSpacing:t.css("letter-spacing"),textIndent:t.css("text-indent"),textRendering:t.css("text-rendering"),textTransform:t.css("text-transform")}).insertAfter(t)}function o(n,t){return i.normalizeQuery(n)===i.normalizeQuery(t)}function f(n){return n.altKey||n.ctrlKey||n.metaKey||n.shiftKey}var u;return u={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},i.normalizeQuery=function(n){return t.toStr(n).replace(/^\s*/g,"").replace(/\s{2,}/g," ")},t.mixin(i.prototype,r,{_onBlur:function(){this.resetInputValue();this.trigger("blurred")},_onFocus:function(){this.queryWhenFocused=this.query;this.trigger("focused")},_onKeydown:function(n){var t=u[n.which||n.keyCode];this._managePreventDefault(t,n);t&&this._shouldTrigger(t,n)&&this.trigger(t+"Keyed",n)},_onInput:function(){this._setQuery(this.getInputValue());this.clearHintIfInvalid();this._checkLanguageDirection()},_managePreventDefault:function(n,t){var i;switch(n){case"up":case"down":i=!f(t);break;default:i=!1}i&&t.preventDefault()},_shouldTrigger:function(n,t){var i;switch(n){case"tab":i=!f(t);break;default:i=!0}return i},_checkLanguageDirection:function(){var n=(this.$input.css("direction")||"ltr").toLowerCase();this.dir!==n&&(this.dir=n,this.$hint.attr("dir",n),this.trigger("langDirChanged",n))},_setQuery:function(n,t){var i,r;i=o(n,this.query);r=i?this.query.length!==n.length:!1;this.query=n;t||i?!t&&r&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query)},_updateDescendent:function(n,t){this.$input.attr("aria-activedescendant",t)},bind:function(){var n=this,i,r,f,e;i=t.bind(this._onBlur,this);r=t.bind(this._onFocus,this);f=t.bind(this._onKeydown,this);e=t.bind(this._onInput,this);this.$input.on("blur.tt",i).on("focus.tt",r).on("keydown.tt",f);if(!t.isMsie()||t.isMsie()>9)this.$input.on("input.tt",e);else this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(i){u[i.which||i.keyCode]||t.defer(t.bind(n._onInput,n,i))});return this},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getLangDir:function(){return this.dir},getQuery:function(){return this.query||""},setQuery:function(n,t){this.setInputValue(n);this._setQuery(n,t)},hasQueryChangedSinceLastFocus:function(){return this.query!==this.queryWhenFocused},getInputValue:function(){return this.$input.val()},setInputValue:function(n){this.$input.val(n);this.clearHintIfInvalid();this._checkLanguageDirection()},resetInputValue:function(){this.setInputValue(this.query)},getHint:function(){return this.$hint.val()},setHint:function(n){this.$hint.val(n)},clearHint:function(){this.setHint("")},clearHintIfInvalid:function(){var n,t,i,r;n=this.getInputValue();t=this.getHint();i=n!==t&&t.indexOf(n)===0;r=n!==""&&i&&!this.hasOverflow();r||this.clearHint()},hasFocus:function(){return this.$input.is(":focus")},hasOverflow:function(){var n=this.$input.width()-2;return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>=n},isCursorAtEnd:function(){var n,i,r;return(n=this.$input.val().length,i=this.$input[0].selectionStart,t.isNumber(i))?i===n:document.selection?(r=document.selection.createRange(),r.moveStart("character",-n),n===r.text.length):!0},destroy:function(){this.$hint.off(".tt");this.$input.off(".tt");this.$overflowHelper.remove();this.$hint=this.$input=this.$overflowHelper=n("<div>")},setAriaExpanded:function(n){this.$input.attr("aria-expanded",n)}}),i}(),f=function(){"use strict";function u(i,r){i=i||{};i.templates=i.templates||{};i.templates.notFound=i.templates.notFound||i.templates.empty;i.source||n.error("missing source");i.node||n.error("missing node");i.name&&!h(i.name)&&n.error("invalid dataset name: "+i.name);r.mixin(this);this.highlight=!!i.highlight;this.name=t.toStr(i.name||f());this.limit=i.limit||5;this.displayFn=e(i.display||i.displayKey);this.templates=o(i.templates,this.displayFn);this.source=i.source.__ttAdapter?i.source.__ttAdapter():i.source;this.async=t.isUndefined(i.async)?this.source.length>2:!!i.async;this._resetLastSuggestion();this.$el=n(i.node).attr("role","presentation").addClass(this.classes.dataset).addClass(this.classes.dataset+"-"+this.name)}function e(n){function i(t){return t[n]}return n=n||t.stringify,t.isFunction(n)?n:i}function o(i,r){function u(r){var u=i.suggestion;return n(u(r)).attr("id",t.guid())}function f(i){return n('<div role="option">').attr("id",t.guid()).text(r(i))}return{notFound:i.notFound&&t.templatify(i.notFound),pending:i.pending&&t.templatify(i.pending),header:i.header&&t.templatify(i.header),footer:i.footer&&t.templatify(i.footer),suggestion:i.suggestion?u:f}}function h(n){return/^[_a-zA-Z0-9-]+$/.test(n)}var i,f;return i={dataset:"tt-selectable-dataset",val:"tt-selectable-display",obj:"tt-selectable-object"},f=t.getIdGenerator(),u.extractData=function(t){var r=n(t);return r.data(i.obj)?{dataset:r.data(i.dataset)||"",val:r.data(i.val)||"",obj:r.data(i.obj)||null}:null},t.mixin(u.prototype,r,{_overwrite:function(n,t){t=t||[];t.length?this._renderSuggestions(n,t):this.async&&this.templates.pending?this._renderPending(n):!this.async&&this.templates.notFound?this._renderNotFound(n):this._empty();this.trigger("rendered",t,!1,this.name)},_append:function(n,t){t=t||[];t.length&&this.$lastSuggestion.length?this._appendSuggestions(n,t):t.length?this._renderSuggestions(n,t):!this.$lastSuggestion.length&&this.templates.notFound&&this._renderNotFound(n);this.trigger("rendered",t,!0,this.name)},_renderSuggestions:function(n,t){var i;i=this._getSuggestionsFragment(n,t);this.$lastSuggestion=i.children().last();this.$el.html(i).prepend(this._getHeader(n,t)).append(this._getFooter(n,t))},_appendSuggestions:function(n,t){var i,r;i=this._getSuggestionsFragment(n,t);r=i.children().last();this.$lastSuggestion.after(i);this.$lastSuggestion=r},_renderPending:function(n){var t=this.templates.pending;this._resetLastSuggestion();t&&this.$el.html(t({query:n,dataset:this.name}))},_renderNotFound:function(n){var t=this.templates.notFound;this._resetLastSuggestion();t&&this.$el.html(t({query:n,dataset:this.name}))},_empty:function(){this.$el.empty();this._resetLastSuggestion()},_getSuggestionsFragment:function(r,u){var f=this,e;return e=document.createDocumentFragment(),t.each(u,function(t){var u,o;o=f._injectQuery(r,t);u=n(f.templates.suggestion(o)).data(i.dataset,f.name).data(i.obj,t).data(i.val,f.displayFn(t)).addClass(f.classes.suggestion+" "+f.classes.selectable);e.appendChild(u[0])}),this.highlight&&s({className:this.classes.highlight,node:e,pattern:r}),n(e)},_getFooter:function(n,t){return this.templates.footer?this.templates.footer({query:n,suggestions:t,dataset:this.name}):null},_getHeader:function(n,t){return this.templates.header?this.templates.header({query:n,suggestions:t,dataset:this.name}):null},_resetLastSuggestion:function(){this.$lastSuggestion=n()},_injectQuery:function(n,i){return t.isObject(i)?t.mixin({_query:n},i):i},update:function(t){function e(n){u||(u=!0,n=(n||[]).slice(0,i.limit),r=n.length,i._overwrite(t,n),r<i.limit&&i.async&&i.trigger("asyncRequested",t,i.name))}function o(u){if(u=u||[],!f&&r<i.limit){i.cancel=n.noop;var e=Math.abs(r-i.limit);r+=e;i._append(t,u.slice(0,e));i.async&&i.trigger("asyncReceived",t,i.name)}}var i=this,f=!1,u=!1,r=0;this.cancel();this.cancel=function(){f=!0;i.cancel=n.noop;i.async&&i.trigger("asyncCanceled",t,i.name)};this.source(t,e,o);u||e([])},cancel:n.noop,clear:function(){this._empty();this.cancel();this.trigger("cleared")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=n("<div>")}}),u}(),i=function(){"use strict";function i(i,r){function e(t){var i=u.$node.find(t.node).first();return t.node=i.length?i:n("<div>").appendTo(u.$node),new f(t,r)}var u=this;i=i||{};i.node||n.error("node is required");r.mixin(this);this.$node=n(i.node);this.query=null;this.datasets=t.map(i.datasets,e)}return t.mixin(i.prototype,r,{_onSelectableClick:function(t){this.trigger("selectableClicked",n(t.currentTarget))},_onRendered:function(n,t,i,r){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty());this.trigger("datasetRendered",t,i,r)},_onCleared:function(){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty());this.trigger("datasetCleared")},_propagate:function(){this.trigger.apply(this,arguments)},_allDatasetsEmpty:function(){return t.every(this.datasets,t.bind(function(n){var t=n.isEmpty();return this.$node.attr("aria-expanded",!t),t},this))},_getSelectables:function(){return this.$node.find(this.selectors.selectable)},_removeCursor:function(){var n=this.getActiveSelectable();n&&n.removeClass(this.classes.cursor)},_ensureVisible:function(n){var t,i,r,u;t=n.position().top;i=t+n.outerHeight(!0);r=this.$node.scrollTop();u=this.$node.height()+parseInt(this.$node.css("paddingTop"),10)+parseInt(this.$node.css("paddingBottom"),10);t<0?this.$node.scrollTop(r+t):u<i&&this.$node.scrollTop(r+(i-u))},bind:function(){var i=this,r=t.bind(this._onSelectableClick,this);this.$node.on("click.tt",this.selectors.selectable,r);this.$node.on("mouseover",this.selectors.selectable,function(){i.setCursor(n(this))});this.$node.on("mouseleave",function(){i._removeCursor()});return t.each(this.datasets,function(n){n.onSync("asyncRequested",i._propagate,i).onSync("asyncCanceled",i._propagate,i).onSync("asyncReceived",i._propagate,i).onSync("rendered",i._onRendered,i).onSync("cleared",i._onCleared,i)}),this},isOpen:function(){return this.$node.hasClass(this.classes.open)},open:function(){this.$node.scrollTop(0);this.$node.addClass(this.classes.open)},close:function(){this.$node.attr("aria-expanded",!1);this.$node.removeClass(this.classes.open);this._removeCursor()},setLanguageDirection:function(n){this.$node.attr("dir",n)},selectableRelativeToCursor:function(n){var i,r,u,t;return r=this.getActiveSelectable(),i=this._getSelectables(),u=r?i.index(r):-1,t=u+n,t=(t+1)%(i.length+1)-1,t=t<-1?i.length-1:t,t===-1?null:i.eq(t)},setCursor:function(n){this._removeCursor();(n=n&&n.first())&&(n.addClass(this.classes.cursor),this._ensureVisible(n))},getSelectableData:function(n){return n&&n.length?f.extractData(n):null},getActiveSelectable:function(){var n=this._getSelectables().filter(this.selectors.cursor).first();return n.length?n:null},getTopSelectable:function(){var n=this._getSelectables().first();return n.length?n:null},update:function(n){function r(t){t.update(n)}var i=n!==this.query;return i&&(this.query=n,t.each(this.datasets,r)),i},empty:function(){function n(n){n.clear()}t.each(this.datasets,n);this.query=null;this.$node.addClass(this.classes.empty)},destroy:function(){function i(n){n.destroy()}this.$node.off(".tt");this.$node=n("<div>");t.each(this.datasets,i)}}),i}(),h=function(){"use strict";function i(i){this.$el=n("<span><\/span>",{role:"status","aria-live":"polite"}).css({position:"absolute",padding:"0",border:"0",height:"1px",width:"1px","margin-bottom":"-1px","margin-right":"-1px",overflow:"hidden",clip:"rect(0 0 0 0)","white-space":"nowrap"});i.$input.after(this.$el);t.each(i.menu.datasets,t.bind(function(n){if(n.onSync){n.onSync("rendered",t.bind(this.update,this));n.onSync("cleared",t.bind(this.cleared,this))}},this))}return t.mixin(i.prototype,{update:function(n,t){var r=t.length,i;i=r===1?{result:"result",is:"is"}:{result:"results",is:"are"};this.$el.text(r+" "+i.result+" "+i.is+" available, use up and down arrow keys to navigate.")},cleared:function(){this.$el.text("")}}),i}(),c=function(){"use strict";function r(){i.apply(this,[].slice.call(arguments,0))}var n=i.prototype;return t.mixin(r.prototype,i.prototype,{open:function(){return this._allDatasetsEmpty()||this._show(),n.open.apply(this,[].slice.call(arguments,0))},close:function(){return this._hide(),n.close.apply(this,[].slice.call(arguments,0))},_onRendered:function(){return this._allDatasetsEmpty()?this._hide():this.isOpen()&&this._show(),n._onRendered.apply(this,[].slice.call(arguments,0))},_onCleared:function(){return this._allDatasetsEmpty()?this._hide():this.isOpen()&&this._show(),n._onCleared.apply(this,[].slice.call(arguments,0))},setLanguageDirection:function(t){return this.$node.css(t==="ltr"?this.css.ltr:this.css.rtl),n.setLanguageDirection.apply(this,[].slice.call(arguments,0))},_hide:function(){this.$node.hide()},_show:function(){this.$node.css("display","block")}}),r}(),l=function(){"use strict";function r(r,u){var f,e,o,s,h,c,l,a,v,y,p;r=r||{};r.input||n.error("missing input");r.menu||n.error("missing menu");r.eventBus||n.error("missing event bus");u.mixin(this);this.eventBus=r.eventBus;this.minLength=t.isNumber(r.minLength)?r.minLength:1;this.input=r.input;this.menu=r.menu;this.enabled=!0;this.autoselect=!!r.autoselect;this.active=!1;this.input.hasFocus()&&this.activate();this.dir=this.input.getLangDir();this._hacks();this.menu.bind().onSync("selectableClicked",this._onSelectableClicked,this).onSync("asyncRequested",this._onAsyncRequested,this).onSync("asyncCanceled",this._onAsyncCanceled,this).onSync("asyncReceived",this._onAsyncReceived,this).onSync("datasetRendered",this._onDatasetRendered,this).onSync("datasetCleared",this._onDatasetCleared,this);f=i(this,"activate","open","_onFocused");e=i(this,"deactivate","_onBlurred");o=i(this,"isActive","isOpen","_onEnterKeyed");s=i(this,"isActive","isOpen","_onTabKeyed");h=i(this,"isActive","_onEscKeyed");c=i(this,"isActive","open","_onUpKeyed");l=i(this,"isActive","open","_onDownKeyed");a=i(this,"isActive","isOpen","_onLeftKeyed");v=i(this,"isActive","isOpen","_onRightKeyed");y=i(this,"_openIfActive","_onQueryChanged");p=i(this,"_openIfActive","_onWhitespaceChanged");this.input.bind().onSync("focused",f,this).onSync("blurred",e,this).onSync("enterKeyed",o,this).onSync("tabKeyed",s,this).onSync("escKeyed",h,this).onSync("upKeyed",c,this).onSync("downKeyed",l,this).onSync("leftKeyed",a,this).onSync("rightKeyed",v,this).onSync("queryChanged",y,this).onSync("whitespaceChanged",p,this).onSync("langDirChanged",this._onLangDirChanged,this)}function i(n){var i=[].slice.call(arguments,1);return function(){var r=[].slice.call(arguments);t.each(i,function(t){return n[t].apply(n,r)})}}return t.mixin(r.prototype,{_hacks:function(){var r,i;r=this.input.$input||n("<div>");i=this.menu.$node||n("<div>");r.on("blur.tt",function(n){var u,f,e;u=document.activeElement;f=i.is(u);e=i.has(u).length>0;t.isMsie()&&(f||e)&&(n.preventDefault(),n.stopImmediatePropagation(),t.defer(function(){r.focus()}))});i.on("mousedown.tt",function(n){n.preventDefault()})},_onSelectableClicked:function(n,t){this.select(t)},_onDatasetCleared:function(){this._updateHint()},_onDatasetRendered:function(n,t,i,r){if(this._updateHint(),this.autoselect){var u=this.selectors.cursor.substr(1);this.menu.$node.find(this.selectors.suggestion).first().addClass(u)}this.eventBus.trigger("render",t,i,r)},_onAsyncRequested:function(n,t,i){this.eventBus.trigger("asyncrequest",i,t)},_onAsyncCanceled:function(n,t,i){this.eventBus.trigger("asynccancel",i,t)},_onAsyncReceived:function(n,t,i){this.eventBus.trigger("asyncreceive",i,t)},_onFocused:function(){this._minLengthMet()&&this.menu.update(this.input.getQuery())},_onBlurred:function(){this.input.hasQueryChangedSinceLastFocus()&&this.eventBus.trigger("change",this.input.getQuery())},_onEnterKeyed:function(n,t){var i;(i=this.menu.getActiveSelectable())?this.select(i)&&(t.preventDefault(),t.stopPropagation()):this.autoselect&&this.select(this.menu.getTopSelectable())&&(t.preventDefault(),t.stopPropagation())},_onTabKeyed:function(n,t){var i;(i=this.menu.getActiveSelectable())?this.select(i)&&t.preventDefault():this.autoselect&&(i=this.menu.getTopSelectable())&&this.autocomplete(i)&&t.preventDefault()},_onEscKeyed:function(){this.close()},_onUpKeyed:function(){this.moveCursor(-1)},_onDownKeyed:function(){this.moveCursor(1)},_onLeftKeyed:function(){this.dir==="rtl"&&this.input.isCursorAtEnd()&&this.autocomplete(this.menu.getActiveSelectable()||this.menu.getTopSelectable())},_onRightKeyed:function(){this.dir==="ltr"&&this.input.isCursorAtEnd()&&this.autocomplete(this.menu.getActiveSelectable()||this.menu.getTopSelectable())},_onQueryChanged:function(n,t){this._minLengthMet(t)?this.menu.update(t):this.menu.empty()},_onWhitespaceChanged:function(){this._updateHint()},_onLangDirChanged:function(n,t){this.dir!==t&&(this.dir=t,this.menu.setLanguageDirection(t))},_openIfActive:function(){this.isActive()&&this.open()},_minLengthMet:function(n){return n=t.isString(n)?n:this.input.getQuery()||"",n.length>=this.minLength},_updateHint:function(){var f,i,n,e,o,s,r;f=this.menu.getTopSelectable();i=this.menu.getSelectableData(f);n=this.input.getInputValue();!i||t.isBlankString(n)||this.input.hasOverflow()?this.input.clearHint():(e=u.normalizeQuery(n),o=t.escapeRegExChars(e),s=new RegExp("^(?:"+o+")(.+$)","i"),r=s.exec(i.val),r&&this.input.setHint(n+r[1]))},isEnabled:function(){return this.enabled},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},isActive:function(){return this.active},activate:function(){return this.isActive()?!0:!this.isEnabled()||this.eventBus.before("active")?!1:(this.active=!0,this.eventBus.trigger("active"),!0)},deactivate:function(){return this.isActive()?this.eventBus.before("idle")?!1:(this.active=!1,this.close(),this.eventBus.trigger("idle"),!0):!0},isOpen:function(){return this.menu.isOpen()},open:function(){return this.isOpen()||this.eventBus.before("open")||(this.input.setAriaExpanded(!0),this.menu.open(),this._updateHint(),this.eventBus.trigger("open")),this.isOpen()},close:function(){return this.isOpen()&&!this.eventBus.before("close")&&(this.input.setAriaExpanded(!1),this.menu.close(),this.input.clearHint(),this.input.resetInputValue(),this.eventBus.trigger("close")),!this.isOpen()},setVal:function(n){this.input.setQuery(t.toStr(n))},getVal:function(){return this.input.getQuery()},select:function(n){var t=this.menu.getSelectableData(n);return t&&!this.eventBus.before("select",t.obj,t.dataset)?(this.input.setQuery(t.val,!0),this.eventBus.trigger("select",t.obj,t.dataset),this.close(),!0):!1},autocomplete:function(n){var i,t,r;return(i=this.input.getQuery(),t=this.menu.getSelectableData(n),r=t&&i!==t.val,r&&!this.eventBus.before("autocomplete",t.obj,t.dataset))?(this.input.setQuery(t.val),this.eventBus.trigger("autocomplete",t.obj,t.dataset),!0):!1},moveCursor:function(n){var f,i,t,r,u,e,o;return(f=this.input.getQuery(),i=this.menu.selectableRelativeToCursor(n),t=this.menu.getSelectableData(i),r=t?t.obj:null,u=t?t.dataset:null,o=i?i.attr("id"):null,this.input.trigger("cursorchange",o),e=this._minLengthMet()&&this.menu.update(f),!e&&!this.eventBus.before("cursorchange",r,u))?(this.menu.setCursor(i),t?typeof t.val=="string"&&this.input.setInputValue(t.val):(this.input.resetInputValue(),this._updateHint()),this.eventBus.trigger("cursorchange",r,u),!0):!1},destroy:function(){this.input.destroy();this.menu.destroy()}}),r}();(function(){"use strict";function r(t,i){t.each(function(){var t=n(this),r;(r=t.data(f.typeahead))&&i(r,t)})}function y(n,t){return n.clone().addClass(t.classes.hint).removeData().css(t.css.hint).css(w(n)).prop({readonly:!0,required:!1}).removeAttr("id name placeholder").removeClass("required").attr({spellcheck:"false",tabindex:-1})}function p(n,t){n.data(f.attrs,{dir:n.attr("dir"),autocomplete:n.attr("autocomplete"),spellcheck:n.attr("spellcheck"),style:n.attr("style")});n.addClass(t.classes.input).attr({spellcheck:!1});try{n.attr("dir")||n.attr("dir","auto")}catch(i){}return n}function w(n){return{backgroundAttachment:n.css("background-attachment"),backgroundClip:n.css("background-clip"),backgroundColor:n.css("background-color"),backgroundImage:n.css("background-image"),backgroundOrigin:n.css("background-origin"),backgroundPosition:n.css("background-position"),backgroundRepeat:n.css("background-repeat"),backgroundSize:n.css("background-size")}}function b(n){var r,i;r=n.data(f.www);i=n.parent().filter(r.selectors.wrapper);t.each(n.data(f.attrs),function(i,r){t.isUndefined(i)?n.removeAttr(r):n.attr(r,i)});n.removeData(f.typeahead).removeData(f.www).removeData(f.attr).removeClass(r.classes.input);i.length&&(n.detach().insertAfter(i),i.remove())}function v(i){var u,r;return u=t.isJQuery(i)||t.isElement(i),r=u?n(i).first():[],r.length?r:null}var a,f,s;a=n.fn.typeahead;f={www:"tt-www",attrs:"tt-attrs",typeahead:"tt-typeahead"};s={initialize:function(r,s){function w(){var e,g,w,b,k,d,tt,it,nt,ft,rt,ut;t.each(s,function(n){n.highlight=!!r.highlight});e=n(this);g=n(a.html.wrapper);w=v(r.hint);b=v(r.menu);k=r.hint!==!1&&!w;d=r.menu!==!1&&!b;k&&(w=y(e,a));d&&(b=n(a.html.menu).css(a.css.menu));w&&w.val("");e=p(e,a);(k||d)&&(g.css(a.css.wrapper),e.css(k?a.css.input:a.css.inputWithNoHint),e.wrap(g).parent().prepend(k?w:null).append(d?b:null));ut=d?c:i;tt=new o({el:e});it=new u({hint:w,input:e,menu:b},a);nt=new ut({node:b,datasets:s},a);ft=new h({$input:e,menu:nt});rt=new l({input:it,menu:nt,eventBus:tt,minLength:r.minLength,autoselect:r.autoselect},a);e.data(f.www,a);e.data(f.typeahead,rt)}var a;return s=t.isArray(s)?s:[].slice.call(arguments,1),r=r||{},a=e(r.classNames),this.each(w)},isEnabled:function(){var n;return r(this.first(),function(t){n=t.isEnabled()}),n},enable:function(){return r(this,function(n){n.enable()}),this},disable:function(){return r(this,function(n){n.disable()}),this},isActive:function(){var n;return r(this.first(),function(t){n=t.isActive()}),n},activate:function(){return r(this,function(n){n.activate()}),this},deactivate:function(){return r(this,function(n){n.deactivate()}),this},isOpen:function(){var n;return r(this.first(),function(t){n=t.isOpen()}),n},open:function(){return r(this,function(n){n.open()}),this},close:function(){return r(this,function(n){n.close()}),this},select:function(t){var i=!1,u=n(t);return r(this.first(),function(n){i=n.select(u)}),i},autocomplete:function(t){var i=!1,u=n(t);return r(this.first(),function(n){i=n.autocomplete(u)}),i},moveCursor:function(n){var t=!1;return r(this.first(),function(i){t=i.moveCursor(n)}),t},val:function(n){var i;return arguments.length?(r(this,function(i){i.setVal(t.toStr(n))}),this):(r(this.first(),function(n){i=n.getVal()}),i)},destroy:function(){return r(this,function(n,t){b(t);n.destroy()}),this}};n.fn.typeahead=function(n){return s[n]?s[n].apply(this,[].slice.call(arguments,1)):s.initialize.apply(this,arguments)};n.fn.typeahead.noConflict=function(){return n.fn.typeahead=a,this}})()});!function(n,t,i){"use strict";var r=function(n){return n.properties.osm_value},u=function(n){return function(t){var i=t.properties.name,r=n(t);return r&&(i+=", "+r),t.properties.city&&t.properties.city!==t.properties.name&&(i+=", "+t.properties.city),t.properties.country&&(i+=", "+t.properties.country),i}};n.PhotonAddressEngine=function(n){var f,c;n=n||{};var l=n.formatType||r,o=n.formatResult||u(l),s=n.url||"http://photon.komoot.de",h=n.limit||5,e={};return n.lat&&n.lon&&(e.lat=n.lat,e.lon=n.lon),n.lang&&(e.lang=n.lang),e.limit=h,f=new i({local:[],queryTokenizer:i.tokenizers.nonword,datumTokenizer:function(n){return i.tokenizers.obj.whitespace(["country","city","postcode","name","state"])(n.properties)},identify:function(n){return n.properties.osm_id},remote:{url:s+"/api/",sufficient:h,prepare:function(n,t){return t.data=e,t.data.q=n,t},transform:function(n){var t=this;return n.features.forEach(function(n){n.description=o(n)}),n.features||[]}}}),c=f.search,f.search=function(n,i,r){var u=jQuery.Deferred(),e=jQuery.Deferred();c.call(f,n,function(n){u.resolve(n)},function(n){e.resolve(n)});t.when(u,e).then(function(n,u){var e=[].concat(n,u);t(f).trigger("addresspicker:predictions",[e]);i(n);r(u)})},f.bindDefaultTypeaheadEvent=function(n){n.bind("typeahead:selected",function(n,i){t(f).trigger("addresspicker:selected",[i])})},f.reverseGeocode=function(n){t.get(s+"/reverse",{lat:n[0],lon:n[1]}).then(function(n){if(n.features){var i=n.features[0];i.description=o(i);t(f).trigger("addresspicker:selected",[i])}})},f}}(this,jQuery,Bloodhound);var rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i,rcheckableType=/^(?:checkbox|radio)$/i;jQuery.fn.extend({serializeAll:function(n){return jQuery.param(this.serializeAllArray(n))},serializeAllArray:function(n){var t=this;return n&&(t=t.find(n)),t.map(function(){var n=jQuery.prop(this,"elements");return n?jQuery.makeArray(n):this}).filter(function(){var n=this.type;return this.name&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(n)&&(this.checked||!rcheckableType.test(n))}).map(function(n,t){var i=jQuery(this).val();return i==null?null:Array.isArray(i)?jQuery.map(i,function(n){return{name:t.name,value:n.replace(rCRLF,"\r\n")}}):{name:t.name,value:i.replace(rCRLF,"\r\n")}}).get()},putCursorAtEnd:function(){return this.each(function(){var n=$(this),i=this,t;n.is(":focus")||n.focus();i.setSelectionRange?(t=n.val().length*2,setTimeout(function(){i.setSelectionRange(t,t)},1)):n.val(n.val());this.scrollTop=999999})}}),function(){function n(n){while(n.length>0)n.shift()();window.async=function(n,t){createAsyncFunction(n,t)}}$(document).ready(function(){window.async&&async.f&&async.f.length>0&&n(async.f)})}();Email=function(){function r(n,t,i){var u=[$("#ChosenLang").serializeAll()||"",i||""],r=appendStringParams($("#EmailPrivateData *").serializeAll()||"",u);r&&ajaxRequest(n,t,"POST",r,function(n){n.status==ajaxRequest.StatusType.Success&&n.replaces&&Email.initEmailBody()})}function f(n){if(!n)return"";var i=[],t;do t=parseInt(n.getAttribute("mailcontext")||0),!isNaN(t)&&t>0&&i.push(t);while(n=n.up(".EmailContext"));return i.join(",")}function e(){function n(n){var t;return n&&(t=n.up("#CustomizeSender")),t||(t=document.getElementById("CustomizeSender")),t}function t(){return document.getElementById("senderEmail")}function r(){t().appendChild(createHtmlElement("option",{value:"Customize",text:Translations.get(Translations.keys.Customize)}))}var i="|:|";return{change:function(t){var i=n(t).querySelector("#EditSenderEmail"),r=n(t).querySelector(".closeInput");t.selectedIndex>=parseInt(document.getElementById("FixedEmails").value)?(t.options[t.selectedIndex].value=="Customize"?(i.show(),setTimeout(function(){$(i).focus()},50)):i.hide(),n(t).show(),r.show()):n(t).hide()},addCookie:function(u,f){var s=t().options,h="",c,o,l,a,v,y=function(i){t().selectedIndex=i;n(u).hide();u.value=s[0].value},e;if(!u.value){y(0);return}for(c=t().length,e=0;e<c;e++)if(s[e]&&(o=s[e].value,o!=""&&o!="Customize")){if(u.value==o){y(e);return}h+=o+i}l=$(n(u)).find("*").serializeAll()||"";a=Requests.get(Requests.keys.Emails)+"="+encodeURIComponent(h);v=appendStringParams(l,a);ajaxRequest(u,f,"POST",v,function(n){var i,f;n.status==ajaxRequest.StatusType.Success&&(u.hide(),i=t(),f=i[i.selectedIndex],f.text=u.value,f.value=u.value,i.length<5&&r(),u.value=i.options[0].value)})},removeCookie:function(u,f){var c="",h=t(),e=h.options,l,s,a,v,y,p,o;for(h.removeChild(e[h.selectedIndex]),n(u).hide(),n(u).querySelector("#EditSenderEmail").value=e[0].value,l=e.length,o=0;o<l;o++)e[o]&&(s=e[o].value,s!=""&&s!="Customize"&&(c+=s+i));a=$(n(u)).find("*").serializeAll()||"";v=Requests.get(Requests.keys.Emails)+"="+encodeURIComponent(c);y=appendStringParams(a,v);ajaxRequest(u,f,"POST",y);e=t().options;e.length<5&&(p=e.findIndex(function(n){return n&&n.value==="Customize"}),p==-1&&r())},updateCookie:function(n){for(var f=t().options,e="",r,o,s,u=0;u<f.length;u++)f[u]&&(r=f[u].value,r!=""&&r!="Customize"&&(e+=r+i));o=[Requests.get(Requests.keys.Index)+"="+t().selectedIndex,Requests.get(Requests.keys.Emails)+"="+encodeURIComponent(e)];s=appendStringParams($("#FixedEmails").serializeAll(),o);ajaxRequest(null,n,"POST",s)}}}var t="",u=/^([a-zA-Zà-úÀ-Ú0-9_\-]+(\.[a-zA-Zà-úÀ-Ú0-9_\-]+)*)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Zà-úÀ-Ú0-9\-]+\.)+))([a-zA-Zà-úÀ-Ú0-9])+(\]?)$/,i=Object.freeze({OnEmailSent:"OnEmailSent"}),n=[];return{CallbackKeys:i,popup:function(n,i,r){ajaxRequest(n,i,"POST",r,function(n){if(n.status==ajaxRequest.StatusType.Success){var i=Popup.current();t=i.getAttribute("data-tinymce-upload-url");Email.initEmailBody();try{document.execCommand("AutoUrlDetect",!1,!1)}catch(r){}Search.EntityContact.alertExceedingLimit(Popup.current());i.querySelector(".RecipientBox").querySelector(".ContactBar").click()}})},popupBulk:function(n,t,i){var r=Search.GenericList.getSelectedIDs(!0);if(!r){MessageBox.alert(n.getAttribute("data-no-items-msg"));return}i=appendStringParams(i,Requests.get(Requests.keys.ObjectIDs)+"="+encodeURIComponent(r));Email.popup(n,t,i)},popupFromContext:function(n,t,i,r){var o=f(n),u,h,e,c,s;if(o&&(r=o+(r?","+r:""),u=i?i.split("&"):null,h=Requests.get(Requests.keys.EntityIDsTo),u)){for(c=!1,s=0;s<u.length;s++)if(e=u[s].split("="),e&&e.length==2&&e[0]===h){c=!0;u[s]=h+"="+(e[1]?e[1]+","+o:o);break}c?i=u.join("&"):i+=(i?"&":"")+(h+"="+o)}Email.popup(n,t,i)},popupTemplates:function(n,t,i,r,u,f){ManageConfig.EmailTemplates.popup(n,t,i,r,{popupOptions:new Popup.LayerOptions(function(){ManageConfig.EmailTemplates.storeTemplateCount()},null,null,function(){var n=$(f).serializeAll();n&&ajaxRequest(null,u,"POST",n)},function(){return!ManageConfig.EmailTemplates.changedTemplateCount()})})},popupSentEmail:function(n,t,i){ajaxRequest(n,t,"GET",i)},onTemplateChange:function(n,t){r(n,t,$("#EmailTemplates").serializeAll())},onLanguageChange:function(n,t){MessageBox.confirm(Translations.get(Translations.keys.EmailPopupLangChange),Translations.get(Translations.keys.OK),function(){r(n,t)},"",Translations.get(Translations.keys.Cancel),function(){var n=document.getElementById("ChosenLang");n.value=n.getAttribute("data-curr-val")})},isValid:function(n){return u.test(n)},send:function(t,r,u,f,e){Email.Sender.updateCookie(r);var o,s,h;u.querySelectorAll(".contactSearchDrop").forEach(function(n){n.innerHTML=""});TinyMceEditor.post(f);o=$(u.querySelector(".EmailParams")).find("*").serializeAll()||"";s=Media.serializeTarget(e,Requests.get(Requests.keys.Medias));h=appendStringParams(o,s);ajaxRequest(u,t,"POST",h,function(t){var r,f,e;t.status==ajaxRequest.StatusType.Success&&(r=n.findIndex(function(n){return n.CallerID===u.id&&n.Type===i.OnEmailSent}),r>-1&&(f=n[r],e=isObject(f)&&f.Callback?f.Callback:null,typeof e=="function"&&(e(),setTimeout(function(){n.splice(r,1)},50))))})},onWarningNoReceivers:function(){var n=Popup.current(),t=n?n.querySelector(".ContactBar"):null;t&&t.click()},initEmailBody:function(){TinyMceEditor.load("emailBody",300,t)},registerCallback:function(t,i,r){if(!t){console.error("Email.registerCallback: callerID invalido ou nao fornecido.");return}if(!i){console.error("Email.registerCallback: type invalido ou nao fornecido.");return}if(typeof r!="function"){console.error("Email.registerCallback: callback invalida ou nao fornecida.");return}var u=n.findIndex(function(n){return n.CallerID===t&&n.Type===i});u>-1&&n.splice(u,1);n.push({CallerID:t,Type:i,Callback:r})},Sender:e()}}(),function(n){var t=function(n){"use strict";return{hide:function(){return n.style.display="none",this},attach:function(i,r){return n.addEventListener?n.addEventListener(i,r,!1):n.attachEvent&&n.attachEvent("on"+i,r),function(){t(n).detach(i,r)}},detach:function(t,i){return n.removeEventListener?n.removeEventListener(t,i,!1):n.attachEvent&&n.detachEvent("on"+t,i),this},contains:function(t){return t?n===t?!0:n.contains?n.contains(t):!!(t.compareDocumentPosition(n)&8):!1},insertBefore:function(t){return t.parentNode.insertBefore(n,t),this},remove:function(){return n.parentNode.removeChild(n),this},css:function(i){if(n.style==null)throw new t.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");return i.opacity!=null&&typeof n.style.opacity!="string"&&typeof n.filters!="undefined"&&(i.filter="alpha(opacity="+Math.round(100*i.opacity)+")"),t.extend(n.style,i),this},hasClass:function(t,i){var r=new RegExp("(^| )"+t+"( |$)");return r.test(n.className)||!!(i&&r.test(n.parentNode.className))},addClass:function(i){return t(n).hasClass(i)||(n.className+=" "+i),this},removeClass:function(t){var i=new RegExp("(^| )"+t+"( |$)");return n.className=n.className.replace(i," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(i,r){var f,u=[];return r&&n.querySelector?n.querySelector("."+i):n.querySelectorAll?n.querySelectorAll("."+i):(f=n.getElementsByTagName("*"),t.each(f,function(n,r){t(r).hasClass(i)&&u.push(r)}),r?u[0]:u)},getFirstByClass:function(i){return t(n).getByClass(i,!0)},children:function(){for(var i=[],t=n.firstChild;t;)t.nodeType===1&&i.push(t),t=t.nextSibling;return i},setText:function(t){return n.innerText=t,n.textContent=t,this},clearText:function(){return t(n).setText("")},hasAttribute:function(t){var i;return n.hasAttribute?n.hasAttribute(t)?/^false$/i.exec(n.getAttribute(t))==null:!1:(i=n[t],i===undefined)?!1:/^false$/i.exec(i)==null}}};(function(){"use strict";t.canvasToBlob=function(n,i,r){return t.dataUriToBlob(n.toDataURL(i,r))};t.dataUriToBlob=function(n){var i,r,e=function(n,t){var r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=r&&new r;return i?(i.append(n),i.getBlob(t)):new Blob([n],{type:t})},u,f;return r=n.split(",")[0].indexOf("base64")>=0?atob(n.split(",")[1]):decodeURI(n.split(",")[1]),f=n.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(r.length),u=new Uint8Array(i),t.each(r,function(n,t){u[n]=t.charCodeAt(0)}),e(i,f)};t.log=function(n,t){window.console&&(t&&t!=="info"?window.console[t]?window.console[t](n):window.console.log("<"+t+"> "+n):window.console.log(n))};t.isObject=function(n){return n&&!n.nodeType&&Object.prototype.toString.call(n)==="[object Object]"};t.isFunction=function(n){return typeof n=="function"};t.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"||n&&window.ArrayBuffer&&n.buffer&&n.buffer.constructor===ArrayBuffer};t.isItemList=function(n){return Object.prototype.toString.call(n)==="[object DataTransferItemList]"};t.isNodeList=function(n){return Object.prototype.toString.call(n)==="[object NodeList]"||n.item&&n.namedItem};t.isString=function(n){return Object.prototype.toString.call(n)==="[object String]"};t.trimStr=function(n){return String.prototype.trim?n.trim():n.replace(/^\s+|\s+$/g,"")};t.format=function(n){var u=Array.prototype.slice.call(arguments,1),i=n,r=i.indexOf("{}");return t.each(u,function(n,t){var u=i.substring(0,r),f=i.substring(r+2);return i=u+t+f,r=i.indexOf("{}",r+t.length),r<0?!1:void 0}),i};t.isFile=function(n){return window.File&&Object.prototype.toString.call(n)==="[object File]"};t.isFileList=function(n){return window.FileList&&Object.prototype.toString.call(n)==="[object FileList]"};t.isFileOrInput=function(n){return t.isFile(n)||t.isInput(n)};t.isInput=function(n,t){var i=function(n){var i=n.toLowerCase();return t?i!=="file":i==="file"};return window.HTMLInputElement&&Object.prototype.toString.call(n)==="[object HTMLInputElement]"&&n.type&&i(n.type)?!0:n.tagName&&n.tagName.toLowerCase()==="input"&&n.type&&i(n.type)?!0:!1};t.isBlob=function(n){if(window.Blob&&Object.prototype.toString.call(n)==="[object Blob]")return!0};t.isXhrUploadSupported=function(){var n=document.createElement("input");return n.type="file",n.multiple!==undefined&&typeof File!="undefined"&&typeof FormData!="undefined"&&typeof t.createXhrInstance().upload!="undefined"};t.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(n){return t.log("Neither XHR or ActiveX are supported!","error"),null}};t.isFolderDropSupported=function(n){return n.items&&n.items.length>0&&n.items[0].webkitGetAsEntry};t.isFileChunkingSupported=function(){return!t.androidStock()&&t.isXhrUploadSupported()&&(File.prototype.slice!==undefined||File.prototype.webkitSlice!==undefined||File.prototype.mozSlice!==undefined)};t.sliceBlob=function(n,t,i){var r=n.slice||n.mozSlice||n.webkitSlice;return r.call(n,t,i)};t.arrayBufferToHex=function(n){var i="",r=new Uint8Array(n);return t.each(r,function(n,t){var r=t.toString(16);r.length<2&&(r="0"+r);i+=r}),i};t.readBlobToHex=function(n,i,r){var e=t.sliceBlob(n,i,i+r),u=new FileReader,f=new t.Promise;return u.onload=function(){f.success(t.arrayBufferToHex(u.result))},u.onerror=f.failure,u.readAsArrayBuffer(e),f};t.extend=function(n,i,r){return t.each(i,function(i,u){r&&t.isObject(u)?(n[i]===undefined&&(n[i]={}),t.extend(n[i],u,!0)):n[i]=u}),n};t.override=function(n,i){var r={},u=i(r);return t.each(u,function(t,i){n[t]!==undefined&&(r[t]=n[t]);n[t]=i}),n};t.indexOf=function(n,t,i){if(n.indexOf)return n.indexOf(t,i);i=i||0;var r=n.length;for(i<0&&(i+=r);i<r;i+=1)if(n.hasOwnProperty(i)&&n[i]===t)return i;return-1};t.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)})};t.ie=function(){return navigator.userAgent.indexOf("MSIE")!==-1||navigator.userAgent.indexOf("Trident")!==-1};t.ie7=function(){return navigator.userAgent.indexOf("MSIE 7")!==-1};t.ie8=function(){return navigator.userAgent.indexOf("MSIE 8")!==-1};t.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!==-1};t.ie11=function(){return t.ie()&&navigator.userAgent.indexOf("rv:11")!==-1};t.edge=function(){return navigator.userAgent.indexOf("Edge")>=0};t.safari=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Apple")!==-1};t.chrome=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Google")!==-1};t.opera=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Opera")!==-1};t.firefox=function(){return!t.edge()&&!t.ie11()&&navigator.userAgent.indexOf("Mozilla")!==-1&&navigator.vendor!==undefined&&navigator.vendor===""};t.windows=function(){return navigator.platform==="Win32"};t.android=function(){return navigator.userAgent.toLowerCase().indexOf("android")!==-1};t.androidStock=function(){return t.android()&&navigator.userAgent.toLowerCase().indexOf("chrome")<0};t.ios6=function(){return t.ios()&&navigator.userAgent.indexOf(" OS 6_")!==-1};t.ios7=function(){return t.ios()&&navigator.userAgent.indexOf(" OS 7_")!==-1};t.ios8=function(){return t.ios()&&navigator.userAgent.indexOf(" OS 8_")!==-1};t.ios800=function(){return t.ios()&&navigator.userAgent.indexOf(" OS 8_0 ")!==-1};t.ios=function(){return navigator.userAgent.indexOf("iPad")!==-1||navigator.userAgent.indexOf("iPod")!==-1||navigator.userAgent.indexOf("iPhone")!==-1};t.iosChrome=function(){return t.ios()&&navigator.userAgent.indexOf("CriOS")!==-1};t.iosSafari=function(){return t.ios()&&!t.iosChrome()&&navigator.userAgent.indexOf("Safari")!==-1};t.iosSafariWebView=function(){return t.ios()&&!t.iosChrome()&&!t.iosSafari()};t.preventDefault=function(n){n.preventDefault?n.preventDefault():n.returnValue=!1};t.toElement=function(){var n=document.createElement("div");return function(t){n.innerHTML=t;var i=n.firstChild;return n.removeChild(i),i}}();t.each=function(n,i){var r,u;if(n)if(window.Storage&&n.constructor===window.Storage){for(r=0;r<n.length;r++)if(u=i(n.key(r),n.getItem(n.key(r))),u===!1)break}else if(t.isArray(n)||t.isItemList(n)||t.isNodeList(n)){for(r=0;r<n.length;r++)if(u=i(r,n[r]),u===!1)break}else if(t.isString(n)){for(r=0;r<n.length;r++)if(u=i(r,n.charAt(r)),u===!1)break}else for(r in n)if(Object.prototype.hasOwnProperty.call(n,r)&&(u=i(r,n[r]),u===!1))break};t.bind=function(n,i){if(t.isFunction(n)){var r=Array.prototype.slice.call(arguments,2);return function(){var u=t.extend([],r);return arguments.length&&(u=u.concat(Array.prototype.slice.call(arguments))),n.apply(i,u)}}throw new Error("first parameter must be a function!");};t.obj2url=function(n,i,r){var u=[],f="&",e=function(n,r){var f=i?/\[\]$/.test(i)?i:i+"["+r+"]":r;f!=="undefined"&&r!=="undefined"&&u.push(typeof n=="object"?t.obj2url(n,f,!0):Object.prototype.toString.call(n)==="[object Function]"?encodeURIComponent(f)+"="+encodeURIComponent(n()):encodeURIComponent(f)+"="+encodeURIComponent(n))};return!r&&i?(f=/\?/.test(i)?/\?$/.test(i)?"":"&":"?",u.push(i),u.push(t.obj2url(n))):Object.prototype.toString.call(n)==="[object Array]"&&typeof n!="undefined"?t.each(n,function(n,t){e(t,n)}):typeof n!="undefined"&&n!==null&&typeof n=="object"?t.each(n,function(n,t){e(t,n)}):u.push(encodeURIComponent(i)+"="+encodeURIComponent(n)),i?u.join(f):u.join(f).replace(/^&/,"").replace(/%20/g,"+")};t.obj2FormData=function(n,i,r){return i||(i=new FormData),t.each(n,function(n,u){n=r?r+"["+n+"]":n;t.isObject(u)?t.obj2FormData(u,i,n):t.isFunction(u)?i.append(n,u()):i.append(n,u)}),i};t.obj2Inputs=function(n,i){var r;return i||(i=document.createElement("form")),t.obj2FormData(n,{append:function(n,t){r=document.createElement("input");r.setAttribute("name",n);r.setAttribute("value",t);i.appendChild(r)}}),i};t.parseJson=function(n){return window.JSON&&t.isFunction(JSON.parse)?JSON.parse(n):eval("("+n+")")};t.getExtension=function(n){var t=n.lastIndexOf(".")+1;if(t>0)return n.substr(t,n.length-t)};t.getFilename=function(n){return t.isInput(n)?n.value.replace(/.*(\/|\\)/,""):t.isFile(n)&&n.fileName!==null&&n.fileName!==undefined?n.fileName:n.name};t.DisposeSupport=function(){var n=[];return{dispose:function(){var t;do t=n.shift(),t&&t();while(t)},attach:function(){var n=arguments;this.addDisposer(t(n[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){n.push(t)}}}})(),function(){"use strict";typeof define=="function"&&define.amd?define(function(){return t}):typeof module!="undefined"&&module.exports?module.exports=t:n.qq=t}(),function(){"use strict";t.Error=function(n){this.message="[Fine Uploader "+t.version+"] "+n};t.Error.prototype=new Error}();t.version="5.16.0";t.supportedFeatures=function(){"use strict";function k(){var i=!0,n;try{n=document.createElement("input");n.type="file";t(n).hide();n.disabled&&(i=!1)}catch(r){i=!1}return i}function d(){return(t.chrome()||t.opera())&&navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)!==undefined}function w(){if(window.XMLHttpRequest){var n=t.createXhrInstance();return n.withCredentials!==undefined}return!1}function b(){return window.XDomainRequest!==undefined}function g(){return w()?!0:b()}function nt(){return document.createElement("input").webkitdirectory!==undefined}function tt(){try{return!!window.localStorage&&t.isFunction(window.localStorage.setItem)}catch(n){return!1}}function it(){var n=document.createElement("span");return("draggable"in n||"ondragstart"in n&&"ondrop"in n)&&!t.android()&&!t.ios()}var i,f,e,n,o,r,s,h,c,l,a,v,y,u,p;return i=k(),n=i&&t.isXhrUploadSupported(),f=n&&!t.androidStock(),e=n&&it(),o=e&&function(){var n=document.createElement("input");return n.type="file",!!("webkitdirectory"in(n||document.querySelectorAll("input[type=file]")[0]))}(),r=n&&t.isFileChunkingSupported(),s=n&&r&&tt(),h=n&&d(),c=i&&(window.postMessage!==undefined||n),a=w(),l=b(),v=g(),y=nt(),u=n&&window.FileReader!==undefined,p=function(){return n?!t.androidStock()&&!t.iosChrome():!1}(),{ajaxUploading:n,blobUploading:f,canDetermineSize:n,chunking:r,deleteFileCors:v,deleteFileCorsXdr:l,deleteFileCorsXhr:a,dialogElement:!!window.HTMLDialogElement,fileDrop:e,folderDrop:o,folderSelection:y,imagePreviews:u,imageValidation:u,itemSizeValidation:n,pause:r,progressBar:p,resume:s,scaling:u&&f,tiffPreviews:t.safari(),unlimitedScaledImageSize:!t.ios(),uploading:i,uploadCors:c,uploadCustomHeaders:n,uploadNonMultipart:n,uploadViaPaste:h}}();t.isGenericPromise=function(n){"use strict";return!!(n&&n.then&&t.isFunction(n.then))};t.Promise=function(){"use strict";var i,n,f=[],e=[],r=[],u=0;t.extend(this,{then:function(t,r){return u===0?(t&&f.push(t),r&&e.push(r)):u===-1?r&&r.apply(null,n):t&&t.apply(null,i),this},done:function(t){return u===0?r.push(t):t.apply(null,n===undefined?i:n),this},success:function(){return u=1,i=arguments,f.length&&t.each(f,function(n,t){t.apply(null,i)}),r.length&&t.each(r,function(n,t){t.apply(null,i)}),this},failure:function(){return u=-1,n=arguments,e.length&&t.each(e,function(t,i){i.apply(null,n)}),r.length&&t.each(r,function(t,i){i.apply(null,n)}),this}})};t.BlobProxy=function(n,i){"use strict";t.extend(this,{referenceBlob:n,create:function(){return i(n)}})};t.UploadButton=function(n){"use strict";function e(){var n=document.createElement("input");return n.setAttribute(t.UploadButton.BUTTON_ID_ATTR_NAME,f),n.setAttribute("title",i.title),o.setMultiple(i.multiple,n),i.folders&&t.supportedFeatures.folderSelection&&n.setAttribute("webkitdirectory",""),i.acceptFiles&&n.setAttribute("accept",i.acceptFiles),n.setAttribute("type","file"),n.setAttribute("name",i.name),t(n).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:t.ie()&&!t.ie8()?"3500px":"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),t.ie7()||t(n).css({height:"100%"}),i.element.appendChild(n),u.attach(n,"change",function(){i.onChange(n)}),u.attach(n,"mouseover",function(){t(i.element).addClass(i.hoverClass)}),u.attach(n,"mouseout",function(){t(i.element).removeClass(i.hoverClass)}),u.attach(n,"focus",function(){t(i.element).addClass(i.focusClass)}),u.attach(n,"blur",function(){t(i.element).removeClass(i.focusClass)}),n}var o=this,u=new t.DisposeSupport,i={acceptFiles:null,element:null,focusClass:"qq-upload-button-focus",folders:!1,hoverClass:"qq-upload-button-hover",ios8BrowserCrashWorkaround:!1,multiple:!1,name:"qqfile",onChange:function(){},title:null},r,f;t.extend(i,n);f=t.getUniqueId();t(i.element).css({position:"relative",overflow:"hidden",direction:"ltr"});t.extend(this,{getInput:function(){return r},getButtonId:function(){return f},setMultiple:function(n,r){var u=r||this.getInput();i.ios8BrowserCrashWorkaround&&t.ios8()&&(t.iosChrome()||t.iosSafariWebView())?u.setAttribute("multiple",""):n?u.setAttribute("multiple",""):u.removeAttribute("multiple")},setAcceptFiles:function(n){n!==i.acceptFiles&&r.setAttribute("accept",n)},reset:function(){r.parentNode&&t(r).remove();t(i.element).removeClass(i.focusClass);r=null;r=e()}});r=e()};t.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id";t.UploadData=function(n){"use strict";function o(n){if(t.isArray(n)){var r=[];return t.each(n,function(n,t){r.push(i[t])}),r}return i[n]}function s(n){if(t.isArray(n)){var r=[];return t.each(n,function(n,t){r.push(i[u[t]])}),r}return i[u[n]]}function h(n){var u=[],f=[].concat(n);return t.each(f,function(n,f){var e=r[f];e!==undefined&&t.each(e,function(n,t){u.push(i[t])})}),u}var i=[],u={},r={},e={},f={};t.extend(this,{addFile:function(o){var h=o.status||t.status.SUBMITTING,s=i.push({name:o.name,originalName:o.name,uuid:o.uuid,size:o.size==null?-1:o.size,status:h,file:o.file})-1;o.batchId&&(i[s].batchId=o.batchId,f[o.batchId]===undefined&&(f[o.batchId]=[]),f[o.batchId].push(s));o.proxyGroupId&&(i[s].proxyGroupId=o.proxyGroupId,e[o.proxyGroupId]===undefined&&(e[o.proxyGroupId]=[]),e[o.proxyGroupId].push(s));i[s].id=s;u[o.uuid]=s;r[h]===undefined&&(r[h]=[]);r[h].push(s);o.onBeforeStatusChange&&o.onBeforeStatusChange(s);n.onStatusChange(s,null,h);return s},retrieve:function(n){if(t.isObject(n)&&i.length){if(n.id!==undefined)return o(n.id);if(n.uuid!==undefined)return s(n.uuid);if(n.status)return h(n.status)}else return t.extend([],i,!0)},removeFileRef:function(n){var t=o(n);t&&delete t.file},reset:function(){i=[];u={};r={};f={}},setStatus:function(u,f){var e=i[u].status,o=t.indexOf(r[e],u);r[e].splice(o,1);i[u].status=f;r[f]===undefined&&(r[f]=[]);r[f].push(u);n.onStatusChange(u,e,f)},uuidChanged:function(n,t){var r=i[n].uuid;i[n].uuid=t;u[t]=n;delete u[r]},updateName:function(n,t){i[n].name=t},updateSize:function(n,t){i[n].size=t},setParentId:function(n,t){i[n].parentId=t},getIdsInProxyGroup:function(n){var t=i[n].proxyGroupId;return t?e[t]:[]},getIdsInBatch:function(n){var t=i[n].batchId;return f[t]}})};t.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_FINALIZING:"upload finalizing",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"},function(){"use strict";t.basePublicApi={addBlobs:function(n,t,i){this.addFiles(n,t,i)},addInitialFiles:function(n){var i=this;t.each(n,function(n,t){i._addCannedFile(t)})},addFiles:function(n,i,r){this._maybeHandleIos8SafariWorkaround();var f=this._storedIds.length===0?t.getUniqueId():this._currentBatchId,e=t.bind(function(n){this._handleNewFile({blob:n,name:this._options.blobs.defaultName},f,u)},this),o=t.bind(function(n){this._handleNewFile(n,f,u)},this),s=t.bind(function(n){var i=t.canvasToBlob(n);this._handleNewFile({blob:i,name:this._options.blobs.defaultName+".png"},f,u)},this),h=t.bind(function(n){var i=n.quality&&n.quality/100,r=t.canvasToBlob(n.canvas,n.type,i);this._handleNewFile({blob:r,name:n.name},f,u)},this),c=t.bind(function(n){if(t.isInput(n)&&t.supportedFeatures.ajaxUploading){var i=Array.prototype.slice.call(n.files),r=this;t.each(i,function(n,t){r._handleNewFile(t,f,u)})}else this._handleNewFile(n,f,u)},this),l=function(){t.isFileList(n)&&(n=Array.prototype.slice.call(n));n=[].concat(n)},a=this,u=[];this._currentBatchId=f;n&&(l(),t.each(n,function(n,i){t.isFileOrInput(i)?c(i):t.isBlob(i)?e(i):t.isObject(i)?i.blob&&i.name?o(i):i.canvas&&i.name&&h(i):i.tagName&&i.tagName.toLowerCase()==="canvas"?s(i):a.log(i+" is not a valid file container!  Ignoring!","warn")}),this.log("Received "+u.length+" files."),this._prepareItemsForUpload(u,i,r))},cancel:function(n){var i=this._uploadData.retrieve({id:n});i&&i.status===t.status.UPLOAD_FINALIZING?this.log(t.format("Ignoring cancel for file ID {} ({}).  Finalizing upload.",n,this.getName(n)),"error"):this._handler.cancel(n)},cancelAll:function(){var n=[],i=this;t.extend(n,this._storedIds);t.each(n,function(n,t){i.cancel(t)});this._handler.cancelAll()},clearStoredFiles:function(){this._storedIds=[]},continueUpload:function(n){var i=this._uploadData.retrieve({id:n});return!t.supportedFeatures.pause||!this._options.chunking.enabled?!1:i.status===t.status.PAUSED?(this.log(t.format("Paused file ID {} ({}) will be continued.  Not paused.",n,this.getName(n))),this._uploadFile(n),!0):(this.log(t.format("Ignoring continue for file ID {} ({}).  Not paused.",n,this.getName(n)),"error"),!1)},deleteFile:function(n){return this._onSubmitDelete(n)},doesExist:function(n){return this._handler.isValid(n)},drawThumbnail:function(n,i,r,u,f){var e=new t.Promise,o,s;return this._imageGenerator?(o=this._thumbnailUrls[n],s={customResizeFunction:f,maxSize:r>0?r:null,scale:r>0},!u&&t.supportedFeatures.imagePreviews&&(o=this.getFile(n)),o==null?e.failure({container:i,error:"File or URL not found."}):this._imageGenerator.generate(o,i,s).then(function(n){e.success(n)},function(n,t){e.failure({container:n,error:t||"Problem generating thumbnail"})})):e.failure({container:i,error:"Missing image generator module"}),e},getButton:function(n){return this._getButton(this._buttonIdsForFileIds[n])},getEndpoint:function(n){return this._endpointStore.get(n)},getFile:function(n){var t=this._handler.getFile(n),i;return t||(i=this._uploadData.retrieve({id:n}),i&&(t=i.file)),t||null},getInProgress:function(){return this._uploadData.retrieve({status:[t.status.UPLOADING,t.status.UPLOAD_RETRYING,t.status.QUEUED]}).length},getName:function(n){return this._uploadData.retrieve({id:n}).name},getParentId:function(n){var t=this.getUploads({id:n}),i=null;return t&&t.parentId!==undefined&&(i=t.parentId),i},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(n){return this._uploadData.retrieve({id:n}).size},getNetUploads:function(){return this._netUploaded},getRemainingAllowedItems:function(){var n=this._currentItemLimit;return n>0?n-this._netUploadedOrQueued:null},getUploads:function(n){return this._uploadData.retrieve(n)},getUuid:function(n){return this._uploadData.retrieve({id:n}).uuid},isResumable:function(n){return this._handler.hasResumeRecord(n)},log:function(n,i){this._options.debug&&(!i||i==="info")?t.log("[Fine Uploader "+t.version+"] "+n):i&&i!=="info"&&t.log("[Fine Uploader "+t.version+"] "+n,i)},pauseUpload:function(n){var i=this._uploadData.retrieve({id:n});if(!t.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(t.indexOf([t.status.UPLOADING,t.status.UPLOAD_RETRYING],i.status)>=0){if(this._handler.pause(n))return this._uploadData.setStatus(n,t.status.PAUSED),!0;this.log(t.format("Unable to pause file ID {} ({}).",n,this.getName(n)),"error")}else this.log(t.format("Ignoring pause for file ID {} ({}).  Not in progress.",n,this.getName(n)),"error");return!1},removeFileRef:function(n){this._handler.expunge(n);this._uploadData.removeFileRef(n)},reset:function(){this.log("Resetting uploader...");this._handler.reset();this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._thumbnailUrls=[];t.each(this._buttons,function(n,t){t.reset()});this._paramsStore.reset();this._endpointStore.reset();this._netUploadedOrQueued=0;this._netUploaded=0;this._uploadData.reset();this._buttonIdsForFileIds=[];this._pasteHandler&&this._pasteHandler.reset();this._options.session.refreshOnReset&&this._refreshSessionData();this._succeededSinceLastAllComplete=[];this._failedSinceLastAllComplete=[];this._totalProgress&&this._totalProgress.reset();this._customResumeDataStore.reset()},retry:function(n){return this._manualRetry(n)},scaleImage:function(n,i){var r=this;return t.Scaler.prototype.scaleImage(n,i,{log:t.bind(r.log,r),getFile:t.bind(r.getFile,r),uploadData:r._uploadData})},setCustomHeaders:function(n,t){this._customHeadersStore.set(n,t)},setCustomResumeData:function(n,t){this._customResumeDataStore.set(t,n)},setDeleteFileCustomHeaders:function(n,t){this._deleteFileCustomHeadersStore.set(n,t)},setDeleteFileEndpoint:function(n,t){this._deleteFileEndpointStore.set(n,t)},setDeleteFileParams:function(n,t){this._deleteFileParamsStore.set(n,t)},setEndpoint:function(n,t){this._endpointStore.set(n,t)},setForm:function(n){this._updateFormSupportAndParams(n)},setItemLimit:function(n){this._currentItemLimit=n},setName:function(n,t){this._uploadData.updateName(n,t)},setParams:function(n,t){this._paramsStore.set(n,t)},setUuid:function(n,t){return this._uploadData.uuidChanged(n,t)},setStatus:function(n,i){var u=this.getUploads({id:n}),r;if(!u)throw new t.Error(n+" is not a valid file ID.");switch(i){case t.status.DELETED:this._onDeleteComplete(n,null,!1);break;case t.status.DELETE_FAILED:this._onDeleteComplete(n,null,!0);break;default:r="Method setStatus called on '"+name+"' not implemented yet for "+i;this.log(r);throw new t.Error(r);}},uploadStoredFiles:function(){this._storedIds.length===0?this._itemError("noFilesError"):this._uploadStoredFiles()}};t.basePrivateApi={_addCannedFile:function(n){var i=this;return this._uploadData.addFile({uuid:n.uuid,name:n.name,size:n.size,status:t.status.UPLOAD_SUCCESSFUL,onBeforeStatusChange:function(t){n.deleteFileEndpoint&&i.setDeleteFileEndpoint(n.deleteFileEndpoint,t);n.deleteFileParams&&i.setDeleteFileParams(n.deleteFileParams,t);n.thumbnailUrl&&(i._thumbnailUrls[t]=n.thumbnailUrl);i._netUploaded++;i._netUploadedOrQueued++}})},_annotateWithButtonId:function(n,i){t.isFile(n)&&(n.qqButtonId=this._getButtonId(i))},_batchError:function(n){this._options.callbacks.onError(null,null,n,undefined)},_createDeleteHandler:function(){var n=this;return new t.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._deleteFileCustomHeadersStore,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,cors:this._options.cors,log:t.bind(n.log,n),onDelete:function(t){n._onDelete(t);n._options.callbacks.onDelete(t)},onDeleteComplete:function(t,i,r){n._onDeleteComplete(t,i,r);n._options.callbacks.onDeleteComplete(t,i,r)}})},_createPasteHandler:function(){var n=this;return new t.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:t.bind(n.log,n),pasteReceived:function(i){n._handleCheckedCallback({name:"onPasteReceived",callback:t.bind(n._options.callbacks.onPasteReceived,n,i),onSuccess:t.bind(n._handlePasteSuccess,n,i),identifier:"pasted image"})}}})},_createStore:function(n,i){var u={},o=n,f={},r=i,e=function(n){return t.isObject(n)?t.extend({},n):n},s=function(){return t.isFunction(r)?r():r},h=function(n,i){r&&t.isObject(i)&&t.extend(i,s());f[n]&&t.extend(i,f[n])};return{set:function(n,t){t==null?(u={},o=e(n)):u[t]=e(n)},get:function(n){var t;return t=n!=null&&u[n]?u[n]:e(o),h(n,t),e(t)},addReadOnly:function(n,i){t.isObject(u)&&(n===null?t.isFunction(i)?r=i:(r=r||{},t.extend(r,i)):(f[n]=f[n]||{},t.extend(f[n],i)))},remove:function(n){return delete u[n]},reset:function(){u={};f={};o=n}}},_createUploadDataTracker:function(){var n=this;return new t.UploadData({getName:function(t){return n.getName(t)},getUuid:function(t){return n.getUuid(t)},getSize:function(t){return n.getSize(t)},onStatusChange:function(t,i,r){n._onUploadStatusChange(t,i,r);n._options.callbacks.onStatusChange(t,i,r);n._maybeAllComplete(t,r);n._totalProgress&&setTimeout(function(){n._totalProgress.onStatusChange(t,i,r)},0)}})},_createUploadButton:function(n){function e(){return t.supportedFeatures.ajaxUploading?i._options.workarounds.iosEmptyVideos&&t.ios()&&!t.ios6()&&i._isAllowedExtension(f,".mov")?!1:n.multiple===undefined?i._options.multiple:n.multiple:!1}var i=this,u=n.accept||this._options.validation.acceptFiles,f=n.allowedExtensions||this._options.validation.allowedExtensions,r;return r=new t.UploadButton({acceptFiles:u,element:n.element,focusClass:this._options.classes.buttonFocus,folders:n.folders,hoverClass:this._options.classes.buttonHover,ios8BrowserCrashWorkaround:this._options.workarounds.ios8BrowserCrash,multiple:e(),name:this._options.request.inputName,onChange:function(n){i._onInputChange(n)},title:n.title==null?this._options.text.fileInputTitle:n.title}),this._disposeSupport.addDisposer(function(){r.dispose()}),i._buttons.push(r),r},_createUploadHandler:function(n,i){var r=this,u={},f={debug:this._options.debug,maxConnections:this._options.maxConnections,cors:this._options.cors,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:t.bind(r.log,r),preventRetryParam:this._options.retry.preventRetryResponseProperty,onProgress:function(n,t,i,f){if(!(i<0)&&!(f<0)){if(u[n]){if(u[n].loaded!==i||u[n].total!==f){r._onProgress(n,t,i,f);r._options.callbacks.onProgress(n,t,i,f)}}else{r._onProgress(n,t,i,f);r._options.callbacks.onProgress(n,t,i,f)}u[n]={loaded:i,total:f}}},onComplete:function(n,i,f,e){delete u[n];var s=r.getUploads({id:n}).status,o;if(s!==t.status.UPLOAD_SUCCESSFUL&&s!==t.status.UPLOAD_FAILED)if(o=r._onComplete(n,i,f,e),o instanceof t.Promise)o.done(function(){r._options.callbacks.onComplete(n,i,f,e)});else r._options.callbacks.onComplete(n,i,f,e)},onCancel:function(n,i,u){var f=new t.Promise;return r._handleCheckedCallback({name:"onCancel",callback:t.bind(r._options.callbacks.onCancel,r,n,i),onFailure:f.failure,onSuccess:function(){u.then(function(){r._onCancel(n,i)});f.success()},identifier:n}),f},onUploadPrep:t.bind(this._onUploadPrep,this),onUpload:function(n,i){r._onUpload(n,i);var u=r._options.callbacks.onUpload(n,i);return t.isGenericPromise(u)?(r.log(t.format("onUpload for {} returned a Promise - waiting for resolution.",n)),u):(new t.Promise).success()},onUploadChunk:function(n,i,u){r._onUploadChunk(n,u);var f=r._options.callbacks.onUploadChunk(n,i,u);return t.isGenericPromise(f)?(r.log(t.format("onUploadChunk for {}.{} returned a Promise - waiting for resolution.",n,u.partIndex)),f):(new t.Promise).success()},onUploadChunkSuccess:function(n,t){r._onUploadChunkSuccess(n,t);r._options.callbacks.onUploadChunkSuccess.apply(r,arguments)},onResume:function(n,t,i,u){return r._options.callbacks.onResume(n,t,i,u)},onAutoRetry:function(){return r._onAutoRetry.apply(r,arguments)},onUuidChanged:function(n,t){r.log("Server requested UUID change from '"+r.getUuid(n)+"' to '"+t+"'");r.setUuid(n,t)},getName:t.bind(r.getName,r),getUuid:t.bind(r.getUuid,r),getSize:t.bind(r.getSize,r),setSize:t.bind(r._setSize,r),getDataByUuid:function(n){return r.getUploads({uuid:n})},isQueued:function(n){var i=r.getUploads({id:n}).status;return i===t.status.QUEUED||i===t.status.SUBMITTED||i===t.status.UPLOAD_RETRYING||i===t.status.PAUSED},getIdsInProxyGroup:r._uploadData.getIdsInProxyGroup,getIdsInBatch:r._uploadData.getIdsInBatch,isInProgress:function(n){return r.getUploads({id:n}).status===t.status.UPLOADING},getCustomResumeData:t.bind(r._getCustomResumeData,r),setStatus:function(n,t){r._uploadData.setStatus(n,t)}};return t.each(this._options.request,function(n,t){f[n]=t}),f.customHeaders=this._customHeadersStore,n&&t.each(n,function(n,t){f[n]=t}),new t.UploadHandlerController(f,i)},_fileOrBlobRejected:function(n){this._netUploadedOrQueued--;this._uploadData.setStatus(n,t.status.REJECTED)},_formatSize:function(n){if(n===0)return n+this._options.text.sizeSymbols[0];var t=-1;do n=n/1e3,t++;while(n>999);return Math.max(n,.1).toFixed(1)+this._options.text.sizeSymbols[t]},_generateExtraButtonSpecs:function(){var n=this;this._extraButtonSpecs={};t.each(this._options.extraButtons,function(i,r){var u=r.multiple,e=t.extend({},n._options.validation,!0),f=t.extend({},r);u===undefined&&(u=n._options.multiple);f.validation&&t.extend(e,r.validation,!0);t.extend(f,{multiple:u,validation:e},!0);n._initExtraButton(f)})},_getButton:function(n){var t=this._extraButtonSpecs[n];return t?t.element:n===this._defaultButtonId?this._options.button:void 0},_getButtonId:function(n){var u,r,i=n;if(i instanceof t.BlobProxy&&(i=i.referenceBlob),i&&!t.isBlob(i)){if(t.isFile(i))return i.qqButtonId;if(i.tagName.toLowerCase()==="input"&&i.type.toLowerCase()==="file")return i.getAttribute(t.UploadButton.BUTTON_ID_ATTR_NAME);if(u=i.getElementsByTagName("input"),t.each(u,function(n,t){if(t.getAttribute("type")==="file")return r=t,!1}),r)return r.getAttribute(t.UploadButton.BUTTON_ID_ATTR_NAME)}},_getCustomResumeData:function(n){return this._customResumeDataStore.get(n)},_getNotFinished:function(){return this._uploadData.retrieve({status:[t.status.UPLOADING,t.status.UPLOAD_RETRYING,t.status.QUEUED,t.status.SUBMITTING,t.status.SUBMITTED,t.status.PAUSED]}).length},_getValidationBase:function(n){var t=this._extraButtonSpecs[n];return t?t.validation:this._options.validation},_getValidationDescriptor:function(n){return n.file instanceof t.BlobProxy?{name:t.getFilename(n.file.referenceBlob),size:n.file.referenceBlob.size}:{name:this.getUploads({id:n.id}).name,size:this.getUploads({id:n.id}).size}},_getValidationDescriptors:function(n){var r=this,i=[];return t.each(n,function(n,t){i.push(r._getValidationDescriptor(t))}),i},_handleCameraAccess:function(){if(this._options.camera.ios&&t.ios()){var r="image/*;capture=camera",u=this._options.camera.button,i=u?this._getButtonId(u):this._defaultButtonId,n=this._options;i&&i!==this._defaultButtonId&&(n=this._extraButtonSpecs[i]);n.multiple=!1;n.validation.acceptFiles===null?n.validation.acceptFiles=r:n.validation.acceptFiles+=","+r;t.each(this._buttons,function(t,r){if(r.getButtonId()===i)return r.setMultiple(n.multiple),r.setAcceptFiles(n.acceptFiles),!1})}},_handleCheckedCallback:function(n){var r=this,i=n.callback();if(t.isGenericPromise(i))return this.log(n.name+" - waiting for "+n.name+" promise to be fulfilled for "+n.identifier),i.then(function(t){r.log(n.name+" promise success for "+n.identifier);n.onSuccess(t)},function(){n.onFailure?(r.log(n.name+" promise failure for "+n.identifier),n.onFailure()):r.log(n.name+" promise failure for "+n.identifier)});if(i!==!1)n.onSuccess(i);else n.onFailure?(this.log(n.name+" - return value was 'false' for "+n.identifier+".  Invoking failure callback."),n.onFailure()):this.log(n.name+" - return value was 'false' for "+n.identifier+".  Will not proceed.");return i},_handleNewFile:function(n,i,r){var u=this,o=t.getUniqueId(),e=-1,s=t.getFilename(n),f=n.blob||n,h=this._customNewFileHandler?this._customNewFileHandler:t.bind(u._handleNewFileGeneric,u);!t.isInput(f)&&f.size>=0&&(e=f.size);h(f,s,o,e,r,i,this._options.request.uuidName,{uploadData:u._uploadData,paramsStore:u._paramsStore,addFileToHandler:function(n,t){u._handler.add(n,t);u._netUploadedOrQueued++;u._trackButton(n)}})},_handleNewFileGeneric:function(n,t,i,r,u,f){var e=this._uploadData.addFile({uuid:i,name:t,size:r,batchId:f,file:n});this._handler.add(e,n);this._trackButton(e);this._netUploadedOrQueued++;u.push({id:e,file:n})},_handlePasteSuccess:function(n,t){var r=n.type.split("/")[1],i=t;i==null&&(i=this._options.paste.defaultName);i+="."+r;this.addFiles({name:i,blob:n})},_handleDeleteSuccess:function(n){if(this.getUploads({id:n}).status!==t.status.DELETED){var i=this.getName(n);this._netUploadedOrQueued--;this._netUploaded--;this._handler.expunge(n);this._uploadData.setStatus(n,t.status.DELETED);this.log("Delete request for '"+i+"' has succeeded.")}},_handleDeleteFailed:function(n,i){var r=this.getName(n);if(this._uploadData.setStatus(n,t.status.DELETE_FAILED),this.log("Delete request for '"+r+"' has failed.","error"),i&&i.withCredentials!==undefined)this._options.callbacks.onError(n,r,"Delete request failed with response code "+i.status,i);else this._options.callbacks.onError(n,r,"Delete request failed",i)},_initExtraButton:function(n){var t=this._createUploadButton({accept:n.validation.acceptFiles,allowedExtensions:n.validation.allowedExtensions,element:n.element,folders:n.folders,multiple:n.multiple,title:n.fileInputTitle});this._extraButtonSpecs[t.getButtonId()]=n},_initFormSupportAndParams:function(){this._formSupport=t.FormSupport&&new t.FormSupport(this._options.form,t.bind(this.uploadStoredFiles,this),t.bind(this.log,this));this._formSupport&&this._formSupport.attachedToForm?(this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&(this._options.request.endpoint=this._formSupport.newEndpoint)):this._paramsStore=this._createStore(this._options.request.params)},_isDeletePossible:function(){return!t.DeleteFileAjaxRequester||!this._options.deleteFile.enabled?!1:this._options.cors.expected?t.supportedFeatures.deleteFileCorsXhr?!0:t.supportedFeatures.deleteFileCorsXdr&&this._options.cors.allowXdr?!0:!1:!0},_isAllowedExtension:function(n,i){var r=!1;return n.length?(t.each(n,function(n,u){if(t.isString(u)){var f=new RegExp("\\."+u+"$","i");if(i.match(f)!=null)return r=!0,!1}}),r):!0},_itemError:function(n,i,r){function f(n,t){u=u.replace(n,t)}var u=this._options.messages[n],s=[],h=[].concat(i),c=h[0],a=this._getButtonId(r),e=this._getValidationBase(a),l,o;t.each(e.allowedExtensions,function(n,i){t.isString(i)&&s.push(i)});l=s.join(", ").toLowerCase();f("{file}",this._options.formatFileName(c));f("{extensions}",l);f("{sizeLimit}",this._formatSize(e.sizeLimit));f("{minSizeLimit}",this._formatSize(e.minSizeLimit));o=u.match(/(\{\w+\})/g);o!==null&&t.each(o,function(n,t){f(t,h[n])});this._options.callbacks.onError(null,c,u,undefined);return u},_manualRetry:function(n,i){if(this._onBeforeManualRetry(n))return this._netUploadedOrQueued++,this._uploadData.setStatus(n,t.status.UPLOAD_RETRYING),i?i(n):this._handler.retry(n),!0},_maybeAllComplete:function(n,i){var r=this,u=this._getNotFinished();i===t.status.UPLOAD_SUCCESSFUL?this._succeededSinceLastAllComplete.push(n):i===t.status.UPLOAD_FAILED&&this._failedSinceLastAllComplete.push(n);u===0&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)&&setTimeout(function(){r._onAllComplete(r._succeededSinceLastAllComplete,r._failedSinceLastAllComplete)},0)},_maybeHandleIos8SafariWorkaround:function(){var n=this;if(this._options.workarounds.ios8SafariUploads&&t.ios800()&&t.iosSafari()){setTimeout(function(){window.alert(n._options.messages.unsupportedBrowserIos8Safari)},0);throw new t.Error(this._options.messages.unsupportedBrowserIos8Safari);}},_maybeParseAndSendUploadError:function(n,t,i,r){if(!i.success)if(r&&r.status!==200&&!i.error)this._options.callbacks.onError(n,t,"XHR returned response code "+r.status,r);else{var u=i.error?i.error:this._options.text.defaultResponseError;this._options.callbacks.onError(n,t,u,r)}},_maybeProcessNextItemAfterOnValidateCallback:function(n,i,r,u,f){var e=this;if(i.length>r)if(n||!this._options.validation.stopOnFirstInvalidFile)setTimeout(function(){var n=e._getValidationDescriptor(i[r]),o=e._getButtonId(i[r].file),s=e._getButton(o);e._handleCheckedCallback({name:"onValidate",callback:t.bind(e._options.callbacks.onValidate,e,n,s),onSuccess:t.bind(e._onValidateCallbackSuccess,e,i,r,u,f),onFailure:t.bind(e._onValidateCallbackFailure,e,i,r,u,f),identifier:"Item '"+n.name+"', size: "+n.size})},0);else if(!n)for(;r<i.length;r++)e._fileOrBlobRejected(i[r].id)},_onAllComplete:function(n,i){this._totalProgress&&this._totalProgress.onAllComplete(n,i,this._preventRetries);this._options.callbacks.onAllComplete(t.extend([],n),t.extend([],i));this._succeededSinceLastAllComplete=[];this._failedSinceLastAllComplete=[]},_onAutoRetry:function(n,i,r,u,f){var e=this,o;if(e._preventRetries[n]=r[e._options.retry.preventRetryResponseProperty],e._shouldAutoRetry(n)){o=e._options.retry.autoAttemptDelay*1e3;e._maybeParseAndSendUploadError.apply(e,arguments);e._options.callbacks.onAutoRetry(n,i,e._autoRetries[n]);return e._onBeforeAutoRetry(n,i),e._uploadData.setStatus(n,t.status.UPLOAD_RETRYING),e._retryTimeouts[n]=setTimeout(function(){e.log("Starting retry for "+i+"...");f?f(n):e._handler.retry(n)},o),!0}},_onBeforeAutoRetry:function(n,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onBeforeManualRetry:function(n){var i=this._currentItemLimit,t;return this._preventRetries[n]?(this.log("Retries are forbidden for id "+n,"warn"),!1):this._handler.isValid(n)?(t=this.getName(n),this._options.callbacks.onManualRetry(n,t)===!1)?!1:i>0&&this._netUploadedOrQueued+1>i?(this._itemError("retryFailTooManyItems"),!1):(this.log("Retrying upload for '"+t+"' (id: "+n+")..."),!0):(this.log("'"+n+"' is not a valid file ID","error"),!1)},_onCancel:function(n){this._netUploadedOrQueued--;clearTimeout(this._retryTimeouts[n]);var i=t.indexOf(this._storedIds,n);!this._options.autoUpload&&i>=0&&this._storedIds.splice(i,1);this._uploadData.setStatus(n,t.status.CANCELED)},_onComplete:function(n,i,r,u){return r.success?(r.thumbnailUrl&&(this._thumbnailUrls[n]=r.thumbnailUrl),this._netUploaded++,this._uploadData.setStatus(n,t.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(n,t.status.UPLOAD_FAILED),r[this._options.retry.preventRetryResponseProperty]===!0&&(this._preventRetries[n]=!0)),this._maybeParseAndSendUploadError(n,i,r,u),r.success?!0:!1},_onDelete:function(n){this._uploadData.setStatus(n,t.status.DELETING)},_onDeleteComplete:function(n,t,i){var r=this.getName(n);i?this._handleDeleteFailed(n,t):this._handleDeleteSuccess(n)},_onInputChange:function(n){var i;if(t.supportedFeatures.ajaxUploading){for(i=0;i<n.files.length;i++)this._annotateWithButtonId(n.files[i],n);this.addFiles(n.files)}else n.value.length>0&&this.addFiles(n);t.each(this._buttons,function(n,t){t.reset()})},_onProgress:function(n,t,i,r){this._totalProgress&&this._totalProgress.onIndividualProgress(n,i,r)},_onSubmit:function(){},_onSubmitCallbackSuccess:function(n){this._onSubmit.apply(this,arguments);this._uploadData.setStatus(n,t.status.SUBMITTED);this._onSubmitted.apply(this,arguments);this._options.autoUpload?(this._options.callbacks.onSubmitted.apply(this,arguments),this._uploadFile(n)):(this._storeForLater(n),this._options.callbacks.onSubmitted.apply(this,arguments))},_onSubmitDelete:function(n,i,r){var u=this.getUuid(n),f;return i&&(f=t.bind(i,this,n,u,r)),this._isDeletePossible()?(this._handleCheckedCallback({name:"onSubmitDelete",callback:t.bind(this._options.callbacks.onSubmitDelete,this,n),onSuccess:f||t.bind(this._deleteHandler.sendDelete,this,n,u,r),identifier:n}),!0):(this.log("Delete request ignored for ID "+n+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn"),!1)},_onSubmitted:function(){},_onTotalProgress:function(n,t){this._options.callbacks.onTotalProgress(n,t)},_onUploadPrep:function(){},_onUpload:function(n){this._uploadData.setStatus(n,t.status.UPLOADING)},_onUploadChunk:function(){},_onUploadChunkSuccess:function(n){!this._preventRetries[n]&&this._options.retry.enableAuto&&(this._autoRetries[n]=0)},_onUploadStatusChange:function(n,i,r){r===t.status.PAUSED&&clearTimeout(this._retryTimeouts[n])},_onValidateBatchCallbackFailure:function(n){var i=this;t.each(n,function(n,t){i._fileOrBlobRejected(t.id)})},_onValidateBatchCallbackSuccess:function(n,i,r,u,f){var o,e=this._currentItemLimit,s=this._netUploadedOrQueued;e===0||s<=e?i.length>0?this._handleCheckedCallback({name:"onValidate",callback:t.bind(this._options.callbacks.onValidate,this,n[0],f),onSuccess:t.bind(this._onValidateCallbackSuccess,this,i,0,r,u),onFailure:t.bind(this._onValidateCallbackFailure,this,i,0,r,u),identifier:"Item '"+i[0].file.name+"', size: "+i[0].file.size}):this._itemError("noFilesError"):(this._onValidateBatchCallbackFailure(i),o=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,s).replace(/\{itemLimit\}/g,e),this._batchError(o))},_onValidateCallbackFailure:function(n,t,i,r){var u=t+1;this._fileOrBlobRejected(n[t].id,n[t].file.name);this._maybeProcessNextItemAfterOnValidateCallback(!1,n,u,i,r)},_onValidateCallbackSuccess:function(n,t,i,r){var u=this,f=t+1,e=this._getValidationDescriptor(n[t]);this._validateFileOrBlobData(n[t],e).then(function(){u._upload(n[t].id,i,r);u._maybeProcessNextItemAfterOnValidateCallback(!0,n,f,i,r)},function(){u._maybeProcessNextItemAfterOnValidateCallback(!1,n,f,i,r)})},_prepareItemsForUpload:function(n,i,r){if(n.length===0){this._itemError("noFilesError");return}var u=this._getValidationDescriptors(n),e=this._getButtonId(n[0].file),f=this._getButton(e);this._handleCheckedCallback({name:"onValidateBatch",callback:t.bind(this._options.callbacks.onValidateBatch,this,u,f),onSuccess:t.bind(this._onValidateBatchCallbackSuccess,this,u,n,i,r,f),onFailure:t.bind(this._onValidateBatchCallbackFailure,this,n),identifier:"batch validation"})},_preventLeaveInProgress:function(){var n=this;this._disposeSupport.attach(window,"beforeunload",function(t){if(n.getInProgress())return t=t||window.event,t.returnValue=n._options.messages.onLeave,n._options.messages.onLeave})},_refreshSessionData:function(){var n=this,i=this._options.session;t.Session&&this._options.session.endpoint!=null&&(this._session||(t.extend(i,{cors:this._options.cors}),i.log=t.bind(this.log,this),i.addFileRecord=t.bind(this._addCannedFile,this),this._session=new t.Session(i)),setTimeout(function(){n._session.refresh().then(function(t,i){n._sessionRequestComplete();n._options.callbacks.onSessionRequestComplete(t,!0,i)},function(t,i){n._options.callbacks.onSessionRequestComplete(t,!1,i)})},0))},_sessionRequestComplete:function(){},_setSize:function(n,t){this._uploadData.updateSize(n,t);this._totalProgress&&this._totalProgress.onNewSize(n)},_shouldAutoRetry:function(n){var i=this._uploadData.retrieve({id:n});return!this._preventRetries[n]&&this._options.retry.enableAuto&&i.status!==t.status.PAUSED&&(this._autoRetries[n]===undefined&&(this._autoRetries[n]=0),this._autoRetries[n]<this._options.retry.maxAutoAttempts)?(this._autoRetries[n]+=1,!0):!1},_storeForLater:function(n){this._storedIds.push(n)},_trackButton:function(n){var i;i=t.supportedFeatures.ajaxUploading?this._handler.getFile(n).qqButtonId:this._getButtonId(this._handler.getInput(n));i&&(this._buttonIdsForFileIds[n]=i)},_updateFormSupportAndParams:function(n){this._options.form.element=n;this._formSupport=t.FormSupport&&new t.FormSupport(this._options.form,t.bind(this.uploadStoredFiles,this),t.bind(this.log,this));this._formSupport&&this._formSupport.attachedToForm&&(this._paramsStore.addReadOnly(null,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&this.setEndpoint(this._formSupport.newEndpoint))},_upload:function(n,i,r){var u=this.getName(n);i&&this.setParams(i,n);r&&this.setEndpoint(r,n);this._handleCheckedCallback({name:"onSubmit",callback:t.bind(this._options.callbacks.onSubmit,this,n,u),onSuccess:t.bind(this._onSubmitCallbackSuccess,this,n,u),onFailure:t.bind(this._fileOrBlobRejected,this,n,u),identifier:n})},_uploadFile:function(n){this._handler.upload(n)||this._uploadData.setStatus(n,t.status.QUEUED)},_uploadStoredFiles:function(){for(var i,n,r=this;this._storedIds.length;)i=this._storedIds.shift(),this._uploadFile(i);n=this.getUploads({status:t.status.SUBMITTING}).length;n&&(t.log("Still waiting for "+n+" files to clear submit queue. Will re-parse stored IDs array shortly."),setTimeout(function(){r._uploadStoredFiles()},1e3))},_validateFileOrBlobData:function(n,i){var s=this,u=function(){return n.file instanceof t.BlobProxy?n.file.referenceBlob:n.file}(),f=i.name,e=i.size,h=this._getButtonId(n.file),o=this._getValidationBase(h),r=new t.Promise;return(r.then(function(){},function(){s._fileOrBlobRejected(n.id,f)}),t.isFileOrInput(u)&&!this._isAllowedExtension(o.allowedExtensions,f))?(this._itemError("typeError",f,u),r.failure()):!this._options.validation.allowEmpty&&e===0?(this._itemError("emptyError",f,u),r.failure()):e>0&&o.sizeLimit&&e>o.sizeLimit?(this._itemError("sizeError",f,u),r.failure()):e>0&&e<o.minSizeLimit?(this._itemError("minSizeError",f,u),r.failure()):(t.ImageValidation&&t.supportedFeatures.imagePreviews&&t.isFile(u)?new t.ImageValidation(u,t.bind(s.log,s)).validate(o.image).then(r.success,function(n){s._itemError(n+"ImageError",f,u);r.failure()}):r.success(),r)},_wrapCallbacks:function(){var n,t,i;n=this;t=function(t,i,r){var u;try{return i.apply(n,r)}catch(f){u=f.message||f.toString();n.log("Caught exception in '"+t+"' callback - "+u,"error")}};for(i in this._options.callbacks)(function(){var r,u;r=i;u=n._options.callbacks[r];n._options.callbacks[r]=function(){return t(r,u,arguments)}})()}}}(),function(){"use strict";t.FineUploaderBasic=function(n){var i=this;this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,warnBeforeUnload:!0,request:{customHeaders:{},endpoint:"/server/upload",filenameParam:"qqfilename",forceMultipart:!0,inputName:"qqfile",method:"POST",omitDefaultParams:!1,params:{},paramsInBody:!0,requireSuccessJson:!0,totalFileSizeName:"qqtotalfilesize",uuidName:"qquuid"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null,image:{maxHeight:0,maxWidth:0,minHeight:0,minWidth:0},allowEmpty:!1},callbacks:{onSubmit:function(){},onSubmitted:function(){},onComplete:function(){},onAllComplete:function(){},onCancel:function(){},onUpload:function(){},onUploadChunk:function(){},onUploadChunkSuccess:function(){},onResume:function(){},onProgress:function(){},onTotalProgress:function(){},onError:function(){},onAutoRetry:function(){},onManualRetry:function(){},onValidateBatch:function(){},onValidate:function(){},onSubmitDelete:function(){},onDelete:function(){},onDeleteComplete:function(){},onPasteReceived:function(){},onStatusChange:function(){},onSessionRequestComplete:function(){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled.",unsupportedBrowserIos8Safari:"Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,concurrent:{enabled:!1},mandatory:!1,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"},partSize:function(){return 2e6},success:{endpoint:null,headers:function(){return null},jsonPayload:!1,method:"POST",params:function(){return null},resetOnStatus:[]}},resume:{enabled:!1,recordsExpireIn:7,paramNames:{resuming:"qqresume"},customKeys:function(){return[]}},formatFileName:function(n){return n},text:{defaultResponseError:"Upload failure reason unknown",fileInputTitle:"file input",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:!0},form:{element:"qq-form",autoUpload:!1,interceptSubmit:!0},scaling:{customResizer:null,sendOriginal:!0,orient:!0,defaultType:null,defaultQuality:80,failureText:"Failed to scale",includeExif:!1,sizes:[]},workarounds:{iosEmptyVideos:!0,ios8SafariUploads:!0,ios8BrowserCrash:!1}};t.extend(this._options,n,!0);this._buttons=[];this._extraButtonSpecs={};this._buttonIdsForFileIds=[];this._wrapCallbacks();this._disposeSupport=new t.DisposeSupport;this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._thumbnailUrls=[];this._netUploadedOrQueued=0;this._netUploaded=0;this._uploadData=this._createUploadDataTracker();this._initFormSupportAndParams();this._customHeadersStore=this._createStore(this._options.request.customHeaders);this._deleteFileCustomHeadersStore=this._createStore(this._options.deleteFile.customHeaders);this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params);this._endpointStore=this._createStore(this._options.request.endpoint);this._deleteFileEndpointStore=this._createStore(this._options.deleteFile.endpoint);this._handler=this._createUploadHandler();this._deleteHandler=t.DeleteFileAjaxRequester&&this._createDeleteHandler();this._options.button&&(this._defaultButtonId=this._createUploadButton({element:this._options.button,title:this._options.text.fileInputTitle}).getButtonId());this._generateExtraButtonSpecs();this._handleCameraAccess();this._options.paste.targetElement&&(t.PasteSupport?this._pasteHandler=this._createPasteHandler():this.log("Paste support module not found","error"));this._options.warnBeforeUnload&&this._preventLeaveInProgress();this._imageGenerator=t.ImageGenerator&&new t.ImageGenerator(t.bind(this.log,this));this._refreshSessionData();this._succeededSinceLastAllComplete=[];this._failedSinceLastAllComplete=[];this._scaler=t.Scaler&&new t.Scaler(this._options.scaling,t.bind(this.log,this))||{};this._scaler.enabled&&(this._customNewFileHandler=t.bind(this._scaler.handleNewFile,this._scaler));t.TotalProgress&&t.supportedFeatures.progressBar&&(this._totalProgress=new t.TotalProgress(t.bind(this._onTotalProgress,this),function(n){var t=i._uploadData.retrieve({id:n});return t&&t.size||0}));this._currentItemLimit=this._options.validation.itemLimit;this._customResumeDataStore=this._createStore()};t.FineUploaderBasic.prototype=t.basePublicApi;t.extend(t.FineUploaderBasic.prototype,t.basePrivateApi)}();t.AjaxRequester=function(n){"use strict";function a(){return t.indexOf(["GET","POST","HEAD"],i.method)>=0}function v(){var n=!1;return t.each(n,function(i,r){if(t.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],r)<0)return n=!0,!1}),n}function o(n){return i.cors.expected&&n.withCredentials===undefined}function y(){var n;return(window.XMLHttpRequest||window.ActiveXObject)&&(n=t.createXhrInstance(),n.withCredentials===undefined&&(n=new XDomainRequest,n.onload=function(){},n.onerror=function(){},n.ontimeout=function(){},n.onprogress=function(){})),n}function f(n,u){var f=r[n].xhr;return f||(f=u?u:i.cors.expected?y():t.createXhrInstance(),r[n].xhr=f),f}function c(n){var e=t.indexOf(u,n),f=i.maxConnections,o;delete r[n];u.splice(e,1);u.length>=f&&e<f&&(o=u[f-1],l(o))}function h(n,t){var r=f(n),s=i.method,u=t===!0;c(n);u?e(s+" request for "+n+" has failed","error"):o(r)||tt(r.status)||(u=!0,e(s+" request for "+n+" has failed - response code "+r.status,"error"));i.onComplete(n,r,u)}function p(n){var f=r[n].additionalParams,e=i.mandatedParams,u;return i.paramsStore.get&&(u=i.paramsStore.get(n)),f&&t.each(f,function(n,t){u=u||{};u[n]=t}),e&&t.each(e,function(n,t){u=u||{};u[n]=t}),u}function l(n,u){var h=f(n,u),l=i.method,c=p(n),a=r[n].payload,v;i.onSend(n);return v=w(n,c,r[n].additionalQueryParams),o(h)?(h.onload=d(n),h.onerror=g(n)):h.onreadystatechange=b(n),k(n),h.open(l,v,!0),i.cors.expected&&i.cors.sendCredentials&&!o(h)&&(h.withCredentials=!0),nt(n),e("Sending "+l+" request for "+n),a?h.send(a):s||!c?h.send():c&&i.contentType&&i.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0?h.send(t.obj2url(c,"")):c&&i.contentType&&i.contentType.toLowerCase().indexOf("application/json")>=0?h.send(JSON.stringify(c)):h.send(c),h}function w(n,u,f){var e=i.endpointStore.get(n),o=r[n].addToPath;return o!=undefined&&(e+="/"+o),s&&u&&(e=t.obj2url(u,e)),f&&(e=t.obj2url(f,e)),e}function b(n){return function(){f(n).readyState===4&&h(n)}}function k(n){var t=i.onProgress;t&&(f(n).upload.onprogress=function(i){i.lengthComputable&&t(n,i.loaded,i.total)})}function d(n){return function(){h(n)}}function g(n){return function(){h(n,!0)}}function nt(n){var u=f(n),e=i.customHeaders,c=r[n].additionalHeaders||{},h=i.method,s={};o(u)||(i.acceptHeader&&u.setRequestHeader("Accept",i.acceptHeader),i.allowXRequestedWithAndCacheControl&&(i.cors.expected&&a()&&!v(e)||(u.setRequestHeader("X-Requested-With","XMLHttpRequest"),u.setRequestHeader("Cache-Control","no-cache"))),i.contentType&&(h==="POST"||h==="PUT")&&u.setRequestHeader("Content-Type",i.contentType),t.extend(s,t.isFunction(e)?e(n):e),t.extend(s,c),t.each(s,function(n,t){u.setRequestHeader(n,t)}))}function tt(n){return t.indexOf(i.successfulResponseCodes[i.method],n)>=0}function it(n,t,f,e,o,s,h){r[n]={addToPath:f,additionalParams:e,additionalQueryParams:o,additionalHeaders:s,payload:h};var c=u.push(n);if(c<=i.maxConnections)return l(n,t)}var e,s,u=[],r={},i={acceptHeader:null,validMethods:["PATCH","POST","PUT"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:!0,successfulResponseCodes:{DELETE:[200,202,204],PATCH:[200,201,202,203,204],POST:[200,201,202,203,204],PUT:[200,201,202,203,204],GET:[200]},cors:{expected:!1,sendCredentials:!1},log:function(){},onSend:function(){},onComplete:function(){},onProgress:null};if(t.extend(i,n),e=i.log,t.indexOf(i.validMethods,i.method)<0)throw new Error("'"+i.method+"' is not a supported method for this type of request!");s=i.method==="GET"||i.method==="DELETE";t.extend(this,{initTransport:function(n){var u,r,f,e,o,s;return{withPath:function(n){return u=n,this},withParams:function(n){return r=n,this},withQueryParams:function(n){return s=n,this},withHeaders:function(n){return f=n,this},withPayload:function(n){return e=n,this},withCacheBuster:function(){return o=!0,this},send:function(h){return o&&t.indexOf(["GET","DELETE"],i.method)>=0&&(r.qqtimestamp=(new Date).getTime()),it(n,h,u,r,s,f,e)}}},canceled:function(n){c(n)}})};t.UploadHandler=function(n){"use strict";var r=n.proxy,i={},u=r.onCancel,f=r.getName;t.extend(this,{add:function(n,t){i[n]=t;i[n].temp={}},cancel:function(n){var r=this,e=new t.Promise,o=u(n,f(n),e);o.then(function(){r.isValid(n)&&(i[n].canceled=!0,r.expunge(n));e.success()})},expunge:function(n){delete i[n]},getThirdPartyFileId:function(n){return i[n].key},isValid:function(n){return i[n]!==undefined},reset:function(){i={}},_getFileState:function(n){return i[n]},_setThirdPartyFileId:function(n,t){i[n].key=t},_wasCanceled:function(n){return!!i[n].canceled}})};t.UploadHandlerController=function(n,i){"use strict";var h=this,l=!1,c=!1,a,o,r,u={paramsStore:{},maxConnections:3,chunking:{enabled:!1,multiple:{enabled:!1}},log:function(){},onProgress:function(){},onComplete:function(){},onCancel:function(){},onUploadPrep:function(){},onUpload:function(){},onUploadChunk:function(){},onUploadChunkSuccess:function(){},onAutoRetry:function(){},onResume:function(){},onUuidChanged:function(){},getName:function(){},setSize:function(){},isQueued:function(){},getIdsInProxyGroup:function(){},getIdsInBatch:function(){},isInProgress:function(){}},s={done:function(n,t,i,f){var e=r._getChunkData(n,t);r._getFileState(n).attemptingResume=!1;delete r._getFileState(n).temp.chunkProgress[t];r._getFileState(n).loaded+=e.size;u.onUploadChunkSuccess(n,r._getChunkDataForCallback(e),i,f)},finalize:function(n){var t=u.getSize(n),i=u.getName(n);o("All chunks have been uploaded for "+n+" - finalizing....");r.finalizeChunks(n).then(function(f,s){o("Finalize successful for "+n);var h=e.normalizeResponse(f,!0);u.onProgress(n,i,t,t);r._maybeDeletePersistedChunkData(n);e.cleanup(n,h,s)},function(t,r){var f=e.normalizeResponse(t,!1);o("Problem finalizing chunks for file ID "+n+" - "+f.error,"error");(f.reset||r&&u.chunking.success.resetOnStatus.indexOf(r.status)>=0)&&s.reset(n);u.onAutoRetry(n,i,f,r)||e.cleanup(n,f,r)})},handleFailure:function(n,i,h,l){var y=u.getName(i),a,v;o("Chunked upload request failed for "+i+", chunk "+n);r.clearCachedChunk(i,n);a=e.normalizeResponse(h,!1);a.reset?s.reset(i):(v=t.indexOf(r._getFileState(i).chunking.inProgress,n),v>=0&&(r._getFileState(i).chunking.inProgress.splice(v,1),r._getFileState(i).chunking.remaining.unshift(n)));r._getFileState(i).temp.ignoreFailure||(c&&(r._getFileState(i).temp.ignoreFailure=!0,o(t.format("Going to attempt to abort these chunks: {}. These are currently in-progress: {}.",JSON.stringify(Object.keys(r._getXhrs(i))),JSON.stringify(r._getFileState(i).chunking.inProgress))),t.each(r._getXhrs(i),function(n,r){o(t.format("Attempting to abort file {}.{}. XHR readyState {}. ",i,n,r.readyState));r.abort();r._cancelled=!0}),r.moveInProgressToRemaining(i),f.free(i,!0)),u.onAutoRetry(i,y,a,l)||e.cleanup(i,a,l))},hasMoreParts:function(n){return!!r._getFileState(n).chunking.remaining.length},nextPart:function(n){var t=r._getFileState(n).chunking.remaining.shift();return t>=r._getTotalChunks(n)&&(t=null),t},reset:function(n){o("Server or callback has ordered chunking effort to be restarted on next attempt for item ID "+n,"error");r._maybeDeletePersistedChunkData(n);r.reevaluateChunking(n);r._getFileState(n).loaded=0;r._getFileState(n).attemptingResume=!1},sendNext:function(n){var w=u.getSize(n),y=u.getName(n),i=s.nextPart(n),h=r._getChunkData(n,i),l=r._getFileState(n),a=l.attemptingResume,v=l.chunking.inProgress||[],p;l.loaded==null&&(l.loaded=0);a&&u.onResume(n,y,h,l.customResumeData)===!1&&(s.reset(n),i=s.nextPart(n),h=r._getChunkData(n,i),a=!1);i==null&&v.length===0?s.finalize(n):(v.push(i),r._getFileState(n).chunking.inProgress=v,c&&f.open(n,i),c&&f.available()&&r._getFileState(n).chunking.remaining.length&&s.sendNext(n),h.blob.size===0&&(o(t.format("Chunk {} for file {} will not be uploaded, zero sized chunk.",i,n),"error"),s.handleFailure(i,n,"File is no longer available",null)),p=u.onUploadChunk(n,y,r._getChunkDataForCallback(h)),p.then(function(f){if(u.isInProgress(n)){o(t.format("Sending chunked upload request for item {}.{}, bytes {}-{} of {}.",n,i,h.start+1,h.end,w));var c={chunkIdx:i,id:n,overrides:f,resuming:a};r.uploadChunk(c).then(function(u,f){o("Chunked upload request succeeded for "+n+", chunk "+i);r.clearCachedChunk(n,i);var h=r._getFileState(n).chunking.inProgress||[],l=e.normalizeResponse(u,!0),c=t.indexOf(h,i);o(t.format("Chunk {} for file {} uploaded successfully.",i,n));s.done(n,i,l,f);c>=0&&h.splice(c,1);r._maybePersistChunkedState(n);s.hasMoreParts(n)||h.length!==0?s.hasMoreParts(n)?s.sendNext(n):o(t.format("File ID {} has no more chunks to send and these chunk indexes are still marked as in-progress: {}",n,JSON.stringify(h))):s.finalize(n)},function(t,r){s.handleFailure(i,n,t,r)}).done(function(){r.clearXhr(n,i)})}else o(t.format("Not sending chunked upload request for item {}.{} - no longer in progress.",n,i))},function(t){s.handleFailure(i,n,t,null)}))}},f={_open:[],_openChunks:{},_waiting:[],available:function(){var r=u.maxConnections,n=0,i=0;return t.each(f._openChunks,function(t,r){n++;i+=r.length}),r-(f._open.length-n+i)},free:function(n,i){var c=!i,s=t.indexOf(f._waiting,n),h=t.indexOf(f._open,n),u;delete f._openChunks[n];e.getProxyOrBlob(n)instanceof t.BlobProxy&&(o("Generated blob upload has ended for "+n+", disposing generated blob."),delete r._getFileState(n).file);s>=0?f._waiting.splice(s,1):c&&h>=0&&(f._open.splice(h,1),u=f._waiting.shift(),u>=0&&(f._open.push(u),e.start(u)))},getWaitingOrConnected:function(){var n=[];return t.each(f._openChunks,function(t,i){i&&i.length&&n.push(parseInt(t))}),t.each(f._open,function(t,i){f._openChunks[i]||n.push(parseInt(i))}),n=n.concat(f._waiting)},isUsingConnection:function(n){return t.indexOf(f._open,n)>=0},open:function(n,t){return(t==null&&f._waiting.push(n),f.available())?(t==null?(f._waiting.pop(),f._open.push(n)):function(){var i=f._openChunks[n]||[];i.push(t);f._openChunks[n]=i}(),!0):!1},reset:function(){f._waiting=[];f._open=[]}},v={send:function(n,t){r._getFileState(n).loaded=0;o("Sending simple upload request for "+n);r.uploadFile(n).then(function(i,r){o("Simple upload request succeeded for "+n);var f=e.normalizeResponse(i,!0),s=u.getSize(n);u.onProgress(n,t,s,s);e.maybeNewUuid(n,f);e.cleanup(n,f,r)},function(i,r){o("Simple upload request failed for "+n);var f=e.normalizeResponse(i,!1);u.onAutoRetry(n,t,f,r)||e.cleanup(n,f,r)})}},e={cancel:function(n){o("Cancelling "+n);u.paramsStore.remove(n);f.free(n)},cleanup:function(n,t,i){var e=u.getName(n);u.onComplete(n,e,t,i);r._getFileState(n)&&r._clearXhrs&&r._clearXhrs(n);f.free(n)},getProxyOrBlob:function(n){return r.getProxy&&r.getProxy(n)||r.getFile&&r.getFile(n)},initHandler:function(){var n=i?t[i]:t.traditional,f=t.supportedFeatures.ajaxUploading?"Xhr":"Form";r=new n[f+"UploadHandler"](u,{getCustomResumeData:u.getCustomResumeData,getDataByUuid:u.getDataByUuid,getName:u.getName,getSize:u.getSize,getUuid:u.getUuid,log:o,onCancel:u.onCancel,onProgress:u.onProgress,onUuidChanged:u.onUuidChanged,onFinalizing:function(n){u.setStatus(n,t.status.UPLOAD_FINALIZING)}});r._removeExpiredChunkingRecords&&r._removeExpiredChunkingRecords()},isDeferredEligibleForUpload:function(n){return u.isQueued(n)},maybeDefer:function(n,i){if(i&&!r.getFile(n)&&i instanceof t.BlobProxy){u.onUploadPrep(n);o("Attempting to generate a blob on-demand for "+n);i.create().then(function(t){o("Generated an on-demand blob for "+n);r.updateBlob(n,t);u.setSize(n,t.size);r.reevaluateChunking(n);e.maybeSendDeferredFiles(n)},function(i){var r={};i&&(r.error=i);o(t.format("Failed to generate blob for ID {}.  Error message: {}.",n,i),"error");u.onComplete(n,u.getName(n),t.extend(r,a),null);e.maybeSendDeferredFiles(n);f.free(n)})}else return e.maybeSendDeferredFiles(n);return!1},maybeSendDeferredFiles:function(n){var i=u.getIdsInProxyGroup(n),f=!1;return i&&i.length?(o("Maybe ready to upload proxy group file "+n),t.each(i,function(t,i){if(e.isDeferredEligibleForUpload(i)&&!!r.getFile(i))f=i===n,e.now(i);else if(e.isDeferredEligibleForUpload(i))return!1})):(f=!0,e.now(n)),f},maybeNewUuid:function(n,t){if(t.newUuid!==undefined)u.onUuidChanged(n,t.newUuid)},normalizeResponse:function(n,i){var r=n;return t.isObject(n)||(r={},t.isString(n)&&!i&&(r.error=n)),r.success=i,r},now:function(n){var i=u.getName(n);if(!h.isValid(n))throw new t.Error(n+" is not a valid file ID to upload!");u.onUpload(n,i).then(function(e){e&&e.pause?(u.setStatus(n,t.status.PAUSED),r.pause(n),f.free(n)):l&&r._shouldChunkThisFile(n)?s.sendNext(n):v.send(n,i)},function(t){if(t=t||{},o(n+" upload start aborted due to rejected onUpload Promise - details: "+t,"error"),!u.onAutoRetry(n,i,t.responseJSON||{})){var r=e.normalizeResponse(t.responseJSON,!1);e.cleanup(n,r)}})},start:function(n){var t=e.getProxyOrBlob(n);return t?e.maybeDefer(n,t):(e.now(n),!0)}};t.extend(this,{add:function(){r.add.apply(this,arguments)},upload:function(n){return f.open(n)?e.start(n):!1},retry:function(n){return c&&(r._getFileState(n).temp.ignoreFailure=!1),f.isUsingConnection(n)?e.start(n):h.upload(n)},cancel:function(n){var i=r.cancel(n);t.isGenericPromise(i)?i.then(function(){e.cancel(n)}):i!==!1&&e.cancel(n)},cancelAll:function(){var t=f.getWaitingOrConnected(),n;if(t.length)for(n=t.length-1;n>=0;n--)h.cancel(t[n]);f.reset()},getFile:function(n){return r.getProxy&&r.getProxy(n)?r.getProxy(n).referenceBlob:r.getFile&&r.getFile(n)},isProxied:function(n){return!!(r.getProxy&&r.getProxy(n))},getInput:function(n){if(r.getInput)return r.getInput(n)},reset:function(){o("Resetting upload handler");h.cancelAll();f.reset();r.reset()},expunge:function(n){if(h.isValid(n))return r.expunge(n)},isValid:function(n){return r.isValid(n)},hasResumeRecord:function(n){var t=r.isValid(n)&&r._getLocalStorageId&&r._getLocalStorageId(n);return t?!!localStorage.getItem(t):!1},getResumableFilesData:function(){return r.getResumableFilesData?r.getResumableFilesData():[]},getThirdPartyFileId:function(n){if(h.isValid(n))return r.getThirdPartyFileId(n)},pause:function(n){return h.isResumable(n)&&r.pause&&h.isValid(n)&&r.pause(n)?(f.free(n),r.moveInProgressToRemaining(n),!0):!1},isAttemptingResume:function(n){return!!r.isAttemptingResume&&r.isAttemptingResume(n)},isResumable:function(n){return!!r.isResumable&&r.isResumable(n)}});t.extend(u,n);o=u.log;l=u.chunking.enabled&&t.supportedFeatures.chunking;c=l&&u.chunking.concurrent.enabled;a=function(){var n={};return n[u.preventRetryParam]=!0,n}();e.initHandler()};t.WindowReceiveMessage=function(n){"use strict";var r={log:function(){}},i={};t.extend(r,n);t.extend(this,{receiveMessage:function(n,r){var u=function(n){r(n.data)};window.postMessage?i[n]=t(window).attach("message",u):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(n){if(window.postMessage){var t=i[n];t&&t()}}})};t.FormUploadHandler=function(n){"use strict";function p(n){delete u[n];c&&(clearTimeout(f[n]),delete f[n],o.stopReceivingMessages(n));var i=document.getElementById(r._getIframeName(n));i&&(i.setAttribute("src","javascript:false;"),t(i).remove())}function l(n){return n.split("_")[0]}function w(n){var i=t.toElement("<iframe src='javascript:false;' name='"+n+"' />");return i.setAttribute("id",n),i.style.display="none",document.body.appendChild(i),i}function b(n,s){var h=n.id,c=l(h),a=y(c);e[a]=s;u[c]=t(n).attach("load",function(){r.getInput(c)&&(i("Received iframe load event for CORS upload request (iframe name "+h+")"),f[h]=setTimeout(function(){var n="No valid message received from loaded iframe for iframe name "+h;i(n,"error");s({error:n})},1e3))});o.receiveMessage(h,function(n){i("Received the following window message: '"+n+"'");var c=l(h),u=r._parseJsonResponse(n),t=u.uuid,s;t&&e[t]?(i("Handling response for iframe name "+h),clearTimeout(f[h]),delete f[h],r._detachLoadEvent(h),s=e[t],delete e[t],o.stopReceivingMessages(h),s(u)):t||i("'"+n+"' does not contain a UUID - ignoring.")})}var s=n.options,r=this,h=n.proxy,a=t.getUniqueId(),e={},u={},f={},c=s.isCors,v=s.inputName,y=h.getUuid,i=h.log,o=new t.WindowReceiveMessage({log:i});t.extend(this,new t.UploadHandler(n));t.override(this,function(n){return{add:function(i,r){n.add(i,{input:r});r.setAttribute("name",v);r.parentNode&&t(r).remove()},expunge:function(t){p(t);n.expunge(t)},isValid:function(t){return n.isValid(t)&&r._getFileState(t).input!==undefined}}});t.extend(this,{getInput:function(n){return r._getFileState(n).input},_attachLoadEvent:function(n,r){var f;c?b(n,r):u[n.id]=t(n).attach("load",function(){if(i("Received response for "+n.id),n.parentNode){try{if(n.contentDocument&&n.contentDocument.body&&n.contentDocument.body.innerHTML=="false")return}catch(t){i("Error when attempting to access iframe during handling of upload response ("+t.message+")","error");f={success:!1}}r(f)}})},_createIframe:function(n){var t=r._getIframeName(n);return w(t)},_detachLoadEvent:function(n){u[n]!==undefined&&(u[n](),delete u[n])},_getIframeName:function(n){return n+"_"+a},_initFormForUpload:function(n){var e=n.method,r=n.endpoint,u=n.params,o=n.paramsInBody,s=n.targetName,i=t.toElement("<form method='"+e+"' enctype='multipart/form-data'><\/form>"),f=r;return o?t.obj2Inputs(u,i):f=t.obj2url(u,r),i.setAttribute("action",f),i.setAttribute("target",s),i.style.display="none",document.body.appendChild(i),i},_parseJsonResponse:function(n){var r={};try{r=t.parseJson(n)}catch(u){i("Error when attempting to parse iframe upload response ("+u.message+")","error")}return r}})};t.XhrUploadHandler=function(n){"use strict";function v(n){t.each(i._getXhrs(n),function(t,r){var u=i._getAjaxRequester(n,t);r.onreadystatechange=null;r.upload.onprogress=null;r.abort();u&&u.canceled&&u.canceled(n)})}var i=this,a=n.options.namespace,r=n.proxy,f=n.options.chunking,h=function(n){var e=i._getFileState(n),r;return e.chunkSize?e.chunkSize:(r=f.partSize,t.isFunction(r)&&(r=r(n,u(n))),e.chunkSize=r,r)},c=n.options.resume,y=f&&n.options.chunking.enabled&&t.supportedFeatures.chunking,e=c&&n.options.resume.enabled&&y&&t.supportedFeatures.resume,o=r.getName,u=r.getSize,p=r.getUuid,w=r.getEndpoint,b=r.getDataByUuid,k=r.onUuidChanged,l=r.onProgress,s=r.log,d=r.getCustomResumeData;t.extend(this,new t.UploadHandler(n));t.override(this,function(n){return{add:function(r,u){if(t.isFile(u)||t.isBlob(u))n.add(r,{file:u});else if(u instanceof t.BlobProxy)n.add(r,{proxy:u});else throw new Error("Passed obj is not a File, Blob, or proxy");i._initTempState(r);e&&i._maybePrepareForResume(r)},expunge:function(t){v(t);i._maybeDeletePersistedChunkData(t);i._clearXhrs(t);n.expunge(t)}}});t.extend(this,{clearCachedChunk:function(n,t){delete i._getFileState(n).temp.cachedChunks[t]},clearXhr:function(n,t){var r=i._getFileState(n).temp;r.xhrs&&delete r.xhrs[t];r.ajaxRequesters&&delete r.ajaxRequesters[t]},finalizeChunks:function(n,r){var f=i._getTotalChunks(n)-1,u=i._getXhr(n,f);return r?(new t.Promise).success(r(u),u):(new t.Promise).success({},u)},getFile:function(n){return i.isValid(n)&&i._getFileState(n).file},getProxy:function(n){return i.isValid(n)&&i._getFileState(n).proxy},getResumableFilesData:function(){var n=[];return i._iterateResumeRecords(function(t,r){i.moveInProgressToRemaining(null,r.chunking.inProgress,r.chunking.remaining);var u={name:r.name,remaining:r.chunking.remaining,size:r.size,uuid:r.uuid};r.key&&(u.key=r.key);r.customResumeData&&(u.customResumeData=r.customResumeData);n.push(u)}),n},isAttemptingResume:function(n){return i._getFileState(n).attemptingResume},isResumable:function(n){return!!f&&i.isValid(n)&&!i._getFileState(n).notResumable},moveInProgressToRemaining:function(n,r,u){var o=i._getFileState(n)||{},e=o.chunking||{},f=r||e.inProgress,h=u||e.remaining;f&&(s(t.format("Moving these chunks from in-progress {}, to remaining.",JSON.stringify(f))),f.reverse(),t.each(f,function(n,t){h.unshift(t)}),f.length=0)},pause:function(n){if(i.isValid(n))return s(t.format("Aborting XHR upload for {} '{}' due to pause instruction.",n,o(n))),i._getFileState(n).paused=!0,v(n),!0},reevaluateChunking:function(n){if(f&&i.isValid(n)){var t=i._getFileState(n),r,u;if(delete t.chunking,t.chunking={},r=i._getTotalChunks(n),r>1||f.mandatory){for(t.chunking.enabled=!0,t.chunking.parts=r,t.chunking.remaining=[],u=0;u<r;u++)t.chunking.remaining.push(u);i._initTempState(n)}else t.chunking.enabled=!1}},updateBlob:function(n,t){i.isValid(n)&&(i._getFileState(n).file=t)},_clearXhrs:function(n){var r=i._getFileState(n).temp;t.each(r.ajaxRequesters,function(n){delete r.ajaxRequesters[n]});t.each(r.xhrs,function(n){delete r.xhrs[n]})},_createXhr:function(n,r){return i._registerXhr(n,r,t.createXhrInstance())},_getAjaxRequester:function(n,t){var r=t==null?-1:t;return i._getFileState(n).temp.ajaxRequesters[r]},_getChunkData:function(n,r){var e=h(n),s=u(n),a=i.getFile(n),f=e*r,o=f+e>=s?s:f+e,v=i._getTotalChunks(n),c=this._getFileState(n).temp.cachedChunks,l=c[r]||t.sliceBlob(a,f,o);return c[r]=l,{part:r,start:f,end:o,count:v,blob:l,size:o-f}},_getChunkDataForCallback:function(n){return{partIndex:n.part,startByte:n.start+1,endByte:n.end,totalParts:n.count}},_getLocalStorageId:function(n){var r=o(n),f=u(n),e=h(n),s=w(n),l=c.customKeys(n),i=t.format("qq{}resume{}-{}-{}-{}-{}",a,"5.0",r,f,e,s);return l.forEach(function(n){i+="-"+n}),i},_getMimeType:function(n){return i.getFile(n).type},_getPersistableData:function(n){return i._getFileState(n).chunking},_getTotalChunks:function(n){if(f){var t=u(n),i=h(n);return Math.ceil(t/i)}},_getXhr:function(n,t){var r=t==null?-1:t;return i._getFileState(n).temp.xhrs[r]},_getXhrs:function(n){return i._getFileState(n).temp.xhrs},_iterateResumeRecords:function(n){e&&t.each(localStorage,function(i,r){if(i.indexOf(t.format("qq{}resume",a))===0){var u=JSON.parse(r);n(i,u)}})},_initTempState:function(n){i._getFileState(n).temp={ajaxRequesters:{},chunkProgress:{},xhrs:{},cachedChunks:{}}},_markNotResumable:function(n){i._getFileState(n).notResumable=!0},_maybeDeletePersistedChunkData:function(n){var t;return e&&i.isResumable(n)&&(t=i._getLocalStorageId(n),t&&localStorage.getItem(t))?(localStorage.removeItem(t),!0):!1},_maybePrepareForResume:function(n){var u=i._getFileState(n),f,r;e&&u.key===undefined&&(f=i._getLocalStorageId(n),r=localStorage.getItem(f),r&&(r=JSON.parse(r),b(r.uuid)?i._markNotResumable(n):(s(t.format("Identified file with ID {} and name of {} as resumable.",n,o(n))),k(n,r.uuid),u.key=r.key,u.chunking=r.chunking,u.loaded=r.loaded,u.customResumeData=r.customResumeData,u.attemptingResume=!0,i.moveInProgressToRemaining(n))))},_maybePersistChunkedState:function(n){var r=i._getFileState(n),c,f,h;if(e&&i.isResumable(n)){h=d(n);c=i._getLocalStorageId(n);f={name:o(n),size:u(n),uuid:p(n),key:r.key,chunking:r.chunking,loaded:r.loaded,lastUpdated:Date.now()};h&&(f.customResumeData=h);try{localStorage.setItem(c,JSON.stringify(f))}catch(l){s(t.format("Unable to save resume data for '{}' due to error: '{}'.",n,l.toString()),"warn")}}},_registerProgressHandler:function(n,r,f){var s=i._getXhr(n,r),e=o(n),h={simple:function(t,i){var r=u(n);t===i?l(n,e,r,r):l(n,e,t>=r?r-1:t,r)},chunked:function(o,s){var h=i._getFileState(n).temp.chunkProgress,a=i._getFileState(n).loaded,v=o,y=s,p=u(n),w=v-(y-f),c=a;h[r]=w;t.each(h,function(n,t){c+=t});l(n,e,c,p)}};s.upload.onprogress=function(n){if(n.lengthComputable){var t=f==null?"simple":"chunked";h[t](n.loaded,n.total)}}},_registerXhr:function(n,t,r,u){var e=t==null?-1:t,f=i._getFileState(n).temp;return f.xhrs=f.xhrs||{},f.ajaxRequesters=f.ajaxRequesters||{},f.xhrs[e]=r,u&&(f.ajaxRequesters[e]=u),r},_removeExpiredChunkingRecords:function(){var n=c.recordsExpireIn;i._iterateResumeRecords(function(t,i){var r=new Date(i.lastUpdated);r.setDate(r.getDate()+n);r.getTime()<=Date.now()&&(s("Removing expired resume record with key "+t),localStorage.removeItem(t))})},_shouldChunkThisFile:function(n){var t=i._getFileState(n);return t.chunking||i.reevaluateChunking(n),t.chunking.enabled}})};t.DeleteFileAjaxRequester=function(n){"use strict";function u(){return i.method.toUpperCase()==="POST"?{_method:"DELETE"}:{}}var r,i={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:function(){return{}},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(){},onDelete:function(){},onDeleteComplete:function(){}};t.extend(i,n);r=t.extend(this,new t.AjaxRequester({acceptHeader:"application/json",validMethods:["POST","DELETE"],method:i.method,endpointStore:i.endpointStore,paramsStore:i.paramsStore,mandatedParams:u(),maxConnections:i.maxConnections,customHeaders:function(n){return i.customHeaders.get(n)},log:i.log,onSend:i.onDelete,onComplete:i.onDeleteComplete,cors:i.cors}));t.extend(this,{sendDelete:function(n,t,u){var f=u||{};i.log("Submitting delete file request for "+n);i.method==="DELETE"?r.initTransport(n).withPath(t).withParams(f).send():(f[i.uuidParamName]=t,r.initTransport(n).withParams(f).send())}})},function(){function u(n){var r=n.naturalWidth,u=n.naturalHeight,t=document.createElement("canvas"),i;return r*u>1048576?(t.width=t.height=1,i=t.getContext("2d"),i.drawImage(n,-r+1,0),i.getImageData(0,0,1,1).data[3]===0):!1}function f(n,t,i){var u=document.createElement("canvas"),f=0,s=i,r=i,e,h,c,o;for(u.width=1,u.height=i,e=u.getContext("2d"),e.drawImage(n,0,0),h=e.getImageData(0,0,1,i).data;r>f;)c=h[(r-1)*4+3],c===0?s=r:f=r,r=s+f>>1;return o=r/i,o===0?1:o}function e(i,r,u,f){var e=document.createElement("canvas"),s=u.mime||"image/jpeg",o=new t.Promise;return n(i,r,e,u,f).then(function(){o.success(e.toDataURL(s,u.quality||.8))}),o}function o(n){var i=5241e3;if(!t.ios())throw new t.Error("Downsampled dimensions can only be reliably calculated for iOS!");if(n.origHeight*n.origWidth>i)return{newHeight:Math.round(Math.sqrt(i*(n.origHeight/n.origWidth))),newWidth:Math.round(Math.sqrt(i*(n.origWidth/n.origHeight)))}}function n(n,r,e,h,c){var y=n.naturalWidth,p=n.naturalHeight,l=h.width,a=h.height,w=e.getContext("2d"),b=new t.Promise,v;return(w.save(),h.resize)?s({blob:r,canvas:e,image:n,imageHeight:p,imageWidth:y,orientation:h.orientation,resize:h.resize,targetHeight:a,targetWidth:l}):(t.supportedFeatures.unlimitedScaledImageSize||(v=o({origWidth:l,origHeight:a}),v&&(t.log(t.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h",l,a,v.newWidth,v.newHeight),"warn"),l=v.newWidth,a=v.newHeight)),i(e,l,a,h.orientation),t.ios()?function(){u(n)&&(y/=2,p/=2);var t=1024,i=document.createElement("canvas"),k=c?f(n,y,p):1,h=Math.ceil(t*l/y),v=Math.ceil(t*a/p/k),o=0,b=0,r,e,s;for(i.width=i.height=t,r=i.getContext("2d");o<p;){for(e=0,s=0;e<y;)r.clearRect(0,0,t,t),r.drawImage(n,-e,-o),w.drawImage(i,0,0,t,t,s,b,h,v),e+=t,s+=h;o+=t;b+=v}w.restore();i=r=null}():w.drawImage(n,0,0,l,a),e.qqImageRendered&&e.qqImageRendered(),b.success(),b)}function s(n){var h=n.blob,e=n.image,c=n.imageHeight,l=n.imageWidth,a=n.orientation,u=new t.Promise,v=n.resize,f=document.createElement("canvas"),y=f.getContext("2d"),r=n.canvas,o=n.targetHeight,s=n.targetWidth;return i(f,l,c,a),r.height=o,r.width=s,y.drawImage(e,0,0),v({blob:h,height:o,image:e,sourceCanvas:f,targetCanvas:r,width:s}).then(function(){r.qqImageRendered&&r.qqImageRendered();u.success()},u.failure),u}function i(n,t,i,r){switch(r){case 5:case 6:case 7:case 8:n.width=i;n.height=t;break;default:n.width=t;n.height=i}var u=n.getContext("2d");switch(r){case 2:u.translate(t,0);u.scale(-1,1);break;case 3:u.translate(t,i);u.rotate(Math.PI);break;case 4:u.translate(0,i);u.scale(1,-1);break;case 5:u.rotate(.5*Math.PI);u.scale(1,-1);break;case 6:u.rotate(.5*Math.PI);u.translate(0,-i);break;case 7:u.rotate(.5*Math.PI);u.translate(t,-i);u.scale(-1,1);break;case 8:u.rotate(-.5*Math.PI);u.translate(-t,0)}}function r(n,t){var i=this;window.Blob&&n instanceof Blob&&function(){var t=new Image,r=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!r)throw Error("No createObjectURL function found to create blob url");t.src=r.createObjectURL(n);i.blob=n;n=t}();n.naturalWidth||n.naturalHeight||(n.onload=function(){var n=i.imageLoadListeners;n&&(i.imageLoadListeners=null,setTimeout(function(){for(var t=0,i=n.length;t<i;t++)n[t]()},0))},n.onerror=t,this.imageLoadListeners=[]);this.srcImage=n}r.prototype.render=function(i,r){r=r||{};var c=this,o=this.srcImage.naturalWidth,s=this.srcImage.naturalHeight,u=r.width,f=r.height,l=r.maxWidth,a=r.maxHeight,v=!this.blob||this.blob.type==="image/jpeg",y=i.tagName.toLowerCase(),h;if(this.imageLoadListeners){this.imageLoadListeners.push(function(){c.render(i,r)});return}if(u&&!f?f=s*u/o<<0:f&&!u?u=o*f/s<<0:(u=o,f=s),l&&u>l&&(u=l,f=s*u/o<<0),a&&f>a&&(f=a,u=o*f/s<<0),h={width:u,height:f},t.each(r,function(n,t){h[n]=t}),y==="img"?function(){var n=i.src;e(c.srcImage,c.blob,h,v).then(function(t){i.src=t;n===i.src&&i.onload()})}():y==="canvas"&&n(this.srcImage,this.blob,i,h,v),typeof this.onrender=="function")this.onrender(i)};t.MegaPixImage=r}();t.ImageGenerator=function(n){"use strict";function r(n){return n.tagName.toLowerCase()==="img"}function u(n){return n.tagName.toLowerCase()==="canvas"}function h(){return(new Image).crossOrigin!==undefined}function c(){var n=document.createElement("canvas");return n.getContext&&n.getContext("2d")}function e(n){var r=n.split("/"),u=r[r.length-1].split("?")[0],i=t.getExtension(u);i=i&&i.toLowerCase();switch(i){case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"bmp":return"image/bmp";case"gif":return"image/gif";case"tiff":case"tif":return"image/tiff"}}function f(n){var i=document.createElement("a"),r,u,f;return(i.href=n,r=i.protocol,f=i.port,u=i.hostname,r.toLowerCase()!==window.location.protocol.toLowerCase())?!0:u.toLowerCase()!==window.location.hostname.toLowerCase()?!0:f!==window.location.port&&!t.ie()?!0:!1}function l(t,i){t.onload=function(){t.onload=null;t.onerror=null;i.success(t)};t.onerror=function(){t.onload=null;t.onerror=null;n("Problem drawing thumbnail!","error");i.failure(t,"Problem drawing thumbnail!")}}function a(n,t){n.qqImageRendered=function(){t.success(n)}}function i(i,f){var e=r(i)||u(i);return r(i)?l(i,f):u(i)?a(i,f):(f.failure(i),n(t.format("Element container of type {} is not supported!",i.tagName),"error")),e}function v(r,u,f){var e=new t.Promise,s=new t.Identify(r,n),o=f.maxSize,h=f.orient==null?!0:f.orient,c=function(){u.onerror=null;u.onload=null;n("Could not render preview, file may be too large!","error");e.failure(u,"Browser cannot render image!")};return s.isPreviewable().then(function(s){var a={parse:function(){return(new t.Promise).success()}},v=h?new t.Exif(r,n):a,l=new t.MegaPixImage(r,c);i(u,e)&&v.parse().then(function(n){var t=n&&n.Orientation;l.render(u,{maxWidth:o,maxHeight:o,orientation:t,mime:s,resize:f.customResizeFunction})},function(i){n(t.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",i));l.render(u,{maxWidth:o,maxHeight:o,mime:s,resize:f.customResizeFunction})})},function(){n("Not previewable");e.failure(u,"Not previewable")}),e}function o(n,r,u,o,s){var h=new Image,c=new t.Promise;i(h,c);f(n)&&(h.crossOrigin="anonymous");h.src=n;c.then(function(){i(r,u);var f=new t.MegaPixImage(h);f.render(r,{maxWidth:o,maxHeight:o,mime:e(n),resize:s})},u.failure)}function s(n,r,u,f){i(r,u);t(r).css({maxWidth:f+"px",maxHeight:f+"px"});r.src=n}function y(n,e,l){var a=new t.Promise,y=l.scale,v=y?l.maxSize:null;return y&&r(e)?c()?f(n)&&!h()?s(n,e,a,v):o(n,e,a,v):s(n,e,a,v):u(e)?o(n,e,a,v):i(e,a)&&(e.src=n),a}t.extend(this,{generate:function(i,r,u){return t.isString(i)?(n("Attempting to update thumbnail based on server response."),y(i,r,u||{})):(n("Attempting to draw client-side image preview."),v(i,r,u||{}))}});this._testing={};this._testing.isImg=r;this._testing.isCanvas=u;this._testing.isCrossOrigin=f;this._testing.determineMimeOfFileName=e};t.Exif=function(n,i){"use strict";function r(n){for(var t=0,i=0;n.length>0;)t+=parseInt(n.substring(0,2),16)*Math.pow(2,i),n=n.substring(2,n.length),i+=8;return t}function f(i,r){var u=i,e=r;return u===undefined&&(u=2,e=new t.Promise),t.readBlobToHex(n,u,4).then(function(n){var t=/^ffe([0-9])/.exec(n),i;t?t[1]!=="1"?(i=parseInt(n.slice(4,8),16),f(u+i+2,e)):e.success(u):e.failure("No EXIF header to be found!")}),e}function o(){var i=new t.Promise;return t.readBlobToHex(n,0,6).then(function(n){n.indexOf("ffd8")!==0?i.failure("Not a valid JPEG!"):f().then(function(n){i.success(n)},function(n){i.failure(n)})}),i}function s(i){var r=new t.Promise;return t.readBlobToHex(n,i+10,2).then(function(n){r.success(n==="4949")}),r}function h(i,u){var f=new t.Promise;return t.readBlobToHex(n,i+18,2).then(function(n){if(u)return f.success(r(n));f.success(parseInt(n,16))}),f}function c(i,r){var u=i+20,f=r*12;return t.readBlobToHex(n,u,f)}function l(n){for(var i=[],t=0;t+24<=n.length;)i.push(n.slice(t,t+24)),t+=24;return i}function a(n,i){var o=16,f=t.extend([],e),s={};return t.each(i,function(t,i){var c=i.slice(0,4),e=n?r(c):parseInt(c,16),l=f.indexOf(e),h,a,v;return l>=0&&(a=u[e].name,v=u[e].bytes,h=i.slice(o,o+v*2),s[a]=n?r(h):parseInt(h,16),f.splice(l,1)),f.length===0?!1:void 0}),s}var e=[274],u={274:{name:"Orientation",bytes:2}};t.extend(this,{parse:function(){var u=new t.Promise,r=function(n){i(t.format("EXIF header parse failed: '{}' ",n));u.failure(n)};return o().then(function(f){i(t.format("Moving forward with EXIF header parsing for '{}'",n.name===undefined?"blob":n.name));s(f).then(function(n){i(t.format("EXIF Byte order is {} endian",n?"little":"big"));h(f,n).then(function(e){i(t.format("Found {} APP1 directory entries",e));c(f,e).then(function(t){var r=l(t),f=a(n,r);i("Successfully parsed some EXIF tags");u.success(f)},r)},r)},r)},r),u}});this._testing={};this._testing.parseLittleEndian=r};t.Identify=function(n,i){"use strict";function r(n,i){var r=!1,u=[].concat(n);return t.each(u,function(n,t){if(i.indexOf(t)===0)return r=!0,!1}),r}t.extend(this,{isPreviewable:function(){var o=this,u=new t.Promise,f=!1,e=n.name===undefined?"blob":n.name;return i(t.format("Attempting to determine if {} can be rendered in this browser",e)),i("First pass: check type attribute of blob object."),this.isPreviewableSync()?(i("Second pass: check for magic bytes in file header."),t.readBlobToHex(n,0,4).then(function(n){t.each(o.PREVIEWABLE_MIME_TYPES,function(i,e){if(r(e,n))return(i!=="image/tiff"||t.supportedFeatures.tiffPreviews)&&(f=!0,u.success(i)),!1});i(t.format("'{}' is {} able to be rendered in this browser",e,f?"":"NOT"));f||u.failure()},function(){i("Error reading file w/ name '"+e+"'.  Not able to be rendered in this browser.");u.failure()})):u.failure(),u},isPreviewableSync:function(){var u=n.type,f=t.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES),u)>=0,r=!1,e=n.name===undefined?"blob":n.name;return f&&(r=u==="image/tiff"?t.supportedFeatures.tiffPreviews:!0),r||i(e+" is not previewable in this browser per the blob's type attr"),r}})};t.Identify.prototype.PREVIEWABLE_MIME_TYPES={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]};t.ImageValidation=function(n,i){"use strict";function r(n){var i=!1;return t.each(n,function(n,t){if(t>0)return i=!0,!1}),i}function u(){var r=new t.Promise;return new t.Identify(n,i).isPreviewable().then(function(){var t=new Image,u=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;u?(t.onerror=function(){i("Cannot determine dimensions for image.  May be too large.","error");r.failure()},t.onload=function(){r.success({width:this.width,height:this.height})},t.src=u.createObjectURL(n)):(i("No createObjectURL function available to generate image URL!","error"),r.failure())},r.failure),r}function f(n,i){var r;return t.each(n,function(n,t){if(t>0){var u=/(max|min)(Width|Height)/.exec(n),e=u[2].charAt(0).toLowerCase()+u[2].slice(1),f=i[e];switch(u[1]){case"min":if(f<t)return r=n,!1;break;case"max":if(f>t)return r=n,!1}}}),r}this.validate=function(n){var e=new t.Promise;return i("Attempting to validate image."),r(n)?u().then(function(t){var i=f(n,t);i?e.failure(i):e.success()},e.success):e.success(),e}};t.Session=function(n){"use strict";function r(n){if(t.isArray(n))return!0;i.log("Session response is not an array.","error")}function u(n,u,f,e){var o=!1;u=u&&r(n);u&&t.each(n,function(n,r){if(r.uuid==null)o=!0,i.log(t.format("Session response item {} did not include a valid UUID - ignoring.",n),"error");else if(r.name==null)o=!0,i.log(t.format("Session response item {} did not include a valid name - ignoring.",n),"error");else try{return i.addFileRecord(r),!0}catch(u){o=!0;i.log(u.message,"error")}return!1});e[u&&!o?"success":"failure"](n,f)}var i={endpoint:null,params:{},customHeaders:{},cors:{},addFileRecord:function(){},log:function(){}};t.extend(i,n,!0);this.refresh=function(){var n=new t.Promise,r=function(t,i,r){u(t,i,r,n)},f=t.extend({},i),e=new t.SessionAjaxRequester(t.extend(f,{onComplete:r}));return e.queryServer(),n}};t.SessionAjaxRequester=function(n){"use strict";function u(n,r,u){var f=null;if(r.responseText!=null)try{f=t.parseJson(r.responseText)}catch(e){i.log("Problem parsing session response: "+e.message,"error");u=!0}i.onComplete(f,!u,r)}var r,i={endpoint:null,customHeaders:{},params:{},cors:{expected:!1,sendCredentials:!1},onComplete:function(){},log:function(){}};t.extend(i,n);r=t.extend(this,new t.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",endpointStore:{get:function(){return i.endpoint}},customHeaders:i.customHeaders,log:i.log,onComplete:u,cors:i.cors}));t.extend(this,{queryServer:function(){var n=t.extend({},i.params);i.log("Session query request.");r.initTransport("sessionRefresh").withParams(n).withCacheBuster().send()}})};t.Scaler=function(n,i){"use strict";var l=this,u=n.customResizer,f=n.sendOriginal,e=n.orient,o=n.defaultType,s=n.defaultQuality/100,h=n.failureText,c=n.includeExif,r=this._getSortedSizes(n.sizes);t.extend(this,{enabled:t.supportedFeatures.scaling&&r.length>0,getFileRecords:function(n,l,a){var y=this,p=[],v=a.blob?a.blob:a,w=new t.Identify(v,i);return w.isPreviewableSync()?(t.each(r,function(n,r){var f=y._determineOutputType({defaultType:o,requestedType:r.type,refType:v.type});p.push({uuid:t.getUniqueId(),name:y._getName(l,{name:r.name,type:f,refType:v.type}),blob:new t.BlobProxy(v,t.bind(y._generateScaledImage,y,{customResizeFunction:u,maxSize:r.maxSize,orient:e,type:f,quality:s,failedText:h,includeExif:c,log:i}))})}),p.push({uuid:n,name:l,size:v.size,blob:f?v:null})):p.push({uuid:n,name:l,size:v.size,blob:v}),p},handleNewFile:function(n,i,r,u,f,e,o,s){var v=this,w=n.qqButtonId||n.blob&&n.blob.qqButtonId,l=[],h=null,y=s.addFileToHandler,c=s.uploadData,a=s.paramsStore,p=t.getUniqueId();t.each(v.getFileRecords(r,i,n),function(n,i){var u=i.size,r;i.blob instanceof t.BlobProxy&&(u=-1);r=c.addFile({uuid:i.uuid,name:i.name,size:u,batchId:e,proxyGroupId:p});i.blob instanceof t.BlobProxy?l.push(r):h=r;i.blob?(y(r,i.blob),f.push({id:r,file:i.blob})):c.setStatus(r,t.status.REJECTED)});h!==null&&(t.each(l,function(n,t){var i={qqparentuuid:c.retrieve({id:h}).uuid,qqparentsize:c.retrieve({id:h}).size};i[o]=c.retrieve({id:t}).uuid;c.setParentId(t,h);a.addReadOnly(t,i)}),l.length&&function(){var n={};n[o]=c.retrieve({id:h}).uuid;a.addReadOnly(h,n)}())}})};t.extend(t.Scaler.prototype,{scaleImage:function(n,i,r){"use strict";if(!t.supportedFeatures.scaling)throw new t.Error("Scaling is not supported in this browser!");var u=new t.Promise,e=r.log,o=r.getFile(n),f=r.uploadData.retrieve({id:n}),s=f&&f.name,h=f&&f.uuid,c={customResizer:i.customResizer,sendOriginal:!1,orient:i.orient,defaultType:i.type||null,defaultQuality:i.quality,failedToScaleText:"Unable to scale",sizes:[{name:"",maxSize:i.maxSize}]},l=new t.Scaler(c,e);return t.Scaler&&t.supportedFeatures.imagePreviews&&o?t.bind(function(){var i=l.getFileRecords(h,s,o)[0];i&&i.blob instanceof t.BlobProxy?i.blob.create().then(u.success,u.failure):(e(n+" is not a scalable image!","error"),u.failure())},this)():(u.failure(),e("Could not generate requested scaled image for "+n+".  Scaling is either not possible in this browser, or the file could not be located.","error")),u},_determineOutputType:function(n){"use strict";var i=n.requestedType,r=n.defaultType,u=n.refType;return!r&&!i?u!=="image/jpeg"?"image/png":u:i?t.indexOf(Object.keys(t.Identify.prototype.PREVIEWABLE_MIME_TYPES),i)>=0?i==="image/tiff"?t.supportedFeatures.tiffPreviews?i:r:i:r:r},_getName:function(n,i){"use strict";var f=n.lastIndexOf("."),e=i.type||"image/png",s=i.refType,r="",o=t.getExtension(n),u="";return i.name&&i.name.trim().length&&(u=" ("+i.name+")"),f>=0?(r=n.substr(0,f),s!==e&&(o=e.split("/")[1]),r+=u+"."+o):r=n+u,r},_getSortedSizes:function(n){"use strict";return n=t.extend([],n),n.sort(function(n,t){return n.maxSize>t.maxSize?1:n.maxSize<t.maxSize?-1:0})},_generateScaledImage:function(n,i){"use strict";var o=this,s=n.customResizeFunction,r=n.log,h=n.maxSize,c=n.orient,f=n.type,l=n.quality,a=n.failedText,v=n.includeExif&&i.type==="image/jpeg"&&f==="image/jpeg",u=new t.Promise,y=new t.ImageGenerator(r),e=document.createElement("canvas");return r("Attempting to generate scaled version for "+i.name),y.generate(i,e,{maxSize:h,orient:c,customResizeFunction:s}).then(function(){var n=e.toDataURL(f,l),s=function(){r("Success generating scaled version for "+i.name);var f=t.dataUriToBlob(n);u.success(f)};v?o._insertExifHeader(i,n,r).then(function(t){n=t;s()},function(){r("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.","error");s()}):s()},function(){r("Failed attempt to generate scaled version for "+i.name,"error");u.failure(a)}),u},_insertExifHeader:function(n,i,r){"use strict";var u=new FileReader,f=new t.Promise,e="";return u.onload=function(){e=u.result;f.success(t.ExifRestorer.restore(e,i))},u.onerror=function(){r("Problem reading "+n.name+" during attempt to transfer EXIF data to scaled version.","error");f.failure()},u.readAsDataURL(n),f},_dataUriToBlob:function(n){"use strict";var i,u,r,f;return i=n.split(",")[0].indexOf("base64")>=0?atob(n.split(",")[1]):decodeURI(n.split(",")[1]),u=n.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(i.length),f=new Uint8Array(r),t.each(i,function(n,t){f[n]=t.charCodeAt(0)}),this._createBlob(r,u)},_createBlob:function(n,t){"use strict";var r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=r&&new r;return i?(i.append(n),i.getBlob(t)):new Blob([n],{type:t})}});t.ExifRestorer=function(){var n={};return n.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n.encode64=function(n){var o="",u,t,i="",s,h,f,r="",e=0;do u=n[e++],t=n[e++],i=n[e++],s=u>>2,h=(u&3)<<4|t>>4,f=(t&15)<<2|i>>6,r=i&63,isNaN(t)?f=r=64:isNaN(i)&&(r=64),o=o+this.KEY_STR.charAt(s)+this.KEY_STR.charAt(h)+this.KEY_STR.charAt(f)+this.KEY_STR.charAt(r),u=t=i="",s=h=f=r="";while(e<n.length);return o},n.restore=function(n,t){var i="data:image/jpeg;base64,";if(!n.match(i))return t;var r=this.decode64(n.replace(i,"")),u=this.slice2Segments(r),f=this.exifManipulation(t,u);return i+this.encode64(f)},n.exifManipulation=function(n,t){var i=this.getExifArray(t),r=this.insertExif(n,i);return new Uint8Array(r)},n.getExifArray=function(n){for(var t,i=0;i<n.length;i++)if(t=n[i],t[0]==255&t[1]==225)return t;return[]},n.insertExif=function(n,t){var f=n.replace("data:image/jpeg;base64,",""),i=this.decode64(f),u=i.indexOf(255,3),e=i.slice(0,u),o=i.slice(u),r=e;return r=r.concat(t),r.concat(o)},n.slice2Segments=function(n){for(var t=0,i=[];;){if(n[t]==255&n[t+1]==218)break;if(n[t]==255&n[t+1]==216)t+=2;else{var u=n[t+2]*256+n[t+3],r=t+u+2,f=n.slice(t,r);i.push(f);t=r}if(t>n.length)break}return i},n.decode64=function(n){var e,o,s="",h,r,t,u="",i=0,f=[];if(/[^A-Za-z0-9\+\/\=]/g.exec(n))throw new Error("There were invalid base64 characters in the input text.  Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");do h=this.KEY_STR.indexOf(n.charAt(i++)),r=this.KEY_STR.indexOf(n.charAt(i++)),t=this.KEY_STR.indexOf(n.charAt(i++)),u=this.KEY_STR.indexOf(n.charAt(i++)),e=h<<2|r>>4,o=(r&15)<<4|t>>2,s=(t&3)<<6|u,f.push(e),t!=64&&f.push(o),u!=64&&f.push(s),e=o=s="",h=r=t=u="";while(i<n.length);return f},n}();t.TotalProgress=function(n,i){"use strict";var r={},f=0,u=0,o=-1,s=-1,h=function(t,i){(t!==o||i!==s)&&n(t,i);o=t;s=i},l=function(n,i){var r=!0;return t.each(n,function(n,u){if(t.indexOf(i,u)>=0)return r=!1,!1}),r},a=function(n){e(n,-1,-1);delete r[n]},v=function(n,t,i){(t.length===0||l(t,i))&&(h(u,u),this.reset())},c=function(n){var t=i(n);t>0&&(e(n,0,t),r[n]={loaded:0,total:t})},e=function(n,t,i){var e=r[n]?r[n].loaded:0,o=r[n]?r[n].total:0;t===-1&&i===-1?(f-=e,u-=o):(t&&(f+=t-e),i&&(u+=i-o));h(f,u)};t.extend(this,{onAllComplete:v,onStatusChange:function(n,i,r){r===t.status.CANCELED||r===t.status.REJECTED?a(n):r===t.status.SUBMITTING&&c(n)},onIndividualProgress:function(n,t,i){e(n,t,i);r[n]={loaded:t,total:i}},onNewSize:function(n){c(n)},reset:function(){r={};f=0;u=0}})};t.PasteSupport=function(n){"use strict";function u(n){return n.type&&n.type.indexOf("image/")===0}function f(){r=t(i.targetElement).attach("paste",function(n){var r=n.clipboardData;r&&t.each(r.items,function(n,t){if(u(t)){var r=t.getAsFile();i.callbacks.pasteReceived(r)}})})}function e(){r&&r()}var i,r;i={targetElement:null,callbacks:{log:function(){},pasteReceived:function(){}}};t.extend(i,n);f();t.extend(this,{reset:function(){e()}})};t.FormSupport=function(n,i,r){"use strict";function h(n){n.getAttribute("action")&&(f.newEndpoint=n.getAttribute("action"))}function e(n,t){if(n.checkValidity&&!n.checkValidity())r("Form did not pass validation checks - will not upload.","error"),t();else return!0}function c(n){var r=n.submit;t(n).attach("submit",function(t){t=t||window.event;t.preventDefault?t.preventDefault():t.returnValue=!1;e(n,r)&&i()});n.submit=function(){e(n,r)&&i()}}function l(n){return n&&(t.isString(n)&&(n=document.getElementById(n)),n&&(r("Attaching to form element."),h(n),o&&c(n))),n}var f=this,o=n.interceptSubmit,u=n.element,s=n.autoUpload;t.extend(this,{newEndpoint:null,newAutoUpload:s,attachedToForm:!1,getFormInputsAsObject:function(){return u==null?null:f._form2Obj(u)}});u=l(u);this.attachedToForm=!!u};t.extend(t.FormSupport.prototype,{_form2Obj:function(n){"use strict";var i={},u=function(n){return t.indexOf(["button","image","reset","submit"],n.toLowerCase())<0},f=function(n){return t.indexOf(["checkbox","radio"],n.toLowerCase())>=0},r=function(n){return f(n.type)&&!n.checked?!0:n.disabled&&n.type.toLowerCase()!=="hidden"},e=function(n){var i=null;return t.each(t(n).children(),function(n,t){if(t.tagName.toLowerCase()==="option"&&t.selected)return i=t.value,!1}),i};return t.each(n.elements,function(n,f){if((t.isInput(f,!0)||f.tagName.toLowerCase()==="textarea")&&u(f.type)&&!r(f))i[f.name]=f.value;else if(f.tagName.toLowerCase()==="select"&&!r(f)){var o=e(f);o!==null&&(i[f.name]=o)}}),i}});t.traditional=t.traditional||{};t.traditional.FormUploadHandler=function(n,i){"use strict";function o(n,t){var f,e,i;try{e=t.contentDocument||t.contentWindow.document;i=e.body.innerHTML;u("converting iframe's innerHTML to JSON");u("innerHTML = "+i);i&&i.match(/^<pre/i)&&(i=e.body.firstChild.firstChild.nodeValue);f=r._parseJsonResponse(i)}catch(o){u("Error when attempting to parse form upload response ("+o.message+")","error");f={success:!1}}return f}function s(t,i){var u=n.paramsStore.get(t),o=n.method.toLowerCase()==="get"?"GET":"POST",s=n.endpointStore.get(t),h=f(t);return u[n.uuidName]=e(t),u[n.filenameParam]=h,r._initFormForUpload({method:o,endpoint:s,params:u,paramsInBody:n.paramsInBody,targetName:i.name})}var r=this,f=i.getName,e=i.getUuid,u=i.log;this.uploadFile=function(i){var c=r.getInput(i),f=r._createIframe(i),h=new t.Promise,e;return e=s(i,f),e.appendChild(c),r._attachLoadEvent(f,function(e){u("iframe loaded");var s=e?e:o(i,f);r._detachLoadEvent(i);n.cors.expected||t(f).remove();s.success?h.success(s):h.failure(s)}),u("Sending upload request for "+i),e.submit(),t(e).remove(),h};t.extend(this,new t.FormUploadHandler({options:{isCors:n.cors.expected,inputName:n.inputName},proxy:{onCancel:n.onCancel,getName:f,getUuid:e,log:u}}))};t.traditional=t.traditional||{};t.traditional.XhrUploadHandler=function(n,i){"use strict";var r=this,o=i.getName,s=i.getSize,h=i.getUuid,u=i.log,f=n.forceMultipart||n.paramsInBody,v=function(t,i,r){var u=s(t),e=o(t);n.omitDefaultParams||(i[n.chunking.paramNames.partIndex]=r.part,i[n.chunking.paramNames.partByteOffset]=r.start,i[n.chunking.paramNames.chunkSize]=r.size,i[n.chunking.paramNames.totalParts]=r.count,i[n.totalFileSizeName]=u);f&&!n.omitDefaultParams&&(i[n.filenameParam]=e)},y=new t.traditional.AllChunksDoneAjaxRequester({cors:n.cors,endpoint:n.chunking.success.endpoint,headers:n.chunking.success.headers,jsonPayload:n.chunking.success.jsonPayload,log:u,method:n.chunking.success.method,params:n.chunking.success.params}),c=function(n,i){var r=new t.Promise;return i.onreadystatechange=function(){if(i.readyState===4){var t=b(n,i);t.success?r.success(t.response,i):r.failure(t.response,i)}},r},p=function(t){var i=n.paramsStore.get(t),u=o(t),f=s(t);return i[n.uuidName]=h(t),i[n.filenameParam]=u,i[n.totalFileSizeName]=f,i[n.chunking.paramNames.totalParts]=r._getTotalChunks(t),i},w=function(i,r){return t.indexOf([200,201,202,203,204],i.status)<0||n.requireSuccessJson&&!r.success||r.reset},b=function(n,t){var i;return u("xhr - server response received for "+n),u("responseText = "+t.responseText),i=e(!0,t),{success:!w(t,i),response:i}},e=function(i,r){var f={};try{u(t.format("Received response status {} with body: {}",r.status,r.responseText));f=t.parseJson(r.responseText)}catch(e){i&&n.requireSuccessJson&&u("Error when attempting to parse xhr response text ("+e.message+")","error")}return f},k=function(i){var u=new t.Promise;return y.complete(i,r._createXhr(i),p(i),n.customHeaders.get(i)).then(function(n){u.success(e(!1,n),n)},function(n){u.failure(e(!1,n),n)}),u},l=function(i){var a=i.fileOrBlob,u=i.id,v=i.xhr,e=i.xhrOverrides||{},y=i.customParams||{},b=i.params||{},p=e.params||{},r,c=f?new FormData:null,k=e.method||n.method,l=e.endpoint||n.endpointStore.get(u),w=o(u),d=s(u);return(n.omitDefaultParams?(r=t.extend({},y),t.extend(r,p)):(r=t.extend({},y),t.extend(r,p),t.extend(r,b),r[n.uuidName]=h(u),r[n.filenameParam]=w,f?r[n.totalFileSizeName]=d:n.paramsInBody||(r[n.inputName]=w)),n.paramsInBody||(l=t.obj2url(r,l)),v.open(k,l,!0),n.cors.expected&&n.cors.sendCredentials&&(v.withCredentials=!0),f)?(n.paramsInBody&&t.obj2FormData(r,c),c.append(n.inputName,a),c):a},a=function(i){var e=i.headerOverrides,o=i.id,u=i.xhr,s,h;e?t.each(e,function(n,t){u.setRequestHeader(n,t)}):(s=n.customHeaders.get(o),h=r.getFile(o),u.setRequestHeader("Accept","application/json"),u.setRequestHeader("X-Requested-With","XMLHttpRequest"),u.setRequestHeader("Cache-Control","no-cache"),f||(u.setRequestHeader("Content-Type","application/octet-stream"),u.setRequestHeader("X-Mime-Type",h.type)),t.each(s,function(n,t){u.setRequestHeader(n,t)}))};t.extend(this,{uploadChunk:function(t){var i=t.id,f=t.chunkIdx,s=t.overrides||{},w=t.resuming,e=r._getChunkData(i,f),u=r._createXhr(i,f),h,y,p,o={};return h=c(i,u),r._registerProgressHandler(i,f,e.size),p=n.paramsStore.get(i),v(i,o,e),w&&(o[n.resume.paramNames.resuming]=!0),y=l({fileOrBlob:e.blob,id:i,customParams:p,params:o,xhr:u,xhrOverrides:s}),a({headerOverrides:s.headers,id:i,xhr:u}),u.send(y),h},uploadFile:function(t){var o=r.getFile(t),u,i,f,e;return i=r._createXhr(t),r._registerProgressHandler(t),u=c(t,i),f=n.paramsStore.get(t),e=l({fileOrBlob:o,id:t,customParams:f,xhr:i}),a({id:t,xhr:i}),i.send(e),u}});t.extend(this,new t.XhrUploadHandler({options:t.extend({namespace:"traditional"},n),proxy:t.extend({getEndpoint:n.endpointStore.get},i)}));t.override(this,function(r){return{finalizeChunks:function(u){i.onFinalizing(u);return n.chunking.success.endpoint?k(u):r.finalizeChunks(u,t.bind(e,this,!0))}}})};t.traditional.AllChunksDoneAjaxRequester=function(n){"use strict";var u,i={cors:{allowXdr:!1,expected:!1,sendCredentials:!1},endpoint:null,log:function(){},method:"POST"},r={},f={get:function(n){return t.isFunction(i.endpoint)?i.endpoint(n):i.endpoint}};t.extend(i,n);u=t.extend(this,new t.AjaxRequester({acceptHeader:"application/json",contentType:i.jsonPayload?"application/json":"application/x-www-form-urlencoded",validMethods:[i.method],method:i.method,endpointStore:f,allowXRequestedWithAndCacheControl:!1,cors:i.cors,log:i.log,onComplete:function(n,t,i){var u=r[n];delete r[n];i?u.failure(t):u.success(t)}}));t.extend(this,{complete:function(n,f,e,o){var s=new t.Promise;return i.log("Submitting All Chunks Done request for "+n),r[n]=s,u.initTransport(n).withParams(i.params(n)||e).withHeaders(i.headers(n)||o).send(f),s}})}}(window);var Media=function(){function c(){return s||(s={typeError:Translations.get(Translations.keys.UNSUPPORTED_FILE_TYPE),sizeError:Translations.get(Translations.keys.ERROR_FILE_SIZE),minSizeError:"",emptyError:"",onLeave:"",notSupported:Translations.get(Translations.keys.UPLOAD_NOT_ALLOWED)}),s}function i(n,t,i,r,u,f){var e={button:n,request:{endpoint:t},multiple:i?!0:!1,preventDefault:!0,messages:c(),callbacks:r,text:{fileInputTitle:n.getAttribute("data-input-title")}};return isObject(u)&&(e.request.params=u),isObject(f)&&(e.validation=f),e}function u(n){return n.getAttribute("data-multiple")!=null}function l(n){function r(n){return t.push(n),!0}function i(n){for(var r=typeof n,i=0;i<t.length;i++)if(t[i].UID==n)return t[i];return null}function u(n){var t=i(n.toString());return t?(t.Deleted=!0,!0):!1}function f(n){if(t.length==0)return"";var i=JSON.stringify(t);return n?encodeURIComponent(i):i}function e(){for(var n=0;n<t.length;n++)if(t[n].Deleted==!1&&t[n].IsTemp||t[n].Deleted&&t[n].IsTemp==!1)return!0;return!1}var t=n;return{addItem:r,getItem:i,deleteItem:u,IsUploading:!1,serialize:f,ItemList:t,hasNewMedia:e}}function f(n,t,i,r,u){typeof i=="string"&&(i=document.querySelector(i));var f,e;return(n.MyMedia=l(ensureArray(t)),r||(r=n.parentNode),f=r.querySelector(".EgoUpload"),!f&&i&&(f=i.querySelector(".EgoUpload")),!f)?null:(i?i.id?e=i.id:(e=guid(),i.setAttribute("id",e)):e=n.id,f.setAttribute("data-lock-id",e),f.setAttribute("data-attach-ctx-id",n.id),EventHandler.addListener(f,"click",function(n){var t=document.getElementById(this.getAttribute("data-attach-ctx-id"));return t?t.MyMedia.IsUploading?(MessageBox.alert(Translations.get(Translations.keys.CurrentlyUploadingFile)),stopEventPropagation(n,!0),!1):!u&&!Limit.withinLimit(Limit.LimitType.AddMedia)?(n.preventDefault(),stopEventPropagation(n,!0),!1):void 0:!1}),f)}function p(n,t,i){var r;return t.MyMedia=l([]),i?i.id?r=i.id:(r=guid(),i.setAttribute("id",r)):r=t.id,n.setAttribute("data-lock-id",r),n.setAttribute("data-attach-ctx-id",t.id),EventHandler.addListener(n,"click",function(n){var t=document.getElementById(this.getAttribute("data-attach-ctx-id"));return t?t.MyMedia.IsUploading?(MessageBox.alert(Translations.get(Translations.keys.CurrentlyUploadingFile)),stopEventPropagation(n,!0),!1):Limit.withinLimit(Limit.LimitType.AddMedia)?void 0:(stopEventPropagation(n,!0),!1):!1}),n}function a(n){var i=n.getAttribute("data-loading-uid"),t=n.up().querySelector("."+i);return t||(t=createHtmlElement("div",{id:"attachLoading","class":"loading "+i},[createHtmlElement("i",{"class":"icon-loading"})]),n.getAttribute("data-loading-position")=="before"?n.up().insertBefore(t,n):n.tryAddAfter(t)),t}function e(n){var t=n?document.getElementById(n.getAttribute("data-attach-ctx-id")):null;t&&(t.MyMedia.IsUploading=!0,Element.show(a(n)))}function t(n,t){var i=n?document.getElementById(n.getAttribute("data-lock-id")):null;i&&(t?i.removeAttribute("ajaxRequest"):i.setAttribute("ajaxRequest","true"))}function w(n,t,i){var e,o,u,f,r;return t=t||"",i=i||"",e=createHtmlElement("a",{href:"javascript:void(0);","class":"blueOutlineBtn",onclick:'Media.removeMedia(this, "'+t+'", "'+i+'");',title:Translations.get(Translations.keys.Delete)}),e.appendChild(createHtmlElement("i",{"class":"icon-fechar"})),o=createHtmlElement("div",{"class":"clearContent"}),o.appendChild(e),u=createHtmlElement("a",{href:n.Src,"class":"grayLink",download:n.Name,target:"_blank",title:n.Name}),u.appendChild(createHtmlElement("i",{"class":"icon-doc"})),u.appendChild(document.createTextNode(" "+n.Name)),f=createHtmlElement("div",{"class":"userTeamCard"}),f.appendChild(o),f.appendChild(u),r=createHtmlElement("div",{id:"AttachAsset_"+n.UID,"class":"col-4 AttachAsset"}),r.setAttribute("data-id",n.ID),r.setAttribute("data-uid",n.UID),r.appendChild(f),r}function b(t){switch(t){case n.AttachmentsOnProposalList:return!1;default:return!0}}function o(t,i,r,u){var f,c,l,e,v;if(t){f=document.getElementById(t.getAttribute("data-attach-ctx-id"));Element.hide(a(t));var h="",o=!1,s=null;if(typeof r!="number"&&(r=parseInt(t.getAttribute("data-upload-type"))||n.Attachments),i)switch(r){case n.FileArchive:i.status==ajaxRequest.StatusType.Success&&isObject(i.data)&&i.data.mediaHtml&&(Element.hide(f.querySelector(".NoContentMessage")),e=htmlStringToElement(i.data.mediaHtml),e.style.display="none",c=f.querySelector(".SubLevelContext"),c?c.up().insertBefore(e,c):f.appendChild(e),$(e).fadeIn(),o=!0);break;case n.AgencyNews:i.status==ajaxRequest.StatusType.Success&&isObject(i.data)&&i.data.mediaHtml&&i.data.isAgencyNewsUpload?i.data.mediaList&&i.data.mediaList.length>0&&(s=[],JSON.parse(i.data.mediaList).forEach(function(n){f.MyMedia.addItem(n);s.push(n)}),i.data.isDocument?document.querySelector(".agencyNewsFileContainer").innerHTML+=i.data.mediaHtml:document.querySelector(".contentPhotos").innerHTML+=i.data.mediaHtml,o=!0):i.status==ajaxRequest.StatusType.Success&&isObject(i.data)&&i.data.mediaHtml&&i.data.isVideo&&(i.data.mediaList&&i.data.mediaList.length>0&&(f.MyMedia.addItem(JSON.parse(i.data.mediaList)),document.querySelector(".contentVideos").innerHTML+=i.data.mediaHtml,o=!0,s=f.MyMedia.ItemList.last()),Popup.close());break;case n.EntityBlacklist:i.status==ajaxRequest.StatusType.Success&&isObject(i.data)&&i.data.mediaHtml&&i.data.mediaItem&&(f.MyMedia.addItem(i.data.mediaItem)&&(e=htmlStringToElement(i.data.mediaHtml),f.appendChild(e),o=!0,s=f.MyMedia.ItemList.last()),o||(h=i.error));break;case n.UploadRemaxImport:if(i.status==ajaxRequest.StatusType.Success){if(i.updates&&$(i.updates).length>0)for(key in i.updates)content=i.updates[key],content&&document.querySelectorAll(key).forEach(function(n){$(n).html(content)});o=!0}o||(h=i.error);break;case n.TimelineFile:i.status==ajaxRequest.StatusType.Success&&isObject(i.data)&&i.data.mediaHtml&&(e=htmlStringToElement(i.data.mediaHtml),e.style.display="none",f.hide(),t.hide(),f.up().appendChild(e),$(e).fadeIn(),o=!0);break;case n.ContractTemplate:i&&i.status===ajaxRequest.StatusType.Success&&(o=!0);break;case n.CompanyImages:case n.EntityAvatar:case n.AttachmentsOnProposalList:case n.AttachmentsOnProposalPopup:case n.Attachments:default:i&&(i.success&&(l=i.MediaItem||i.Media,f.MyMedia.addItem(l)&&(b(r)&&(e=w(l,f.getAttribute("data-delete-url"),f.getAttribute("data-delete-params")),e.style.display="none",f.appendChild(e),$(e).fadeIn()),o=!0,s=f.MyMedia.ItemList.last())),o||(h=i.error||i.message))}return o?typeof u==typeof Function&&u(f,t,s):MessageBox.alert(h||Translations.get(Translations.keys.ErrorUploadingFile)),t._uplHandler?(v=t._uplHandler.getRemainingAllowedItems(),f.MyMedia.IsUploading=v&&v.length>0):f.MyMedia.IsUploading=!1,f}}function r(n){n.MyMedia.hasNewMedia()?n.querySelector(".newMedia")||n.appendChild(createHtmlElement("input",{type:"hidden",name:"_mediaChk","class":"newMedia",value:"1"})):n.querySelectorAll(".newMedia").invoke("remove")}function k(n){return n?parseInt(n.getAttribute("data-size-limit"))||0:0}function d(n){if(!n)return[];var t=n.getAttribute("data-formats");return t?(t=t.replace(/[\*\.]/g,""),t.split(",")):[]}function v(n,t){var i,r;return n?(i=n.getAttribute("data-formats"),i=="")?!0:(r=","+t.substring(t.lastIndexOf(".")).toLowerCase()+",",(","+i.replace(/\*/g,"")+",").indexOf(r)==-1)?(MessageBox.alert(Translations.get(Translations.keys.UnsupportedFileType)),!1):!0:!0}function y(n,s,h,l,a,v,y,p){var g=typeof n=="string"?document.querySelector(n):n,w,b,nt,tt;if(g&&(w=g.querySelector(".AttachList"),w)){if(w.id||(w.id="AttachList_"+shortGuid()),g.setAttribute("data-attach-list",w.id),b=f(w,h,l,null,p),!b){console.warn("Media[_setupUpload]: button not found. execution has stopped for the following target:");console.log(n);return}nt={onSubmit:function(){e(this._options.button);t(this._options.button,!1)},onComplete:function(n,i,u){var f=o(this._options.button,u,a,y);r(f);t(this._options.button,!0)},onError:function(n,t,i){if(i){var r=!1;forEachProp(c(),function(n,t){if(t[n]===i)return r=!0,!1});r&&MessageBox.alert(i)}}};tt={sizeLimit:k(w),allowedExtensions:d(w)};b._uplHandler=new qq.FineUploaderBasic(i(b,s,u(w),nt,v,tt))}}function h(n){return n.classList.contains("AttachList")?n:n.hasAttribute("data-attach-list")?n.querySelector("#"+n.getAttribute("data-attach-list")):null}var n=Object.freeze({Attachments:0,FileArchive:1,AgencyNews:2,EntityBlacklist:3,Video:4,UploadRemaxImport:5,TimelineFile:6,AttachmentsOnProposalList:7,AttachmentsOnProposalPopup:8,ExtranetMessage:9,ContractTemplate:10,CompanyImages:11,EntityAvatar:12}),s=null;return{UploadHandlerType:n,removeMedia:function(n,t,i,u){var f=n.classList.contains("AttachAsset")&&n||n.up(".AttachAsset")||$(n).parents(".userTeamCard:first").parent().get(),e,s,o;if(!f){console.error("Media.removeMedia: caller invalido.");console.log(n);return}if(e=f.getAttribute("data-uid"),s=f.getAttribute("data-id"),!e){console.error("Media.removeMedia: UID nao encontrado.");console.log(n);console.log(f);return}o=function(n,t){var i=n.up(".AttachList"),u;i?(i.MyMedia.deleteItem(t)&&Element.remove(i.querySelector('[id="AttachAsset_'+t+'"]')),r(i),u=i.querySelector(".EgoUpload"),u&&u.style.display=="none"&&u.show()):n.up(".inputInfoContent")&&(i=n.up(".inputInfoContent").querySelector(".AttachList"),i.MyMedia.deleteItem(t)&&Element.remove(i.querySelector('[id="AttachAsset_'+t+'"]')),r(i))};t&&i?(u=u||"POST",i=appendStringParams(i,Requests.getPair(Requests.keys.MediaID,s)),ajaxRequest(n,t,u,i,function(t){t.status===ajaxRequest.StatusType.Success&&o(n,e)})):o(n,e)},markChanges:r,getBasicOptions:i,setupUpload:y,setupUploadWebSites:function(r,s,h,c,l){var y=r.querySelector(".AttachList"),a;if(y){if(a=f(y,h,l),!a){console.warn("Media.setupUploadWebSites: button not found. execution has stopped for the following target:");console.log(r);return}a._uplHandler=new qq.FineUploaderBasic(i(a,s,u(y),{onSubmit:function(n,i){if(v(r,i)===!1)return!1;var u=this._options.button.up("#contentPlugin");u;e(this._options.button);t(this._options.button,!1)},onComplete:function(i,r,u){o(this._options.button,u,n.Attachments);c&&WebSiteTemplate.SetChanges(c);t(this._options.button,!0)}}))}},setupUploadFileArchive:function(r,s,h,c,l){var v=r.querySelectorAll(".AttachList"),a,y,d,b,p,g,w,k;if(v&&v.length!=0)for(w=0;w<v.length;w++)(a=v[w],y=a.getAttribute("data-upload-map-key"),a&&y)&&(d=h[y]||[],b=a.up(".ArchiveBox"),p=f(a,d,b,b),p&&(g={onSubmit:function(){e(this._options.button);t(this._options.button,!1)},onComplete:function(i,r,u){var f=o(this._options.button,u,n.FileArchive,l);t(this._options.button,!0)}},k=HttpUtility.queryToObject(c),k[Requests.get(Requests.keys.CategoryID)]=y,p._uplHandler=new qq.FineUploaderBasic(i(p,s,u(a),g,k))))},setupUploadContactByFile:function(n,f,o,s,h){var c=n.querySelector(".AttachList"),v,y,w,l,b,a;if(c){if(v=[],y=n.getAttribute("data-allowedExtensions").split(".").join(""),y!=null)for(w=y.split(","),l=0;l<w.length;l++)v.push(w[l]);if(b={allowedExtensions:v},a=p(n,c,o),!a){console.warn("Media.setupUploadContactByFile: button not found. execution has stopped for the following target:");console.log(n);return}a._uplHandler=new qq.FineUploaderBasic(i(a,f,u(c),{onSubmit:function(i,r){if(n.getAttribute("data-allowedextensions")!=""){var u=","+r.substring(r.lastIndexOf(".")).toLowerCase()+",";if((","+n.getAttribute("data-allowedextensions").replace(/\*/g,"")+",").indexOf(u)==-1)return MessageBox.alert(Translations.get(Translations.keys.UNSUPPORTED_FILE_TYPE)),!1}e(this._options.button);t(this._options.button,!1);Loading.show()},onComplete:function(n,i,u){if(Loading.hide(),u.success){var f=[];f.push(Requests.get(Requests.keys.FileName)+"="+i);f.push(Requests.get(Requests.keys.FilePath)+"="+encodeURIComponent(u.MediaItem.PhysicalPath+u.MediaItem.File));f.push(Requests.get(Requests.keys.FileFormat)+"="+h);f=f.filter(function(n){return n.length}).join("&");Entity.openImportEntityByFilePopup("",s,f)}r(c);t(this._options.button,!0)},onError:function(n,t,i){console.log(i);MessageBox.alert(Translations.get(Translations.keys.GenericError))}},null,b))}},setupUploadBlacklist:function(s,h,c){var a=s.querySelector(".AttachList"),l,v;if(a){if(l=f(a,[],c),!l){console.warn("Media.setupUploadBlacklist: button not found. execution has stopped for the following target:");console.log(s);return}v={onSubmit:function(){e(this._options.button);t(this._options.button,!1)},onComplete:function(i,u,f){var e=o(this._options.button,f,n.EntityBlacklist);r(e);t(this._options.button,!0)}};l&&(l._uplHandler=new qq.FineUploaderBasic(i(l,h,u(a),v)))}},replaceUploaderHtml:function(n,t){var i,r;n&&typeof t=="string"&&(i=n.querySelector(".AttachList"),i)&&(r=i.parentNode,i.remove(),n.querySelector(".EgoUpload").remove(),Element.remove(n.querySelector("#attachLoading")),r)&&(r.innerHTML+=t)},setupUploadAgencyNewsVideo:function(n,e,s,h,c,l){var a=n.querySelector(".AttachList"),v;if(a){if(v=f(a,h,c),!v){console.warn("Media.setupUploadAgencyNewsVideo: button not found. execution has stopped for the following target:");console.log(n);return}YoutubeExporter.directUploadHandler&&YoutubeExporter.directUploadHandler._button._input.remove();YoutubeExporter.directUploadHandler=new qq.FineUploaderBasic(i(v,e,u(a),{onSubmit:function(n){if($("#galleryInfo").length){var t=$("#galleryInfo").find("*").serializeAll();this.setParams(JSON.parse('{"'+t.replace(/&/g,'","').replace(/=/g,'":"')+'"}',function(n,t){return n===""?t:decodeURIComponent(t)}),n)}else return s(n),!1},onUpload:function(n){if(Loading.show(),$("#galleryInfo").length){var t=$("#galleryInfo").find("*").serializeAll();this.setParams(JSON.parse('{"'+t.replace(/&/g,'","').replace(/=/g,'":"')+'"}',function(n,t){return n===""?t:decodeURIComponent(t)}),n)}},onComplete:function(n,i,u){Loading.hide();var f=o(this._options.button,u,l);r(f);t(this._options.button,!0)}}))}},setupUploadRemaxImport:function(s,h,c,l){var y=s.querySelector(".AttachList"),a;if(y){if(a=f(y,c,l),!a){console.warn("Media.setupUploadRemaxImport: button not found. execution has stopped for the following target:");console.log(s);return}a._uplHandler=new qq.FineUploaderBasic(i(a,h,u(y),{onSubmit:function(n,i){if(a.getAttribute("data-attach-ctx-id")!=""&&v(document.getElementById(a.getAttribute("data-attach-ctx-id")),i)===!1)return!1;e(this._options.button);t(this._options.button,!1)},onComplete:function(i,u,f){var e=o(this._options.button,f,n.UploadRemaxImport);r(e);t(this._options.button,!0)}}))}},setupUploadTimelineFile:function(t,i){t&&t.querySelectorAll(".RelatedMedia:not(.UploadSetupFinished)").forEach(function(t){if(t.querySelector(".EgoUpload")){var r=HttpUtility.queryToObject(decodeURIComponent(t.getAttribute("data-parameters")));y(t,t.getAttribute("data-upload-url"),[],t,n.TimelineFile,r,i);t.addClassName("UploadSetupFinished")}})},bulkMoveAction:function(n,t){if(n){var i=[];$("#FileArchiveCategories input[type='checkbox']").each(function(){this.checked&&i.push(this.getAttribute("data-object-id"))});i&&i.length>0&&ajaxRequest(n,t,"POST",Requests.get(Requests.keys.ObjectIDs)+"="+i)}},bulkDeleteMediasAction:function(n,t,i){if(n){var r=[],u=[];if($("#FileArchiveCategories input[type='checkbox']").each(function(){this.checked&&(r.push(this.getAttribute("data-object-id")),u.push(this))}),r.length>0)MessageBox.confirm(i.format(r.length),Translations.get(Translations.keys.Yes),function(){ajaxRequest(n,t,"POST",Requests.get(Requests.keys.ObjectIDs)+"="+r,function(n){n.status==ajaxRequest.StatusType.Success&&u&&u.length>0&&u.forEach(function(n){if(n){var t=n.up(".dashboardBoxLine");t&&t.remove()}})})},"",Translations.get(Translations.keys.Cancel));else return}},sendAllByEmail:function(n,t,i){var r,u;n&&(r=[],$("#FileArchiveCategories input[type='checkbox']").each(function(){this.checked&&r.push(this.getAttribute("data-object-id"))}),u=i,u+="&"+Requests.get(Requests.keys.ObjectIDs)+"="+r,Email.popup(n,t,u))},serializeTarget:function(n,t){var i,r;return n?(t||(console.warn("Media.serializeTarget: requestKey invalida ou nao fornecida. Será usada a seguinte:"),console.log(Requests.get(Requests.keys.Medias)),t=Requests.get(Requests.keys.Medias)),i=h(n),!i)?(console.error("Media.serializeTarget: contentor de media nao encontrado para o target fornecido."),console.log(n),""):(r=i.MyMedia&&i.MyMedia.ItemList&&i.MyMedia.ItemList.length?i.MyMedia.serialize(!0):"[]",t+"="+r):(console.error("Media.serializeTarget: target invalido ou nao fornecido."),console.log(n),"")},hasMedia:function(n){if(!n)return console.error("Media.hasMedia: target invalido ou nao fornecido."),console.log(n),!1;var t=h(n);return t?t.MyMedia&&t.MyMedia.ItemList&&t.MyMedia.ItemList.length&&t.MyMedia.ItemList.find(function(n){return n.Deleted!=!0})?!0:!1:(console.error("Media.hasMedia: contentor de anexos nao encontrado para o target fornecido."),console.log(n),!1)},getMediaAssets:function(n){if(!n)return console.error("Media.getMediaAssets: target invalido ou nao fornecido."),console.log(n),[];var t=h(n);return t?t.querySelectorAll(".AttachAsset").map(function(n){return n}):(console.error("Media.getMediaAssets: contentor de media nao encontrado para o target fornecido."),console.log(n),[])},contractNextStep:function(n,t,i){var e=n.up(".popupBox"),f=$("#maxStep").val(),r=$("#currentStep").val(),u=parseInt(r,10)+1;i=appendStringParams(i,"step="+u);i=appendStringParams(i,$(e).find("*").serializeAll());ajaxRequest(n,t,"POST",i,function(n){n.status==ajaxRequest.StatusType.Success&&(r>=1&&$("#previousButton").show(),r==parseInt(f,10)-1&&($("#finishButton").show(),$("#nextButton").hide(),$("#cancelButton").hide()),r<f&&($("#contractStep_"+r).hide(),$("#contractStep_"+u).show(),$("#currentStep").val(u)))})},contractPreviousStep:function(){var t=$("#maxStep").val(),n=$("#currentStep").val();n==2&&$("#previousButton").hide();n==t&&($("#finishButton").hide(),$("#nextButton").show(),$("#cancelButton").show());n>1&&($("#contractStep_"+n).hide(),$("#contractStep_"+(parseInt(n,10)-1)).show(),$("#currentStep").val(parseInt(n,10)-1))},contractToggleSearchBox:function(n,t){$("#display_"+n).hide();$("#edit_"+n).show();t&&($("#display_"+n).show(),$("#edit_"+n).hide())},toogleCustomContract:function(n,t){if(n.checked)$("#items").show();else{n.checked=!0;var i=function(){n.checked=!1;$("#items").hide();$("#input.WordTag").each(function(n){n.value=n.readAttribute("defaultValue")});Media.contractIsContentChanged=!1};Media.contractIsContentChanged==!0?MessageBox.confirm(t,Translations.get(Translations.keys.Yes),i,null,Translations.get(Translations.keys.No)):i()}},contractChangeInputSelection:function(n,t,i){var r=[],u=$(n).val();$('input[name^="'+n.name.split("_")[2]+'."]').each(function(n){r.push(n.name);n.name.toLowerCase().includes("signature")||(n.value="")});i=appendStringParams(i,"val="+u+"&type=entity");u>0?ajaxRequest(n,t,"POST",i,function(n){n.status==ajaxRequest.StatusType.Success&&n.data.keys&&forEachProp(data.keys,function(n){n.toLowerCase().includes("signature")||$('input[name="'+n+'"]').each(function(t){t.value=data.keys[n];t.setAttribute("defaultValue",data.keys[n])})})}):r.each(function(n){$$('input[name="'+n+'"]').each(function(n){n.name.toLowerCase().includes("signature")||(n.value="",n.setAttribute("defaultValue",""))})})},contractIsContentChanged:!1,contractCustomContentChanged:function(){Media.contractIsContentChanged=!0},contractUpdateFieldEdit:function(n){var t=n.name;$('#input[name="'+t+'"]').each(function(t){t.value=n.value})}}}(),Payment=function(){return{pay:function(n,t,i){ajaxRequest(n,t,"POST",$(i).find("*").serializeAll(),function(n){n.data&&n.data.url&&(top.location=n.data.url)})},showOlderPh:function(n){var i=n.closest("table"),t,r;if(i){for(t=0;r=i.rows[t];t++)r.style.display="";n.closest("tr").remove()}},redirectToAction:function(n,t,i){var r=[];r.push(Requests.get(Requests.keys.ID)+"="+i);r.push(Requests.get(Requests.keys.CurrentUrl)+"="+encodeURIComponent(window.location.host+window.location.pathname));Popup.close();ajaxRequest(n,t,"GET",r.join("&"),function(n){n&&n.status==1&&n.data&&n.data.url&&(window.location.href=n.data.url)})},productCartToggle:function(n){var u,i,t,r;n.getAttribute("data-value-price")!=null&&(u=n.getAttribute("data-value-price"),u&&(u=parseFloat(u),i=$("#PayTotalAmount"),i&&i.attr("data-value-price")&&(t=parseFloat(i.attr("data-value-price")),n.classList.contains("active")?(n.classList.remove("active"),n.childNodes[1].textContent=n.getAttribute("data-value-disableT"),t=t-u):(n.classList.add("active"),n.childNodes[1].textContent=n.getAttribute("data-value-activeT"),t=t+u),i.attr("data-value-price",t),r=$("#PayScheduleCart"),t<=0?(i.text("-"),r&&!r.hasClass("disabled")&&r.addClass("disabled")):(i.text(Money.format(t)),r&&r.hasClass("disabled")&&r.removeClass("disabled")))))},payAllBtn:function(n,t){var i;if(!n.classList.contains("disabled")){var u=[],f=0,r="";$(".gridResultsTable.paymentsTable").find(".blueOutlineBtn.singleSelectionBtn.active").each(function(){u.push($(this).attr("data-value-id"));f+=Number($(this).attr("data-value-price"));$(this).attr("data-value-profileID")!=undefined&&$(this).attr("data-value-prodName")!=undefined&&(r+=$(this).attr("data-value-prodName").length>0?Translations.get(Translations.keys.PaymentsListProfile).format($(this).attr("data-value-prodName")+" - "+$(this).attr("data-value-profileID")):Translations.get(Translations.keys.PaymentsListProfile).format($(this).attr("data-value-profileID")))});i=[];i.push(Requests.get(Requests.keys.IDs)+"="+encodeURIComponent(u.join(",")));i.push(Requests.get(Requests.keys.CurrentUrl)+"="+encodeURIComponent(window.location.host+window.location.pathname));i.push(Requests.get(Requests.keys.Value)+"="+f);r&&r.length>=0?MessageBox.confirm(Translations.get(Translations.keys.PaymentsListProfileContext).format(r),Translations.get(Translations.keys.Proceed),function(){ajaxRequest(n,t,"GET",i.join("&"),function(n){n&&n.status==1&&n.data&&n.data.url&&(window.location.href=n.data.url)})},"",Translations.get(Translations.keys.Cancel)):ajaxRequest(n,t,"GET",i.join("&"),function(n){n&&n.status==1&&n.data&&n.data.url&&(window.location.href=n.data.url)})}},openBuyEgoCoinPopup:function(n,t,i){ajaxRequest(n,t,"GET",i)}}}(),TINY=TINY||{},T$=T$||function(n){return document.getElementById(n)},T$$$=T$$$||function(){return document.all?1:0};TINY.CreateTinyEditor=function(n,t){if(n&&n.editorConf){window.multiHtmlInc||(window.multiHtmlInc=1);var i=$(n.editorConf.name+(t||""));i&&!i._initialized&&(oTinyEditor.push(new TINY.editor.edit("editor"+multiHtmlInc,{id:i.getAttribute("id"),width:"100%",height:175,cssclass:"te",controlclass:"tecontrol",rowclass:"teheader",dividerclass:"tedivider",controls:["bold","italic","underline","strikethrough","|","subscript","superscript","|","orderedlist","unorderedlist","|","outdent","indent","|","leftalign","centeralign","rightalign","blockjustify","|","unformat","|","undo","redo","n","font","size","style","|","image","hr","link","unlink","|","cut","copy","paste","print",,"|","uploadimage"],footer:n.editorConf.HideFooter,fonts:["Verdana","Arial","Georgia","Trebuchet MS","Book Antiqua","Calibri"],xhtml:!1,cssfile:"",bodyid:"editor"+multiHtmlInc,footerclass:"tefooter",toggle:{text:"source",activetext:"wysiwyg",cssclass:"toggle"},css:"body{font-family:Helvetica, Arial, sans-serif; font-size: 13px; line-height:22px;}",resize:{cssclass:"resize"},upload_handler:n.editorConf.uploadHandler||null,onchange:n.editorConf.changeHandler||null})),i._initialized=!0,multiHtmlInc++)}};TINY.editor=function(){function t(t,r){var g,e,nt,tt,it,rt,v,ht,y,ct,p,ut,a,lt,d,w;this.getLanguagePack();this.n=t;window[t]=this;this.t=T$(r.id);this.t.classList.add("wysiwyg");this.obj=r;this.xhtml=r.xhtml;var c=document.createElement("div"),b=document.createElement("div"),o=document.createElement("div"),at=r.controls.length,k=0;if(this.upload_handler=r.upload_handler||{uploadUrl:null,onsubmit:null,onComplete:null},this.i=document.createElement("iframe"),this.i.width=r.width||"500",this.i.height=r.height||"250",this.ie=T$$$(),g=this.i.width.indexOf("%")>0?this.i.width:parseInt(this.i.width)+"px",o.className=r.rowclass||"tinyeditor-header",c.className=r.cssclass||"tinyeditor",c.style.width=g,!r.noChrome)for(c.appendChild(o),k;k<at;k++)if(e=r.controls[k],e=="n")o=document.createElement("div"),o.className=r.rowclass||"tinyeditor-header",c.appendChild(o);else if(e=="|")nt=document.createElement("div"),nt.className=r.dividerclass||"tinyeditor-divider",o.appendChild(nt);else if(e=="font"){var s=document.createElement("select"),ft=r.fonts||["Arial","Verdana","Georgia","Times New Roman"],vt=ft.length,f=0;for(s.className="tinyeditor-font",s.onchange=new Function(this.n+'.ddaction(this, "fontname")'),s.options[0]=new Option(TINY.editor.lng.font||"Font",""),f;f<vt;f++)tt=ft[f],s.options[f+1]=new Option(tt,tt);o.appendChild(s)}else if(e=="size"){var s=document.createElement("select"),et=r.sizes||[1,2,3,4,5,6,7],ot=et.length,f=0;for(s.className="tinyeditor-size",s.onchange=new Function(this.n+'.ddaction(this, "fontsize")'),f;f<ot;f++)it=et[f],s.options[f]=new Option(it,it);o.appendChild(s)}else if(e=="style"){var s=document.createElement("select"),st=r.styles||[[TINY.editor.lng.style||"Style",""],["Paragraph","<p>"],["Header 1","<h1>"],["Header 2","<h2>"],["Header 3","<h3>"],["Header 4","<h4>"],["Header 5","<h5>"],["Header 6","<h6>"]],ot=st.length,f=0;for(s.className="tinyeditor-style",s.onchange=new Function(this.n+'.ddaction(this, "formatblock")'),f;f<ot;f++)rt=st[f],s.options[f]=new Option(rt[0],rt[1]);o.appendChild(s)}else if(e=="uploadimage"){if(this.upload_handler&&typeof this.upload_handler=="function"){var u=document.createElement("div"),f=n[e],h=f[0]*i;u.className=r.controlclass;u.style.backgroundPosition="0px "+h+"px";u.title=(this.upload_handler.allowFiles?TINY.editor.lng.uploadimage_file:TINY.editor.lng[e])||f[1];u._ulpHandler=this.upload_handler(u,this);u.editorRef=this;u.onmouseover=new Function(this.n+".hover(this,"+h+",1)");u.onmouseout=new Function(this.n+".hover(this,"+h+",0)");o.appendChild(u);this.ie&&(u.unselectable="on")}}else if(e=="surveylink"){var u=document.createElement("div"),f=n[e],yt=f[2],l,h=f[0]*i+4;u.className=r.controlclass;u.unselectable="on";u.style.backgroundPosition="0px "+h+"px";u.title=TINY.editor.lng.surveylink||f[1];l='.insert("'+(TINY.editor.lng.surveylinkadd||f[4])+'", "'+(TINY.editor.lng.surveylinkdef||f[5])+'", "'+f[3]+'")';u.onmousedown=new Function(this.n+(e=="print"?".print()":l));u.onmouseover=new Function(this.n+".hover(this, "+h+", 1)");u.onmouseout=new Function(this.n+".hover(this, "+h+", 0)");o.appendChild(u);this.ie&&(u.unselectable="on")}else if(e=="contactname"){var u=document.createElement("div"),f=n[e],yt=f[2],l,h=f[0]*i+4;u.className=r.controlclass;u.unselectable="on";u.style.backgroundPosition="0px "+h+"px";u.title=TINY.editor.lng.addcontactname||f[1];l='.setPlaceholder("'+(TINY.editor.lng.nameholder||f[4])+'")';u.onmousedown=new Function(this.n+(e=="print"?".print()":l));u.onmouseover=new Function(this.n+".hover(this, "+h+", 1)");u.onmouseout=new Function(this.n+".hover(this, "+h+", 0)");o.appendChild(u);this.ie&&(u.unselectable="on")}else if(n[e]){var u=document.createElement("div"),f=n[e],yt=f[2],l,h=f[0]*i;u.className=r.controlclass;u.unselectable="on";u.style.backgroundPosition="0px "+h+"px";u.title=TINY.editor.lng[e]||f[1];l=yt=="a"?'.action("'+f[3]+'", 0, '+(f[4]||0)+")":'.insert("'+f[4]+'", "'+f[5]+'", "'+f[3]+'")';u.onmousedown=new Function(this.n+(e=="print"?".print()":l));u.onmouseover=new Function(this.n+".hover(this, "+h+", 1)");u.onmouseout=new Function(this.n+".hover(this, "+h+", 0)");o.appendChild(u);this.ie&&(u.unselectable="on")}if(b.setAttribute("style","-webkit-overflow-scrolling:touch;"),this.t.parentNode.insertBefore(c,this.t),this.t.style.width=g,b.appendChild(this.t),b.appendChild(this.i),c.appendChild(b),this.t.style.display="none",r.footer&&(v=document.createElement("div"),v.className=r.footerclass||"tinyeditor-footer",r.toggle&&(ht=r.toggle,y=document.createElement("div"),y.className=ht.cssclass||"toggle",y.innerHTML=r.toggletext||TINY.editor.lng.source||"source",y.onclick=new Function(this.n+".toggle(0, this);return false"),v.appendChild(y)),r.resize&&(ct=r.resize,p=document.createElement("div"),p.className=ct.cssclass||"resize",p.onmousedown=new Function("event",this.n+".resize(event);return false"),p.onselectstart=function(){return!1},v.appendChild(p)),c.appendChild(v)),ut="",EventHandler.removeListener(this.t,"change",r.onchange),r.onchange&&(EventHandler.addListener(this.t,"change",r.onchange),ut=" onblur=\"top[window.document.body.getAttribute('gref')].post();\" "),this.e=this.i.contentWindow.document,this.e.open(),a="<html><head>",lt=r.bodyid?' id="'+r.bodyid+'"':"",r.cssfile&&(a+='<link rel="stylesheet" href="'+r.cssfile+'" />'),r.css&&(a+='<style type="text/css">'+r.css+"<\/style>"),d=r.content||this.t.value,this.obj.egoNewsletter&&(d=d.replace(/<head[\s\S]+<\/head>/ig,"")),a+="<\/head><body"+lt+'gref="'+this.n+'" '+ut+' contenteditable="true">'+d,a+="<\/body><\/html>",this.e.write(a),this.e.close(),r.onchange||(this.e.designMode="On"),this.d=1,this.xhtml)try{this.e.execCommand("styleWithCSS",0,0)}catch(pt){try{this.e.execCommand("useCSS",0,1)}catch(pt){}}r.onKeyUp&&(w=this,EventHandler.addListener(this.e,"keyup",function(n){var t=n||w.i.contentWindow.event;w.obj.onKeyUp(t);$(w.t).trigger("keyUp")}));r.onPaste&&(w=this,EventHandler.addListener(this.e,"paste",function(){r.onPaste()}));r.autofocus&&setTimeout(function(n){n.e.body&&(n.e.body.focus(),n.i.contentWindow.focus())},100,this);$(this.t).trigger("load")}var n=[],i=-30;return n.bold=[4,"Bold","a","bold"],n.italic=[5,"Italic","a","italic"],n.underline=[6,"Underline","a","underline"],n.strikethrough=[7,"Strikethrough","a","strikethrough"],n.subscript=[8,"Subscript","a","subscript"],n.superscript=[9,"Superscript","a","superscript"],n.orderedlist=[10,"Insert Ordered List","a","insertorderedlist"],n.unorderedlist=[11,"Insert Unordered List","a","insertunorderedlist"],n.outdent=[12,"Outdent","a","outdent"],n.indent=[13,"Indent","a","indent"],n.leftalign=[14,"Left Align","a","justifyleft"],n.centeralign=[15,"Center Align","a","justifycenter"],n.rightalign=[16,"Right Align","a","justifyright"],n.blockjustify=[17,"Block Justify","a","justifyfull"],n.undo=[18,"Undo","a","undo"],n.redo=[19,"Redo","a","redo"],n.image=[20,"Insert Image","i","insertimage","Enter Image URL:","http://"],n.hr=[21,"Insert Horizontal Rule","a","inserthorizontalrule"],n.link=[22,"Insert Hyperlink","i","createlink","Enter URL:","http://"],n.unlink=[23,"Remove Hyperlink","a","unlink"],n.unformat=[24,"Remove Formatting","a","removeformat"],n.print=[25,"Print","a","print"],n.uploadimage=[26,"Upload Image","i","uploadimage","Browse Image:","http://"],n.surveylink=[27,"Survey response link","i","surveylink","Link text:","seguinte link"],n.contactname=[28,"Contact name","i","entityname"],t.prototype.print=function(){this.i.contentWindow.print()},t.prototype.hover=function(n,t,i){this.getSelection();n.style.backgroundPosition=(i?"34px ":"0px ")+t+"px"},t.prototype.getSelection=function(){this.ie&&this.e.getSelection&&(this.sel=this.e.getSelection(),this.sel.getRangeAt&&this.sel.rangeCount&&(this.range=this.sel.getRangeAt(0)))},t.prototype.restoreSelection=function(){this.range&&this.ie&&this.e.getSelection&&(this.sel=this.e.getSelection(),this.sel.removeAllRanges(),this.sel.addRange(this.range))},t.prototype.getRange=function(){var n=this.e.getSelection();return n&&n.getRangeAt&&n.rangeCount>0?n.getRangeAt(0):n.createRange?n.createRange():void 0},t.prototype.ddaction=function(n,t){var i=n.selectedIndex,r=n.options[i].value;this.action(t,r)},t.prototype.action=function(n,t,i){i&&!this.ie?alert("Your browser does not support this function."):(this.restoreSelection(),this.e.execCommand(n,0,t||null))},t.prototype.insert=function(n,t,i){var u,r,e,f;i=="surveylink"&&this.e&&this.e.getSelection()?(u=this.e.getSelection().anchorNode,u&&u.parentNode&&u.parentNode.tagName=="A"&&(t=u.parentNode.getAttribute("href")),r=prompt(n,t),r!=null&&r!=""&&this.e.execCommand("createlink",0,r),f=this.e.body.innerHTML,f=f.replace('"'+r+'"','"'+r+'" target="_blank" class="responseLink"'),this.e.body.innerHTML=f):(i=="createlink"&&this.e&&this.e.getSelection()&&(u=this.e.getSelection().anchorNode,u&&u.parentNode&&u.parentNode.tagName=="A"&&(t=u.parentNode.getAttribute("href"))),r=prompt(n,t),e="_blank",r!=null&&r!=""&&this.e.execCommand(i,0,r),f=this.e.body.innerHTML,f=f.replace('"'+r+'"','"'+r+'" target="'+e+'"'),this.e.body.innerHTML=f)},t.prototype.setfont=function(){this.restoreSelection();execCommand("formatblock",0,hType)},t.prototype.setPlaceholder=function(n){var t,i;this.restoreSelection();t=this.getRange();t&&(i=this.e.createElement("SPAN"),i.innerHTML=n,t.insertNode(i))},t.prototype.resize=function(n){this.mv&&this.freeze();this.i.bcs=TINY.cursor.top(n);this.mv=new Function("event",this.n+".move(event)");this.sr=new Function(this.n+".freeze()");this.ie?(document.attachEvent("onmousemove",this.mv),document.attachEvent("onmouseup",this.sr)):(document.addEventListener("mousemove",this.mv,1),document.addEventListener("mouseup",this.sr,1))},t.prototype.move=function(n){var t=TINY.cursor.top(n);this.i.height=parseInt(this.i.height)+t-this.i.bcs;this.i.bcs=t},t.prototype.freeze=function(){this.ie?(document.detachEvent("onmousemove",this.mv),document.detachEvent("onmouseup",this.sr)):(document.removeEventListener("mousemove",this.mv,1),document.removeEventListener("mouseup",this.sr,1))},t.prototype.toggle=function(n,t){var i,r;this.d?(i=this.e.body.innerHTML,this.xhtml&&(i=i.replace(/<span class="apple-style-span">(.*)<\/span>/gi,"$1"),i=i.replace(/ class="apple-style-span"/gi,""),i=i.replace(/<span style="">/gi,""),i=i.replace(/<br>/gi,"<br />"),i=i.replace(/<br ?\/?>$/gi,""),i=i.replace(/^<br ?\/?>/gi,""),i=i.replace(/(<img [^>]+[^\/])>/gi,"$1 />"),i=i.replace(/<b\b[^>]*>(.*?)<\/b[^>]*>/gi,"<strong>$1<\/strong>"),i=i.replace(/<i\b[^>]*>(.*?)<\/i[^>]*>/gi,"<em>$1<\/em>"),i=i.replace(/<u\b[^>]*>(.*?)<\/u[^>]*>/gi,'<span style="text-decoration:underline">$1<\/span>'),i=i.replace(/<(b|strong|em|i|u) style="font-weight:normal;?">(.*)<\/(b|strong|em|i|u)>/gi,"$2"),i=i.replace(/<(b|strong|em|i|u) style="(.*)">(.*)<\/(b|strong|em|i|u)>/gi,'<span style="$2"><$4>$3<\/$4><\/span>'),i=i.replace(/<span style="font-weight:normal;?">(.*)<\/span>/gi,"$1"),i=i.replace(/<span style="font-weight:bold;?">(.*)<\/span>/gi,"<strong>$1<\/strong>"),i=i.replace(/<span style="font-style:italic;?">(.*)<\/span>/gi,"<em>$1<\/em>"),i=i.replace(/<span style="font-weight:bold;?">(.*)<\/span>|<b\b[^>]*>(.*?)<\/b[^>]*>/gi,"<strong>$1<\/strong>")),t&&(t.innerHTML=this.obj.toggletext||"wysiwyg"),r=this.t.value,this.t.value=i=="<br>"||i=="<br/>"||i=="<br />"?"":i,this.obj.onchange&&r!=this.t.value&&$(this.t).trigger("change"),n||(this.t.style.height=this.i.height+"px",this.i.style.display="none",this.t.style.display="block",this.d=0)):(i=this.t.value,t&&(t.innerHTML=this.obj.toggletext||TINY.editor.lng.source||"source"),this.xhtml&&!this.ie&&(i=i.replace(/<strong>(.*)<\/strong>/gi,'<span style="font-weight:bold;">$1<\/span>'),i=i.replace(/<em>(.*)<\/em>/gi,'<span style="font-weight:italic;">$1<\/span>')),this.e.body.innerHTML=i,this.t.style.display="none",this.i.style.display="block",this.d=1)},t.prototype.post=function(){this.d&&this.toggle(1)},t.prototype.getLanguagePack=function(){if(!TINY.editor.__lngLoaded){TINY.editor.lng=[];TINY.editor.__lngLoaded=!0;var t="/egocore/translations/tinyeditortranslator",n={method:"GET",data:"",async:!1,success:function(n){try{TINY.editor.lng=JSON.parse(n.data)}catch(t){TINY.editor.lng=[]}}};"ajaxRequest"in window?ajaxRequest(null,t,n.method,n.data,n.success,{async:!1,hideLoading:!0}):"jQuery"in window&&jQuery.ajax(t,n)}},t.prototype.contentNode=function(){return this.t.up("."+this.obj.cssclass)},t.prototype.setHeight=function(n){this.i.height=n},t.prototype.focus=function(){this.e.body.focus();this.i.contentWindow.focus()},t.prototype.reloadFrame=function(){var r="",n,u,t,i;if(this.obj.onchange&&(r=" onblur=\"top[window.document.body.getAttribute('gref')].post();\" "),this.e=this.i.contentWindow.document,this.e.open(),n="<html><head>",u=this.obj.bodyid?' id="'+this.obj.bodyid+'"':"",this.obj.cssfile&&(n+='<link rel="stylesheet" href="'+this.obj.cssfile+'" />'),this.obj.css&&(n+='<style type="text/css">'+this.obj.css+"<\/style>"),t=this.obj.content||this.t.value,this.obj.egoNewsletter&&(t=t.replace(/<head[\s\S]+<\/head>/ig,"")),n+="<\/head><body"+u+'gref="'+this.n+'" '+r+' contenteditable="true">'+t,n+="<\/body><\/html>",this.e.write(n),this.e.close(),this.obj.onchange||(this.e.designMode="On"),this.d=1,this.xhtml)try{this.e.execCommand("styleWithCSS",0,0)}catch(f){try{this.e.execCommand("useCSS",0,1)}catch(f){}}this.obj.onKeyUp&&(i=this,EventHandler.addListener(this.e,"keyup",function(n){var t=n||i.i.contentWindow.event;i.obj.onKeyUp(t);$(i.t).trigger("keyUp")}))},{edit:t}}();TINY.cursor=function(){return{top:function(n){return T$$$()?window.event.clientY+document.documentElement.scrollTop+document.body.scrollTop:n.clientY+window.scrollY}}}();
/*! jQuery UI - v1.12.1 - 2019-07-31
* http://jqueryui.com
* Includes: widget.js, position.js, data.js, disable-selection.js, form-reset-mixin.js, keycode.js, labels.js, scroll-parent.js, unique-id.js, widgets/draggable.js, widgets/droppable.js, widgets/resizable.js, widgets/selectable.js, widgets/sortable.js, widgets/menu.js, widgets/mouse.js, widgets/selectmenu.js, widgets/slider.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */
(function(n){typeof define=="function"&&define.amd?define(["jquery"],n):n(jQuery)})(function(n){var f,u,r,e,o,s,h,c,l,a,v,y,p,w,b,t,k,i,d,g,nt,tt,it,rt,ut;n.ui=n.ui||{};f=n.ui.version="1.12.1";
/*!
 * jQuery UI Widget 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
u=0;r=Array.prototype.slice;n.cleanData=function(t){return function(i){for(var r,u,f=0;(u=i[f])!=null;f++)try{r=n._data(u,"events");r&&r.remove&&n(u).triggerHandler("remove")}catch(e){}t(i)}}(n.cleanData);n.widget=function(t,i,r){var f,u,o,h={},e=t.split(".")[0],s;return t=t.split(".")[1],s=e+"-"+t,r||(r=i,i=n.Widget),n.isArray(r)&&(r=n.extend.apply(null,[{}].concat(r))),n.expr[":"][s.toLowerCase()]=function(t){return!!n.data(t,s)},n[e]=n[e]||{},f=n[e][t],u=n[e][t]=function(n,t){if(!this._createWidget)return new u(n,t);arguments.length&&this._createWidget(n,t)},n.extend(u,f,{version:r.version,_proto:n.extend({},r),_childConstructors:[]}),o=new i,o.options=n.widget.extend({},o.options),n.each(r,function(t,r){if(!n.isFunction(r)){h[t]=r;return}h[t]=function(){function n(){return i.prototype[t].apply(this,arguments)}function u(n){return i.prototype[t].apply(this,n)}return function(){var i=this._super,f=this._superApply,t;return this._super=n,this._superApply=u,t=r.apply(this,arguments),this._super=i,this._superApply=f,t}}()}),u.prototype=n.widget.extend(o,{widgetEventPrefix:f?o.widgetEventPrefix||t:t},h,{constructor:u,namespace:e,widgetName:t,widgetFullName:s}),f?(n.each(f._childConstructors,function(t,i){var r=i.prototype;n.widget(r.namespace+"."+r.widgetName,u,i._proto)}),delete f._childConstructors):i._childConstructors.push(u),n.widget.bridge(t,u),u};n.widget.extend=function(t){for(var e=r.call(arguments,1),f=0,o=e.length,i,u;f<o;f++)for(i in e[f])u=e[f][i],e[f].hasOwnProperty(i)&&u!==undefined&&(t[i]=n.isPlainObject(u)?n.isPlainObject(t[i])?n.widget.extend({},t[i],u):n.widget.extend({},u):u);return t};n.widget.bridge=function(t,i){var u=i.prototype.widgetFullName||t;n.fn[t]=function(f){var s=typeof f=="string",o=r.call(arguments,1),e=this;return s?this.length||f!=="instance"?this.each(function(){var i,r=n.data(this,u);return f==="instance"?(e=r,!1):r?!n.isFunction(r[f])||f.charAt(0)==="_"?n.error("no such method '"+f+"' for "+t+" widget instance"):(i=r[f].apply(r,o),i!==r&&i!==undefined?(e=i&&i.jquery?e.pushStack(i.get()):i,!1):void 0):n.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+f+"'")}):e=undefined:(o.length&&(f=n.widget.extend.apply(null,[f].concat(o))),this.each(function(){var t=n.data(this,u);t?(t.option(f||{}),t._init&&t._init()):n.data(this,u,new i(f,this))})),e}};n.Widget=function(){};n.Widget._childConstructors=[];n.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(t,i){i=n(i||this.defaultElement||this)[0];this.element=n(i);this.uuid=u++;this.eventNamespace="."+this.widgetName+this.uuid;this.bindings=n();this.hoverable=n();this.focusable=n();this.classesElementLookup={};i!==this&&(n.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(n){n.target===i&&this.destroy()}}),this.document=n(i.style?i.ownerDocument:i.document||i),this.window=n(this.document[0].defaultView||this.document[0].parentWindow));this.options=n.widget.extend({},this.options,this._getCreateOptions(),t);this._create();this.options.disabled&&this._setOptionDisabled(this.options.disabled);this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:n.noop,_create:n.noop,_init:n.noop,destroy:function(){var t=this;this._destroy();n.each(this.classesElementLookup,function(n,i){t._removeClass(i,n)});this.element.off(this.eventNamespace).removeData(this.widgetFullName);this.widget().off(this.eventNamespace).removeAttr("aria-disabled");this.bindings.off(this.eventNamespace)},_destroy:n.noop,widget:function(){return this.element},option:function(t,i){var e=t,r,u,f;if(arguments.length===0)return n.widget.extend({},this.options);if(typeof t=="string")if(e={},r=t.split("."),t=r.shift(),r.length){for(u=e[t]=n.widget.extend({},this.options[t]),f=0;f<r.length-1;f++)u[r[f]]=u[r[f]]||{},u=u[r[f]];if(t=r.pop(),arguments.length===1)return u[t]===undefined?null:u[t];u[t]=i}else{if(arguments.length===1)return this.options[t]===undefined?null:this.options[t];e[t]=i}return this._setOptions(e),this},_setOptions:function(n){for(var t in n)this._setOption(t,n[t]);return this},_setOption:function(n,t){return n==="classes"&&this._setOptionClasses(t),this.options[n]=t,n==="disabled"&&this._setOptionDisabled(t),this},_setOptionClasses:function(t){var i,u,r;for(i in t)(r=this.classesElementLookup[i],t[i]!==this.options.classes[i]&&r&&r.length)&&(u=n(r.get()),this._removeClass(r,i),u.addClass(this._classes({element:u,keys:i,classes:t,add:!0})))},_setOptionDisabled:function(n){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!n);n&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(t){function u(u,f){for(var o,e=0;e<u.length;e++)o=r.classesElementLookup[u[e]]||n(),o=t.add?n(n.unique(o.get().concat(t.element.get()))):n(o.not(t.element).get()),r.classesElementLookup[u[e]]=o,i.push(u[e]),f&&t.classes[u[e]]&&i.push(t.classes[u[e]])}var i=[],r=this;return t=n.extend({element:this.element,classes:this.options.classes||{}},t),this._on(t.element,{remove:"_untrackClassesElement"}),t.keys&&u(t.keys.match(/\S+/g)||[],!0),t.extra&&u(t.extra.match(/\S+/g)||[]),i.join(" ")},_untrackClassesElement:function(t){var i=this;n.each(i.classesElementLookup,function(r,u){n.inArray(t.target,u)!==-1&&(i.classesElementLookup[r]=n(u.not(t.target).get()))})},_removeClass:function(n,t,i){return this._toggleClass(n,t,i,!1)},_addClass:function(n,t,i){return this._toggleClass(n,t,i,!0)},_toggleClass:function(n,t,i,r){r=typeof r=="boolean"?r:i;var u=typeof n=="string"||n===null,f={extra:u?t:i,keys:u?n:t,element:u?this.element:n,add:r};return f.element.toggleClass(this._classes(f),r),this},_on:function(t,i,r){var f,u=this;typeof t!="boolean"&&(r=i,i=t,t=!1);r?(i=f=n(i),this.bindings=this.bindings.add(i)):(r=i,i=this.element,f=this.widget());n.each(r,function(r,e){function o(){if(t||u.options.disabled!==!0&&!n(this).hasClass("ui-state-disabled"))return(typeof e=="string"?u[e]:e).apply(u,arguments)}typeof e!="string"&&(o.guid=e.guid=e.guid||o.guid||n.guid++);var s=r.match(/^([\w:-]*)\s*(.*)$/),h=s[1]+u.eventNamespace,c=s[2];if(c)f.on(h,c,o);else i.on(h,o)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;t.off(i).off(i);this.bindings=n(this.bindings.not(t).get());this.focusable=n(this.focusable.not(t).get());this.hoverable=n(this.hoverable.not(t).get())},_delay:function(n,t){function r(){return(typeof n=="string"?i[n]:n).apply(i,arguments)}var i=this;return setTimeout(r,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t);this._on(t,{mouseenter:function(t){this._addClass(n(t.currentTarget),null,"ui-state-hover")},mouseleave:function(t){this._removeClass(n(t.currentTarget),null,"ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t);this._on(t,{focusin:function(t){this._addClass(n(t.currentTarget),null,"ui-state-focus")},focusout:function(t){this._removeClass(n(t.currentTarget),null,"ui-state-focus")}})},_trigger:function(t,i,r){var u,f,e=this.options[t];if(r=r||{},i=n.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],f=i.originalEvent,f)for(u in f)u in i||(i[u]=f[u]);return this.element.trigger(i,r),!(n.isFunction(e)&&e.apply(this.element[0],[i].concat(r))===!1||i.isDefaultPrevented())}};n.each({show:"fadeIn",hide:"fadeOut"},function(t,i){n.Widget.prototype["_"+t]=function(r,u,f){typeof u=="string"&&(u={effect:u});var o,e=u?u===!0||typeof u=="number"?i:u.effect||i:t;u=u||{};typeof u=="number"&&(u={duration:u});o=!n.isEmptyObject(u);u.complete=f;u.delay&&r.delay(u.delay);o&&n.effects&&n.effects.effect[e]?r[t](u):e!==t&&r[e]?r[e](u.duration,u.easing,f):r.queue(function(i){n(this)[t]();f&&f.call(r[0]);i()})}});e=n.widget;
/*!
 * jQuery UI Position 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/position/
 */
(function(){function c(n,t,i){return[parseFloat(n[0])*(h.test(n[0])?t/100:1),parseFloat(n[1])*(h.test(n[1])?i/100:1)]}function r(t,i){return parseInt(n.css(t,i),10)||0}function a(t){var i=t[0];return i.nodeType===9?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:n.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}var u,i=Math.max,t=Math.abs,f=/left|center|right/,e=/top|center|bottom/,o=/[\+\-]\d+(\.[\d]+)?%?/,s=/^\w+/,h=/%$/,l=n.fn.position;n.position={scrollbarWidth:function(){if(u!==undefined)return u;var r,i,t=n("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'><\/div><\/div>"),f=t.children()[0];return n("body").append(t),r=f.offsetWidth,t.css("overflow","scroll"),i=f.offsetWidth,r===i&&(i=t[0].clientWidth),t.remove(),u=r-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),r=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),u=i==="scroll"||i==="auto"&&t.width<t.element[0].scrollWidth,f=r==="scroll"||r==="auto"&&t.height<t.element[0].scrollHeight;return{width:f?n.position.scrollbarWidth():0,height:u?n.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=n(t||window),r=n.isWindow(i[0]),u=!!i[0]&&i[0].nodeType===9,f=!r&&!u;return{element:i,isWindow:r,isDocument:u,offset:f?n(t).offset():{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}};n.fn.position=function(u){if(!u||!u.of)return l.apply(this,arguments);u=n.extend({},u);var w,h,v,p,y,k,d=n(u.of),nt=n.position.getWithinInfo(u.within),tt=n.position.getScrollInfo(nt),b=(u.collision||"flip").split(" "),g={};return k=a(d),d[0].preventDefault&&(u.at="left top"),h=k.width,v=k.height,p=k.offset,y=n.extend({},p),n.each(["my","at"],function(){var n=(u[this]||"").split(" "),t,i;n.length===1&&(n=f.test(n[0])?n.concat(["center"]):e.test(n[0])?["center"].concat(n):["center","center"]);n[0]=f.test(n[0])?n[0]:"center";n[1]=e.test(n[1])?n[1]:"center";t=o.exec(n[0]);i=o.exec(n[1]);g[this]=[t?t[0]:0,i?i[0]:0];u[this]=[s.exec(n[0])[0],s.exec(n[1])[0]]}),b.length===1&&(b[1]=b[0]),u.at[0]==="right"?y.left+=h:u.at[0]==="center"&&(y.left+=h/2),u.at[1]==="bottom"?y.top+=v:u.at[1]==="center"&&(y.top+=v/2),w=c(g.at,h,v),y.left+=w[0],y.top+=w[1],this.each(function(){var a,k,e=n(this),o=e.outerWidth(),s=e.outerHeight(),it=r(this,"marginLeft"),rt=r(this,"marginTop"),ut=o+it+r(this,"marginRight")+tt.width,ft=s+rt+r(this,"marginBottom")+tt.height,f=n.extend({},y),l=c(g.my,e.outerWidth(),e.outerHeight());u.my[0]==="right"?f.left-=o:u.my[0]==="center"&&(f.left-=o/2);u.my[1]==="bottom"?f.top-=s:u.my[1]==="center"&&(f.top-=s/2);f.left+=l[0];f.top+=l[1];a={marginLeft:it,marginTop:rt};n.each(["left","top"],function(t,i){n.ui.position[b[t]]&&n.ui.position[b[t]][i](f,{targetWidth:h,targetHeight:v,elemWidth:o,elemHeight:s,collisionPosition:a,collisionWidth:ut,collisionHeight:ft,offset:[w[0]+l[0],w[1]+l[1]],my:u.my,at:u.at,within:nt,elem:e})});u.using&&(k=function(n){var r=p.left-f.left,a=r+h-o,c=p.top-f.top,y=c+v-s,l={target:{element:d,left:p.left,top:p.top,width:h,height:v},element:{element:e,left:f.left,top:f.top,width:o,height:s},horizontal:a<0?"left":r>0?"right":"center",vertical:y<0?"top":c>0?"bottom":"middle"};h<o&&t(r+a)<h&&(l.horizontal="center");v<s&&t(c+y)<v&&(l.vertical="middle");l.important=i(t(r),t(a))>i(t(c),t(y))?"horizontal":"vertical";u.using.call(this,n,l)});e.offset(n.extend(f,{using:k}))})};n.ui.position={fit:{left:function(n,t){var e=t.within,u=e.isWindow?e.scrollLeft:e.offset.left,o=e.width,s=n.left-t.collisionPosition.marginLeft,r=u-s,f=s+t.collisionWidth-o-u,h;t.collisionWidth>o?r>0&&f<=0?(h=n.left+r+t.collisionWidth-o-u,n.left+=r-h):n.left=f>0&&r<=0?u:r>f?u+o-t.collisionWidth:u:r>0?n.left+=r:f>0?n.left-=f:n.left=i(n.left-s,n.left)},top:function(n,t){var o=t.within,u=o.isWindow?o.scrollTop:o.offset.top,e=t.within.height,s=n.top-t.collisionPosition.marginTop,r=u-s,f=s+t.collisionHeight-e-u,h;t.collisionHeight>e?r>0&&f<=0?(h=n.top+r+t.collisionHeight-e-u,n.top+=r-h):n.top=f>0&&r<=0?u:r>f?u+e-t.collisionHeight:u:r>0?n.top+=r:f>0?n.top-=f:n.top=i(n.top-s,n.top)}},flip:{left:function(n,i){var r=i.within,y=r.offset.left+r.scrollLeft,c=r.width,o=r.isWindow?r.scrollLeft:r.offset.left,l=n.left-i.collisionPosition.marginLeft,a=l-o,v=l+i.collisionWidth-c-o,u=i.my[0]==="left"?-i.elemWidth:i.my[0]==="right"?i.elemWidth:0,f=i.at[0]==="left"?i.targetWidth:i.at[0]==="right"?-i.targetWidth:0,e=-2*i.offset[0],s,h;a<0?(s=n.left+u+f+e+i.collisionWidth-c-y,(s<0||s<t(a))&&(n.left+=u+f+e)):v>0&&(h=n.left-i.collisionPosition.marginLeft+u+f+e-o,(h>0||t(h)<v)&&(n.left+=u+f+e))},top:function(n,i){var r=i.within,y=r.offset.top+r.scrollTop,c=r.height,o=r.isWindow?r.scrollTop:r.offset.top,l=n.top-i.collisionPosition.marginTop,a=l-o,v=l+i.collisionHeight-c-o,p=i.my[1]==="top",u=p?-i.elemHeight:i.my[1]==="bottom"?i.elemHeight:0,f=i.at[1]==="top"?i.targetHeight:i.at[1]==="bottom"?-i.targetHeight:0,e=-2*i.offset[1],s,h;a<0?(h=n.top+u+f+e+i.collisionHeight-c-y,(h<0||h<t(a))&&(n.top+=u+f+e)):v>0&&(s=n.top-i.collisionPosition.marginTop+u+f+e-o,(s>0||t(s)<v)&&(n.top+=u+f+e))}},flipfit:{left:function(){n.ui.position.flip.left.apply(this,arguments);n.ui.position.fit.left.apply(this,arguments)},top:function(){n.ui.position.flip.top.apply(this,arguments);n.ui.position.fit.top.apply(this,arguments)}}}})();o=n.ui.position;
/*!
 * jQuery UI :data 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
s=n.extend(n.expr[":"],{data:n.expr.createPseudo?n.expr.createPseudo(function(t){return function(i){return!!n.data(i,t)}}):function(t,i,r){return!!n.data(t,r[3])}});
/*!
 * jQuery UI Disable Selection 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
h=n.fn.extend({disableSelection:function(){var n="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(n+".ui-disableSelection",function(n){n.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}});c=n.fn.form=function(){return typeof this[0].form=="string"?this.closest("form"):n(this[0].form)};
/*!
 * jQuery UI Form Reset Mixin 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
l=n.ui.formResetMixin={_formResetHandler:function(){var t=n(this);setTimeout(function(){var i=t.data("ui-form-reset-instances");n.each(i,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element.form(),this.form.length){var n=this.form.data("ui-form-reset-instances")||[];if(!n.length)this.form.on("reset.ui-form-reset",this._formResetHandler);n.push(this);this.form.data("ui-form-reset-instances",n)}},_unbindFormResetHandler:function(){if(this.form.length){var t=this.form.data("ui-form-reset-instances");t.splice(n.inArray(this,t),1);t.length?this.form.data("ui-form-reset-instances",t):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}};
/*!
 * jQuery UI Keycode 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
a=n.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38};v=n.ui.escapeSelector=function(){var n=/([!"#$%&'()*+,./:;<=>?@[\]^`{|}~])/g;return function(t){return t.replace(n,"\\$1")}}();
/*!
 * jQuery UI Labels 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
y=n.fn.labels=function(){var t,r,u,i,f;return this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(i=this.eq(0).parents("label"),u=this.attr("id"),u&&(t=this.eq(0).parents().last(),f=t.add(t.length?t.siblings():this.siblings()),r="label[for='"+n.ui.escapeSelector(u)+"']",i=i.add(f.find(r).addBack(r))),this.pushStack(i))};
/*!
 * jQuery UI Scroll Parent 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
p=n.fn.scrollParent=function(t){var i=this.css("position"),u=i==="absolute",f=t?/(auto|scroll|hidden)/:/(auto|scroll)/,r=this.parents().filter(function(){var t=n(this);return u&&t.css("position")==="static"?!1:f.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return i==="fixed"||!r.length?n(this[0].ownerDocument||document):r};
/*!
 * jQuery UI Unique ID 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
w=n.fn.extend({uniqueId:function(){var n=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++n)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&n(this).removeAttr("id")})}});b=n.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());
/*!
 * jQuery UI Mouse 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
t=!1;n(document).on("mouseup",function(){t=!1});var ft=n.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.on("mousedown."+this.widgetName,function(n){return t._mouseDown(n)}).on("click."+this.widgetName,function(i){if(!0===n.data(i.target,t.widgetName+".preventClickEvent"))return n.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1});this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName);this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!t){this._mouseMoved=!1;this._mouseStarted&&this._mouseUp(i);this._mouseDownEvent=i;var r=this,u=i.which===1,f=typeof this.options.cancel=="string"&&i.target.nodeName?n(i.target).closest(this.options.cancel).length:!1;if(!u||f||!this._mouseCapture(i))return!0;if(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted))return i.preventDefault(),!0;!0===n.data(i.target,this.widgetName+".preventClickEvent")&&n.removeData(i.target,this.widgetName+".preventClickEvent");this._mouseMoveDelegate=function(n){return r._mouseMove(n)};this._mouseUpDelegate=function(n){return r._mouseUp(n)};this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate);return i.preventDefault(),t=!0,!0}},_mouseMove:function(t){if(this._mouseMoved){if(n.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button)return this._mouseUp(t);if(!t.which)if(t.originalEvent.altKey||t.originalEvent.ctrlKey||t.originalEvent.metaKey||t.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(t)}return((t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted)?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(i){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate);this._mouseStarted&&(this._mouseStarted=!1,i.target===this._mouseDownEvent.target&&n.data(i.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(i));this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer);this.ignoreMissingWhich=!1;t=!1;i.preventDefault()},_mouseDistanceMet:function(n){return Math.max(Math.abs(this._mouseDownEvent.pageX-n.pageX),Math.abs(this._mouseDownEvent.pageY-n.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),et=n.ui.plugin={add:function(t,i,r){var u,f=n.ui[t].prototype;for(u in r)f.plugins[u]=f.plugins[u]||[],f.plugins[u].push([i,r[u]])},call:function(n,t,i,r){var u,f=n.plugins[t];if(f&&(r||n.element[0].parentNode&&n.element[0].parentNode.nodeType!==11))for(u=0;u<f.length;u++)n.options[f[u][0]]&&f[u][1].apply(n.element,i)}},ot=n.ui.safeActiveElement=function(n){var t;try{t=n.activeElement}catch(i){t=n.body}return t||(t=n.body),t.nodeName||(t=n.body),t},st=n.ui.safeBlur=function(t){t&&t.nodeName.toLowerCase()!=="body"&&n(t).trigger("blur")};
/*!
 * jQuery UI Draggable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
n.widget("ui.draggable",n.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){this.options.helper==="original"&&this._setPositionRelative();this.options.addClasses&&this._addClass("ui-draggable");this._setHandleClassName();this._mouseInit()},_setOption:function(n,t){this._super(n,t);n==="handle"&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){if((this.helper||this.element).is(".ui-draggable-dragging")){this.destroyOnClear=!0;return}this._removeHandleClassName();this._mouseDestroy()},_mouseCapture:function(t){var i=this.options;return this.helper||i.disabled||n(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),!this.handle)?!1:(this._blurActiveElement(t),this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0)},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=n(this);return n("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=n.ui.safeActiveElement(this.document[0]),r=n(t.target);r.closest(i).length||n.ui.safeBlur(i)},_mouseStart:function(t){var i=this.options;return(this.helper=this._createHelper(t),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),n.ui.ddmanager&&(n.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return n(this).css("position")==="fixed"}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",t)===!1)?(this._clear(),!1):(this._cacheHelperProportions(),n.ui.ddmanager&&!i.dropBehaviour&&n.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),n.ui.ddmanager&&n.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(n){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()};this.offset.click={left:n.pageX-this.offset.left,top:n.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var r=this._uiHash();if(this._trigger("drag",t,r)===!1)return this._mouseUp(new n.Event("mouseup",t)),!1;this.position=r.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",n.ui.ddmanager&&n.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var r=this,i=!1;return n.ui.ddmanager&&!this.options.dropBehaviour&&(i=n.ui.ddmanager.drop(this,t)),this.dropped&&(i=this.dropped,this.dropped=!1),this.options.revert==="invalid"&&!i||this.options.revert==="valid"&&i||this.options.revert===!0||n.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)?n(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){r._trigger("stop",t)!==!1&&r._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),n.ui.ddmanager&&n.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.trigger("focus"),n.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new n.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(t){return this.options.handle?!!n(t.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element;this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(t){var r=this.options,u=n.isFunction(r.helper),i=u?n(r.helper.apply(this.element[0],[t])):r.helper==="clone"?this.element.clone().removeAttr("id"):this.element;return i.parents("body").length||i.appendTo(r.appendTo==="parent"?this.element[0].parentNode:r.appendTo),u&&i[0]===this.element[0]&&this._setPositionRelative(),i[0]===this.element[0]||/(fixed|absolute)/.test(i.css("position"))||i.css("position","absolute"),i},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" "));n.isArray(t)&&(t={left:+t[0],top:+t[1]||0});"left"in t&&(this.offset.click.left=t.left+this.margins.left);"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left);"top"in t&&(this.offset.click.top=t.top+this.margins.top);"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(n){return/(html|body)/i.test(n.tagName)||n===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),i=this.document[0];return this.cssPosition==="absolute"&&this.scrollParent[0]!==i&&n.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition!=="relative")return{top:0,left:0};var n=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:n.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:n.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var f,t,i,r=this.options,u=this.document[0];if(this.relativeContainer=null,!r.containment){this.containment=null;return}if(r.containment==="window"){this.containment=[n(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,n(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,n(window).scrollLeft()+n(window).width()-this.helperProportions.width-this.margins.left,n(window).scrollTop()+(n(window).height()||u.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return}if(r.containment==="document"){this.containment=[0,0,n(u).width()-this.helperProportions.width-this.margins.left,(n(u).height()||u.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return}if(r.containment.constructor===Array){this.containment=r.containment;return}(r.containment==="parent"&&(r.containment=this.helper[0].parentNode),t=n(r.containment),i=t[0],i)&&(f=/(scroll|auto)/.test(t.css("overflow")),this.containment=[(parseInt(t.css("borderLeftWidth"),10)||0)+(parseInt(t.css("paddingLeft"),10)||0),(parseInt(t.css("borderTopWidth"),10)||0)+(parseInt(t.css("paddingTop"),10)||0),(f?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(t.css("borderRightWidth"),10)||0)-(parseInt(t.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(f?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(t.css("borderBottomWidth"),10)||0)-(parseInt(t.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=t)},_convertPositionTo:function(n,t){t||(t=this.position);var i=n==="absolute"?1:-1,r=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-(this.cssPosition==="fixed"?-this.offset.scroll.top:r?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-(this.cssPosition==="fixed"?-this.offset.scroll.left:r?0:this.offset.scroll.left)*i}},_generatePosition:function(n,t){var i,s,u,f,r=this.options,h=this._isRootNode(this.scrollParent[0]),e=n.pageX,o=n.pageY;return h&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,n.pageX-this.offset.click.left<i[0]&&(e=i[0]+this.offset.click.left),n.pageY-this.offset.click.top<i[1]&&(o=i[1]+this.offset.click.top),n.pageX-this.offset.click.left>i[2]&&(e=i[2]+this.offset.click.left),n.pageY-this.offset.click.top>i[3]&&(o=i[3]+this.offset.click.top)),r.grid&&(u=r.grid[1]?this.originalPageY+Math.round((o-this.originalPageY)/r.grid[1])*r.grid[1]:this.originalPageY,o=i?u-this.offset.click.top>=i[1]||u-this.offset.click.top>i[3]?u:u-this.offset.click.top>=i[1]?u-r.grid[1]:u+r.grid[1]:u,f=r.grid[0]?this.originalPageX+Math.round((e-this.originalPageX)/r.grid[0])*r.grid[0]:this.originalPageX,e=i?f-this.offset.click.left>=i[0]||f-this.offset.click.left>i[2]?f:f-this.offset.click.left>=i[0]?f-r.grid[0]:f+r.grid[0]:f),r.axis==="y"&&(e=this.originalPageX),r.axis==="x"&&(o=this.originalPageY)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.offset.scroll.top:h?0:this.offset.scroll.top),left:e-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.offset.scroll.left:h?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging");this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove();this.helper=null;this.cancelHelperRemoval=!1;this.destroyOnClear&&this.destroy()},_trigger:function(t,i,r){return r=r||this._uiHash(),n.ui.plugin.call(this,t,[i,r,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),r.offset=this.positionAbs),n.Widget.prototype._trigger.call(this,t,i,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});n.ui.plugin.add("draggable","connectToSortable",{start:function(t,i,r){var u=n.extend({},i,{item:r.element});r.sortables=[];n(r.options.connectToSortable).each(function(){var i=n(this).sortable("instance");i&&!i.options.disabled&&(r.sortables.push(i),i.refreshPositions(),i._trigger("activate",t,u))})},stop:function(t,i,r){var u=n.extend({},i,{item:r.element});r.cancelHelperRemoval=!1;n.each(r.sortables,function(){var n=this;n.isOver?(n.isOver=0,r.cancelHelperRemoval=!0,n.cancelHelperRemoval=!1,n._storedCSS={position:n.placeholder.css("position"),top:n.placeholder.css("top"),left:n.placeholder.css("left")},n._mouseStop(t),n.options.helper=n.options._helper):(n.cancelHelperRemoval=!0,n._trigger("deactivate",t,u))})},drag:function(t,i,r){n.each(r.sortables,function(){var f=!1,u=this;u.positionAbs=r.positionAbs;u.helperProportions=r.helperProportions;u.offset.click=r.offset.click;u._intersectsWith(u.containerCache)&&(f=!0,n.each(r.sortables,function(){return this.positionAbs=r.positionAbs,this.helperProportions=r.helperProportions,this.offset.click=r.offset.click,this!==u&&this._intersectsWith(this.containerCache)&&n.contains(u.element[0],this.element[0])&&(f=!1),f}));f?(u.isOver||(u.isOver=1,r._parent=i.helper.parent(),u.currentItem=i.helper.appendTo(u.element).data("ui-sortable-item",!0),u.options._helper=u.options.helper,u.options.helper=function(){return i.helper[0]},t.target=u.currentItem[0],u._mouseCapture(t,!0),u._mouseStart(t,!0,!0),u.offset.click.top=r.offset.click.top,u.offset.click.left=r.offset.click.left,u.offset.parent.left-=r.offset.parent.left-u.offset.parent.left,u.offset.parent.top-=r.offset.parent.top-u.offset.parent.top,r._trigger("toSortable",t),r.dropped=u.element,n.each(r.sortables,function(){this.refreshPositions()}),r.currentItem=r.element,u.fromOutside=r),u.currentItem&&(u._mouseDrag(t),i.position=u.position)):u.isOver&&(u.isOver=0,u.cancelHelperRemoval=!0,u.options._revert=u.options.revert,u.options.revert=!1,u._trigger("out",t,u._uiHash(u)),u._mouseStop(t,!0),u.options.revert=u.options._revert,u.options.helper=u.options._helper,u.placeholder&&u.placeholder.remove(),i.helper.appendTo(r._parent),r._refreshOffsets(t),i.position=r._generatePosition(t,!0),r._trigger("fromSortable",t),r.dropped=!1,n.each(r.sortables,function(){this.refreshPositions()}))})}});n.ui.plugin.add("draggable","cursor",{start:function(t,i,r){var u=n("body"),f=r.options;u.css("cursor")&&(f._cursor=u.css("cursor"));u.css("cursor",f.cursor)},stop:function(t,i,r){var u=r.options;u._cursor&&n("body").css("cursor",u._cursor)}});n.ui.plugin.add("draggable","opacity",{start:function(t,i,r){var u=n(i.helper),f=r.options;u.css("opacity")&&(f._opacity=u.css("opacity"));u.css("opacity",f.opacity)},stop:function(t,i,r){var u=r.options;u._opacity&&n(i.helper).css("opacity",u._opacity)}});n.ui.plugin.add("draggable","scroll",{start:function(n,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1));i.scrollParentNotHidden[0]!==i.document[0]&&i.scrollParentNotHidden[0].tagName!=="HTML"&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,r){var u=r.options,o=!1,e=r.scrollParentNotHidden[0],f=r.document[0];e!==f&&e.tagName!=="HTML"?(u.axis&&u.axis==="x"||(r.overflowOffset.top+e.offsetHeight-t.pageY<u.scrollSensitivity?e.scrollTop=o=e.scrollTop+u.scrollSpeed:t.pageY-r.overflowOffset.top<u.scrollSensitivity&&(e.scrollTop=o=e.scrollTop-u.scrollSpeed)),u.axis&&u.axis==="y"||(r.overflowOffset.left+e.offsetWidth-t.pageX<u.scrollSensitivity?e.scrollLeft=o=e.scrollLeft+u.scrollSpeed:t.pageX-r.overflowOffset.left<u.scrollSensitivity&&(e.scrollLeft=o=e.scrollLeft-u.scrollSpeed))):(u.axis&&u.axis==="x"||(t.pageY-n(f).scrollTop()<u.scrollSensitivity?o=n(f).scrollTop(n(f).scrollTop()-u.scrollSpeed):n(window).height()-(t.pageY-n(f).scrollTop())<u.scrollSensitivity&&(o=n(f).scrollTop(n(f).scrollTop()+u.scrollSpeed))),u.axis&&u.axis==="y"||(t.pageX-n(f).scrollLeft()<u.scrollSensitivity?o=n(f).scrollLeft(n(f).scrollLeft()-u.scrollSpeed):n(window).width()-(t.pageX-n(f).scrollLeft())<u.scrollSensitivity&&(o=n(f).scrollLeft(n(f).scrollLeft()+u.scrollSpeed))));o!==!1&&n.ui.ddmanager&&!u.dropBehaviour&&n.ui.ddmanager.prepareOffsets(r,t)}});n.ui.plugin.add("draggable","snap",{start:function(t,i,r){var u=r.options;r.snapElements=[];n(u.snap.constructor!==String?u.snap.items||":data(ui-draggable)":u.snap).each(function(){var t=n(this),i=t.offset();this!==r.element[0]&&r.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,r){for(var e,o,s,h,c,a,l,v,w,b=r.options,f=b.snapTolerance,y=i.offset.left,k=y+r.helperProportions.width,p=i.offset.top,d=p+r.helperProportions.height,u=r.snapElements.length-1;u>=0;u--){if(c=r.snapElements[u].left-r.margins.left,a=c+r.snapElements[u].width,l=r.snapElements[u].top-r.margins.top,v=l+r.snapElements[u].height,k<c-f||y>a+f||d<l-f||p>v+f||!n.contains(r.snapElements[u].item.ownerDocument,r.snapElements[u].item)){r.snapElements[u].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,n.extend(r._uiHash(),{snapItem:r.snapElements[u].item}));r.snapElements[u].snapping=!1;continue}b.snapMode!=="inner"&&(e=Math.abs(l-d)<=f,o=Math.abs(v-p)<=f,s=Math.abs(c-k)<=f,h=Math.abs(a-y)<=f,e&&(i.position.top=r._convertPositionTo("relative",{top:l-r.helperProportions.height,left:0}).top),o&&(i.position.top=r._convertPositionTo("relative",{top:v,left:0}).top),s&&(i.position.left=r._convertPositionTo("relative",{top:0,left:c-r.helperProportions.width}).left),h&&(i.position.left=r._convertPositionTo("relative",{top:0,left:a}).left));w=e||o||s||h;b.snapMode!=="outer"&&(e=Math.abs(l-p)<=f,o=Math.abs(v-d)<=f,s=Math.abs(c-y)<=f,h=Math.abs(a-k)<=f,e&&(i.position.top=r._convertPositionTo("relative",{top:l,left:0}).top),o&&(i.position.top=r._convertPositionTo("relative",{top:v-r.helperProportions.height,left:0}).top),s&&(i.position.left=r._convertPositionTo("relative",{top:0,left:c}).left),h&&(i.position.left=r._convertPositionTo("relative",{top:0,left:a-r.helperProportions.width}).left));!r.snapElements[u].snapping&&(e||o||s||h||w)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,t,n.extend(r._uiHash(),{snapItem:r.snapElements[u].item}));r.snapElements[u].snapping=e||o||s||h||w}}});n.ui.plugin.add("draggable","stack",{start:function(t,i,r){var f,e=r.options,u=n.makeArray(n(e.stack)).sort(function(t,i){return(parseInt(n(t).css("zIndex"),10)||0)-(parseInt(n(i).css("zIndex"),10)||0)});u.length&&(f=parseInt(n(u[0]).css("zIndex"),10)||0,n(u).each(function(t){n(this).css("zIndex",f+t)}),this.css("zIndex",f+u.length))}});n.ui.plugin.add("draggable","zIndex",{start:function(t,i,r){var u=n(i.helper),f=r.options;u.css("zIndex")&&(f._zIndex=u.css("zIndex"));u.css("zIndex",f.zIndex)},stop:function(t,i,r){var u=r.options;u._zIndex&&n(i.helper).css("zIndex",u._zIndex)}});k=n.ui.draggable;
/*!
 * jQuery UI Droppable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
n.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,r=i.accept;this.isover=!1;this.isout=!0;this.accept=n.isFunction(r)?r:function(n){return n.is(r)};this.proportions=function(){if(arguments.length)t=arguments[0];else return t?t:t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}};this._addToManager(i.scope);i.addClasses&&this._addClass("ui-droppable")},_addToManager:function(t){n.ui.ddmanager.droppables[t]=n.ui.ddmanager.droppables[t]||[];n.ui.ddmanager.droppables[t].push(this)},_splice:function(n){for(var t=0;t<n.length;t++)n[t]===this&&n.splice(t,1)},_destroy:function(){var t=n.ui.ddmanager.droppables[this.options.scope];this._splice(t)},_setOption:function(t,i){if(t==="accept")this.accept=n.isFunction(i)?i:function(n){return n.is(i)};else if(t==="scope"){var r=n.ui.ddmanager.droppables[this.options.scope];this._splice(r);this._addToManager(i)}this._super(t,i)},_activate:function(t){var i=n.ui.ddmanager.current;this._addActiveClass();i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=n.ui.ddmanager.current;this._removeActiveClass();i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=n.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._addHoverClass(),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=n.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._removeHoverClass(),this._trigger("out",t,this.ui(i)))},_drop:function(t,r){var u=r||n.ui.ddmanager.current,f=!1;return!u||(u.currentItem||u.element)[0]===this.element[0]?!1:(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var r=n(this).droppable("instance");if(r.options.greedy&&!r.options.disabled&&r.options.scope===u.options.scope&&r.accept.call(r.element[0],u.currentItem||u.element)&&i(u,n.extend(r,{offset:r.element.offset()}),r.options.tolerance,t))return f=!0,!1}),f)?!1:this.accept.call(this.element[0],u.currentItem||u.element)?(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",t,this.ui(u)),this.element):!1},ui:function(n){return{draggable:n.currentItem||n.element,helper:n.helper,position:n.position,offset:n.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});i=n.ui.intersect=function(){function n(n,t,i){return n>=t&&n<t+i}return function(t,i,r,u){if(!i.offset)return!1;var o=(t.positionAbs||t.position.absolute).left+t.margins.left,s=(t.positionAbs||t.position.absolute).top+t.margins.top,h=o+t.helperProportions.width,c=s+t.helperProportions.height,f=i.offset.left,e=i.offset.top,l=f+i.proportions().width,a=e+i.proportions().height;switch(r){case"fit":return f<=o&&h<=l&&e<=s&&c<=a;case"intersect":return f<o+t.helperProportions.width/2&&h-t.helperProportions.width/2<l&&e<s+t.helperProportions.height/2&&c-t.helperProportions.height/2<a;case"pointer":return n(u.pageY,e,i.proportions().height)&&n(u.pageX,f,i.proportions().width);case"touch":return(s>=e&&s<=a||c>=e&&c<=a||s<e&&c>a)&&(o>=f&&o<=l||h>=f&&h<=l||o<f&&h>l);default:return!1}}}();n.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var r,f,u=n.ui.ddmanager.droppables[t.options.scope]||[],o=i?i.type:null,e=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();n:for(r=0;r<u.length;r++)if(!u[r].options.disabled&&(!t||u[r].accept.call(u[r].element[0],t.currentItem||t.element))){for(f=0;f<e.length;f++)if(e[f]===u[r].element[0]){u[r].proportions().height=0;continue n}(u[r].visible=u[r].element.css("display")!=="none",u[r].visible)&&(o==="mousedown"&&u[r]._activate.call(u[r],i),u[r].offset=u[r].element.offset(),u[r].proportions({width:u[r].element[0].offsetWidth,height:u[r].element[0].offsetHeight}))}},drop:function(t,r){var u=!1;return n.each((n.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&i(t,this,this.options.tolerance,r)&&(u=this._drop.call(this,r)||u),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,r)))}),u},dragStart:function(t,i){t.element.parentsUntil("body").on("scroll.droppable",function(){t.options.refreshPositions||n.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,r){t.options.refreshPositions&&n.ui.ddmanager.prepareOffsets(t,r);n.each(n.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var u,o,e,s=i(t,this,this.options.tolerance,r),f=!s&&this.isover?"isout":s&&!this.isover?"isover":null;f&&(this.options.greedy&&(o=this.options.scope,e=this.element.parents(":data(ui-droppable)").filter(function(){return n(this).droppable("instance").options.scope===o}),e.length&&(u=n(e[0]).droppable("instance"),u.greedyChild=f==="isover")),u&&f==="isover"&&(u.isover=!1,u.isout=!0,u._out.call(u,r)),this[f]=!0,this[f==="isout"?"isover":"isout"]=!1,this[f==="isover"?"_over":"_out"].call(this,r),u&&f==="isout"&&(u.isout=!1,u.isover=!0,u._over.call(u,r)))}})},dragStop:function(t,i){t.element.parentsUntil("body").off("scroll.droppable");t.options.refreshPositions||n.ui.ddmanager.prepareOffsets(t,i)}};n.uiBackCompat!==!1&&n.widget("ui.droppable",n.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super();this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super();this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super();this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super();this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}});d=n.ui.droppable;
/*!
 * jQuery UI Resizable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
n.widget("ui.resizable",n.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(n){return parseFloat(n)||0},_isNumber:function(n){return!isNaN(parseFloat(n))},_hasScroll:function(t,i){if(n(t).css("overflow")==="hidden")return!1;var r=i&&i==="left"?"scrollLeft":"scrollTop",u=!1;return t[r]>0?!0:(t[r]=1,u=t[r]>0,t[r]=0,u)},_create:function(){var r,t=this.options,i=this;if(this._addClass("ui-resizable"),n.extend(this,{_aspectRatio:!!t.aspectRatio,aspectRatio:t.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:t.helper||t.ghost||t.animate?t.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(n("<div class='ui-wrapper' style='overflow: hidden;'><\/div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,r={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(r),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(r),this._proportionallyResize()),this._setupHandles(),t.autoHide)n(this.element).on("mouseenter",function(){t.disabled||(i._removeClass("ui-resizable-autohide"),i._handles.show())}).on("mouseleave",function(){t.disabled||i.resizing||(i._addClass("ui-resizable-autohide"),i._handles.hide())});this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){n(t).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function(n,t){this._super(n,t);switch(n){case"handles":this._removeHandles();this._setupHandles()}},_setupHandles:function(){var u=this.options,i,r,f,o,t,e=this;if(this.handles=u.handles||(n(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=n(),this.handles.constructor===String)for(this.handles==="all"&&(this.handles="n,e,s,w,se,sw,ne,nw"),f=this.handles.split(","),this.handles={},r=0;r<f.length;r++)i=n.trim(f[r]),o="ui-resizable-"+i,t=n("<div>"),this._addClass(t,"ui-resizable-handle "+o),t.css({zIndex:u.zIndex}),this.handles[i]=".ui-resizable-"+i,this.element.append(t);this._renderAxis=function(t){var i,r,u,f;t=t||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=n(this.handles[i]),this._on(this.handles[i],{mousedown:e._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(r=n(this.handles[i],this.element),f=/sw|ne|nw|se|n|s/.test(i)?r.outerHeight():r.outerWidth(),u=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(u,f),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])};this._renderAxis(this.element);this._handles=this._handles.add(this.element.find(".ui-resizable-handle"));this._handles.disableSelection();this._handles.on("mouseover",function(){e.resizing||(this.className&&(t=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),e.axis=t&&t[1]?t[1]:"se")});u.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(t){var r,i,u=!1;for(r in this.handles)i=n(this.handles[r])[0],(i===t.target||n.contains(i,t.target))&&(u=!0);return!this.options.disabled&&u},_mouseStart:function(t){var u,f,e,r=this.options,i=this.element;return this.resizing=!0,this._renderProxy(),u=this._num(this.helper.css("left")),f=this._num(this.helper.css("top")),r.containment&&(u+=n(r.containment).scrollLeft()||0,f+=n(r.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:u,top:f},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:i.width(),height:i.height()},this.originalSize=this._helper?{width:i.outerWidth(),height:i.outerHeight()}:{width:i.width(),height:i.height()},this.sizeDiff={width:i.outerWidth()-i.width(),height:i.outerHeight()-i.height()},this.originalPosition={left:u,top:f},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio=typeof r.aspectRatio=="number"?r.aspectRatio:this.originalSize.width/this.originalSize.height||1,e=n(".ui-resizable-"+this.axis).css("cursor"),n("body").css("cursor",e==="auto"?this.axis+"-resize":e),this._addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,r,u=this.originalMousePosition,e=this.axis,o=t.pageX-u.left||0,s=t.pageY-u.top||0,f=this._change[e];return(this._updatePrevProperties(),!f)?!1:(i=f.apply(this,[t,o,s]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),r=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),n.isEmptyObject(r)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1)},_mouseStop:function(t){this.resizing=!1;var r,u,f,e,o,s,h,c=this.options,i=this;return this._helper&&(r=this._proportionallyResizeElements,u=r.length&&/textarea/i.test(r[0].nodeName),f=u&&this._hasScroll(r[0],"left")?0:i.sizeDiff.height,e=u?0:i.sizeDiff.width,o={width:i.helper.width()-e,height:i.helper.height()-f},s=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,h=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null,c.animate||this.element.css(n.extend(o,{top:h,left:s})),i.helper.height(i.size.height),i.helper.width(i.size.width),this._helper&&!c.animate&&this._proportionallyResize()),n("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left};this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var n={};return this.position.top!==this.prevPosition.top&&(n.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(n.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(n.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(n.height=this.size.height+"px"),this.helper.css(n),n},_updateVirtualBoundaries:function(n){var r,u,f,e,t,i=this.options;t={minWidth:this._isNumber(i.minWidth)?i.minWidth:0,maxWidth:this._isNumber(i.maxWidth)?i.maxWidth:Infinity,minHeight:this._isNumber(i.minHeight)?i.minHeight:0,maxHeight:this._isNumber(i.maxHeight)?i.maxHeight:Infinity};(this._aspectRatio||n)&&(r=t.minHeight*this.aspectRatio,f=t.minWidth/this.aspectRatio,u=t.maxHeight*this.aspectRatio,e=t.maxWidth/this.aspectRatio,r>t.minWidth&&(t.minWidth=r),f>t.minHeight&&(t.minHeight=f),u<t.maxWidth&&(t.maxWidth=u),e<t.maxHeight&&(t.maxHeight=e));this._vBoundaries=t},_updateCache:function(n){this.offset=this.helper.offset();this._isNumber(n.left)&&(this.position.left=n.left);this._isNumber(n.top)&&(this.position.top=n.top);this._isNumber(n.height)&&(this.size.height=n.height);this._isNumber(n.width)&&(this.size.width=n.width)},_updateRatio:function(n){var t=this.position,i=this.size,r=this.axis;return this._isNumber(n.height)?n.width=n.height*this.aspectRatio:this._isNumber(n.width)&&(n.height=n.width/this.aspectRatio),r==="sw"&&(n.left=t.left+(i.width-n.width),n.top=null),r==="nw"&&(n.top=t.top+(i.height-n.height),n.left=t.left+(i.width-n.width)),n},_respectSize:function(n){var t=this._vBoundaries,i=this.axis,r=this._isNumber(n.width)&&t.maxWidth&&t.maxWidth<n.width,u=this._isNumber(n.height)&&t.maxHeight&&t.maxHeight<n.height,f=this._isNumber(n.width)&&t.minWidth&&t.minWidth>n.width,e=this._isNumber(n.height)&&t.minHeight&&t.minHeight>n.height,o=this.originalPosition.left+this.originalSize.width,s=this.originalPosition.top+this.originalSize.height,h=/sw|nw|w/.test(i),c=/nw|ne|n/.test(i);return f&&(n.width=t.minWidth),e&&(n.height=t.minHeight),r&&(n.width=t.maxWidth),u&&(n.height=t.maxHeight),f&&h&&(n.left=o-t.minWidth),r&&h&&(n.left=o-t.maxWidth),e&&c&&(n.top=s-t.minHeight),u&&c&&(n.top=s-t.maxHeight),n.width||n.height||n.left||!n.top?n.width||n.height||n.top||!n.left||(n.left=null):n.top=null,n},_getPaddingPlusBorderDimensions:function(n){for(var t=0,i=[],r=[n.css("borderTopWidth"),n.css("borderRightWidth"),n.css("borderBottomWidth"),n.css("borderLeftWidth")],u=[n.css("paddingTop"),n.css("paddingRight"),n.css("paddingBottom"),n.css("paddingLeft")];t<4;t++)i[t]=parseFloat(r[t])||0,i[t]+=parseFloat(u[t])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var n,t=0,i=this.helper||this.element;t<this._proportionallyResizeElements.length;t++)n=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(n)),n.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset();this._helper?(this.helper=this.helper||n("<div style='overflow:hidden;'><\/div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(n,t){return{width:this.originalSize.width+t}},w:function(n,t){var i=this.originalSize,r=this.originalPosition;return{left:r.left+t,width:i.width-t}},n:function(n,t,i){var r=this.originalSize,u=this.originalPosition;return{top:u.top+i,height:r.height-i}},s:function(n,t,i){return{height:this.originalSize.height+i}},se:function(t,i,r){return n.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,r]))},sw:function(t,i,r){return n.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,r]))},ne:function(t,i,r){return n.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,r]))},nw:function(t,i,r){return n.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,r]))}},_propagate:function(t,i){n.ui.plugin.call(this,t,[i,this.ui()]);t!=="resize"&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}});n.ui.plugin.add("resizable","animate",{stop:function(t){var i=n(this).resizable("instance"),u=i.options,r=i._proportionallyResizeElements,f=r.length&&/textarea/i.test(r[0].nodeName),s=f&&i._hasScroll(r[0],"left")?0:i.sizeDiff.height,h=f?0:i.sizeDiff.width,c={width:i.size.width-h,height:i.size.height-s},e=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,o=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(n.extend(c,o&&e?{top:o,left:e}:{}),{duration:u.animateDuration,easing:u.animateEasing,step:function(){var u={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};r&&r.length&&n(r[0]).css({width:u.width,height:u.height});i._updateCache(u);i._propagate("resize",t)}})}});n.ui.plugin.add("resizable","containment",{start:function(){var r,f,e,o,s,h,c,t=n(this).resizable("instance"),l=t.options,a=t.element,u=l.containment,i=u instanceof n?u.get(0):/parent/.test(u)?a.parent().get(0):u;i&&(t.containerElement=n(i),/document/.test(u)||u===document?(t.containerOffset={left:0,top:0},t.containerPosition={left:0,top:0},t.parentData={element:n(document),left:0,top:0,width:n(document).width(),height:n(document).height()||document.body.parentNode.scrollHeight}):(r=n(i),f=[],n(["Top","Right","Left","Bottom"]).each(function(n,i){f[n]=t._num(r.css("padding"+i))}),t.containerOffset=r.offset(),t.containerPosition=r.position(),t.containerSize={height:r.innerHeight()-f[3],width:r.innerWidth()-f[1]},e=t.containerOffset,o=t.containerSize.height,s=t.containerSize.width,h=t._hasScroll(i,"left")?i.scrollWidth:s,c=t._hasScroll(i)?i.scrollHeight:o,t.parentData={element:i,left:e.left,top:e.top,width:h,height:c}))},resize:function(t){var o,s,h,c,i=n(this).resizable("instance"),v=i.options,r=i.containerOffset,l=i.position,f=i._aspectRatio||t.shiftKey,e={top:0,left:0},a=i.containerElement,u=!0;a[0]!==document&&/static/.test(a.css("position"))&&(e=r);l.left<(i._helper?r.left:0)&&(i.size.width=i.size.width+(i._helper?i.position.left-r.left:i.position.left-e.left),f&&(i.size.height=i.size.width/i.aspectRatio,u=!1),i.position.left=v.helper?r.left:0);l.top<(i._helper?r.top:0)&&(i.size.height=i.size.height+(i._helper?i.position.top-r.top:i.position.top),f&&(i.size.width=i.size.height*i.aspectRatio,u=!1),i.position.top=i._helper?r.top:0);h=i.containerElement.get(0)===i.element.parent().get(0);c=/relative|absolute/.test(i.containerElement.css("position"));h&&c?(i.offset.left=i.parentData.left+i.position.left,i.offset.top=i.parentData.top+i.position.top):(i.offset.left=i.element.offset().left,i.offset.top=i.element.offset().top);o=Math.abs(i.sizeDiff.width+(i._helper?i.offset.left-e.left:i.offset.left-r.left));s=Math.abs(i.sizeDiff.height+(i._helper?i.offset.top-e.top:i.offset.top-r.top));o+i.size.width>=i.parentData.width&&(i.size.width=i.parentData.width-o,f&&(i.size.height=i.size.width/i.aspectRatio,u=!1));s+i.size.height>=i.parentData.height&&(i.size.height=i.parentData.height-s,f&&(i.size.width=i.size.height*i.aspectRatio,u=!1));u||(i.position.left=i.prevPosition.left,i.position.top=i.prevPosition.top,i.size.width=i.prevSize.width,i.size.height=i.prevSize.height)},stop:function(){var t=n(this).resizable("instance"),r=t.options,u=t.containerOffset,f=t.containerPosition,e=t.containerElement,i=n(t.helper),o=i.offset(),s=i.outerWidth()-t.sizeDiff.width,h=i.outerHeight()-t.sizeDiff.height;t._helper&&!r.animate&&/relative/.test(e.css("position"))&&n(this).css({left:o.left-f.left-u.left,width:s,height:h});t._helper&&!r.animate&&/static/.test(e.css("position"))&&n(this).css({left:o.left-f.left-u.left,width:s,height:h})}});n.ui.plugin.add("resizable","alsoResize",{start:function(){var t=n(this).resizable("instance"),i=t.options;n(i.alsoResize).each(function(){var t=n(this);t.data("ui-resizable-alsoresize",{width:parseFloat(t.width()),height:parseFloat(t.height()),left:parseFloat(t.css("left")),top:parseFloat(t.css("top"))})})},resize:function(t,i){var r=n(this).resizable("instance"),e=r.options,u=r.originalSize,f=r.originalPosition,o={height:r.size.height-u.height||0,width:r.size.width-u.width||0,top:r.position.top-f.top||0,left:r.position.left-f.left||0};n(e.alsoResize).each(function(){var t=n(this),u=n(this).data("ui-resizable-alsoresize"),r={},f=t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];n.each(f,function(n,t){var i=(u[t]||0)+(o[t]||0);i&&i>=0&&(r[t]=i||null)});t.css(r)})},stop:function(){n(this).removeData("ui-resizable-alsoresize")}});n.ui.plugin.add("resizable","ghost",{start:function(){var t=n(this).resizable("instance"),i=t.size;t.ghost=t.originalElement.clone();t.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0});t._addClass(t.ghost,"ui-resizable-ghost");n.uiBackCompat!==!1&&typeof t.options.ghost=="string"&&t.ghost.addClass(this.options.ghost);t.ghost.appendTo(t.helper)},resize:function(){var t=n(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=n(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}});n.ui.plugin.add("resizable","grid",{resize:function(){var h,t=n(this).resizable("instance"),i=t.options,y=t.size,o=t.originalSize,s=t.originalPosition,c=t.axis,l=typeof i.grid=="number"?[i.grid,i.grid]:i.grid,f=l[0]||1,e=l[1]||1,a=Math.round((y.width-o.width)/f)*f,v=Math.round((y.height-o.height)/e)*e,r=o.width+a,u=o.height+v,p=i.maxWidth&&i.maxWidth<r,w=i.maxHeight&&i.maxHeight<u,b=i.minWidth&&i.minWidth>r,k=i.minHeight&&i.minHeight>u;i.grid=l;b&&(r+=f);k&&(u+=e);p&&(r-=f);w&&(u-=e);/^(se|s|e)$/.test(c)?(t.size.width=r,t.size.height=u):/^(ne)$/.test(c)?(t.size.width=r,t.size.height=u,t.position.top=s.top-v):/^(sw)$/.test(c)?(t.size.width=r,t.size.height=u,t.position.left=s.left-a):((u-e<=0||r-f<=0)&&(h=t._getPaddingPlusBorderDimensions(this)),u-e>0?(t.size.height=u,t.position.top=s.top-v):(u=e-h.height,t.size.height=u,t.position.top=s.top+o.height-u),r-f>0?(t.size.width=r,t.position.left=s.left-a):(r=f-h.width,t.size.width=r,t.position.left=s.left+o.width-r))}});g=n.ui.resizable;
/*!
 * jQuery UI Selectable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
nt=n.widget("ui.selectable",n.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t=this;this._addClass("ui-selectable");this.dragged=!1;this.refresh=function(){t.elementPos=n(t.element[0]).offset();t.selectees=n(t.options.filter,t.element[0]);t._addClass(t.selectees,"ui-selectee");t.selectees.each(function(){var i=n(this),u=i.offset(),r={left:u.left-t.elementPos.left,top:u.top-t.elementPos.top};n.data(this,"selectable-item",{element:this,$element:i,left:r.left,top:r.top,right:r.left+i.outerWidth(),bottom:r.top+i.outerHeight(),startselected:!1,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})};this.refresh();this._mouseInit();this.helper=n("<div>");this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item");this._mouseDestroy()},_mouseStart:function(t){var i=this,r=this.options;(this.opos=[t.pageX,t.pageY],this.elementPos=n(this.element[0]).offset(),this.options.disabled)||(this.selectees=n(r.filter,this.element[0]),this._trigger("start",t),n(r.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),r.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var r=n.data(this,"selectable-item");r.startselected=!0;t.metaKey||t.ctrlKey||(i._removeClass(r.$element,"ui-selected"),r.selected=!1,i._addClass(r.$element,"ui-unselecting"),r.unselecting=!0,i._trigger("unselecting",t,{unselecting:r.element}))}),n(t.target).parents().addBack().each(function(){var u,r=n.data(this,"selectable-item");if(r)return u=!t.metaKey&&!t.ctrlKey||!r.$element.hasClass("ui-selected"),i._removeClass(r.$element,u?"ui-unselecting":"ui-selected")._addClass(r.$element,u?"ui-selecting":"ui-unselecting"),r.unselecting=!u,r.selecting=u,r.selected=u,u?i._trigger("selecting",t,{selecting:r.element}):i._trigger("unselecting",t,{unselecting:r.element}),!1}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var o,i=this,s=this.options,r=this.opos[0],u=this.opos[1],f=t.pageX,e=t.pageY;return r>f&&(o=f,f=r,r=o),u>e&&(o=e,e=u,u=o),this.helper.css({left:r,top:u,width:f-r,height:e-u}),this.selectees.each(function(){var o=n.data(this,"selectable-item"),c=!1,h={};o&&o.element!==i.element[0]&&(h.left=o.left+i.elementPos.left,h.right=o.right+i.elementPos.left,h.top=o.top+i.elementPos.top,h.bottom=o.bottom+i.elementPos.top,s.tolerance==="touch"?c=!(h.left>f||h.right<r||h.top>e||h.bottom<u):s.tolerance==="fit"&&(c=h.left>r&&h.right<f&&h.top>u&&h.bottom<e),c?(o.selected&&(i._removeClass(o.$element,"ui-selected"),o.selected=!1),o.unselecting&&(i._removeClass(o.$element,"ui-unselecting"),o.unselecting=!1),o.selecting||(i._addClass(o.$element,"ui-selecting"),o.selecting=!0,i._trigger("selecting",t,{selecting:o.element}))):(o.selecting&&((t.metaKey||t.ctrlKey)&&o.startselected?(i._removeClass(o.$element,"ui-selecting"),o.selecting=!1,i._addClass(o.$element,"ui-selected"),o.selected=!0):(i._removeClass(o.$element,"ui-selecting"),o.selecting=!1,o.startselected&&(i._addClass(o.$element,"ui-unselecting"),o.unselecting=!0),i._trigger("unselecting",t,{unselecting:o.element}))),o.selected&&(t.metaKey||t.ctrlKey||o.startselected||(i._removeClass(o.$element,"ui-selected"),o.selected=!1,i._addClass(o.$element,"ui-unselecting"),o.unselecting=!0,i._trigger("unselecting",t,{unselecting:o.element})))))}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,n(".ui-unselecting",this.element[0]).each(function(){var r=n.data(this,"selectable-item");i._removeClass(r.$element,"ui-unselecting");r.unselecting=!1;r.startselected=!1;i._trigger("unselected",t,{unselected:r.element})}),n(".ui-selecting",this.element[0]).each(function(){var r=n.data(this,"selectable-item");i._removeClass(r.$element,"ui-selecting")._addClass(r.$element,"ui-selected");r.selecting=!1;r.selected=!0;r.startselected=!0;i._trigger("selected",t,{selected:r.element})}),this._trigger("stop",t),this.helper.remove(),!1}});
/*!
 * jQuery UI Sortable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
tt=n.widget("ui.sortable",n.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(n,t,i){return n>=t&&n<t+i},_isFloating:function(n){return/left|right/.test(n.css("float"))||/inline|table-cell/.test(n.css("display"))},_create:function(){this.containerCache={};this._addClass("ui-sortable");this.refresh();this.offset=this.element.offset();this._mouseInit();this._setHandleClassName();this.ready=!0},_setOption:function(n,t){this._super(n,t);n==="handle"&&this._setHandleClassName()},_setHandleClassName:function(){var t=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle");n.each(this.items,function(){t._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var n=this.items.length-1;n>=0;n--)this.items[n].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,i){var r=null,f=!1,u=this;return this.reverting?!1:this.options.disabled||this.options.type==="static"?!1:(this._refreshItems(t),n(t.target).parents().each(function(){if(n.data(this,u.widgetName+"-item")===u)return r=n(this),!1}),n.data(t.target,u.widgetName+"-item")===u&&(r=n(t.target)),!r)?!1:this.options.handle&&!i&&(n(this.options.handle,r).find("*").addBack().each(function(){this===t.target&&(f=!0)}),!f)?!1:(this.currentItem=r,this._removeCurrentsFromItems(),!0)},_mouseStart:function(t,i,r){var f,e,u=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},n.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,u.cursorAt&&this._adjustOffsetFromHelper(u.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),u.containment&&this._setContainment(),u.cursor&&u.cursor!=="auto"&&(e=this.document.find("body"),this.storedCursor=e.css("cursor"),e.css("cursor",u.cursor),this.storedStylesheet=n("<style>*{ cursor: "+u.cursor+" !important; }<\/style>").appendTo(e)),u.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",u.opacity)),u.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",u.zIndex)),this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!r)for(f=this.containers.length-1;f>=0;f--)this.containers[f]._trigger("activate",t,this._uiHash(this));return n.ui.ddmanager&&(n.ui.ddmanager.current=this),n.ui.ddmanager&&!u.dropBehaviour&&n.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var e,u,f,o,i=this.options,r=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-this.overflowOffset.top<i.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-i.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-this.overflowOffset.left<i.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-i.scrollSpeed)):(t.pageY-this.document.scrollTop()<i.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-i.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())<i.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+i.scrollSpeed)),t.pageX-this.document.scrollLeft()<i.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-i.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())<i.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+i.scrollSpeed))),r!==!1&&n.ui.ddmanager&&!i.dropBehaviour&&n.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&this.options.axis==="y"||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&this.options.axis==="x"||(this.helper[0].style.top=this.position.top+"px"),e=this.items.length-1;e>=0;e--)if((u=this.items[e],f=u.item[0],o=this._intersectsWithPointer(u),o)&&u.instance===this.currentContainer&&f!==this.currentItem[0]&&this.placeholder[o===1?"next":"prev"]()[0]!==f&&!n.contains(this.placeholder[0],f)&&(this.options.type==="semi-dynamic"?!n.contains(this.element[0],f):!0)){if(this.direction=o===1?"down":"up",this.options.tolerance==="pointer"||this._intersectsWithSides(u))this._rearrange(t,u);else break;this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),n.ui.ddmanager&&n.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(n.ui.ddmanager&&!this.options.dropBehaviour&&n.ui.ddmanager.drop(this,t),this.options.revert){var e=this,f=this.placeholder.offset(),r=this.options.axis,u={};r&&r!=="x"||(u.left=f.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft));r&&r!=="y"||(u.top=f.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop));this.reverting=!0;n(this.helper).animate(u,parseInt(this.options.revert,10)||500,function(){e._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new n.Event("mouseup",{target:null}));this.options.helper==="original"?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!=="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),n.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?n(this.domPosition.prev).after(this.currentItem):n(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var r=this._getItemsAsjQuery(t&&t.connected),i=[];return t=t||{},n(r).each(function(){var r=(n(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);r&&i.push((t.key||r[1]+"[]")+"="+(t.key&&t.expression?r[1]:r[2]))}),!i.length&&t.key&&i.push(t.key+"="),i.join("&")},toArray:function(t){var r=this._getItemsAsjQuery(t&&t.connected),i=[];return t=t||{},r.each(function(){i.push(n(t.item||this).attr(t.attribute||"id")||"")}),i},_intersectsWith:function(n){var t=this.positionAbs.left,h=t+this.helperProportions.width,i=this.positionAbs.top,c=i+this.helperProportions.height,r=n.left,f=r+n.width,u=n.top,e=u+n.height,o=this.offset.click.top,s=this.offset.click.left,l=this.options.axis==="x"||i+o>u&&i+o<e,a=this.options.axis==="y"||t+s>r&&t+s<f,v=l&&a;return this.options.tolerance==="pointer"||this.options.forcePointerForContainers||this.options.tolerance!=="pointer"&&this.helperProportions[this.floating?"width":"height"]>n[this.floating?"width":"height"]?v:r<t+this.helperProportions.width/2&&h-this.helperProportions.width/2<f&&u<i+this.helperProportions.height/2&&c-this.helperProportions.height/2<e},_intersectsWithPointer:function(n){var t,i,r=this.options.axis==="x"||this._isOverAxis(this.positionAbs.top+this.offset.click.top,n.top,n.height),u=this.options.axis==="y"||this._isOverAxis(this.positionAbs.left+this.offset.click.left,n.left,n.width),f=r&&u;return f?(t=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?i==="right"||t==="down"?2:1:t&&(t==="down"?2:1)):!1},_intersectsWithSides:function(n){var r=this._isOverAxis(this.positionAbs.top+this.offset.click.top,n.top+n.height/2,n.height),u=this._isOverAxis(this.positionAbs.left+this.offset.click.left,n.left+n.width/2,n.width),t=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection();return this.floating&&i?i==="right"&&u||i==="left"&&!u:t&&(t==="down"&&r||t==="up"&&!r)},_getDragVerticalDirection:function(){var n=this.positionAbs.top-this.lastPositionAbs.top;return n!==0&&(n>0?"down":"up")},_getDragHorizontalDirection:function(){var n=this.positionAbs.left-this.lastPositionAbs.left;return n!==0&&(n>0?"right":"left")},refresh:function(n){return this._refreshItems(n),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var n=this.options;return n.connectWith.constructor===String?[n.connectWith]:n.connectWith},_getItemsAsjQuery:function(t){function h(){s.push(this)}var r,u,e,i,s=[],f=[],o=this._connectWith();if(o&&t)for(r=o.length-1;r>=0;r--)for(e=n(o[r],this.document[0]),u=e.length-1;u>=0;u--)i=n.data(e[u],this.widgetFullName),i&&i!==this&&!i.options.disabled&&f.push([n.isFunction(i.options.items)?i.options.items.call(i.element):n(i.options.items,i.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),i]);for(f.push([n.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):n(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),r=f.length-1;r>=0;r--)f[r][0].each(h);return n(s)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=n.grep(this.items,function(n){for(var i=0;i<t.length;i++)if(t[i]===n.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[];this.containers=[this];var r,u,e,i,o,s,h,l,a=this.items,f=[[n.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):n(this.options.items,this.element),this]],c=this._connectWith();if(c&&this.ready)for(r=c.length-1;r>=0;r--)for(e=n(c[r],this.document[0]),u=e.length-1;u>=0;u--)i=n.data(e[u],this.widgetFullName),i&&i!==this&&!i.options.disabled&&(f.push([n.isFunction(i.options.items)?i.options.items.call(i.element[0],t,{item:this.currentItem}):n(i.options.items,i.element),i]),this.containers.push(i));for(r=f.length-1;r>=0;r--)for(o=f[r][1],s=f[r][0],u=0,l=s.length;u<l;u++)h=n(s[u]),h.data(this.widgetName+"-item",o),a.push({item:h,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.floating=this.items.length?this.options.axis==="x"||this._isFloating(this.items[0].item):!1;this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var r,f,u,i=this.items.length-1;i>=0;i--)(r=this.items[i],r.instance!==this.currentContainer&&this.currentContainer&&r.item[0]!==this.currentItem[0])||(f=this.options.toleranceElement?n(this.options.toleranceElement,r.item):r.item,t||(r.width=f.outerWidth(),r.height=f.outerHeight()),u=f.offset(),r.left=u.left,r.top=u.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)u=this.containers[i].element.offset(),this.containers[i].containerCache.left=u.left,this.containers[i].containerCache.top=u.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var r,i=t.options;i.placeholder&&i.placeholder.constructor!==String||(r=i.placeholder,i.placeholder={element:function(){var u=t.currentItem[0].nodeName.toLowerCase(),i=n("<"+u+">",t.document[0]);return t._addClass(i,"ui-sortable-placeholder",r||t.currentItem[0].className)._removeClass(i,"ui-sortable-helper"),u==="tbody"?t._createTrPlaceholder(t.currentItem.find("tr").eq(0),n("<tr>",t.document[0]).appendTo(i)):u==="tr"?t._createTrPlaceholder(t.currentItem,i):u==="img"&&i.attr("src",t.currentItem.attr("src")),r||i.css("visibility","hidden"),i},update:function(n,u){(!r||i.forcePlaceholderSize)&&(u.height()||u.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),u.width()||u.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}});t.placeholder=n(i.placeholder.element.call(t.element,t.currentItem));t.currentItem.after(t.placeholder);i.placeholder.update(t,t.placeholder)},_createTrPlaceholder:function(t,i){var r=this;t.children().each(function(){n("<td>&#160;<\/td>",r.document[0]).attr("colspan",n(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(t){for(var u,c,f,a,v,o,l,s,h,e=null,i=null,r=this.containers.length-1;r>=0;r--)if(!n.contains(this.currentItem[0],this.containers[r].element[0]))if(this._intersectsWith(this.containers[r].containerCache)){if(e&&n.contains(this.containers[r].element[0],e.element[0]))continue;e=this.containers[r];i=r}else this.containers[r].containerCache.over&&(this.containers[r]._trigger("out",t,this._uiHash(this)),this.containers[r].containerCache.over=0);if(e)if(this.containers.length===1)this.containers[i].containerCache.over||(this.containers[i]._trigger("over",t,this._uiHash(this)),this.containers[i].containerCache.over=1);else{for(c=1e4,f=null,s=e.floating||this._isFloating(this.currentItem),a=s?"left":"top",v=s?"width":"height",h=s?"pageX":"pageY",u=this.items.length-1;u>=0;u--)n.contains(this.containers[i].element[0],this.items[u].item[0])&&this.items[u].item[0]!==this.currentItem[0]&&(o=this.items[u].item.offset()[a],l=!1,t[h]-o>this.items[u][v]/2&&(l=!0),Math.abs(t[h]-o)<c&&(c=Math.abs(t[h]-o),f=this.items[u],this.direction=l?"up":"down"));if(!f&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[i]){this.currentContainer.containerCache.over||(this.containers[i]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1);return}f?this._rearrange(t,f,null,!0):this._rearrange(t,null,this.containers[i].element,!0);this._trigger("change",t,this._uiHash());this.containers[i]._trigger("change",t,this._uiHash(this));this.currentContainer=this.containers[i];this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[i]._trigger("over",t,this._uiHash(this));this.containers[i].containerCache.over=1}},_createHelper:function(t){var r=this.options,i=n.isFunction(r.helper)?n(r.helper.apply(this.element[0],[t,this.currentItem])):r.helper==="clone"?this.currentItem.clone():this.currentItem;return i.parents("body").length||n(r.appendTo!=="parent"?r.appendTo:this.currentItem[0].parentNode)[0].appendChild(i[0]),i[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!i[0].style.width||r.forceHelperSize)&&i.width(this.currentItem.width()),(!i[0].style.height||r.forceHelperSize)&&i.height(this.currentItem.height()),i},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" "));n.isArray(t)&&(t={left:+t[0],top:+t[1]||0});"left"in t&&(this.offset.click.left=t.left+this.margins.left);"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left);"top"in t&&(this.offset.click.top=t.top+this.margins.top);"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return this.cssPosition==="absolute"&&this.scrollParent[0]!==this.document[0]&&n.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&n.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var n=this.currentItem.position();return{top:n.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:n.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,r,u,i=this.options;i.containment==="parent"&&(i.containment=this.helper[0].parentNode);(i.containment==="document"||i.containment==="window")&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,i.containment==="document"?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,(i.containment==="document"?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]);/^(document|window|parent)$/.test(i.containment)||(t=n(i.containment)[0],r=n(i.containment).offset(),u=n(t).css("overflow")!=="hidden",this.containment=[r.left+(parseInt(n(t).css("borderLeftWidth"),10)||0)+(parseInt(n(t).css("paddingLeft"),10)||0)-this.margins.left,r.top+(parseInt(n(t).css("borderTopWidth"),10)||0)+(parseInt(n(t).css("paddingTop"),10)||0)-this.margins.top,r.left+(u?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(n(t).css("borderLeftWidth"),10)||0)-(parseInt(n(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,r.top+(u?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(n(t).css("borderTopWidth"),10)||0)-(parseInt(n(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var r=t==="absolute"?1:-1,u=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==this.document[0]&&n.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,f=/(html|body)/i.test(u[0].tagName);return{top:i.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():f?0:u.scrollTop())*r,left:i.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():f?0:u.scrollLeft())*r}},_generatePosition:function(t){var r,u,i=this.options,f=t.pageX,e=t.pageY,o=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==this.document[0]&&n.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,s=/(html|body)/i.test(o[0].tagName);return this.cssPosition!=="relative"||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(e=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(e=this.containment[3]+this.offset.click.top)),i.grid&&(r=this.originalPageY+Math.round((e-this.originalPageY)/i.grid[1])*i.grid[1],e=this.containment?r-this.offset.click.top>=this.containment[1]&&r-this.offset.click.top<=this.containment[3]?r:r-this.offset.click.top>=this.containment[1]?r-i.grid[1]:r+i.grid[1]:r,u=this.originalPageX+Math.round((f-this.originalPageX)/i.grid[0])*i.grid[0],f=this.containment?u-this.offset.click.left>=this.containment[0]&&u-this.offset.click.left<=this.containment[2]?u:u-this.offset.click.left>=this.containment[0]?u-i.grid[0]:u+i.grid[0]:u)),{top:e-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():s?0:o.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():s?0:o.scrollLeft())}},_rearrange:function(n,t,i,r){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],this.direction==="down"?t.item[0]:t.item[0].nextSibling);this.counter=this.counter?++this.counter:1;var u=this.counter;this._delay(function(){u===this.counter&&this.refreshPositions(!r)})},_clear:function(n,t){function u(n,t,i){return function(r){i._trigger(n,r,t._uiHash(t))}}this.reverting=!1;var i,r=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)(this._storedCSS[i]==="auto"||this._storedCSS[i]==="static")&&(this._storedCSS[i]="");this.currentItem.css(this._storedCSS);this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&r.push(function(n){this._trigger("receive",n,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!==this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!==this.currentItem.parent()[0])&&!t&&r.push(function(n){this._trigger("update",n,this._uiHash())}),this!==this.currentContainer&&(t||(r.push(function(n){this._trigger("remove",n,this._uiHash())}),r.push(function(n){return function(t){n._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(n){return function(t){n._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)t||r.push(u("deactivate",this,this.containers[i])),this.containers[i].containerCache.over&&(r.push(u("out",this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex==="auto"?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",n,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(i=0;i<r.length;i++)r[i].call(this,n);this._trigger("stop",n,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){n.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||n([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}});
/*!
 * jQuery UI Menu 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
it=n.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element;this.mouseHandled=!1;this.element.uniqueId().attr({role:this.options.role,tabIndex:0});this._addClass("ui-menu","ui-widget ui-widget-content");this._on({"mousedown .ui-menu-item":function(n){n.preventDefault()},"click .ui-menu-item":function(t){var i=n(t.target),r=n(n.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(t):!this.element.is(":focus")&&r.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&this.active.parents(".ui-menu").length===1&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){if(!this.previousFilter){var r=n(t.target).closest(".ui-menu-item"),i=n(t.currentTarget);r[0]===i[0]&&(this._removeClass(i.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(t,i))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(n,t){var i=this.active||this.element.find(this.options.items).eq(0);t||this.focus(n,i)},blur:function(t){this._delay(function(){var i=!n.contains(this.element[0],n.ui.safeActiveElement(this.document[0]));i&&this.collapseAll(t)})},keydown:"_keydown"});this.refresh();this._on(this.document,{click:function(n){this._closeOnDocumentClick(n)&&this.collapseAll(n);this.mouseHandled=!1}})},_destroy:function(){var t=this.element.find(".ui-menu-item").removeAttr("role aria-disabled"),i=t.children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show();i.children().each(function(){var t=n(this);t.data("ui-menu-submenu-caret")&&t.remove()})},_keydown:function(t){var i,u,r,f,e=!0;switch(t.keyCode){case n.ui.keyCode.PAGE_UP:this.previousPage(t);break;case n.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case n.ui.keyCode.HOME:this._move("first","first",t);break;case n.ui.keyCode.END:this._move("last","last",t);break;case n.ui.keyCode.UP:this.previous(t);break;case n.ui.keyCode.DOWN:this.next(t);break;case n.ui.keyCode.LEFT:this.collapse(t);break;case n.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case n.ui.keyCode.ENTER:case n.ui.keyCode.SPACE:this._activate(t);break;case n.ui.keyCode.ESCAPE:this.collapse(t);break;default:e=!1;u=this.previousFilter||"";f=!1;r=t.keyCode>=96&&t.keyCode<=105?(t.keyCode-96).toString():String.fromCharCode(t.keyCode);clearTimeout(this.filterTimer);r===u?f=!0:r=u+r;i=this._filterMenuItems(r);i=f&&i.index(this.active.next())!==-1?this.active.nextAll(".ui-menu-item"):i;i.length||(r=String.fromCharCode(t.keyCode),i=this._filterMenuItems(r));i.length?(this.focus(t,i),this.previousFilter=r,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}e&&t.preventDefault()},_activate:function(n){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(n):this.select(n))},refresh:function(){var u,t,f,i,e,r=this,s=this.options.icons.submenu,o=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length);f=o.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=n(this),i=t.prev(),u=n("<span>").data("ui-menu-submenu-caret",!0);r._addClass(u,"ui-menu-icon","ui-icon "+s);i.attr("aria-haspopup","true").prepend(u);t.attr("aria-labelledby",i.attr("id"))});this._addClass(f,"ui-menu","ui-widget ui-widget-content ui-front");u=o.add(this.element);t=u.find(this.options.items);t.not(".ui-menu-item").each(function(){var t=n(this);r._isDivider(t)&&r._addClass(t,"ui-menu-divider","ui-widget-content")});i=t.not(".ui-menu-item, .ui-menu-divider");e=i.children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()});this._addClass(i,"ui-menu-item")._addClass(e,"ui-menu-item-wrapper");t.filter(".ui-state-disabled").attr("aria-disabled","true");this.active&&!n.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(n,t){if(n==="icons"){var i=this.element.find(".ui-menu-icon");this._removeClass(i,null,this.options.icons.submenu)._addClass(i,null,t.submenu)}this._super(n,t)},_setOptionDisabled:function(n){this._super(n);this.element.attr("aria-disabled",String(n));this._toggleClass(null,"ui-state-disabled",!!n)},focus:function(n,t){var i,r,u;this.blur(n,n&&n.type==="focus");this._scrollIntoView(t);this.active=t.first();r=this.active.children(".ui-menu-item-wrapper");this._addClass(r,null,"ui-state-active");this.options.role&&this.element.attr("aria-activedescendant",r.attr("id"));u=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper");this._addClass(u,null,"ui-state-active");n&&n.type==="keydown"?this._close():this.timer=this._delay(function(){this._close()},this.delay);i=t.children(".ui-menu");i.length&&n&&/^mouse/.test(n.type)&&this._startOpening(i);this.activeMenu=t.parent();this._trigger("focus",n,{item:t})},_scrollIntoView:function(t){var e,o,i,r,u,f;this._hasScroll()&&(e=parseFloat(n.css(this.activeMenu[0],"borderTopWidth"))||0,o=parseFloat(n.css(this.activeMenu[0],"paddingTop"))||0,i=t.offset().top-this.activeMenu.offset().top-e-o,r=this.activeMenu.scrollTop(),u=this.activeMenu.height(),f=t.outerHeight(),i<0?this.activeMenu.scrollTop(r+i):i+f>u&&this.activeMenu.scrollTop(r+i-u+f))},blur:function(n,t){(t||clearTimeout(this.timer),this.active)&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",n,{item:this.active}),this.active=null)},_startOpening:function(n){(clearTimeout(this.timer),n.attr("aria-hidden")==="true")&&(this.timer=this._delay(function(){this._close();this._open(n)},this.delay))},_open:function(t){var i=n.extend({of:this.active},this.options.position);clearTimeout(this.timer);this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true");t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(t,i){clearTimeout(this.timer);this.timer=this._delay(function(){var r=i?this.element:n(t&&t.target).closest(this.element.find(".ui-menu"));r.length||(r=this.element);this._close(r);this.blur(t);this._removeClass(r.find(".ui-state-active"),null,"ui-state-active");this.activeMenu=r},this.delay)},_close:function(n){n||(n=this.active?this.active.parent():this.element);n.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(t){return!n(t.target).closest(".ui-menu").length},_isDivider:function(n){return!/[^\-\u2014\u2013\s]/.test(n.text())},collapse:function(n){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(n,t))},expand:function(n){var t=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(n,t)}))},next:function(n){this._move("next","first",n)},previous:function(n){this._move("prev","last",n)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(n,t,i){var r;this.active&&(r=n==="first"||n==="last"?this.active[n==="first"?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[n+"All"](".ui-menu-item").eq(0));r&&r.length&&this.active||(r=this.activeMenu.find(this.options.items)[t]());this.focus(i,r)},nextPage:function(t){var i,r,u;if(!this.active){this.next(t);return}this.isLastItem()||(this._hasScroll()?(r=this.active.offset().top,u=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=n(this),i.offset().top-r-u<0}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items)[this.active?"last":"first"]()))},previousPage:function(t){var i,r,u;if(!this.active){this.next(t);return}this.isFirstItem()||(this._hasScroll()?(r=this.active.offset().top,u=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=n(this),i.offset().top-r+u>0}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items).first()))},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||n(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0);this._trigger("select",t,i)},_filterMenuItems:function(t){var i=t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),r=new RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return r.test(n.trim(n(this).children(".ui-menu-item-wrapper").text()))})}});
/*!
 * jQuery UI Selectmenu 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
rt=n.widget("ui.selectmenu",[n.ui.formResetMixin,{version:"1.12.1",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:!1,change:null,close:null,focus:null,open:null,select:null},_create:function(){var t=this.element.uniqueId().attr("id");this.ids={element:t,button:t+"-button",menu:t+"-menu"};this._drawButton();this._drawMenu();this._bindFormResetHandler();this._rendered=!1;this.menuItems=n()},_drawButton:function(){var t,i=this,r=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button);this._on(this.labels,{click:function(n){this.button.focus();n.preventDefault()}});this.element.hide();this.button=n("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element);this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget");t=n("<span>").appendTo(this.button);this._addClass(t,"ui-selectmenu-icon","ui-icon "+this.options.icons.button);this.buttonItem=this._renderButtonItem(r).appendTo(this.button);this.options.width!==!1&&this._resizeButton();this._on(this.button,this._buttonEvents);this.button.one("focusin",function(){i._rendered||i._refreshMenu()})},_drawMenu:function(){var t=this;this.menu=n("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu});this.menuWrap=n("<div>").append(this.menu);this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front");this.menuWrap.appendTo(this._appendTo());this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(n,i){n.preventDefault();t._setSelection();t._select(i.item.data("ui-selectmenu-item"),n)},focus:function(n,i){var r=i.item.data("ui-selectmenu-item");t.focusIndex!=null&&r.index!==t.focusIndex&&(t._trigger("focus",n,{item:r}),t.isOpen||t._select(r,n));t.focusIndex=r.index;t.button.attr("aria-activedescendant",t.menuItems.eq(r.index).attr("id"))}}).menu("instance");this.menuInstance._off(this.menu,"mouseleave");this.menuInstance._closeOnDocumentClick=function(){return!1};this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu();this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{}));this.options.width===null&&this._resizeButton()},_refreshMenu:function(){var n,t=this.element.find("option");(this.menu.empty(),this._parseOptions(t),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper"),this._rendered=!0,t.length)&&(n=this._getSelectedItem(),this.menuInstance.focus(null,n),this._setAria(n.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(n){this.options.disabled||(this._rendered?(this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.menuItems.length)&&(this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",n))},_position:function(){this.menuWrap.position(n.extend({of:this.button},this.options.position))},close:function(n){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",n))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(t){var i=n("<span>");return this._setText(i,t.label),this._addClass(i,"ui-selectmenu-text"),i},_renderMenu:function(t,i){var r=this,u="";n.each(i,function(i,f){var e;f.optgroup!==u&&(e=n("<li>",{text:f.optgroup}),r._addClass(e,"ui-selectmenu-optgroup","ui-menu-divider"+(f.element.parent("optgroup").prop("disabled")?" ui-state-disabled":"")),e.appendTo(t),u=f.optgroup);r._renderItemData(t,f)})},_renderItemData:function(n,t){return this._renderItem(n,t).data("ui-selectmenu-item",t)},_renderItem:function(t,i){var r=n("<li>"),u=n("<div>",{title:i.element.attr("title")});return i.disabled&&this._addClass(r,null,"ui-state-disabled"),this._setText(u,i.label),r.append(u).appendTo(t)},_setText:function(n,t){t?n.text(t):n.html("&#160;")},_move:function(n,t){var i,r,u=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex).parent("li"):(i=this.menuItems.eq(this.element[0].selectedIndex).parent("li"),u+=":not(.ui-state-disabled)");r=n==="first"||n==="last"?i[n==="first"?"prevAll":"nextAll"](u).eq(-1):i[n+"All"](u).eq(0);r.length&&this.menuInstance.focus(t,r)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(n){this[this.isOpen?"close":"open"](n)},_setSelection:function(){var n;this.range&&(window.getSelection?(n=window.getSelection(),n.removeAllRanges(),n.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(t){this.isOpen&&(n(t.target).closest(".ui-selectmenu-menu, #"+n.ui.escapeSelector(this.ids.button)).length||this.close(t))}},_buttonEvents:{mousedown:function(){var n;window.getSelection?(n=window.getSelection(),n.rangeCount&&(this.range=n.getRangeAt(0))):this.range=document.selection.createRange()},click:function(n){this._setSelection();this._toggle(n)},keydown:function(t){var i=!0;switch(t.keyCode){case n.ui.keyCode.TAB:case n.ui.keyCode.ESCAPE:this.close(t);i=!1;break;case n.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(t);break;case n.ui.keyCode.UP:t.altKey?this._toggle(t):this._move("prev",t);break;case n.ui.keyCode.DOWN:t.altKey?this._toggle(t):this._move("next",t);break;case n.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(t):this._toggle(t);break;case n.ui.keyCode.LEFT:this._move("prev",t);break;case n.ui.keyCode.RIGHT:this._move("next",t);break;case n.ui.keyCode.HOME:case n.ui.keyCode.PAGE_UP:this._move("first",t);break;case n.ui.keyCode.END:case n.ui.keyCode.PAGE_DOWN:this._move("last",t);break;default:this.menu.trigger(t);i=!1}i&&t.preventDefault()}},_selectFocusedItem:function(n){var t=this.menuItems.eq(this.focusIndex).parent("li");t.hasClass("ui-state-disabled")||this._select(t.data("ui-selectmenu-item"),n)},_select:function(n,t){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=n.index;this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(n));this._setAria(n);this._trigger("select",t,{item:n});n.index!==i&&this._trigger("change",t,{item:n});this.close(t)},_setAria:function(n){var t=this.menuItems.eq(n.index).attr("id");this.button.attr({"aria-labelledby":t,"aria-activedescendant":t});this.menu.attr("aria-activedescendant",t)},_setOption:function(n,t){if(n==="icons"){var i=this.button.find("span.ui-icon");this._removeClass(i,null,this.options.icons.button)._addClass(i,null,t.button)}this._super(n,t);n==="appendTo"&&this.menuWrap.appendTo(this._appendTo());n==="width"&&this._resizeButton()},_setOptionDisabled:function(n){this._super(n);this.menuInstance.option("disabled",n);this.button.attr("aria-disabled",n);this._toggleClass(this.button,null,"ui-state-disabled",n);this.element.prop("disabled",n);n?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?n(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front, dialog")),t.length||(t=this.document[0].body),t},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen);this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen);this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var n=this.options.width;if(n===!1){this.button.css("width","");return}n===null&&(n=this.element.show().outerWidth(),this.element.hide());this.button.outerWidth(n)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var n=this._super();return n.disabled=this.element.prop("disabled"),n},_parseOptions:function(t){var r=this,i=[];t.each(function(t,u){i.push(r._parseOption(n(u),t))});this.items=i},_parseOption:function(n,t){var i=n.parent("optgroup");return{element:n,index:t,value:n.val(),label:n.text(),optgroup:i.attr("label")||"",disabled:i.prop("disabled")||n.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler();this.menuWrap.remove();this.button.remove();this.element.show();this.element.removeUniqueId();this.labels.attr("for",this.ids.element)}}]);
/*!
 * jQuery UI Slider 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
ut=n.widget("ui.slider",n.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1;this._mouseSliding=!1;this._animateOff=!0;this._handleIndex=null;this._detectOrientation();this._mouseInit();this._calculateNewMax();this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content");this._refresh();this._animateOff=!1},_refresh:function(){this._createRange();this._createHandles();this._setupEvents();this._refreshValue()},_createHandles:function(){var r,i,u=this.options,t=this.element.find(".ui-slider-handle"),f=[];for(i=u.values&&u.values.length||1,t.length>i&&(t.slice(i).remove(),t=t.slice(0,i)),r=t.length;r<i;r++)f.push("<span tabindex='0'><\/span>");this.handles=t.add(n(f.join("")).appendTo(this.element));this._addClass(this.handles,"ui-slider-handle","ui-state-default");this.handle=this.handles.eq(0);this.handles.each(function(t){n(this).data("ui-slider-handle-index",t).attr("tabIndex",0)})},_createRange:function(){var t=this.options;t.range?(t.range===!0&&(t.values?t.values.length&&t.values.length!==2?t.values=[t.values[0],t.values[0]]:n.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({left:"",bottom:""})):(this.range=n("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),(t.range==="min"||t.range==="max")&&this._addClass(this.range,"ui-slider-range-"+t.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles);this._on(this.handles,this._handleEvents);this._hoverable(this.handles);this._focusable(this.handles)},_destroy:function(){this.handles.remove();this.range&&this.range.remove();this._mouseDestroy()},_mouseCapture:function(t){var s,f,r,i,u,h,e,c,o=this,l=this.options;return l.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),s={x:t.pageX,y:t.pageY},f=this._normValueFromMouse(s),r=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var e=Math.abs(f-o.values(t));(r>e||r===e&&(t===o._lastChangedValue||o.values(t)===l.min))&&(r=e,i=n(this),u=t)}),h=this._start(t,u),h===!1)?!1:(this._mouseSliding=!0,this._handleIndex=u,this._addClass(i,null,"ui-state-active"),i.trigger("focus"),e=i.offset(),c=!n(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=c?{left:0,top:0}:{left:t.pageX-e.left-i.width()/2,top:t.pageY-e.top-i.height()/2-(parseInt(i.css("borderTopWidth"),10)||0)-(parseInt(i.css("borderBottomWidth"),10)||0)+(parseInt(i.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,u,f),this._animateOff=!0,!0)},_mouseStart:function(){return!0},_mouseDrag:function(n){var t={x:n.pageX,y:n.pageY},i=this._normValueFromMouse(t);return this._slide(n,this._handleIndex,i),!1},_mouseStop:function(n){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(n,this._handleIndex),this._change(n,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(n){var i,r,t,u,f;return this.orientation==="horizontal"?(i=this.elementSize.width,r=n.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(i=this.elementSize.height,r=n.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),t=r/i,t>1&&(t=1),t<0&&(t=0),this.orientation==="vertical"&&(t=1-t),u=this._valueMax()-this._valueMin(),f=this._valueMin()+t*u,this._trimAlignValue(f)},_uiHash:function(n,t,i){var r={handle:this.handles[n],handleIndex:n,value:t!==undefined?t:this.value()};return this._hasMultipleValues()&&(r.value=t!==undefined?t:this.values(n),r.values=i||this.values()),r},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(n,t){return this._trigger("start",n,this._uiHash(t))},_slide:function(n,t,i){var u,r,f=this.value(),e=this.values();(this._hasMultipleValues()&&(r=this.values(t?0:1),f=this.values(t),this.options.values.length===2&&this.options.range===!0&&(i=t===0?Math.min(r,i):Math.max(r,i)),e[t]=i),i!==f)&&(u=this._trigger("slide",n,this._uiHash(t,i,e)),u!==!1)&&(this._hasMultipleValues()?this.values(t,i):this.value(i))},_stop:function(n,t){this._trigger("stop",n,this._uiHash(t))},_change:function(n,t){this._keySliding||this._mouseSliding||(this._lastChangedValue=t,this._trigger("change",n,this._uiHash(t)))},value:function(n){if(arguments.length){this.options.value=this._trimAlignValue(n);this._refreshValue();this._change(null,0);return}return this._value()},values:function(t,i){var u,f,r;if(arguments.length>1){this.options.values[t]=this._trimAlignValue(i);this._refreshValue();this._change(null,t);return}if(arguments.length)if(n.isArray(arguments[0])){for(u=this.options.values,f=arguments[0],r=0;r<u.length;r+=1)u[r]=this._trimAlignValue(f[r]),this._change(null,r);this._refreshValue()}else return this._hasMultipleValues()?this._values(t):this.value();else return this._values()},_setOption:function(t,i){var r,u=0;t==="range"&&this.options.range===!0&&(i==="min"?(this.options.value=this._values(0),this.options.values=null):i==="max"&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null));n.isArray(this.options.values)&&(u=this.options.values.length);this._super(t,i);switch(t){case"orientation":this._detectOrientation();this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation);this._refreshValue();this.options.range&&this._refreshRange(i);this.handles.css(i==="horizontal"?"bottom":"left","");break;case"value":this._animateOff=!0;this._refreshValue();this._change(null,0);this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),r=u-1;r>=0;r--)this._change(null,r);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0;this._calculateNewMax();this._refreshValue();this._animateOff=!1;break;case"range":this._animateOff=!0;this._refresh();this._animateOff=!1}},_setOptionDisabled:function(n){this._super(n);this._toggleClass(null,"ui-state-disabled",!!n)},_value:function(){var n=this.options.value;return this._trimAlignValue(n)},_values:function(n){var r,t,i;if(arguments.length)return r=this.options.values[n],this._trimAlignValue(r);if(this._hasMultipleValues()){for(t=this.options.values.slice(),i=0;i<t.length;i+=1)t[i]=this._trimAlignValue(t[i]);return t}return[]},_trimAlignValue:function(n){if(n<=this._valueMin())return this._valueMin();if(n>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(n-this._valueMin())%t,r=n-i;return Math.abs(i)*2>=t&&(r+=i>0?t:-t),parseFloat(r.toFixed(5))},_calculateNewMax:function(){var n=this.options.max,i=this._valueMin(),t=this.options.step,r=Math.round((n-i)/t)*t;n=r+i;n>this.options.max&&(n-=t);this.max=parseFloat(n.toFixed(this._precision()))},_precision:function(){var n=this._precisionOf(this.options.step);return this.options.min!==null&&(n=Math.max(n,this._precisionOf(this.options.min))),n},_precisionOf:function(n){var t=n.toString(),i=t.indexOf(".");return i===-1?0:t.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(n){n==="vertical"&&this.range.css({width:"",left:""});n==="horizontal"&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var s,t,c,f,h,e=this.options.range,i=this.options,r=this,u=this._animateOff?!1:i.animate,o={};this._hasMultipleValues()?this.handles.each(function(f){t=(r.values(f)-r._valueMin())/(r._valueMax()-r._valueMin())*100;o[r.orientation==="horizontal"?"left":"bottom"]=t+"%";n(this).stop(1,1)[u?"animate":"css"](o,i.animate);r.options.range===!0&&(r.orientation==="horizontal"?(f===0&&r.range.stop(1,1)[u?"animate":"css"]({left:t+"%"},i.animate),f===1&&r.range[u?"animate":"css"]({width:t-s+"%"},{queue:!1,duration:i.animate})):(f===0&&r.range.stop(1,1)[u?"animate":"css"]({bottom:t+"%"},i.animate),f===1&&r.range[u?"animate":"css"]({height:t-s+"%"},{queue:!1,duration:i.animate})));s=t}):(c=this.value(),f=this._valueMin(),h=this._valueMax(),t=h!==f?(c-f)/(h-f)*100:0,o[this.orientation==="horizontal"?"left":"bottom"]=t+"%",this.handle.stop(1,1)[u?"animate":"css"](o,i.animate),e==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[u?"animate":"css"]({width:t+"%"},i.animate),e==="max"&&this.orientation==="horizontal"&&this.range.stop(1,1)[u?"animate":"css"]({width:100-t+"%"},i.animate),e==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[u?"animate":"css"]({height:t+"%"},i.animate),e==="max"&&this.orientation==="vertical"&&this.range.stop(1,1)[u?"animate":"css"]({height:100-t+"%"},i.animate))},_handleEvents:{keydown:function(t){var e,r,i,u,f=n(t.target).data("ui-slider-handle-index");switch(t.keyCode){case n.ui.keyCode.HOME:case n.ui.keyCode.END:case n.ui.keyCode.PAGE_UP:case n.ui.keyCode.PAGE_DOWN:case n.ui.keyCode.UP:case n.ui.keyCode.RIGHT:case n.ui.keyCode.DOWN:case n.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass(n(t.target),null,"ui-state-active"),e=this._start(t,f),e===!1))return}u=this.options.step;r=this._hasMultipleValues()?i=this.values(f):i=this.value();switch(t.keyCode){case n.ui.keyCode.HOME:i=this._valueMin();break;case n.ui.keyCode.END:i=this._valueMax();break;case n.ui.keyCode.PAGE_UP:i=this._trimAlignValue(r+(this._valueMax()-this._valueMin())/this.numPages);break;case n.ui.keyCode.PAGE_DOWN:i=this._trimAlignValue(r-(this._valueMax()-this._valueMin())/this.numPages);break;case n.ui.keyCode.UP:case n.ui.keyCode.RIGHT:if(r===this._valueMax())return;i=this._trimAlignValue(r+u);break;case n.ui.keyCode.DOWN:case n.ui.keyCode.LEFT:if(r===this._valueMin())return;i=this._trimAlignValue(r-u)}this._slide(t,f,i)},keyup:function(t){var i=n(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),this._removeClass(n(t.target),null,"ui-state-active"))}}})});
/*!
* jQuery Simulate v1.0.0 - simulate browser mouse and keyboard events
* https://github.com/jquery/jquery-simulate
*
* Copyright 2012 jQuery Foundation and other contributors
* Released under the MIT license.
* http://jquery.org/license
*
* Date: 2014-08-22
*/
(function(n,t){function u(t){var i,r=n(t.ownerDocument);return t=n(t),i=t.offset(),{x:i.left+t.outerWidth()/2-r.scrollLeft(),y:i.top+t.outerHeight()/2-r.scrollTop()}}function f(t){var i,r=n(t.ownerDocument);return t=n(t),i=t.offset(),{x:i.left-r.scrollLeft(),y:i.top-r.scrollTop()}}var i=/^key/,r=/^(?:mouse|contextmenu)|click/;n.fn.simulate=function(t,i){return this.each(function(){new n.simulate(this,t,i)})};n.simulate=function(t,i,r){var u=n.camelCase("simulate-"+i);this.target=t;this.options=r;this[u]?this[u]():this.simulateEvent(t,i,r)};n.extend(n.simulate,{keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},buttonCode:{LEFT:0,MIDDLE:1,RIGHT:2}});n.extend(n.simulate.prototype,{simulateEvent:function(n,t,i){var r=this.createEvent(t,i);this.dispatchEvent(n,t,r,i)},createEvent:function(n,t){return i.test(n)?this.keyEvent(n,t):r.test(n)?this.mouseEvent(n,t):void 0},mouseEvent:function(i,r){var u,o,f,e;return r=n.extend({bubbles:!0,cancelable:i!=="mousemove",view:window,detail:0,screenX:0,screenY:0,clientX:1,clientY:1,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:t},r),document.createEvent?(u=document.createEvent("MouseEvents"),u.initMouseEvent(i,r.bubbles,r.cancelable,r.view,r.detail,r.screenX,r.screenY,r.clientX,r.clientY,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.button,r.relatedTarget||document.body.parentNode),u.pageX===0&&u.pageY===0&&Object.defineProperty&&(o=u.relatedTarget.ownerDocument||document,f=o.documentElement,e=o.body,Object.defineProperty(u,"pageX",{get:function(){return r.clientX+(f&&f.scrollLeft||e&&e.scrollLeft||0)-(f&&f.clientLeft||e&&e.clientLeft||0)}}),Object.defineProperty(u,"pageY",{get:function(){return r.clientY+(f&&f.scrollTop||e&&e.scrollTop||0)-(f&&f.clientTop||e&&e.clientTop||0)}}))):document.createEventObject&&(u=document.createEventObject(),n.extend(u,r),u.button={0:1,1:4,2:2}[u.button]||(u.button===-1?0:u.button)),u},keyEvent:function(i,r){var u;if(r=n.extend({bubbles:!0,cancelable:!0,view:window,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:0,charCode:t},r),document.createEvent)try{u=document.createEvent("KeyEvents");u.initKeyEvent(i,r.bubbles,r.cancelable,r.view,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode)}catch(f){u=document.createEvent("Events");u.initEvent(i,r.bubbles,r.cancelable);n.extend(u,{view:r.view,ctrlKey:r.ctrlKey,altKey:r.altKey,shiftKey:r.shiftKey,metaKey:r.metaKey,keyCode:r.keyCode,charCode:r.charCode})}else document.createEventObject&&(u=document.createEventObject(),n.extend(u,r));return!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase())&&{}.toString.call(window.opera)!=="[object Opera]"||(u.keyCode=r.charCode>0?r.charCode:r.keyCode,u.charCode=t),u},dispatchEvent:function(n,t,i){n[t]?n[t]():n.dispatchEvent?n.dispatchEvent(i):n.fireEvent&&n.fireEvent("on"+t,i)},simulateFocus:function(){function u(){r=!0}var i,r=!1,t=n(this.target);t.bind("focus",u);t[0].focus();r||(i=n.Event("focusin"),i.preventDefault(),t.trigger(i),t.triggerHandler("focus"));t.unbind("focus",u)},simulateBlur:function(){function u(){r=!0}var i,r=!1,t=n(this.target);t.bind("blur",u);t[0].blur();setTimeout(function(){t[0].ownerDocument.activeElement===t[0]&&t[0].ownerDocument.body.focus();r||(i=n.Event("focusout"),i.preventDefault(),t.trigger(i),t.triggerHandler("blur"));t.unbind("blur",u)},1)}});n.extend(n.simulate.prototype,{simulateDrag:function(){var c=0,r=this.target,i=this.options,l=i.handle==="corner"?f(r):u(r),o=Math.floor(l.x),s=Math.floor(l.y),e={clientX:o,clientY:s},a=i.dx||(i.x!==t?i.x-o:0),v=i.dy||(i.y!==t?i.y-s:0),h=i.moves||3;for(this.simulateEvent(r,"mousedown",e);c<h;c++)o+=a/h,s+=v/h,e={clientX:Math.round(o),clientY:Math.round(s)},this.simulateEvent(r.ownerDocument,"mousemove",e);n.contains(document,r)?(this.simulateEvent(r,"mouseup",e),this.simulateEvent(r,"click",e)):this.simulateEvent(document,"mouseup",e)}})})(jQuery);Location=function(){var n=function(t){if(!t||t===document)return null;var i=t.querySelectorAll("select[multiple]");return i&&i.length>1?t:n(t.parentNode)};return{search:function(t,i,r,u){var h=t.getAttribute("data-next-level"),c=t.getAttribute("data-url"),f,o,s,e;if(!h||!c)return!1;if($(t).val()!=""&&t.hasAttribute("data-edited")&&t.classList.add("edited"),f=Requests.get(Requests.keys.IDs)+"="+$(t).val()+"&"+Requests.get(Requests.keys.Level)+"="+h+"&CurrentLevel="+t.getAttribute("data-level"),o=document.querySelectorAll('[id^="'+t.getAttribute("data-base-id")+'"]'),o&&o.length>0)for(s=0;s<o.length;s++)e=o[s].querySelector("select"),e&&e.value&&e.value.length>0&&(f+="&"+Requests.get(Requests.keys.Level)+"["+e.getAttribute("data-level")+"]="+e.value);typeof i=="string"&&i.length&&(f+="&"+i);t.hasAttribute("data-is-single")&&(f+="&"+Requests.get(Requests.keys.IsSingle)+"=1");t.hasAttribute("data-guid")&&(f+="&LocationGuid="+t.getAttribute("data-guid"));t.hasAttribute("data-is-multiple")&&(f+="&multiple="+t.getAttribute("data-is-multiple"));t.hasAttribute("data-context")&&(f+="&LocationContext="+t.getAttribute("data-context"));t.hasAttribute("data-onchange")&&(f+="&"+Requests.get(Requests.keys.OnChange)+"="+t.getAttribute("data-onchange"));t.hasAttribute("data-show-labels")&&(f+="&ShowLabels=1");ajaxRequest(t,c,"POST",f,r||function(i){if(applyDropdowns(n(t)),typeof u=="function"&&u(i),i&&i.data&&i.data.targets&&i.data.cssClass){var r=document.querySelectorAll('[id^="'+i.data.targets+'"]');r.forEach(function(n){if(n){for(var t=0;t<n.classList.length;t++)n.classList[t].indexOf("col-")===0&&n.classList.remove(n.classList[t]);n.classList.add(i.data.cssClass)}})}})},removeLine:function(n){n.up(".LocationContainer").remove()},addLine:function(n){var i=n.up(".LocationsContainer"),u;if(i){var r=i.querySelector(".LocationsList"),f=i.querySelector(".LocationsTemplate"),t=i.querySelectorAll(".LocationContainer");(t&&t.length>0&&(t=t[t.length-1]),r&&f&&t)&&(u=guid(),t.tryAddAfter(htmlStringToElement(compressText(f.innerHTML).replace(/{guid}/g,u))),r.value=r.value+","+u)}},getCoordinatesFromDropdowns:function(n){var t=n.up(".LocationsContainer"),s,h,c,l,u,r,f,e,o,i;if(t&&(t=t.querySelectorAll(".LocationContainer"),t&&t.length>0)){for(l=t[t.length-1],u=l.querySelectorAll(".LocDD"),r=0;r<u.length;r++)f=u[r].options[u[r].selectedIndex],f&&(e=parseFloat(f.getAttribute("data-latitude")),o=parseFloat(f.getAttribute("data-longitude")),isNaN(e)||isNaN(o)||e=="0"&&o=="0"||(s=e,h=o,c=u[r].getAttribute("data-level")));switch(c){case 0:i=6;break;case 1:i=7;break;case 2:i=9;break;case 3:i=12;break;case 4:i=13;break;case 5:i=14}return{latitude:s,longitude:h,zoom:i}}}}}();requireClass("Associated");var Realestate=function(){var n=Object.freeze({SharedAgencies:-1,AllNetwork:-2,MyAgency:-3}),u=!1,s=0,h=0,i=document.getElementById("Sidebar"),f;if(i)var e=i.querySelectorAll("[data-value='"+n.MyAgency+"']")[0],c=i.querySelectorAll("[data-value='"+n.AllNetwork+"']")[0],p=i.querySelectorAll("[data-value='"+n.SharedAgencies+"']")[0];if(f=document.querySelectorAll(".listSearchButtons")[0],f)var o=f.querySelectorAll("[data-value='"+n.MyAgency+"']")[0],l=f.querySelectorAll("[data-value='"+n.AllNetwork+"']")[0],a=f.querySelectorAll("[data-value='mls']")[0];Search.registerCallback(Search.callbackKeys.PreRequest,function(){var n=[],i,r,t;return Realestate.MlsActive()&&(i="mlsActive=1",r=$(".listSearchButtons select").serializeAll(),r&&(i+="&"+r),n.push(i)),s>0&&(t=Requests.get(Requests.keys.ParentID)+"="+s,n.push(t),h>0&&(t=Requests.get(Requests.keys.RealestateStatus)+"="+h,n.push(t))),n.filter(function(n){return n.length}).join("&")});Search.registerCallback(Search.callbackKeys.PreRequest,function(){var t=document.getElementById("AdvancedSearch"),n;if(!t||(n=t.querySelector("[name='realestate[base][reference]']"),!n))return!1;n.getAttribute("disabled")&&(n.value="")});Search.registerCallback(Search.callbackKeys.PostRequest,function(){var i=document.getElementById("AdvancedSearch"),n,t;if(!i||(n=i.querySelector("[name='realestate[base][reference]']"),!n))return!1;n.getAttribute("disabled")&&(t=n.getAttribute("data-hasmultiple-text"),t&&(n.value=t))});Search.registerCallback(Search.callbackKeys.PostRequest,function(n){o&&e&&n.data.forcedMyAgency&&r(o,e,!0)});Search.registerCallback(Search.callbackKeys.FilterReset,function(){v()});var r=function(n,t,i){n&&n.parentNode.toggleClass("active",i);t&&t.parentNode.toggleClass("selected",i)},v=function(){var n,t;if(u=!1,n=document.querySelectorAll(".listSearchButtons")[0],n)for(t=0;t<n.children.length;t++)n.children[t].classList.remove("active")},y=function(){var n,t;if(i&&(n=i.querySelectorAll("[data-name='sharedapplication']")[0],n))for(n=n.parentNode.parentNode,t=0;t<n.children.length;t++)n.children[t].classList.remove("selected")},t={toggleMlsDropdown:function(n){var t,i;n&&(n.classList.contains("active")?(t=n.getElementsByTagName("select"),t&&t.length>0&&(i=document.getElementById("mlsListDropdownContainer"),i&&(t[0].value="",i.appendChild(t[0])))):(i=document.getElementById("mlsListDropdownContainer"),i&&(t=i.getElementsByTagName("select"),t.length>0&&(t[0].value="",n.appendChild(t[0])))))},MlsActive:function(){return u},init:function(n){if(!n||!n.parentID)return console.error("Realestate.init called without valid options"),!1;s=n.parentID;h=n.fractionsStatus},filterAction:function(t,i){var h=t.getAttribute("data-name"),f=t.getAttribute("data-value"),s;Search.clearSelectedFilter();Search.clearOnlyPinned();t.parentNode.classList.contains("selected")||t.parentNode.classList.contains("active")?f==n.MyAgency?r(o,e,!1):f==n.AllNetwork?r(l,c,!1):f=="mls"?(u=!1,Realestate.toggleMlsDropdown(a.parentNode),a.parentNode.classList.remove("active")):t.parentNode.classList.remove(t.parentNode.classList.contains("selected")?"selected":"active"):(v(),f<0&&f>n.MyAgency||f=="mls"?y():(f==n.MyAgency||f>=0)&&(f==n.MyAgency&&(u=!1),s=t.parentNode.parentNode.querySelectorAll("[data-value='"+n.SharedAgencies+"']")[0],s&&s.parentNode.classList.remove("selected"),r(l,c,!1)),f==n.MyAgency?r(o,e,!0):f==n.AllNetwork?r(l,c,!0):f=="mls"?(u=!0,Realestate.toggleMlsDropdown(t.parentNode),t.parentNode.classList.add("active")):t.parentNode.classList.add("selected"));Search.fullSearch(t.parentNode,i)},onlyPinnedToggle:function(t,i){Search.onlyPinnedToggle(t,i);var r=document.querySelector("[data-value='"+n.MyAgency+"']");r&&r.parentNode.classList.add("selected")},mlsApplicationAction:function(n,t){Search.fullSearch(n.parentNode,t)},loadCustomObjects:function(n){var t=document.getElementById("hVisibleObjIDs"),i,r;!t||t.value.length<=0||(i=document.getElementById("IsMlsSearch"),r=i?$(i).serializeAll():"",ajaxRequest(null,n,"POST",Requests.get(Requests.keys.ObjectIDs)+"="+encodeURIComponent(t.value)+(r?"&"+r:""),null,{hideLoading:!0}))},sort:function(n,t,i){var r=document.getElementById("RealestateSort");Search.setSort(r,i);Search.fullSearch(n,t)},crossLeadAndEmail:function(n,t,i){ajaxRequest(n,t,"GET",i,function(n){n.status==1&&isObject(n.data)&&typeof n.data.popupUrl=="string"&&n.data.popupParams&&Email.popup(null,n.data.popupUrl,n.data.popupParams)})},"delete":function(n,t,i){ajaxRequest(n,t,"POST",i,function(n){n.status==1&&isObject(n.data)&&n.data.url&&(Search.GenericList.deselectAll(),Search.fullSearch(null,n.data.url))})},openCopyPopup:function(n,t,i){if(!i){var r=Search.GenericList.getSelectedIDs();if(!r||r.length<=0){MessageBox.alert(Translations.get(Translations.keys.NoRealestateSelected));return}i=Requests.get(Requests.keys.ObjectIDs)+"="+r}ajaxRequest(n,t,"POST",i,function(){var n=document.getElementById("CopyNumberInput");n&&n.focus()})},copy:function(n,t){ajaxRequest(n,t,"POST",$("#RealestateCopyMain *").serializeAll())},copySuccess:function(n){Popup.close(!0);n?(Search.GenericList.deselectAll(),Search.fullSearch(null,n)):window.location.reload(!0)},traceMarketingPlanChanges:function(n){if(n){var t=document.querySelector("#mkthaschanges").getAttribute("value");return document.querySelector("#mkthaschanges").setAttribute("value","0"),t}document.querySelector("#mkthaschanges").setAttribute("value","1")},openMarketingPlanPopup:function(n,t,i){if(!i){var r=Search.GenericList.getSelectedIDs();if(!r||r.length<=0){MessageBox.alert(Translations.get(Translations.keys.NoRealestateSelected));return}i=Requests.get(Requests.keys.ObjectID)+"="+r}ajaxRequest(n,t,"POST",i,function(){})},saveMarketingPlan:function(n,t,i){var u={},r;document.querySelectorAll("tr[data-configuration]").forEach(function(n){var t=[],i=0,r;n.querySelectorAll("input[data-type]").forEach(function(n){t.push(n.checked?"1":"0");i==0&&(i=n.getAttribute("data-id"))});r="";t.reverse();t.forEach(function(n){r+=n});u[n.getAttribute("data-configuration")]=[i,r]});r="";r+="mkt="+JSON.stringify(u);r+="&"+Requests.get(Requests.keys.ObjectID)+"="+document.querySelector("input[name=objID]").getAttribute("value");i?(r+="&dontAlert=true",ajaxRequest(n,t,"POST",r,function(){i.callbackfunc(i.caller,i.url)})):ajaxRequest(n,t,"POST",r,function(){})},printMarketingPlan:function(n,t){var u=Realestate.traceMarketingPlanChanges(!0),r,i,f;if(u&&u=="1"&&(r=document.querySelector("#mktplanSaveBtn"),r)){i={};i.callbackfunc=Realestate.printMarketingPlan;i.caller=n;i.url=t;Realestate.saveMarketingPlan(r,r.getAttribute("data-url"),i);return}f=Requests.get(Requests.keys.ObjectID)+"="+document.querySelector("input[name=objID]").getAttribute("value");ajaxRequest(n,t,"POST",f,function(n){n.status==1&&n.data&&window.open(n.data)})},emailMarketingPlan:function(n,t){var f=Realestate.traceMarketingPlanChanges(!0),r,i,u;if(f&&f=="1"&&(r=document.querySelector("#mktplanSaveBtn"),r)){i={};i.callbackfunc=Realestate.emailMarketingPlan;i.caller=n;i.url=t;Realestate.saveMarketingPlan(r,r.getAttribute("data-url"),i);return}u=Requests.get(Requests.keys.ObjectID)+"="+document.querySelector("input[name=objID]").getAttribute("value");u+="&print=true";ajaxRequest(n,t,"POST",u,function(t){t.status==1&&t.data&&t.data.url&&t.data.query&&(n.removeAttribute("ajaxRequest"),Email.popup(n,t.data.url,t.data.query))})},openAssociateDevelopmentPopup:function(n,t,i){var u=null,r;if(i)u=Requests.get(Requests.keys.ObjectID)+"="+i;else if(r=Search.GenericList.getSelectedIDs(),!r||r.length<=0){MessageBox.alert(Translations.get(Translations.keys.NoRealestateSelected));return}ajaxRequest(n,t,"POST",u)},associateDevelopment:function(n,t,i){var r=i?i+"":Search.GenericList.getSelectedIDs(!0);if(r.length<=0){MessageBox.alert(Translations.get(Translations.keys.NoRealestateSelected));return}ajaxRequest(n,t,"POST",Requests.get(Requests.keys.ObjectIDs)+"="+r+"&"+$("#DivRealestateAssociateDevelopment *").serializeAll(),function(n){n.status==1&&isObject(n.data)&&n.data.url&&(Popup.close(!0),Search.GenericList.deselectAll(),Search.fullSearch(null,n.data.url))})},loadSlideShowDetail:function(){Slideshow.MultiPlayer.init("RealestateDetailMedia")},openMLS:function(n,t,i,r){var u=!0,f;r||(r=Search.GenericList.getSelectedIDs(!0),u=!1);f=appendStringParams(i+"="+r,[Requests.get(Requests.keys.IsSingle)+"="+(u?1:0)]);ajaxRequest(n,t,"POST",f)},searchMLS:function(n,t,i){var r=n.value,e,o,s,f,h,u,c,l;if(!t||t.length<=0)return console.error("Realestate.searchMLS received invalid or empty 'targets' parameter. Search text was: '"+r+"'"),!1;for(r=r?r.trim().toLowerCase():"",e=n.getAttribute("data-overlay"),u=0;u<t.length;u++)t[u]&&(o=HtmlUtility.toText(t[u].getAttribute("data-label-name")),s=!1,o&&(!r||r==e.toLowerCase()||matchSearchText(r,o)?(t[u].classList.remove("searchHidden"),s=!0):t[u].classList.add("searchHidden")),f=document.getElementById("LabelsGroup_"+t[u].getAttribute("data-parent-container")),h=f?f.getAttribute("data-container-name"):"",h&&(s||!r||r==e.toLowerCase()||matchSearchText(r,h)?f.classList.remove("searchHidden"):f.querySelectorAll(".LabelItem:not(.searchHidden)").length<=0&&f.classList.add("searchHidden")));i&&(c=t[0].up(".Searcheable"),l=!c.querySelectorAll(".LabelsGroup:not(.searchHidden)").length&&r!=e,c.querySelector("#BtnLabelSuggestion")[l?"show":"hide"]())},saveMLS:function(n,t){if(n.classList.remove("disabled"))return!1;var i=$("#hiddenInfo :input").serializeAll();i+=(i?"&":"")+$(".LabelItem :input").serializeAll();ajaxRequest(n,t,"POST",i,null,{messageBoxCallback:function(n){n&&n.status==1&&Popup.close(!0)}})},selectMls:function(n){var t=n.up("#ManageMlsPopup").querySelector("#SaveManageMls");t&&t.classList.remove("disabled")},exportPDF:function(n,t,i,r,u){var f=i?i+"":Search.GenericList.getSelectedIDs(!0),e,o;if(!f||f.length<=0){MessageBox.alert(Translations.get(Translations.keys.NoRealestateSelected));return}if(r&&u&&(e=f.split(","),e.length>u)){MessageBox.confirm(r.format(e.length),Translations.get(Translations.keys.OK),function(){var n=window.open(t+f);n.document.close()});return}o=window.open(t+f);o.document.close()},openKeysRequestMovement:function(n,t,i){var r=i?i+"":Search.GenericList.getSelectedIDs(!0);if(!r){MessageBox.alert(Translations.get(Translations.keys.NoRealestateSelected));return}ajaxRequest(n,t,"POST",Requests.get(Requests.keys.ObjectIDs)+"="+r,function(n){var t,i;n.status==1&&n.popupContent&&(t=Popup.current(),t&&(i=t.querySelector(".SearchInput"),i&&i.focus()))})},saveKeysRequestMovement:function(n,t){var i,r,u;if(!n||!t)return!1;if((i=n.up(".popupBox").querySelector("#DateStart"),i&&i.value=="")||(r=n.up(".popupBox").querySelector("#DateEnd"),r&&r.value==""))return MessageBox.alert(Translations.get(Translations.keys.SelectDate)),!1;if($(".ContactPreview").length&&!$(".ContactPreview").is(":visible"))return MessageBox.alert(Translations.get(Translations.keys.ChooseContact)),!1;u=$(n.up("#KeysRequestPopup")).find("input, select").serializeAll();ajaxRequest(n,t,"POST",u,function(n){n.status==1&&(Popup.close(),n&&n.data&&n.data.filepath&&window.open(n.data.filepath))})},mlsAlert:function(n,t){MessageBox.alert(HtmlUtility.toText(t),null,n)},toggleSliding:function(n){Slideshow.MultiPlayer.toggleSliding(n)},goMyEdenWay:function(n,t,i){ajaxRequest(n,t,"GET",i,function(n){n.status==1&&isObject(n.data)&&n.data.url&&window.open(n.data.url)})},goWorldPosting:function(n,t,i){ajaxRequest(n,t,"GET",i,function(n){n.status==1&&isObject(n.data)&&n.data.url&&window.open(n.data.url)})},createNewsletter:function(n,t,i,r){if(!r||r.length<=0){MessageBox.alert(Translations.get(Translations.keys.NoRealestateSelected));return}window.post(t,i+"="+r,"_blank")},enableWebPortalGroup:function(){var n=document.getElementById("realestate_portals"),t,i;n&&(t=n.querySelector(".WebPortalGroup"),t&&(i=t.querySelectorAll("input[id^=CBPortal_]"),i.length>0&&(n.querySelector(".WebPortals").show(),n.querySelector(".GroupSelector").checked=i.find(function(n){return!n.checked})==undefined)))},fastEditManage:function(n,t,i){MessageBox.confirm(i,Translations.get(Translations.keys.OK),function(){ajaxRequest(n,t,"GET")},null,Translations.get(Translations.keys.Cancel))},recover:function(n,t,i,r){var u=function(){ajaxRequest(n,t,"POST",i,function(n){n.status==1&&isObject(n.data)&&n.data.reload&&window.location.reload(!0)})};MessageBox.confirm(r,Translations.get(Translations.keys.Yes),u,"",Translations.get(Translations.keys.No))},recoverBulk:function(n,t,i){var r=Search.GenericList.getSelectedIDs();if(!Array.isArray(r)||r.length==0)return MessageBox.alert(n.getAttribute("data-no-items-msg")),!1;Realestate.recover(n,t,Requests.get(Requests.keys.ObjectIDs)+"="+r.join(","),i)},popupMarketingColdwell:function(n,t,i){n&&t&&ajaxRequest(n,t,"GET",i,function(n){n.status==1&&isObject(n.data)&&n.data.url&&window.open(n.data.url)})},editMarketingColdwellPDF:function(n,t){var i=$(n.up("#popupColdwellBrochure")).find("*").serialize();ajaxRequest(n,t,"POST",i,function(n){n.status==1&&isObject(n.data)&&n.data.url&&(Popup.close(),window.open(n.data.url))})},bookingPublish:function(n,t,i){var r="&"+n.name+"="+n.checked;ajaxRequest(n,t,"GET",i+r)}};return t.FastEdit=function(){var n="RealestateFastEdit";return{open:function(t,i){var r=Search.GenericList.getSelectedIDs(),u;if(!r||r.length<=0){MessageBox.alert(Translations.get(Translations.keys.NoRealestateSelected));return}u=new Popup.LayerOptions(null,null,null,function(){Realestate.FastEdit.clearFastEditPaneIDs()});ajaxRequest(t,i,"POST",Requests.get(Requests.keys.ObjectIDs)+"="+r.join(","),function(t){var i=Popup.current();applyDropdowns(i);t&&t.data&&User.Permissions.init(Popup.current(),t.data.permissions);Tabs.CollapsingPane.registerNavHeaders(n,i,function(){return Popup.current()})},{popupOptions:u})},save:function(n,t){if(!n||!t)return!1;var i=[];i.push($(n.up("#RealestateFastEditPopup")).find("input, select").serializeAll());i.push("Permissions="+JSON.stringify(Permissions.getTarget("0")));ajaxRequest(n,t,"POST",i.join("&"),null,{messageBoxCallback:function(n){Popup.close();n&&isObject(n.data)&&n.data.url&&Search.fullSearch(null,n.data.url)}})},onCurrencyChange:function(n){var i=n.up(".PriceLineContent"),t="",r=n.value;n.querySelectorAll("option").forEach(function(n){n.getAttribute("value")==r&&(t=n.getAttribute("data-symbol"))});i.querySelectorAll(".spSymbol").forEach(function(n){n.innerHTML=t})},addPriceLine:function(n,t){var r=new Date,u=r.getTime(),f=n.up("[id='business_"+t+"']"),i=f.querySelector("[id='priceTemplate_"+t+"']"),e=i.cloneNode(!0),o=e.innerHTML.replace(/##KEY##/g,t+"_"+u),s=createHtmlElement("div",{"class":"addedContent PriceLineContent",innerHTML:o});i.insertAdjacentHTML("beforebegin",s.outerHTML)},removePriceLine:function(n){var t=n.up(".BusinessSection");n.up(".PriceLineContent").remove()},clearFastEditPaneIDs:function(){Tabs.CollapsingPane.clearCallbacks(n)}}}(),t.TableView=function(){return{init:function(n,t){new TableView(n,"Realestate",t)}}}(),t.Detail=function(){var n={toggleTab:function(n,t,i,r){var u=!1,f;(n.getAttribute("data-req-reset")=="1"&&(u=!0,n.removeAttribute("data-req-reset")),u||!$(n).parent().hasClass("active"))&&(f=$(n).parent().index(),$(n).parent().siblings().removeClass("active"),$(n).parent().addClass("active"),r&&(u||$(r).attr("data-loaded")=="0")&&ajaxRequest(n,t,"GET",i,function(n){n.status==1&&r&&$(r).attr("data-loaded","1")}),$(n).parent().parent().hasClass("tabController")&&($(n).closest(".tabsContainer").find(".tabsContentTab").hide(),$(n).closest(".tabsContainer").find(".tabsContentTab").eq(f).fadeIn()))},resetTab:function(n){var i=n.up(".detailRealestateTabsContainer"),r=n.up(".tabsContentTab"),t=i&&r?i.querySelector('.tabControllerBtn > a[data-container="'+r.id+'"]'):null;t&&(t.setAttribute("data-req-reset","1"),t.click())},printCanvassForm:function(n){var t=document.createElement("div");t.appendChild(n.cloneNode(!0));EgoPrinter.printHtml(t.innerHTML,{inheritCSS:!0,bodyClassOverride:"BodyClass"})},getMediaPackage:function(n,t,i){n.getAttribute("data-loaded-url")!="1"&&ajaxRequest(n,t,"GET",i,function(t){t.status==ajaxRequest.StatusType.Success&&isObject(t.data)&&t.data.url&&(n.setAttribute("href",t.data.url),n.setAttribute("target","_blank"),n.setAttribute("data-loaded-url","1"),n.removeAttribute("onclick"),window.open(t.data.url))})},generateRealestateOfficePDF:function(n,t,i){ajaxRequest(n,t,"GET",i,function(n){n.status==1&&isObject(n.data)&&n.data.url&&window.open(n.data.url)})},generateRealestateOfficeReport:function(n,t){var i=$(n.up("#popupRealestateReport")).find("*").serialize();ajaxRequest(n,t,"POST",i,function(n){n.status==1&&isObject(n.data)&&n.data.url&&(window.open(n.data.url),Popup.close())})},generateRealestateRetailReport:function(n,t){var i=$(n.up("#popupRealestateReport")).find("*").serialize();ajaxRequest(n,t,"POST",i,function(n){n.status==1&&isObject(n.data)&&n.data.url&&(window.open(n.data.url),Popup.close())})},generateColdwellPDF:function(n,t,i){ajaxRequest(n,t,"POST",i,function(n){n.status==1&&isObject(n.data)&&n.data.url&&window.open(n.data.url)})},saveFractionHabitable:function(n,t){var i=$(n.up("#popupFractionHabitable")).find("*").serialize();ajaxRequest(n,t,"POST",i,function(n){n.status==1&&n.updates&&Popup.close()})},generateRealestateFlyerReport:function(n,t){var i=n.up(".PopupContext"),r;i&&(r=$(i).find("*").serializeAll(),ajaxRequest(n,t,"POST",r,null,getOptionsForDirectFileDownload()))},updateMediaRender:function(){var n=document.getElementById("RealestateDetailMedia");n&&Slideshow.MultiPlayer.updateMediaRender(n.querySelector(".SlideshowMultiplayer"))},openContractMediationPopup:function(n,t,i){t&&ajaxRequest(n,t,"GET",i,function(n){var i=document.getElementById("MediationContractPopup").getAttribute("data-mediauploadurl"),t=[];n&&isObject(n.data)&&n.data.serializedMedia&&(t=JSON.parse(n.data.serializedMedia));Realestate.Detail.initializeMediationContractMedia(i,"MediationContractPopup",t,"#UploadMedia")})},saveContractMediation:function(n,t){if(n&&t){var r=n.up("#MediationContractPopup"),i=r.querySelector("#UploadMedia").querySelector(".AttachList"),u=Requests.get(Requests.keys.Medias)+"="+(i.MyMedia&&i.MyMedia.ItemList.length?i.MyMedia.serialize(!0):""),f=$(r).find("*").serializeAll()+"&"+u;ajaxRequest(n,t,"POST",f,function(n){n&&n.status==1&&Popup.close()})}},initializeMediationContractMedia:function(n,t,i,r){var u;u=t?document.getElementById(t):document.getElementById("mediationtab");i||(i=[]);Media.setupUpload(u.querySelector(r),n,i,u)},openLocation:function(n,t,i,r,u){t&&ajaxRequest(n,t,"GET",i,function(t){t&&t.status==1&&ExternalMaps.loadLibrary(n,r,u,"mapCSSLink")})},checkAllFractions:function(n){var r=n.up(".gridResultsTable"),t=r.querySelectorAll("input.ObjectChecker[type=checkbox]"),i;if(!t||t.length<=0)return!1;for(i=0;i<t.length;i++)t[i].checked=n.checked},initFractionsTable:function(){var n=document.getElementById("FractionsTableContent"),t;if(!n)return!1;t=n.getAttribute("data-cookie");Realestate.TableView.init(t,"FractionsTableContent")},searchFractionsTable:function(n,t,i,r){var f=$(".FractionsFilterTableArea"),e,o,s,u;n&&f&&($(n).find("option:selected").length==0&&(e=n.up(".FractionsFilterTableArea"),e&&(o=e.querySelector("#DefaultStatusOption"),o&&(n.value=o.value))),r&&($sortField=f.find("#SortField"),$sortField&&$sortField.length==1&&($sortField.val(r),$sortDirection=f.find("#SortDirection"),$sortDirection&&$sortDirection.length==1&&(s=$sortDirection.val(),s==""?$sortDirection.val("0"):parseInt(s)==0?$sortDirection.val("1"):$sortDirection.val("0")))),u=[],u.push(f.find("*").serializeAll()),i&&u.push(Requests.get(Requests.keys.Page)+"="+i),u=u.filter(function(n){return n.length}).join("&"),ajaxRequest(n,t,"GET",u))},exportFractionsPDF:function(n,t,i){var r=Search.GenericList.getSelectedIDs(!0),u,f;if(!r||r.length<=0){MessageBox.alert(Translations.get(Translations.keys.NoFractionSelected));return}u=i?t+r+i:t+r;f=window.open(u);f.document.close()},fractionEditInTableShow:function(n){var t,i;if(n)t=n.up("td"),t&&(t.querySelector('[data-value="ref"]').hide(),i=t.querySelectorAll('[data-value="refEdit"]'),$(i).each(function(){this.show()}));else return},factionAvailabilityEditInTableSave:function(n,t,i,r){var e,f,u,o;if(n){if(e=n.up("td"),e&&(f=e.querySelector("select"),f&&(u=f.options[f.selectedIndex],u))){var h=e.querySelector('[data-value="refEdit"]'),c=e.querySelector('[data-value="ref"]'),s=c.querySelector("a"),l=f.getAttribute("value");u.value||(u.value=-1);l||f.setAttribute("value",-1);u.value!=l&&(o=[],o.push(Requests.get(Requests.keys.SelectedID)+"="+i),o.push("field="+r),o.push($(e).find("select").serializeAll()),ajaxRequest(n,t,"GET",o.join("&"),function(n){n.status==1&&f.setAttribute("value",u.value)}));h&&h.hide();s&&(u.value==-1?$(s).text(""):$(s).text(u.text+" "),c.show())}}else return},factionRentDateEndEditInTableSave:function(n,t,i,r){var u,e;if(n){if(u=n.up("td"),u&&(e=u.querySelector("input"),e)){var o=u.querySelector('[data-value="refEdit"]'),s=u.querySelector('[data-value="ref"]'),h=s.querySelector("a"),f=[];f.push(Requests.get(Requests.keys.SelectedID)+"="+i);f.push("field="+r);f.push($(u).find("input").serializeAll());ajaxRequest(n,t,"GET",f.join("&"));o&&o.hide();h&&($(h).text(e.value+" "),s.show())}}else return},expandItemMenu:function(n){$(n).closest(".listItemAction").find(".listItemActionDrop").show();$(n).closest(".listItemActionDrop").hide()},popupEmailFractionsBulk:function(n,t,i){var r=Search.GenericList.getSelectedIDs();if(!r||r.length<=0){MessageBox.alert(Translations.get(Translations.keys.NoFractionSelected));return}Email.popup(n,t,i)},seeFractionsList:function(n,t){var i=window.open(t);i.document.close()},openAssociateFraction:function(n,t,i,r,u){var s=document.getElementById("FractionsSection"),h=[],o=$("#FractionsTableContent"),e,f;o&&(e=o.find(".ObjectChecker"),e.length>0&&e.each(function(n,t){h.push($(t).attr("data-object-id"))}));f=[];f.push(Requests.get(Requests.keys.ObjectID)+"="+s.querySelector("#ObjAssociatedID").value);f.push(Requests.get(Requests.keys.SimplifiedContext)+"="+i);f.push(Requests.get(Requests.keys.BusinessObjectWorkOn)+"="+u);Search.Simplified.open(n,t,f.join("&"),null,"POST",{popupOptions:new Popup.LayerOptions(null,null,null,function(){Realestate.Detail.searchFractionsTable(document.getElementById("FractionsSection"),r)})})},openKeyMovementPopup:function(n,t,i){n&&t&&ajaxRequest(n,t,"GET",i)},saveKeysMovementPopup:function(n,t){var i,r;if(n&&t&&(i=n.up(".popupBox"),i)){if(r=n.up(".popupBox").querySelector("#DateStart"),r&&r.value=="")return MessageBox.alert(Translations.get(Translations.keys.SelectDate)),r.focus(),!1;if($(".ContactPreview").length&&!$(".ContactPreview").is(":visible"))return MessageBox.alert(Translations.get(Translations.keys.ChooseContact)),!1;var u=$(i).find("*").serializeAll(),f=i.getAttribute("data-urlrefreshkeylist"),e=i.getAttribute("data-paramsrefreshkeylist");ajaxRequest(n,t,"POST",u,function(i){n&&t&&i&&i.status==1&&(Realestate.Detail.refreshKeyList("",f,e),Popup.close())})}},refreshKeyList:function(n,t,i){t&&ajaxRequest(n,t,"GET",i)},deleteGroupKey:function(n,t,i,r){if(!n||!t||!r)return!1;MessageBox.confirm(r,Translations.get(Translations.keys.Delete),function(){ajaxRequest(n,t,"POST",i,null,{hideLoading:!0})})},cloneKeyGroup:function(n,t,i){if(!n||!t)return!1;ajaxRequest(n,t,"POST",i,null,{hideLoading:!0})},addNewKeyToGroup:function(n){var i=n.up("#RealestateKeyInPopup"),r,t;if(i){r=i.querySelector("#key_index");t=parseInt(r.value);t++;var u=i.querySelector("#KeyTemplate"),f=u.cloneNode(!0),e=createHtmlElement("div",{"class":"addedContent PriceLineContent",innerHTML:f.innerHTML.replace(/INDEX/g,t)}),o=n.up(".contentHeader");$(o).before(e.innerHTML);r.value=t}},removeAddedContent:function(n){if(n){var t=n.up(".addedContent");t&&$(t).remove()}},saveKeysPopup:function(n,t){var r,i,u,f;if(n&&t&&(r=n.up(".popupBox"),r)){if(i=n.up(".popupBox").querySelector("#groupName"),i&&i.value=="")return MessageBox.alert(Translations.get(Translations.keys.MustInsertDescription)),$(i).focus(),!1;if(u=n.up(".popupBox").querySelector("#groupLocation"),u&&u.value=="")return MessageBox.alert(Translations.get(Translations.keys.ClickOnTheLocationYouWant)),!1;f=$(r).find(".popupContent").find("*").serializeAll();ajaxRequest(n,t,"POST",f,function(n){n&&n.status==1&&Popup.close()})}},openEditKeyGroup:function(n,t,i){n&&t&&ajaxRequest(n,t,"GET",i)},openAppraisalEditPopup:function(n,t,i){n&&t&&ajaxRequest(n,t,"GET",i,function(n){var r=document.getElementById("AppraisalEditPopupBox").getAttribute("data-mediauploadurl"),i=[],t;isObject(n.data)&&n.data.serializedMedia&&(i=JSON.parse(n.data.serializedMedia));t=document.getElementById("AppraisalEditPopupBox");Media.setupUpload(t.querySelector("#UploadMedia"),r,i,t)})},printAppraisal:function(n){var i=n.up(".popupBox").querySelector(".popupHeader"),r=n.up(".popupBox").querySelector(".popupContent"),t=document.createElement("div");t.appendChild(i.cloneNode(!0));t.appendChild(r.cloneNode(!0));t.querySelector(".popupCloseBtn").remove();t.querySelector(".fileContent").remove();EgoPrinter.printHtml(t.innerHTML,{inheritCSS:!0})},saveAppraisal:function(n,t){var i;if(n&&t&&(i=n.up(".popupBox"),i)&&Realestate.Detail.validateAppraisal(i)){var r=i.querySelector("#UploadMedia").querySelector(".AttachList"),u=Requests.get(Requests.keys.Medias)+"="+(r.MyMedia&&r.MyMedia.ItemList.length?r.MyMedia.serialize(!0):""),f=$(i).find(".popupContent").find("*").serializeAll()+"&"+u;ajaxRequest(n,t,"POST",f,function(n){n&&n.status==1&&Popup.close()})}},validateAppraisal:function(n){var r=n.querySelector("#appraisalPrice1").value,u=n.querySelector("[name=appraisalEvaluator1_id]").value,t,i;return r==""||r=="0"||u==""||u=="0"?(MessageBox.alert(Translations.get(Translations.keys.MsgAppraisalFields)),!1):(t=n.querySelector("#appraisalPrice2").value,i=n.querySelector("[name=appraisalEvaluator2_id]").value,t!=""&&t!="0"&&(i==""||i=="0"))?(MessageBox.alert(Translations.get(Translations.keys.MsgSecondAppraisalFields)),!1):i!=""&&i!="0"&&(t==""||t=="0")?(MessageBox.alert(Translations.get(Translations.keys.MsgSecondAppraisalFields)),!1):!0},deleteAppraisal:function(n,t,i,r){if(!n||!t||!r)return!1;MessageBox.confirm(r,Translations.get(Translations.keys.Delete),function(){ajaxRequest(n,t,"POST",i,null,{hideLoading:!0})})}};return n.EnterpriseMap=function(){function n(n,t){t.helper.get(0).up(".dragParentItem").setAttribute("dragOn","1");t.helper.get(0).style.position="absolute";$("#EnterpriseMap .FloorFloat").hide()}function t(n,t){t.helper.get(0).up(".dragParentItem").removeAttribute("dragOn");t.helper.get(0).style.position="static"}function i(n,t){var i=t.draggable.get(0),r=i?i.up("#EnterpriseMap"):null,u,f;r&&(u=[Requests.get(Requests.keys.ObjectID)+"="+i.id,Requests.get(Requests.keys.Floor)+"="+n.target.getAttribute("data-floor"),Requests.get(Requests.keys.Position)+"="+n.target.getAttribute("data-pos")],f=appendStringParams($(r).find(".PrivateData :input").serializeAll(),u),ajaxRequest(null,r.getAttribute("data-change-url"),"GET",f,function(n){n.status==1&&n.replaces&&(Popup.close(),Realestate.Detail.EnterpriseMap.init())}))}return{load:function(n,t,i){AjaxQueue.click(n,t,i,function(n){n.status==1&&n.updates&&isObject(n.data)&&n.data.canEditRealestate&&Realestate.Detail.EnterpriseMap.init()})},init:function(){var r=document.getElementById("EnterpriseMap");r&&($(r).find(".ui-draggable").draggable("destroy"),r.querySelectorAll(".DragElem").forEach(function(i){$(i).draggable({containment:r,helper:"clone",start:n,stop:t});i.style.position="static"}),$(r).find(".ui-droppable").droppable("destroy"),r.querySelectorAll(".DropElem").forEach(function(n){$(n).droppable({accept:".DragElem",hoverClass:"Dropping",drop:i})}))},dragItemMouseHover:function(n){var t,i,r;n.getAttribute("dragOn")||(clearTimeout(n.__dragended),t=n.querySelector(".FloorFloat"),n.up(".floorsAlone")&&(i=$(n).offset().top,r=$("#EnterpriseMap").offset().top,t.style.top=i-r+10+"px"),t.show())},dragItemMouseLeave:function(n){clearTimeout(n.__dragended);n.__dragended=function(){n.querySelector(".FloorFloat").hide()}.lazyDo(.2)}}}(),n}(),t.MarketStatistics=function(){return{changetab:function(n){var t=$(n).parent(),i;if(t){if(t.hasClass("active"))return;t.siblings().removeClass("active");t.addClass("active");i=t.index();t.parent().hasClass("tabController")&&($(n).closest(".tabsContainer").find(".tabsContentTab").hide(),$(n).closest(".tabsContainer").find(".tabsContentTab").eq(i).fadeIn(),Realestate.MarketStatistics.loadDefault())}},loadDefault:function(){var t=$(".tabsContentTab:visible"),n;t&&t.length==1&&(n=t.find(".collapsingLine"),n&&n.length>0&&n.each(function(){var n=$(this).attr("data-defaultLoaded");n&&n=="0"&&($(this).find("a").click(),$(this).attr("data-defaultLoaded","1"))}))},loadStatistic:function(n,t,i,r){var u=$(n.up(r)).find("input, select").serializeAll()+"&"+i;Tabs.CollapsingPane.toggle(n,t,u,null,"POST")}}}(),t.Edit=function(){var t=!1,n={},i=function(n,t){var r=n.up(".editContent"),u=r.querySelector(".PrivateData"),f=r.querySelectorAll(".inputInfoContent"),i=$(u).find("*").serializeAll();i=appendStringParams(i,$(f).find("*").serializeAll());$(n).attr("ajaxRequest","");ajaxRequest(n,t,"POST",i,function(n){n.status==1&&$("#averagePrice:not(:visible)").show(350)})},r=function(){};return{Files:[],init:function(t,i){n=t;var u=new PhotonAddressEngine({url:i,onPredictions:r});$("#Address").typeahead(null,{source:u.ttAdapter(),hint:!0,highlight:!0,limit:10,minLength:3,displayKey:"description"})},openHouseClick:function(n,t,i){n.checked?($("#"+t).prop("disabled",""),$("#"+i).prop("disabled","")):($("#"+t).prop("disabled","disabled"),$("#"+i).prop("disabled","disabled"))},occupationChanged:function(n){n.value==1?($("#ocptid").removeAttribute("disabled"),$("#RentTypeId").removeAttribute("disabled"),$("#RentValue").removeAttribute("disabled"),$("#realestate_rent_date_start").each(function(n){n.CalendarDate.enable()}),$("#realestate_rent_date_end").each(function(n){n.CalendarDate.enable()})):($("#ocptid").prop("disabled","disabled"),$("#RentTypeId").prop("disabled","disabled"),$("#RentValue").prop("disabled","disabled"),$("#realestate_rent_date_start").each(function(n){n.CalendarDate.disable()}),$("#realestate_rent_date_end").each(function(n){n.CalendarDate.disable()}))},logAveragePrice:function(n,t,i){ajaxRequest(n,t,"POST","&R="+i)},addPriceLine:function(n,t){var r=new Date,u=r.getTime(),f=n.up("[id='business_"+t+"']"),i=f.querySelector("[id='priceTemplate_"+t+"']"),e=i.cloneNode(!0),o=e.innerHTML.replace(/##KEY##/g,t+"_"+u),s=createHtmlElement("div",{"class":"addedContent PriceLineContent",innerHTML:o});i.insertAdjacentHTML("beforebegin",s.outerHTML);$("#RealestateBusiness_"+t+" > input").prop("checked",!0)},removePriceLine:function(n,t){var i=n.up(".inputInfoContent");n.up(".PriceLineContent").remove();$(".PriceLineContent:visible",i).length==0&&$("#RealestateBusiness_"+t+" > input").prop("checked",!1)},getAveragePrice:function(n,t){n.getAttribute("data-level")!=undefined?Location.search(n,null,function(){n.getAttribute("data-level")!="5"&&i(n,t)}):i(n,t)},checkReference:function(n,i,r){n.value&&(r+="&Reference="+encodeURIComponent(n.value.trim()),ajaxRequest(n,i,"GET",r,function(n){n.status==1&&isObject(n.data)&&(n.data.alreadyExits?($("#referenceStatusAvaliable").hide(),$("#referenceStatusUnavaliable").show()):($("#referenceStatusAvaliable").show(),$("#referenceStatusUnavaliable").hide()),t=n.data.alreadyExits)}))},changeAvailability:function(n,t,i,r){var u=$("#ClosedBusinessInputDefaultTitle"),f=$("#exportSoldCheckbox");f.length&&($(n.options[n.selectedIndex]).data("isunavailable")===1?f.show():f.hide());n.value==i?($("#avaliablitySold").show(),$("#soldType").show(),u.text(u.data("forsale"))):n.value==r?($("#avaliablitySold").show(),u.text(u.data("forrent"))):($("#avaliablitySold").hide(),$("#soldType").hide())},getCadastralReference:function(n,t,i,r,u,f){var e={},o;e[i.attr("name")]=i.val();e[r.attr("name")]=r.val();e[u.attr("name")]=u.val();e[f.attr("name")]=f.val();o=$.param(e);ajaxRequest(n,t,"POST",o,function(){})},checkInputLenght:function(n,t){n.value.length>0?($("#getCadastralReference").length&&$("#getCadastralReference").hide(),$(t).show()):($("#getCadastralReference").length&&$("#getCadastralReference").show(),$(t).hide())},fillCadastralReferenceInput:function(n,t){$("#realestate_cadastral_ref").value=t;$("#getCadastralReference")&&$("#getCadastralReference").hide();$("#validateReference")&&$("#validateReference").show()},checkCadastralReference:function(n,t,i,r){var u=$(t).val(),f;u&&(f="Reference="+encodeURIComponent(u)+"&rid="+r,ajaxRequest(n,i,"GET",f))},validate:function(){t&&MessageBox.alert($(".tooltipContent").text(),function(){$("#Reference").focus()},n.ERROR_SAVING_REALESTATE,n.SOLVE_PROBLEM)},saveRealestate:function(n){var t=n.up(".PageContext");if(!this.validate(t))return!1}}}(),t.AdvertisementPlaque=function(){function n(n,t,i){var r=n.querySelector("."+i),u=t.querySelector("."+i);r&&u&&(r.value=u.value)}function r(n,t){n&&t&&(n.childNodes.length?n.insertBefore(t,n.childNodes[0]):n.appendChild(t))}function t(n,t){var r=n.classList.contains("popupBox")?n.querySelector(".popupContent"):n.up(".popupContent"),i;return(r&&(i=r.querySelector(".ConfigInlineEdit_ItemTemplate")),!i||!i.innerHTML)?null:htmlStringToElement(compressText(i.innerHTML).replace("{force_remove}",t?"1":""))}function u(n,t){var i=n.up(".etp_list_item_edit"),r=i.querySelectorAll(".InlineNameEdit").find(function(n){return n.value&&n.value!=n.getAttribute("data-og-name")});r?typeof t=="function"&&t(n.up(".etp_list_item"),i):$(n.parentNode.querySelector(".aCancelInl")).trigger("click")}function i(n){var t=n?n.up(".PopupContext,.popupBox"):null,i=t?t.querySelector(".PrivateData"):null;return i?$(i).find(":input").serializeAll()||"":""}function f(n){return n.status==ajaxRequest.StatusType.Success&&isObject(n.data)&&n.data.item?htmlStringToElement(compressText(n.data.item)):null}function e(n,t,r,u,f){if(!r)return!1;MessageBox.confirm(r,Translations.get(Translations.keys.Delete),function(){var r=appendStringParams($(n.up(".etp_list_item_header")).find("*").serializeAll(),i(n));ajaxRequest(n,t,"POST",r,function(t){if(t.status==ajaxRequest.StatusType.Success){typeof u=="function"&&u(t);var i=n.up(".etp_list_item");i&&(i.remove(),_RequiresReload=!0);typeof f=="function"&&f(t)}})})}return{manage:function(n,t,i){ajaxRequest(n,t,"GET",i)},saveInline:function(n,t,r){u(n,function(u,e){var o=null,s,h;u&&(o=u.querySelector(".etp_list_item_header input[type=checkbox]"));s=inputIsChecked(o);h=appendStringParams($(e).find("*").serializeAll(),i(e));ajaxRequest(n,t,"POST",h,function(t){var e;if(t.status==ajaxRequest.StatusType.Success){if(_RequiresReload=!0,e=f(t),e){var h=n.up(".collapsingContent,.collapsingLine"),i=_getInlineEditorElement(n,e),o=e.querySelector("input[type=checkbox]");o&&u&&(o.checked=s);i&&i.hasAttribute(_SubLevelAttribute)?(i.up().insertBefore(e,i),i.remove()):(i&&i.remove(),_appendNewItem(h,e))}typeof r=="function"&&r(u,t)}})})},cancelEditInline:function(n,t,i){var r;t?n.up(".etp_list_item_edit").remove():(r=n.up(".etp_list_item"),i&&$(r.querySelector(".FlagSelector")).click(),$(r.querySelector(".etp_list_item_edit")).hide(),$(r.querySelector(".etp_list_item_header")).show())},editInline:function(i){var s=i.up("[data-item-name]").getAttribute("data-item-name"),e=i.up(".etp_list_item"),o=i.up(".etp_list_item_header"),u=e.querySelector(".etp_list_item_edit"),f,r;if(!u){if(u=t(i),!u)return!1;o.parentNode.appendChild(u)}if(f=u.querySelectorAll(".InlineNameEdit"),f.length==1)r=f[0],r.classList.contains("MainTextBox")||r.classList.add("MainTextBox");else if(f.length>1)f.forEach(function(n){n.classList.contains("MainTextBox")?r=n:n.hide()}),r.style.display=="none"&&r.show();else{console.warn("ManageConfig.editInline perdeu acesso a caixa de texto para edicao. fail-safe sera aplicado na proxima tentativa de edicao.");return}r.setAttribute("data-og-name",s);o&&o.hide();r.value=s;u.show();r.focus();n(u,e,"itemID");n(u,e,"itemType")},deleteInline:function(n,t,i){e(n,t,i)},addInlineItem:function(i){var e=i.up(".collapsingLine"),f=null,u;e&&(f=i.up(".collapsingLine").querySelector(".collapsingContent"));f&&(u=t(i,!0),r(f,u),u.show(),highlightNode(u),$(u.querySelector(".InlineNameEdit.MainTextBox")).trigger("focus"),n(u,i.parentNode,"itemType"))}}}(),t}(),Labels=function(){function r(n,t,i,r,u){var f=Array.prototype.slice.call(t,0),e;(f.push(i),f.sort(function(n,t){var i=n.getAttribute(r).toLowerCase(),u=t.getAttribute(r).toLowerCase();return i.localeCompare(u)}),e=f.indexOf(i),e>=f.length-1?n.appendChild(i):n.insertBefore(i,t[e]),u)&&highlightNode(i)}function i(n,t,i,f){var o,s,e=htmlStringToElement(i);if(!e||!e.getAttribute("data-label-name"))return console.error("cannot append invalid label element["+(e?JSON.stringify(e):"")+"]"),!1;o=n.querySelector('[id="LabelsGroup_'+t+'"]');o||(o=u(n.querySelector(".LabelGroupsHolder"),t,e));o.classList.remove("searchHidden");s=o.querySelectorAll(".LabelItem");s.length<=0?(o.appendChild(e),f&&highlightNode(e)):r(o,s,e,"data-label-name",f)}function u(n,t,i){var o=HtmlUtility.encode(t),u=createHtmlElement("div",{id:"LabelsGroup_"+o,"class":"popupTagGroup LabelsGroup","data-container-name":o}),e,f;return u.appendChild(createHtmlElement("div",{"class":"popupTagGroupTitle",innerText:" "+t+" "})),i&&(e=i,typeof i=="string"&&(e=htmlStringToElement(i)),u.appendChild(e)),f=n.querySelectorAll(".LabelsGroup"),!f||f.length<=0?n.appendChild(u):r(n,f,u,"data-container-name"),u}function f(n){var t=n.up(".popupBox"),i;t&&(i=t.querySelector("#SaveManageLabelsList"));Element.removeClassName(i,"disabled")}function e(n,t,i){var r=document.getElementById("LabelsSidebarSection"),h,c,f,e,u,o,s;if(r){if(isBlank(t)||(h=r.querySelector("#appSharesListOuter"),h&&(c=h.querySelector("a"),c&&(c.textContent=t))),typeof i=="string"&&(f=r.queryChildren(".sidebarTagGroup")||[],e=r,f.length==0&&(u=r.querySelector(".sidebarTagGroup"),u&&(e=u.up(),f=e.queryChildren(".sidebarTagGroup")||[])),f.forEach(function(n){n.remove()}),u=htmlStringToElement(i,!1,".sidebarTagGroup"),u&&(o=u.up()),o))while(o.children.length>0)e.appendChild(o.children[0]);typeof n=="number"&&(s=r.querySelector("#appSharesListContent"),s&&(s.querySelectorAll(".active").invoke("removeClassName","active"),s.querySelector('[id="'+n+'"]').classList.add("active")))}}function h(){n&&window.location.reload(!0)}function c(){window.LabelsPopupResizeBound||(EventHandler.addListener(window,"resize",function(){var t=Popup.current(),n;(t&&(n=t.querySelector(".LabelsListContent")),n)&&(n.style.height="",n.style.height=(n.clientHeight||n.offsetHeight)+"px")}),window.LabelsPopupResizeBound=!0)}function o(n){Element.setValue(document.getElementById("SuggestInsertLabelInput"),n)}function s(n,t,i,r){var u,f,o;if(n.classList.contains("disabled"))return!1;if(u=n.up(".popupBox"),i&&(f=u.querySelectorAll(".CheckableItem input[type=checkbox]").find(function(n){return n&&n.checked}),!f))return Popup.close(!0),!1;o=appendStringParams($(u).find(".popupContent *").serializeAll(),$("#LabelSidebarItemsBuildType").serializeAll());ajaxRequest(n,t,"POST",o,function(n){n.status==ajaxRequest.StatusType.Success&&typeof r=="function"&&r.call(this,n)},{messageBoxCallback:function(n){n.status==ajaxRequest.StatusType.Success&&(Popup.close(!0),isObject(n.data)&&(n.data.html&&e(null,"",n.data.html),n.data.selector&&!document.getElementById(n.data.selector)&&(n.replaces=null,window.location.reload(!0))))}})}function l(n,t){var i=n.up().querySelector("#InpSearchLabels_list").value.trim();i&&(o("|"+HtmlUtility.sanitize(i)),s(n,t,!1,function(){o("")}))}function t(){var n=Popup.current(),t;n&&n.classList.contains("ManageLabelsEditPopup")&&(t=n.querySelector(".FilterBoxContext"),n.querySelectorAll(".LabelItem").length?Element.show(t):(Element.hide(t),$(n.querySelector("#CreateLabelEdit")).trigger("focus")),Popup.adjustContentHeight())}function a(){function n(n){var i=document.getElementById("LabelsSidebarSection"),r=i.querySelector("#appSharesListOuter"),u=i.querySelector("#appSharesListMenu .dropHeader"),t;if(n&&n.target&&n.target.nodeName.toLowerCase()=="a"&&(r.contains(n.target)||n.target.up("#appSharesListOuter")||u.contains(n.target)||n.target.up(".dropHeader")))return!1;t=i.querySelector("#appSharesListMenu");t&&(t.hide(),t.classList.remove("left"))}return{open:function(t){var i,r,u;if(t.getAttribute("data-working")=="1")return!1;t.setAttribute("data-working","1");i=$("#appSharesListMenu");i.is(":visible")?i.fadeOut("fast"):(i.fadeIn("fast"),r=i.offset(),u=$(window).width(),r.left<50&&u>768&&i.addClass("left"),t.getAttribute("data-init")!="1"&&(EventHandler.addListener(document.body,"click",function(t){n(t)}),t.setAttribute("data-init","1")));t.setAttribute("data-working","0")},switchApp:function(n,t,i){$("#appSharesListMenu").hide().removeClass("left");i=appendStringParams(i,$("#LabelSidebarItemsBuildType").serializeAll());ajaxRequest(n,t,"GET",i,function(n){n.status==ajaxRequest.StatusType.Success&&isObject(n.data)&&typeof n.data.selectedAppID=="number"&&n.data.appName&&n.data.html&&e(n.data.selectedAppID,n.data.appName,n.data.html)})},leaving:function(n){$(n).parent().find("#appSharesListMenu").delay(500).fadeOut("fast").removeClass("left")},entering:function(n){$(n).parent().find("#appSharesListMenu").stop(!0,!0).fadeIn("fast")},closeMenu:n}}var n=!1;return{popupEdit:function(n,i,r){ajaxRequest(n,i,"POST",r,function(n){if(n.popupContent){var i=Popup.current();i&&i.querySelectorAll(".LabelItem").length==0?$("#CreateLabelEdit").trigger("focus"):$("#InpSearchLabels_edit").trigger("focus");t()}},{popupOptions:new Popup.LayerOptions(null,null,null,h)})},popupList:function(n,t,i){ajaxRequest(n,t,"POST",i,function(n){if(n.popupContent){$("#InpSearchLabels_list").trigger("focus");var t=Popup.current().querySelector(".LabelsListContent"),i=(t.clientHeight||t.offsetHeight)+"px";t.style.height=i;t.setAttribute("data-prev-h",i);c()}})},popupListBulk:function(n,t,i,r,u){var f=Search.GenericList.getSelectedIDs();if(!Array.isArray(f)||f.length==0){MessageBox.alert(n.getAttribute("data-no-items-msg"));return}i=appendStringParams(i,[Requests.get(Requests.keys.ObjectIDs)+"="+encodeURIComponent(f.join(",")),$("#hVisibleObjIDs").serializeAll()]);r&&u&&f.length>u?MessageBox.confirm(r.format(f.length),Translations.get(Translations.keys.OK),function(){Labels.popupList(n,t,i)}):Labels.popupList(n,t,i)},search:function(n,t,i){var r=n.value,h,e,o,f,c,s,u,l;for(t=ensureArray(t),r=r?r.trim().toLowerCase():"",h=n.getAttribute("data-overlay")||"",e=r==(h?h.toLowerCase():""),o=0;o<t.length;o++)f=t[o],f&&(c=HtmlUtility.toText(f.getAttribute("data-label-name")),s=!1,c&&(s=!r||e||matchSearchText(r,c),f.classList.toggle("searchHidden",!s)),u=document.getElementById("LabelsGroup_"+f.getAttribute("data-parent-container")),u&&(l=u.getAttribute("data-container-name"),l&&(s||!r||e||matchSearchText(r,l)?u.classList.remove("searchHidden"):u.querySelectorAll(".LabelItem:not(.searchHidden)").length==0&&u.classList.add("searchHidden"))));if(i){var y=t.length>0?t[0]:n,v=y.up(".Searcheable"),p=v.querySelectorAll(".LabelItem:not(.searchHidden)").length==0&&!e,a=v.querySelector("#BtnLabelSuggestion");a&&(p?a.show():a.hide())}},selectAll:function(n){var t,i;if(n.parentNode.classList.toggle("active"),t=n.up(".LabelsGroup").querySelectorAll('.LabelItem input[type="checkbox"]'),!t||t.length==0)return console.error("cannot find labels for caller["+(n?JSON.stringify(n):n+"")+"]"),!1;for(i=0;i<t.length;i++)t[i].checked=n.checked,t[i].onclick.call(t[i]);f(n)},selectSingle:function(n){var r,e;n.up().classList.toggle("active");var u=n.up(".LabelItem").getAttribute("data-parent-container"),i=n.up('[id="LabelsGroup_'+u+'"]'),t=null;if(i&&(t=i.querySelector('[id="LabelAppLine_'+u+'"]')),n.checked){if(i&&t){if(r=i.querySelectorAll('.LabelItem input[type="checkbox"]'),!r||r.length==0)return console.warn("cannot find labels for application line ID = "+u),!1;e=r.find(function(n){return n&&!n.checked});e||(t.checked=!0)}}else if(t&&t.checked){t.checked=!1;return}f(n)},editLabel:function(n,t){var i=n.up(".LabelItem"),o=i.getAttribute("data-label-id"),s="EditLabelName_"+o,r=i.querySelector("#"+s),u,f,e,h;if(r?u=r.querySelector('input[type="text"]'):(u=createHtmlElement("input",{type:"text",name:t}),f=createHtmlElement("a",{href:"javascript:void(0);","class":"action",onclick:"Labels.cancelEdit(this, "+o+");"}),f.appendChild(createHtmlElement("i",{"class":"icon-fechar"})),e=createHtmlElement("a",{href:"javascript:void(0);","class":"action",onclick:"Labels.saveLabel(this);"}),e.appendChild(createHtmlElement("i",{"class":"icon-check"})),h=[u,f,e],r=createHtmlElement("div",{id:s,"class":"popupTagGroupEdit"},h),i.appendChild(r)),!i.hasAttribute("data-label-name"))return console.error("cannot find label name for caller["+(n?JSON.stringify(n):n+"")+"]"),!1;n.parentNode.hide();u.value=i.getAttribute("data-label-name")||"";r.show();u.focus()},cancelEdit:function(n,t){n.up().hide();n.up(".LabelItem").querySelector("#displayLabelName_"+t).show()},saveLabel:function(r){var f=r.up(".LabelItem"),u=f.getAttribute("data-label-id"),s=r.parentNode.querySelector('input[type="text"]'),e,o;if(!s)return console.error("cannot save label with ID = {0} because the input with the saving value was not found".format(u)),!1;if(e=r.up(".popupBox"),o=s.value.trim(),o&&o!=f.getAttribute("data-label-name")){var h=$(f.querySelector('[id="LabelPrivateData_'+u+'"]')).find("*").serializeAll()||"",c=$(f.querySelector('[id="EditLabelName_'+u+'"]')).find("*").serializeAll()||"",l=e.getAttribute("data-save-label-url"),a=appendStringParams(h,c);ajaxRequest(r,l,"POST",a,function(r){var f,o;if(n=!0,r.status==ajaxRequest.StatusType.Success){if(isObject(r.data)&&r.data.changedGroup&&r.data.newGroupName&&r.data.elem)f=document.getElementById("labelEditLine_"+u),o=f.up(".LabelsGroup"),f.remove(),o.querySelectorAll(".LabelItem").length||o.remove(),i(e,r.data.newGroupName,r.data.elem);else{var s=document.getElementById("labelEditLine_"+u),h=s.getAttribute("data-parent-container"),c=s.outerHTML;s.remove();i(e,h,c)}t()}})}else Labels.cancelEdit(r,u)},saveLabelBold:function(i){var u=i.up(".popupBox"),r=i.up(".LabelItem"),f=r.getAttribute("data-label-id"),e=u.getAttribute("data-save-label-bold-url"),o=$(r.querySelector('[id="LabelPrivateData_'+f+'"]')).find("*").serializeAll();ajaxRequest(i,e,"POST",o,function(r){if(isObject(r.data)&&"style"in r.data){n=!0;var u=r.data.style.trim()==="";i.up().classList.toggle("bold",!u);i.classList.toggle("active",!u);t()}})},deleteLabel:function(i,r){MessageBox.confirm(r,Translations.get(Translations.keys.Delete),function(){var f=i.up(".popupBox"),r=i.up(".LabelItem"),u=r.getAttribute("data-label-id"),e=f.getAttribute("data-delete-label-url"),o=$(r.querySelector('[id="LabelPrivateData_'+u+'"]')).find("*").serializeAll()||"";ajaxRequest(i,e,"POST",o,function(r){if(r.status==ajaxRequest.StatusType.Success){n=!0;var f=i.up('div[data-label-id="'+u+'"]'),o=HtmlUtility.encode(f.getAttribute("data-parent-container")),e=i.up('[id="LabelsGroup_'+o+'"]');f.remove();e.querySelectorAll(".LabelItem").length||e.remove();t()}})})},updateObjectLabels:s,validateAddLabelKeydown:function(n,t){if(getEventKeyCode(n)===EventKeys.Enter){var i=t.parentNode.querySelector("#BtnAddLabel");i.onclick.apply(i)}},addLabelFromSuggestion:l,addLabel:function(r,f){var e=r.parentNode.querySelector("#CreateLabelEdit"),o="",s="";if(e&&(o=e.value.trim(),s=e.getAttribute("data-overlay")),!o||s&&o==s)return MessageBox.alert(f,function(n){n.focus()}.bind(this,e)),!1;e.value=HtmlUtility.sanitize(o);var h=r.up(".popupBox"),c=h.getAttribute("data-save-label-url"),l=$(r.up(".createNewContainer")).find("*").serializeAll();ajaxRequest(r,c,"POST",l,function(f){var h,o,c,l;f.status==ajaxRequest.StatusType.Success&&isObject(f.data)&&f.data.groupName&&f.data.elem&&(r.up(".popupEditTags")&&(n=!0),e.value=s,e.classList.add("greyText"),o=Popup.current(),o&&(h=o.querySelector(".LabelGroupsHolder"),c=HtmlUtility.encode(f.data.groupName),l=h.querySelector('[id="LabelsGroup_'+c+'"]'),l?i(o,f.data.groupName,f.data.elem,!0):u(h,f.data.groupName,f.data.elem),t()))})},AppShares:a()}}(),Portals=function(){function r(n,t,i){i=appendStringParams(i,[$("#hVisibleObjIDs").serializeAll()]);ajaxRequest(n,t,"POST",i)}function f(n){switch(n){case"V":return Translations.get(Translations.keys.Vehicles);case"CP":return Translations.get(Translations.keys.ClientProducts);default:return Translations.get(Translations.keys.Realestates)}}function t(n,t,i,r){n.classList[r]("ui-state-highlight");document.getElementById("portal_"+t).classList[r]("active");i&&i.classList[r]("active")}function u(){i&&clearInterval(i);i=setInterval(function(){if(n.length>0){var t="";n.forEach(function(n){t+=n+"<br />"});MessageBox.alert(t);n=[]}},300)}function e(n){var i=document.getElementById("realestate_export_sold"),r,u,f,t;if(i)if(n.id=="CBPortal_33")i.checked=n.checked;else{for(r=!1,u=document.querySelectorAll("#realestate_portals input[id^=CBPortal_]"),t=0;t<u.length;t++)if(f=u[t],f.getAttribute("websitetemplateid")>0&&f.checked!=n.checked){r=!0;break}if(r)return;i.checked=n.checked}}var n=[],i=0;return{popupListBulk:function(n,t,i,u,f){var e=Search.GenericList.getSelectedIDs();if(!Array.isArray(e)||e.length==0){MessageBox.alert(n.getAttribute("data-no-items-msg"));return}i=appendStringParams(i,Requests.getPair(Requests.keys.ObjectIDs,e.join(",")));u&&f&&e.length>f?MessageBox.confirm(u.format(e.length),Translations.get(Translations.keys.OK),function(){r(n,t,i)}):r(n,t,i)},showWebPortals:function(n){var t=n.up(".ContentBoxLine");$(t).slideUp(500);$(t.next("#WebPortalGroup")).slideDown(1e3)},selectAllPortals:function(n,t){var f=document.getElementById("PublishBtn"),e,u,i,r;for(f&&f.classList.remove("disabled"),e=n.checked,u=t.querySelectorAll("input[type=checkbox]"),r=0;r<u.length;r++)i=u[r],i!=n&&i.checked!=e&&i.click()},updateLimit:function(i,r){var v=document.querySelector(".ObjectExportPortals"),c=parseInt(i.getAttribute("data-limit")),l=i.up(".portalChild"),s=l?i.getAttribute("dependentportal"):i.value,o=document.getElementById("PortalProperties_"+s),p=document.getElementById("PublishBtn"),y,e,a,h,w;return p&&p.classList.remove("disabled"),o.getAttribute("data-value")?(y=f(v.getAttribute("data-ctx")),e=parseInt(o.getAttribute("data-value"),10)+1,i.checked?(e==c-1&&(n.push(Translations.get(Translations.keys.AboutReachLimit)+" "+c+" "+y+" "+Translations.get(Translations.keys.ForPortal)+" "+i.getAttribute("portalname")+"."),u()),e==c&&(n.push(Translations.get(Translations.keys.LimitReached)+" "+c+" "+y+" "+Translations.get(Translations.keys.ForPortal)+" "+i.getAttribute("portalname")+"."),u()),o.innerHTML=e,o.setAttribute("data-value",e),t(i,s,l,"add")):(e=o.getAttribute("data-value"),e>0&&(o.innerHTML=e-1,o.setAttribute("data-value",e-1)),t(i,s,l,"remove"))):t(i,s,l,i.getAttribute("checked")?"add":"remove"),a=v.querySelectorAll("input[id^=CBPortal_]"),r||(h=document.getElementById("CBPortal_33"),h&&i.id!="CBPortal_33"&&!h.checked&&i.checked&&(h.checked=!0,Portals.updateLimit(h)),Portals.checkDependentPortal(s,i.checked,a),Portals.checkLoosePortals(a)),w=a.any(function(n){return n.checked==!1}),v.querySelector(".listSelector").checked=w==!1,!0},checkDependentPortal:function(n,t,i,r){i.forEach(function(u){if((u.id=="CBPortal_33"||u.getAttribute("websitetemplateid")>0)&&e(u),u.getAttribute("dependentportal")){var f=u.getAttribute("dependentportal"),o=new RegExp("(^|,)"+n+"(,|$)");f.match(o)&&((!r&&t||u.classList.contains("ui-state-disabled")&&(!t||r))&&u.checked!=t&&(u.checked=t,Portals.updateLimit(u,!0)),u.id.match(/\d+$/g)+""!=u.getAttribute("dependentportal")&&Portals.checkDependentPortal(u.id.match(/\d+$/g),u.checked,i,r))}})},checkLoosePortals:function(n){var i=!1,r=n.filter(function(n){return n.checked&&!n.classList.contains("ui-state-disabled")}).length;r>0&&(i=!0);n.forEach(function(n){var f;if(n.classList.contains("ui-state-disabled")){var e=new RegExp("_"+n.getAttribute("dependentportal")+"$","ig"),u=!1,r=document.getElementById("CBPortal_"+n.getAttribute("dependentportal"));r&&(i&&r.checked&&r.getAttribute("dependentportal")==0?u=!0:i||(u=!r.checked));(n.getAttribute("id").match(e)||n.getAttribute("dependentportal")==0||u)&&(n.checked=i,f=n.up(".portalChild"),t(n,f?n.getAttribute("dependentportal"):n.value,f,i?"add":"remove"))}})},publish:function(n,t,i){if(!n.classList.contains("disabled")){var r=appendStringParams($(n.up(".ObjectExportPortals")).find("*").serializeAll(),i);ajaxRequest(n,t,"POST",r)}},reloadExportTab:function(n){var t;(n&&(t=document.getElementById(n),t=t?t.up(".detailSection"):null),t)&&Tabs.ajaxReset(t,!0)},updateObjectPortals:function(n,t,i,r){var u,f,e;if(n.classList.contains("disabled"))return!1;if(u=n.up(".popupBox"),i&&(f=u.querySelectorAll(".CheckableItem input[type=checkbox]").find(function(n){return n&&n.checked}),!f))return Popup.close(!0),!1;e=$(u).find(".popupContent *").serializeAll();ajaxRequest(n,t,"POST",e,function(n){n.status==ajaxRequest.StatusType.Success&&typeof r=="function"&&r.call(this,n)},{messageBoxCallback:function(n){n.status==ajaxRequest.StatusType.Success&&(Popup.close(!0),isObject(n.data)&&(n.data.html&&_updateSidebar(null,"",n.data.html),n.data.selector&&!document.getElementById(n.data.selector)&&(n.replaces=null,window.location.reload(!0))))}})},renderPortal:function(n,t,i,r){if(n&&!(i<0)){var u=document.getElementById(r);u&&(u.getAttribute("data-enabled")==0?ajaxRequest(n,t,"POST",Requests.get(Requests.keys.ID)+"="+i,function(n){n&&n.status==1&&(u.setAttribute("data-enabled","1"),$("#"+r).show(),u.parentElement&&(u.parentElement.style.display="block"))}):u.style.display=u.style.display=="none"?"block":"none")}}}}();requireClass("Associated");var Task=function(){function y(){return f||(f=document.getElementById("EventPage")),f}function p(){if(i)return i;var n=y();return n&&(i=n.querySelector("#PrivateData")),i}function e(){return document.getElementById(n.domID)}function o(t){var r=p(),i=e();t?!i&&r&&r.appendChild(createHtmlElement("input",{type:"hidden",id:n.domID,name:n.paramName,value:n.current})):i&&i.remove()}function r(t,i){var r;n.current>0&&n.current==i&&(o(!0),r=function(){o(!1)});Search.fullSearch(null,t,r,!0)}function s(n){var t=document.getElementById("RenderedEventsCount"),i;if(t)return(i=parseInt(t.value)||0,i>0||!n)?!0:(MessageBox.alert(n),!1)}function h(n,i,u,f,e,o,s){if(f=ensureArray(f),s&&(!f||f.length<=0)){MessageBox.alert(Translations.get(Translations.keys.NoSelectedEvents));return}u=appendStringParams(u,Requests.getPair(Requests.keys.EventIDs,f.join(",")));e=e.format(f.length);MessageBox.confirm(e,Translations.get(Translations.keys.OK),function(){ajaxRequest(n,i,"POST",u,function(n){n.status==ajaxRequest.StatusType.Success&&(isObject(n.data)&&("reload"in n.data&&n.data.reload&&window.location.reload(!0),"updateTaskCount"in n.data&&n.data.updateTaskCount&&"taskCount"in n.data&&t(n.data.taskCount),"ratePopupParams"in n.data&&n.data.ratePopupParams&&v(n.data.ratePopupParams),n.data.fullSearchUrl&&r(n.data.fullSearchUrl,f.length==1?parseInt(f[0]):0)),o?Search.GenericList.deselectAll(!0):"Associated"in window&&Associated.Task.clearSelection())})},"",Translations.get(Translations.keys.Cancel))}function c(n,i,r,u,f,e,o){if(u=ensureArray(u),o&&(!u||u.length==0)){MessageBox.alert(Translations.get(Translations.keys.NoSelectedEvents));return}r=appendStringParams(r,Requests.getPair(Requests.keys.EventIDs,u.join(",")));f=f.format(u.length);MessageBox.confirm(f,Translations.get(Translations.keys.Delete),function(){ajaxRequest(n,i,"POST",r,function(n){n.status==ajaxRequest.StatusType.Success&&(isObject(n.data)&&("updateTaskCount"in n.data&&n.data.updateTaskCount&&"taskCount"in n.data&&t(n.data.taskCount),n.data.fullSearchUrl&&Search.fullSearch(null,n.data.fullSearchUrl,null,!0)),e?Search.GenericList.deselectAll(!0):"Associated"in window&&Associated.Task.clearSelection())})},"",Translations.get(Translations.keys.Cancel))}function l(n,t,i,r){if(i=ensureArray(i),r&&(!i||i.length==0)){MessageBox.alert(Translations.get(Translations.keys.NoSelectedEvents));return}var u=Requests.getPair(Requests.keys.ObjectIDs,i.join(","));ajaxRequest(n,t,"POST",u,function(n){n.status==ajaxRequest.StatusType.Success&&isObject(n.data)&&n.data.html&&EgoPrinter.printHtml(n.data.html,{inheritCSS:!0})})}function t(n){var i=document.getElementById("MainMenuTasks"),t=null;i&&(t=i.querySelector(".menuCount"));t&&(t.innerHTML=n)}function a(n){var t=n.up(".listItemAction");t&&t.click()}function v(n){isObject(n)&&(n.reload?Associated.Task.showEventRatingPopup(n.url,n.eventID,n.historicID,n.showMessage,!0):n.searchUrl&&Associated.Task.showEventRatingPopup(n.url,n.eventID,n.historicID,n.showMessage,!1,n.searchUrl))}var f=null,i=null,n={domID:"EventPageSingleID",current:0,paramName:""},u={finishEvents:function(n,t,i,r,u,f){h(n,t,i,r,u,f,!0)},finishSummaryEvent:function(n,t,i,r,u){h(n,t,i,r,u,!1,!1)},saveEvents:function(n,i){var u=n.up(".TaskEditor"),f=$(u).find("*").serializeAll();ajaxRequest(n,i,"POST",f,function(n){var e,i,f;n.status==ajaxRequest.StatusType.Success&&("RoadMap"in window&&RoadMap.updateSummary(),e=function(n){var t=null;return n&&n.querySelectorAll(".taskItem").length==1&&(t=u.querySelector("#EditingTaskID")),t?parseInt(t.value):0}(document.getElementById("EventSearchResults")),Popup.close(),i=document.getElementById("taskTab"),i&&(i.querySelector(".SectionContent").show(),(!n.updates||n.updates.length==0)&&isObject(n.data)&&"updateByTabClick"in n.data&&n.data.updateByTabClick&&(f=i.querySelector("#AssociatedTasks .TaskTabChanger.active")||i.querySelector("#AssociatedTasks .TaskTabChanger"),f&&f.click())),isObject(n.data)&&("updateTaskCount"in n.data&&n.data.updateTaskCount&&"taskCount"in n.data&&t(n.data.taskCount),"highlightID"in n.data&&highlightNode(document.getElementById(n.data.highlightID)),n.data.fullSearchUrl&&r(n.data.fullSearchUrl,e)))})},emailEvent:function(n,t,i,r){if(!r||r.length==0){MessageBox.alert(Translations.get(Translations.keys.NoSelectedEvents));return}i=appendStringParams(i,Requests.get(Requests.keys.ObjectIDs)+"="+r.join(","));Email.popup(n,t,i)},deleteEvents:function(n,t,i,r,u,f){c(n,t,i,r,u,f,!0)},deleteSummaryEvent:function(n,t,i,r,u){c(n,t,i,r,u,!1,!1)},printEventList:function(n,t,i){l(n,t,i,!0)},printSummaryEvent:function(n,t,i){l(n,t,i,!1)},printEventTable:function(n,t,i){var r=s(i);r&&(a(n),Search.fullSearch(n,t,function(n){n.status==ajaxRequest.StatusType.Success&&n.data&&n.data.html&&EgoPrinter.printHtml(n.data.html,n.data.options)},!0))},printEventExcelHTML:function(n,t,i){var u=s(i),r;u&&(a(n),r=$(n.up(".EventScheduleTable")).find("*").serializeAll(),ajaxRequest(n,t,"POST",r))},toggleFinish:function(n,i,u,f,e,o){var s=function(){ajaxRequest(i,u,"POST",f,function(n){if(n.status==ajaxRequest.StatusType.Success){var i=document.getElementById("taskTab");i&&i.querySelector(".SectionContent").show();isObject(n.data)&&("reload"in n.data&&n.data.reload&&window.location.reload(!0),"updateTaskCount"in n.data&&n.data.updateTaskCount&&"taskCount"in n.data&&t(n.data.taskCount),"ratePopupParams"in n.data&&n.data.ratePopupParams&&v(n.data.ratePopupParams),n.data.fullSearchUrl&&r(n.data.fullSearchUrl,o));e?Search.GenericList.deselectAll(!0):"Associated"in window&&Associated.Task.clearSelection()}})};SwipeButton.toggle(i,s,n)},toggleDelete:function(n,i,r,u,f){var e=function(){ajaxRequest(i,r,"POST",u,function(n){n.status==ajaxRequest.StatusType.Success&&("updateTaskCount"in n.data&&n.data.updateTaskCount&&"taskCount"in n.data&&t(n.data.taskCount),n.data.fullSearchUrl&&Search.fullSearch(null,n.data.fullSearchUrl,null,!0),f?Search.GenericList.deselectAll():"Associated"in window&&Associated.Task.clearSelection())})};SwipeButton.toggle(i,e,n)},mobileToggleEventActions:function(n){var t=n.querySelector("i"),i=n.up(".listItemActions");t.classList.contains("icon-dot-menu")?(document.querySelectorAll(".EventItemActions").forEach(function(n){n.classList.remove("open");n.style.overflow=""}),document.querySelectorAll(".listItemActionsToggle a").forEach(function(n){var t=n.querySelector("i");t&&(t.classList.remove("icon-fechar"),t.classList.add("icon-dot-menu"))}),i.classList.add("open"),t.classList.remove("icon-dot-menu"),t.classList.add("icon-fechar"),$(n).delay(500).queue(function(n){i.style.overflow="visible";n()})):(t.classList.remove("icon-fechar"),t.classList.add("icon-dot-menu"),i.style.overflow="",i.classList.remove("open"))},getTemplate:function(n){var t=n.up(".TaskDynamicContext"),i=t.querySelector(".Template .TaskAssociatedContext").cloneNode(!0);t.insertBefore(i,n)},showEditOptions:function(n){var t=n.up(".TaskEditor");$(t.querySelector(".AdvancedOptionsHandle")).fadeOut({duration:200,complete:function(){$(t.querySelector(".AdvancedOptions")).slideDown()}})},deleteRepeatedEvents:function(n,t){ajaxRequest(null,n,"POST",t,function(){Popup.close()})},changeViewType:function(n,t){var r=n.up(".ViewTypeContainer"),i;r?(i=new Date,i.setTime(i.getTime()+31536e6),document.cookie=r.getAttribute("data-cookie-name")+"="+t+"; expires="+i.toUTCString()+"; path=/",window.location.href=r.getAttribute("data-page-raw-url")):window.location.reload(!0)},resetEventFilter:function(){document.getElementById("BaseEventTypeID").value="";document.getElementById("ScheduleTypeFastSearch").value="";document.querySelectorAll(".EventScheduleMenu").forEach(function(n){n.classList.remove("active")})},showLog:function(n,t,i){n&&t&&ajaxRequest(n,t,"GET",i,function(n){n.status==ajaxRequest.StatusType.Success&&n.data.list&&Task.mapIframesToRegister(n.data.list)})},mapIframesToRegister:function(n){var n,t;if(n){if(n=JSON.parse(n),n&&n.length>0)for(IframeManager.registerIframes=[],t=0;t<n.length;t++)IframeManager.register(n[t].ID,n[t].Description);IframeManager.build(!0)}},onSelectTaskSubject:function(n,t){Search.fullSearch(n,t,null,!1)},saveTaskRating:function(n,t,i,r,u){var f,o,e;if(n&&t){if(f=document.getElementById("task_rate"),f&&f.value==""){MessageBox.alert(n.getAttribute("data-missingInfo"));return}e=n.up(".popupBox");e&&(o=$(e).find("*").serializeAll());ajaxRequest(n,t,"POST",o,function(n){n.status==ajaxRequest.StatusType.Success&&(i&&i!=""&&MessageBox.alert(i),r?window.location.reload(!0):u&&Search.fullSearch(null,u,null,!0),Popup.close())})}},visitFilterToggle:function(n,t){var i=document.getElementById("PinnedHandle");i&&i.classList.remove("active");n.classList.contains("active")?(n.classList.remove("active"),$('#BaseEventTypeID option[value=""]').prop("selected",!0)):(n.classList.add("active"),$('#BaseEventTypeID option[value="'+n.getAttribute("data-visit-id")+'"]').prop("selected",!0));Search.fullSearch(n,t,null,!0)},loadEventPreview:function(n,t,i){if(n.getAttribute("data-loaded")!="1"){var u=n.querySelector(".listItemActionDrop"),r;u&&(r=createHtmlElement("div",{"class":"loading"}),r.appendChild(createHtmlElement("i",{"class":"icon-loading"})),u.appendChild(r));ajaxRequest(n,t,"GET",i,function(t){r&&r.remove();t.status==ajaxRequest.StatusType.Success&&t.replaces&&n.setAttribute("data-loaded","1")},{hideLoading:!0})}},onNotificationCheckBoxChange:function(n){var t=n.up(".extraLatPadding");t&&(n.checked?t.querySelectorAll(".notificationAlert").forEach(function(n){n.removeAttribute("disabled")}):t.querySelectorAll(".notificationAlert").forEach(function(n){n.setAttribute("disabled","disabled")}))},slzEventSearchParams:function(){return $("#EventSearchContainer").find("select, input").serializeAll()},responseSearch:function(n,t){r(n,t)},setRepeat:function(n,t){var u=n.up(".TaskTimeAdvancedSettingsContext"),i,r;t?n.checked!=!0&&(i=null,u&&(i=u.querySelector("#TaskRepeatIn")),i&&(i.value=i.options[0].value)):(r=null,u&&(r=u.querySelector("#TaskRepeatCheckbox input[type=checkbox]")),r&&r.checked!=!0&&(r.checked=!0))}};return u.CreateBox=function(){return{save:function(n,t,i){var r=n.up(".listItemAction"),u=r.id;i||(i=n.value);r.querySelector('input[class="TaskDate"]').value=i;ajaxRequest(n,t,"POST",$(r).find("*").serializeAll(),function(n){n.status==ajaxRequest.StatusType.Success&&$("#"+u).trigger("click").removeClass("active")})},cancel:function(n,t){var i=n.up(".listItemAction"),r=i.id;ajaxRequest(n,t,"POST",$(i).find("*").serializeAll(),function(n){n.status==ajaxRequest.StatusType.Success&&$("#"+r).trigger("click")})},openCalendar:function(n){var t=n.up(".listItemAction.float-menu"),i=t.querySelector(".CalendarDate");t.querySelector(".listItemActionDrop").querySelectorAll(".TaskSet").forEach(function(n){n.hide()});i.querySelector(".CalendarBtn").click();i.show()},onClose:function(n){var t=n.querySelector(".CalendarDate"),i;t&&(CalendarDateSelect.selectToday(t),t.hide(),i=n.querySelector(".listItemActionDrop"),i.querySelectorAll(".TaskSet").forEach(function(n){n.show()}))}}}(),u.ListView=function(){return{onLoad:function(){document.getElementById("EventSearchResults")&&$("html, body").animate({scrollTop:"0"})},onSingleLoad:function(t,i){n.paramName=t;n.current=parseInt(i);Element.remove(e())},onlyPinnedToggle:function(n,t){var i=document.getElementById("PinnedHandleVS");i&&(i.classList.remove("active"),$('#BaseEventTypeID option[value=""]').prop("selected",!0));Search.onlyPinnedToggle(n,t)},scheduleTypeFastSearch:function(n,t){var i=n.up("#EventSearchContainer"),u=i.querySelector("#ScheduleTypeFastSearch"),r,f;n.classList.contains("active")?(n.classList.remove("active"),u.value=""):(r=i.querySelector(".taskSearchTimeFrame"),r&&r.querySelectorAll("a").forEach(function(n){n.classList.remove("active")}),n.classList.add("active"),u.value=t);f=i.getAttribute("data-search-url");Search.fullSearch(n,f,null,!1)}}}(),u.ScheduleTable=function(){function t(){$("tr .taskTableTime").each(function(){var n=$(this).next("td").outerHeight();$(this).height(n)});$(".tasksTableLine .tasksTableMain").each(function(){var n=$(this).next("div").outerHeight();$(this).height(n-1)})}function i(n){var r;if(n=n||document.querySelector(".tasksTableContent"),n){if(n.classList.contains("Daily")||n.classList.contains("Monthly")){var u=$(window).height(),f=$(window).width(),e=$(n).offset().top,i=u-e,t=n.up(".tasksTableContainer");f>768?($(n).height(i-60),t&&$(t).height(i-10)):(n.removeAttribute("style"),t&&t.removeAttribute("style"))}r=$(".tasksTableLine").outerWidth();$(".tasksTableHeader").width(r)}}function r(n,t){var i=document.querySelector(".tasksTableSidebar"),r;if(i&&(n=n||document.querySelector(".tasksTableContent"),n))if(i.children.length)if(r=function(){$(n).find(".tasksTableLine").each(function(n){var r=this.querySelector(".tasksTableMain"),t=this.children.map(function(n){return parseInt($(n).outerHeight())}).reduce(function(n,t){return Math.max(n,t)});r.nodeName=="DIV"?$(i.children[n]).height(t-1):$(i.children[n]).height(t)})},t)var f=2,u=0,e=setInterval(function(){if(u>=f){clearInterval(e);return}u++;r()},100);else r();else $(n).find(".tasksTableLine").each(function(){this.classList.contains("currentTime")?$(this).find(".tasksTableMain").clone().addClass("currentTime").appendTo(".tasksTableSidebar"):$(this).find(".tasksTableMain").clone().appendTo(".tasksTableSidebar")})}function u(n){n=n||document.querySelector(".tasksTableContent");$(n).scroll(function(){var n=$(this).offset().left,t=$(this).offset().top;$(".tasksTableHeader").offset({left:-1*this.scrollLeft+n});$(".tasksTableSidebar").offset({top:-1*this.scrollTop+t})})}function f(){var t=document.querySelector(".tasksTableHeader"),n=$(".tasksTableContainer"),i=$(window).scrollTop(),r=$(window).width(),u=t?$(t).outerHeight()||0:0,f=n&&n.length>0?n.offset().top-50:0;i>f&&r<769?(Element.addClassName(t,"fixed"),n&&n.length>0&&n.css({paddingTop:u})):(Element.removeClassName(t,"fixed"),n&&n.length>0&&n.css({paddingTop:0}))}function e(){var t=document.getElementById("EventSchedulePaginator"),n=null;return(t&&(n=t.getAttribute("data-curr-target-id")),n)?document.getElementById(n):n}function o(n){if(n){var t=n.up(".taskSearchTimeFrame");t&&t.querySelectorAll("a").invoke("removeClassName","active");n.classList.add("active")}else document.querySelectorAll(".taskScheduleMenu").invoke("removeClassName","active")}var n=!1;return{tableResize:function(){var n=document.querySelector(".tasksTableContent");t();i(n);r(n,!0)},onLoad:function(){var h=Search.currentViewType(),c,s,l,v,a;(h==Search.ViewTypeKeys.CalendarDaily||h==Search.ViewTypeKeys.CalendarWeekly||h==Search.ViewTypeKeys.CalendarMonthly)&&(c=document.querySelector(".tasksTableContent"),t(),i(c),r(c,!1),n||(EventHandler.addListener(window,"resize",function(){Task.ScheduleTable.tableResize()}),n=!0),u(c),$(window).scroll(f),s=document.getElementById("ScheduleOverflow"),l=null,s&&(l=s.querySelector(".theHour")),l&&(v=$(window).height()-$(s).height(),s.scrollTop=l.offsetTop-v+100),a=null,h!=Search.ViewTypeKeys.CalendarMonthly&&(a=e()),o(a))},change:function(n){Search.CalendarView.fromContext(document.getElementById("EventSearchContainer"),n)},addUser:function(n,t){ajaxRequest(n,t,"POST")},showColumn:function(n,t,i){var r="";n.up("#ChooseUsersPopup").querySelectorAll(".users").forEach(function(n){n.checked&&(r!=""&&(r=r+","),r=r+n.value)});Cookie.set(t,r,365);Popup.close();Search.fullSearch(null,i,null,!0)},hideColumn:function(n,t,i){document.querySelectorAll(".securityUser_"+t).invoke("hide");var r="",u=document.getElementById("oWeeklyHeader");u&&u.querySelectorAll("[id^=oU_]").forEach(function(n){n.style.display!="none"&&(r!=""&&(r=r+","),r=r+n.getAttribute("data-value"))});Cookie.set(n,r,365);r==""&&Search.fullSearch(null,i,null,!0)}}}(),u}(),FacebookExport=function(){var n=0,t=[],i;return{open:function(t,r,u,f,e){i=f;n=e;ajaxRequest(t,r,"GET",u,function(){setTimeline()})},renderAccount:function(){FacebookExport.authorization.accountInfo?(FacebookExport.authorization.accountInfo.userName||(FacebookExport.authorization.accountInfo=JSON.parse(FacebookExport.authorization.accountInfo)),$("#AccountArea strong").html(FacebookExport.authorization.accountInfo.userName),$("#RequiredAuthenticationArea").hide(),$("#AccountArea").show(),$("#galleryInfo").show(),$("#btnPublish").removeClass("disabled"),$("#galleryTitle :input").val(FacebookExport.authorization.galleryInfo.gallery)):($("#RequiredAuthenticationArea").show(),$("#AccountArea").hide(),$("#galleryInfo").hide(),$("#btnPublish").hasClass("disabled")||$("#btnPublish").addClass("disabled"))},onFinish:function(){var n=$$(".NoteList")[0];n&&window.Paginator&&Paginator.toNavBar(n.down(".Paginator")).reload()},chronoShare:function(n,t,i){n.getAttribute("requesting")||ajaxRequest(n,t,"GET",i,function(n){n.status==1&&n.data&&n.data.url&&window.open(n.data.url)})},authorization:{authorized:null,authUrl:null,accountInfo:null,authRef:null,galleryInfo:null,checkAuth:function(){var t="BusinessObject="+n;ajaxRequest("",i,"GET",t,function(n){n&&n.status==1&&(FacebookExport.authorization.authorized=n.data.authorized,FacebookExport.authorization.accountInfo=n.data.account,FacebookExport.authorization.galleryInfo=n.data.settings);n&&n.data&&n.data.authUrl&&(FacebookExport.authorization.authUrl=n.data.authUrl);FacebookExport.authorization.authorized?FacebookExport.renderAccount():($("#RequiredAuthenticationArea").show(),$("#AccountArea").hide())},{hideLoading:!0})},goAuth:function(){if(t.length==0)return MessageBox.alert(CTranslation.get("FACEBOOK_EXPORT_NO_IMAGE_SELECTED")),FacebookExport.renderAccount(),FacebookExport.enableDetails(),!1;FacebookExport.authorization.authUrl&&(this.oAuthWindowRef&&!this.oAuthWindowRef.closed&&this.oAuthWindowRef.close(),this.oAuthWindowRef=window.open(decodeURIComponent(FacebookExport.authorization.authUrl),"_blank","menubar=no,location=no,resizable=yes,scrollbars=no,status=no,width=1000px,height=600px",!0),this.nAuthInterval=setInterval(function(){this.oAuthWindowRef.closed&&FacebookExport.authorization.stopListener()}.bind(this),1e3))},handleAuth:function(n){this.stopListener();var t=$("FacebookExportPopup");FacebookExport.authorization.authorized=!1;FacebookExport.authorization.accountInfo=null;FacebookExport.galleryInfo=null;n&&(n.success?(FacebookExport.authorization.authorized=!0,FacebookExport.authorization.accountInfo=n.account,FacebookExport.authorization.galleryInfo=n.settings,FacebookExport.renderAccount()):n.message&&MessageBox.alert(n.message))},goUnAuth:function(){var n=document.getElementById("oFCExportLogout"),t;n&&n.length!=0||(n=document.createElement("iframe"),n.setAttribute("id","oFCExportLogout"),n.setAttribute("src","javascript:false;"),n.setAttribute("style","display:none;"),document.body.appendChild(n),t=function(){var i=document.getElementById("oFCExportLogout");i.parentNode&&(i.contentDocument&&i.contentDocument.body&&i.contentDocument.body.innerHTML=="false"||(EventHandler.removeListener(n,"load",t),i.remove(),FacebookExport.authorization.authorized=!1,FacebookExport.authorization.accountInfo=null,FacebookExport.authorization.galleryInfo=null,FacebookExport.renderAccount()))},EventHandler.addListener(n,"load",t));n.setAttribute("src",FacebookExport.authorization.accountInfo.unauthorize.url+"?"+FacebookExport.authorization.accountInfo.unauthorize.query)},stopListener:function(){this.nAuthInterval&&(clearInterval(this.nAuthInterval),Loading.hide(),FacebookExport.renderAccount())}},chooseImage:function(n){var t=$(n).closest("#exporterContent"),r=$(n).closest(".templateItem"),i=t.find(".actionBtn");r.toggleClass("active");t.find(".templateItem.active").length?i.removeClass("disabled"):i.addClass("disabled")},createGallery:function(n,i,r,u){if(!$(n).hasClass("disabled")){if($(".multipleImageSelect > .active").length==0){MessageBox.alert(Translations.get(Translations.keys.FacebookNoImageSelected));return}return $(".multipleImageSelect > .active").each(function(n,i){t.push($(i).attr("data-value"))}),ajaxRequest(n,i,"GET",r+"&"+dataSerializer(".multipleImageSelect",".active","data-name","data-value"),function(n){setTimeline();n.status==1&&n.authorized&&(FacebookExport.authorization.authorized=n.authorized,FacebookExport.authorization.accountInfo=n.account,FacebookExport.authorization.galleryInfo=n.settings);FacebookExport.authorization.authorized?FacebookExport.renderAccount():FacebookExport.authorization.checkAuth(u)}),!1}},backToFirstStep:function(n,t,i){ajaxRequest(n,t,"GET",i,function(){setTimeline()})},saveGallery:function(i,r){if(!$(i).hasClass("disabled")){if(!FacebookExport.authorization.authorized)return MessageBox.alert(Translations.get(Translations.keys.FacebookExportAuthenticationRequired)),!1;var u={};u.nid=n;u["facebook[gallery_name]"]=$("#galleryTitle :input").val();u["facebook[userid]"]=FacebookExport.authorization.accountInfo.id;u["facebook[username]"]=FacebookExport.authorization.accountInfo.userName;u["facebook[authcode]"]=FacebookExport.authorization.accountInfo.code;u["facebook[exported]"]=FacebookExport.authorization.galleryInfo.exported?1:0;u["facebook[items]"]=t.join(",");ajaxRequest(i,r,"POST",u,function(){setTimeline()})}}}}(),WhatsApp=function(){return{open:function(n,t,i){var r=new Popup.LayerOptions(function(){Popup.current().querySelector(".ContactContainer").setAttribute("data-force-adjust-overflow","1")},null,null,function(){WhatsApp.onFinish()});ajaxRequest(n,t,"GET",i,function(n){n.status==1&&document.getElementById("ContactContent").querySelector(".RecipientBox .ContactBar").click()},{popupOptions:r})},getEntity:function(n,t,i,r,u){var f=t.innerHTML.replace(/<br\/?>/i,"").trim();window.clearTimeout(WhatsApp.liveSearchTimeoutVar_getEntity);f==""?$("emailBoxResult"+i).innerHTML="":f.length>1&&u.keyCode!=EventKeys.Enter&&(WhatsApp.liveSearchTimeoutVar_getEntity=WhatsApp.getEntityTimeout.lazyDo(1.01,search_url,action,f,sEmailToType,bIsEnter))},onFinish:function(){},share:function(n,t){var r="",i=[],u=$("#whatsapppopup .ContactBar"),f,e;u.length==1&&u.children(".emailRecipient").length>0&&(f=[],u.children(".emailRecipient").each(function(n,t){f.push({key:$(t).children(".Contact").val(),value:$(t).attr("id")})}),$("#contacts").val(JSON.stringify(f)));e=$("#WhatsAppPrivateData input").serializeAll();ajaxRequest(n,t,"GET",e,function(n){var u;if(n.status==ajaxRequest.StatusType.Success&&n.data&&n.data.message)if(r=n.data.message,i=n.data.numberAndCountryCodeList,i&&i.length!=0){for(u=0;u<i.length;u++)if(i[u]){var e="",t=i[u],f=t&&t.Key?t.Key:"";t&&t.Key&&t.Key.indexOf("+")!=-1?f=t.Key.replace("+",""):t&&t.Key&&t.Key.indexOf("(")!=-1&&t.Key.indexOf(")")!=-1?f=t.Key.replace("(","").replace(")",""):t&&t.Key.trim().length>=3&&t.Key.trim().substring(0,2)=="00"?f=t.Key.trim().substring(2):(e="351",t&&t.Value&&t.Value!=""&&(e=t.Value));navigator.userAgent.indexOf("Firefox")==-1||CheckIsMobile.any()?(window.open("https://wa.me/"+e+f+"?text="+r),Popup.close()):(window.open("https://web.whatsapp.com/send?text="+r+"&phone="+e+f),Popup.close())}}else navigator.userAgent.indexOf("Firefox")==-1||CheckIsMobile.any()?(window.open("https://wa.me/?text="+r),Popup.close()):(window.open("https://web.whatsapp.com/send?text="+r),Popup.close())})},openConversation:function(n,t,i){ajaxRequest(n,t,"GET",i,function(n){var i;if(n.status==ajaxRequest.StatusType.Success&&n.data)if(numberAndCountryCodeList=n.data.numberAndCountryCodeList,numberAndCountryCodeList&&numberAndCountryCodeList.length!=0){for(i=0;i<numberAndCountryCodeList.length;i++)if(numberAndCountryCodeList[i]){var u="",t=numberAndCountryCodeList[i],r=t&&t.Key?t.Key:"";t&&t.Key&&t.Key.indexOf("+")!=-1?r=t.Key.replace("+",""):t&&t.Key&&t.Key.indexOf("(")!=-1&&t.Key.indexOf(")")!=-1?r=t.Key.replace("(","").replace(")",""):t&&t.Key.trim().length>=3&&t.Key.trim().substring(0,2)=="00"?r=t.Key.trim().substring(2):(u="351",t&&t.Value&&t.Value!=""&&(u=t.Value));navigator.userAgent.indexOf("Firefox")==-1||CheckIsMobile.any()?(window.open("https://wa.me/"+u+r),Popup.close()):(window.open("https://web.whatsapp.com/send?phone="+u+r),Popup.close())}}else navigator.userAgent.indexOf("Firefox")==-1||CheckIsMobile.any()?(window.open("https://wa.me/"),Popup.close()):(window.open("https://web.whatsapp.com/send"),Popup.close())})}}}(),CheckIsMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return CheckIsMobile.Android()||CheckIsMobile.BlackBerry()||CheckIsMobile.iOS()||CheckIsMobile.Opera()||CheckIsMobile.Windows()}},YoutubeExporter=function(){function n(n){if(!n||n.length==0)return!0;for(var t=0;t<n.length;t++)if(isBlank(n[t].val()))return n[t];return!1}var t=Object.freeze({Undefined:0,AgencyNews:1});return{selectedVideos:[],videos:[],urlRefrehCategories:"",title:"",keywords:"",videoSrc:"",directUploadHandler:null,published:!1,open:function(n,t,i,r){YoutubeExporter.published=!1;ajaxRequest(n,t,"GET",i,function(n){setTimeline();typeof r=="function"&&r(n)})},openSingle:function(n,t,i,r,u){authenticationAction=r;contextID=u;ajaxRequest(n,t,"GET",i,function(){YoutubeExporter.authorization.authorized?YoutubeExporter.renderAccount():YoutubeExporter.authorization.checkAuth(r)})},createGallery:function(n,t,i){if(YoutubeExporter.selectedVideos=[],YoutubeExporter.title="",YoutubeExporter.keywords="",YoutubeExporter.videoSrc="",$(".multipleImageSelect > .active").length==0){MessageBox.alert(Translations.get(Translations.keys.YoutubeNoSelectedVideos));return}if($(".multipleImageSelect > .active").length>1){MessageBox.alert(Translations.get(Translations.keys.YoutubeOnlyOneVideoAllowed));return}return $(".multipleImageSelect > .active").each(function(n,t){YoutubeExporter.title==""&&(YoutubeExporter.title=$(t).attr("data-description"));YoutubeExporter.keywords==""&&(YoutubeExporter.keywords=$(t).attr("data-keywords"));YoutubeExporter.videoSrc==""&&(YoutubeExporter.videoSrc=$(t).attr("data-url"));YoutubeExporter.selectedVideos.push($(t).attr("data-value"))}),ajaxRequest(n,t,"GET",i+"&"+dataSerializer(".multipleImageSelect",".active","data-name","data-value"),function(){setTimeline();GoogleSync.loadYoutube();YoutubeExporter.renderAccount()},{hideLoading:!0}),!1},renderAccount:function(){if(YoutubeExporter.authorization.authorized){YoutubeExporter.refreshCategories($("#videoCategories").attr("data-action"));$("#RequiredAuthenticationArea").hide();$("#galleryTitle > input").val(YoutubeExporter.title);$("#galleryDescription > textarea").val(YoutubeExporter.title);$("#galleryKeywords > input").val(YoutubeExporter.keywords);$("#FileUrl").val(YoutubeExporter.videoSrc);$("#galleryInfo").show();$("#AccountArea > strong").html(YoutubeExporter.authorization.userName);$("#AccountArea").show();$("#btnPublish").removeClass("disabled");var n=document.querySelector("#galleryInfo input[type=text]");n&&(n.focus(),n.moveCursorEnd())}else $("#RequiredAuthenticationArea").show(),$("#galleryInfo").hide(),$("#AccountArea > strong").html(),$("#AccountArea").hide(),$("#btnPublish").addClass("disabled")},renderData:function(){$("#RequiredAuthenticationArea").hide();$("#galleryTitle > input").val(YoutubeExporter.title);$("#galleryDescription > textarea").val(YoutubeExporter.title);$("#galleryKeywords > input").val(YoutubeExporter.keywords);$("#FileUrl").val(YoutubeExporter.videoSrc);$("#galleryInfo").show();$("#AccountArea > strong").html(YoutubeExporter.authorization.userName);$("#AccountArea").show();$("#btnPublish").removeClass("disabled");var n=document.querySelector("#galleryInfo input[type=text]");n&&(n.focus(),n.moveCursorEnd())},refreshCategories:function(n){n&&ajaxRequest("",n,"GET","",function(){},{hideLoading:!0})},authorization:{authorized:null,authUrl:null,userName:null,checkAuth:function(n,t){ajaxRequest(null,n,"POST",t,function(n){n.status==1&&(YoutubeExporter.authorization.authorized=!1,n&&n.data&&(n.data.authUrl&&(YoutubeExporter.authorization.authUrl=n.data.authUrl),n.data.userName&&(YoutubeExporter.authorization.userName=n.data.userName),n.data.authorized?(YoutubeExporter.authorization.authorized=n.data.authorized,YoutubeExporter.renderAccount()):YoutubeExporter.renderAccount()))},{hideLoading:!0})},goAuth:function(){YoutubeExporter.authorization.authUrl&&(this.oAuthWindowRef&&!this.oAuthWindowRef.closed&&this.oAuthWindowRef.close(),this.oAuthWindowRef=window.open(YoutubeExporter.authorization.authUrl,"_blank","menubar=no,location=no,resizable=yes,scrollbars=no,status=no,width=590px,height=590px",!0),this.nAuthInterval=setInterval(function(){this.oAuthWindowRef.closed&&YoutubeExporter.authorization.stopListener()}.bind(this),1e3))},handleAuth:function(n){YoutubeExporter.authorization.userName=n.userName;YoutubeExporter.authorization.authorized=n.authorized;n.message&&MessageBox.alert(n.message);YoutubeExporter.renderAccount()},stopListener:function(){this.nAuthInterval&&clearInterval(this.nAuthInterval)},goUnAuth:function(){GoogleSync.youtubeSignOut();YoutubeExporter.authorization.authorized=!1;YoutubeExporter.renderAccount()}},backToFirstStep:function(n,t,i){ajaxRequest(n,t,"GET",i,function(){setTimeline()})},startUpload:function(t,i){var r,u;if(!YoutubeExporter.authorization.authorized)return MessageBox.alert(Translations.get(Translations.keys.YoutubeAuthenticationRequired)),!1;if(r=n([$("#galleryTitle > input"),$("#galleryKeywords > input"),$("#galleryDescription > textarea"),$("#videoCategories select:first")]),r)return MessageBox.alert(Translations.get(Translations.keys.YoutubeRequiredInfo),function(){r.focus()}),!1;u=$("#galleryInfo :input").serializeAll();ajaxRequest(t,i,"POST",u,function(n){n.status==1&&(YoutubeExporter.published=!0)})},chooseImage:function(n){n&&($(n).parent().toggleClass("active"),$(".multipleImageSelect > .templateItem").not($(n).parent()).removeClass("active"))},startDirectUpload:function(t,i){if(!YoutubeExporter.authorization.authorized)return MessageBox.alert(Translations.get(Translations.keys.YoutubeAuthenticationRequired)),!1;if(!YoutubeExporter.directUploadHandler)return MessageBox.alert(Translations.get(Translations.keys.GenericError)),!1;var r=n([$("#galleryTitle > input"),$("#galleryKeywords > input"),$("#galleryDescription > textarea"),$("#videoCategories select:first")]);if(r)return MessageBox.alert(Translations.get(Translations.keys.YoutubeRequiredInfo),function(){r.focus()}),!1;YoutubeExporter.directUploadHandler._uploadFile(i)},onYoutubeUrlSaved:function(){Popup.close(!0);var n=window.location.href;n=n.replace(window.location.search,"");window.location.href=n},openSaveYoutubeUrlPopup:function(n,t,i){ajaxRequest(n,t,"GET",i)},saveYoutubeUrl:function(n,i,r,u){var f=n.up(".popupBox"),e=f.querySelector(".YoutubeUrl");if(!e||!e.value){MessageBox.alert(u);return}r=appendStringParams(r,$(f).find(":input").serializeAll());ajaxRequest(n,i,"POST",r,function(n){n.status==ajaxRequest.StatusType.Success&&isObject(n.data)&&n.data.uploadType==t.AgencyNews&&n.data.mediaHtml&&(n.data.isAgencyNewsUpload?n.data.mediaList&&n.data.mediaList.length>0&&(JSON.parse(n.data.mediaList).forEach(function(n){AgencyNews.Videos.push(n)}),n.data.isDocument?document.querySelector(".agencyNewsFileContainer").innerHTML+=n.data.mediaHtml:document.querySelector(".contentPhotos").innerHTML+=n.data.mediaHtml,YoutubeExporter.published=!0):n.data.isVideo&&(n.data.mediaList&&n.data.mediaList.length>0&&(AgencyNews.Videos.push(JSON.parse(n.data.mediaList)),document.querySelector(".contentVideos").innerHTML+=n.data.mediaHtml,YoutubeExporter.published=!0),Popup.close()))})}}}(),GoogleMap=function(){function s(n,t,i,r,u,f,e,s){var l=createHtmlElement("div",{id:"bodyContent"}),a=createHtmlElement("p"),v,y,h,c;return a.appendChild(createHtmlElement("label",{style:"font-weight: bold;",innerHTML:i})),a.append(", "+r),l.appendChild(a),l.appendChild(createHtmlElement("p",{innerHTML:u})),l.appendChild(createHtmlElement("p",{innerHTML:f})),v=createHtmlElement("div",{style:"float: left; min-width: 200px; max-width: 220px; margin-left: 10px; margin-top: 10px;"}),v.appendChild(l),y=createHtmlElement("input",{type:"checkbox",id:"ChkRealestate_"+e,"data-object-id":e,value:e,onclick:"Search.GenericList.updateSelectedMapItems(this);"}),n.getAttribute("map-checked")=="1"&&y.setAttribute("checked","checked"),h=createHtmlElement("p",{"class":"balloon",style:"float: left; margin-left: 10px;"}),h.appendChild(y),h.appendChild(createHtmlElement("label",{"for":"ChkRealestate_"+e,innerHTML:"&nbsp;"+Translations.get(Translations.keys.ToSelect)})),h.append(" | "),h.appendChild(createHtmlElement("a",{href:s,target:"_blank","class":"blueLink",innerText:Translations.get(Translations.keys.SeeRealestate)})),c=createHtmlElement("div",{"class":"mapViewBalloon",style:"padding:0"}),c.appendChild(createHtmlElement("img",{src:t,onerror:'this.src = "'+o+'"',style:"position: unset; float: left; margin-top: 13px;"})),c.appendChild(v),c.appendChild(h),c}var u=null,n=[],r=null,i=[],f=null,t=null,h={strokeColor:"#1ca4e8",strokeOpacity:.9,strokeWeight:3,fillColor:"#1ca4e8",fillOpacity:.3,editable:!0,draggable:!0,geodesic:!1},e=null,o="",c=function(){var t=parseInt(Math.random()*6,10)+1,n="AIzaSyBBXKLWTbdoX1zttaY7uY3KEnfe3M_JRkI";switch(t){case 1:n="AIzaSyBBXKLWTbdoX1zttaY7uY3KEnfe3M_JRkI";break;case 2:n="AIzaSyByQfKp1hbEaY_N-oAewev3NZraHbXZW0c";break;case 3:n="AIzaSyDZt1tbbcABEDK386uNTF3LJAz0j2Ja0j4";break;case 4:n="AIzaSyCHhq3SG-w0QrXH0DqZ2DHI5tpTmHzbaiI";break;case 5:n="AIzaSyDYQUNir1WksKH1JmcEsyHLDKoXBDdWTYY";break;case 6:n="AIzaSyDuopa_NVGW2KiUJLoKHDylePtfCdWP79w"}return n};return{initialize:function(){var i="https://maps.googleapis.com/maps/api/js?key="+c()+"&libraries=drawing&callback=GoogleMap.gInitMap",n=document.createElement("script"),t;n.setAttribute("type","text/javascript");n.setAttribute("id","gmapdraw");n.setAttribute("src",i);document.scripts.gmapdraw!=null?setTimeout(function(){GoogleMap.gInitMap()},400):setTimeout(function(){(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(n)},500);t=function(){if(Search.currentIsTargetViewType(Search.ViewTypeKeys.Map)){var n=document.getElementById("realestate_search_polygons").value;return n.length>0?"polygon="+n:null}};e===null&&(Search.registerCallback(Search.callbackKeys.PreRequest,t),e=t)},clearShapes:function(){for(var t=0;t<n.length;t++)n[t].setMap(null);n.length=0},createControlBar:function(n){t=n;var i=document.createElement("div");i.style.marginLeft="-40px";GoogleMap.createControl(i,document.getElementById("add_poly").value,"create-btn");GoogleMap.createControl(i,document.getElementById("delete_poly").value,"delete-btn");GoogleMap.createControl(i,document.getElementById("delete_all").value,"delete-all-btn");GoogleMap.createControl(i,document.getElementById("redraw_poly").value,"redraw-poly-btn");GoogleMap.createControl(i,document.getElementById("search_by_poly").value,"search-by-poly-btn");i.index=1;t.controls[google.maps.ControlPosition.TOP_CENTER].push(i)},createControl:function(n,i,r){var u=document.createElement("div"),f;u.innerHTML=i;u.id=r;u.className="map-polygon-controls";u.addEventListener("mouseover",function(){GoogleMap.bindDrawingButtons(t);this.removeEventListener("mouseover",function(){})});r=="search-by-poly-btn"&&(f=document.getElementById("g-url").value,u.className="map-polygon-controls-blue",u.setAttribute("onclick","GoogleMap.saveChanges(true);GoogleMap.searchByPolygon(this,'"+f+"');GoogleMap.clearShapes();"));r=="redraw-poly-btn"&&(u.className="map-polygon-controls",u.setAttribute("onclick","GoogleMap.loadPolygons();"),document.getElementById("realestate_old_polygons").value==""&&(u.style.display="none"));n.appendChild(u)},openDrawTools:function(){u=new google.maps.drawing.DrawingManager({drawingMode:null,drawingControl:!1,markerOptions:{draggable:!0},polylineOptions:{editable:!0},polygonOptions:{strokeColor:"#1ca4e8",strokeOpacity:.9,strokeWeight:3,fillColor:"#1ca4e8",fillOpacity:.3,editable:!0,draggable:!0,geodesic:!1},map:t})},bindDrawingButtons:function(t){var i=t,e=document.getElementById("create-btn"),o=document.getElementById("delete-btn"),s=document.getElementById("delete-all-btn");google.maps.event.addListener(i,"click",function(){GoogleMap.clearSelection()});google.maps.event.addDomListener(e,"click",function(){u.setDrawingMode(google.maps.drawing.OverlayType.POLYGON)});google.maps.event.addDomListener(o,"click",function(){if(r){var t=GoogleMap.hasShape(n,r);t==!0&&(r.setMap(null),n.splice(f,1),document.getElementById("realestate_search_polygons").value="")}});google.maps.event.addDomListener(s,"click",function(){for(var t=0;t<n.length;t++)n[t].setMap(null);n.length=0});google.maps.event.addListener(u,"overlaycomplete",function(n){GoogleMap.bindPolygonEvent(n)})},bindPolygonEvent:function(n){var t=n.overlay,i=n.type;t.type=i;i!=google.maps.drawing.OverlayType.MARKER&&u.setDrawingMode(null);GoogleMap.bindPolygon(t)},updatePositions:function(t,i){n[t]=i},hasShape:function(n,t){var e=!1,u,r,i;if(t&&n&&n.length>0){for(u=[],r=0;r<t.getPath().length;r++)u.push(t.getPath().getAt(r).toUrlValue(20));for(i=0;i<n.length;i++){var o=n[i],f=[],s=!0;for(r=0;r<o.getPath().length;r++)f.push(o.getPath().getAt(r).toUrlValue(20));for(i=0;i<f.length;i++)f[i]!=u[i]&&(s=!1);s&&(e=!0)}}return e},bindPolygon:function(t){var r,i;$("#search-by-poly-btn").show();r=GoogleMap.hasShape(n,t);r==!1&&n.push(t);i=n.length-1;GoogleMap.setSelection(t,i);google.maps.event.addListener(t,"click",function(){GoogleMap.setSelection(t,i)});google.maps.event.addListener(t,"dragstart",function(){google.maps.event.clearListeners(t.getPath(),"set_at")});google.maps.event.addListener(t,"dragend",function(){GoogleMap.updatePositions(i,t);google.maps.event.addListener(t.getPath(),"set_at",function(){GoogleMap.updatePositions(i,t)})});google.maps.event.addListener(t.getPath(),"insert_at",function(){GoogleMap.updatePositions(i,t)});google.maps.event.addListener(t.getPath(),"remove_at",function(){GoogleMap.updatePositions(i,t)});google.maps.event.addListener(t.getPath(),"set_at",function(){GoogleMap.updatePositions(i,t)})},drawPolygons:function(){for(var r,e,f,u,n=0;n<i.length;n++){for(r=new google.maps.Polygon,r.setMap(t),r.setOptions(h),r.setPath(i[n]),e=i[n].getLength(),f=new google.maps.MVCArray,u=0;u<e;u++)f.push(i[n].getAt(u));r.setPath(f);GoogleMap.bindPolygon(r)}},loadPolygons:function(){var u=document.getElementById("realestate_old_polygons").value,f,t,e,o,r,s;if(u!=null&&u!=""){for(t=0;t<n.length;t++)n[t].setMap(null);for(n.length=0,i.length=0,f=u.split("|"),t=0;t<f.length;t++){for(e=f[t].split(","),o=new google.maps.MVCArray,r=0;r<e.length-1;r++)s=e[r].split(" "),o.push(new google.maps.LatLng(s[0],s[1]));i.push(o)}GoogleMap.drawPolygons()}},setSelection:function(n,t){GoogleMap.clearSelection();r=n;f=t;n.setEditable(!0)},clearSelection:function(){r&&(r.setEditable(!1),f=null,r=null)},saveChanges:function(t){var e,o,u,s,h,r;if(t){for(i.length=0,r=0;r<n.length;r++){for(e=n[r].getPath().getLength(),o=new google.maps.MVCArray,u=0;u<e;u++)o.push(n[r].getPath().getAt(u));i.push(o)}var e=null,f="",c=document.getElementById("realestate_search_polygons");if(i[0]!=null){for(r=0;r<i.length;r++){for(e=i[r].getLength(),u=0;u<e;u++)s=i[r].getAt(u).toUrlValue(20).toString().split(","),f+=s[0]+" "+s[1],u<e-1?f+=",":(f+=",",h=i[r].getAt(0).toUrlValue(20).toString().split(","),f+=h[0]+" "+h[1]);r!=i.length-1&&(f+="|")}c.value=f}else c.value=f}else{for(r=0;r<n.length;r++)n[r].setMap(null);n.length=0}},panMap:function(n){setTimeout(function(){if(document.getElementsByClassName("gm-style-iw").length>0&&document.getElementById("GMapRender")){var t=document.getElementById("GMapRender").getBoundingClientRect(),i=document.getElementsByClassName("gm-style-iw")[0].getBoundingClientRect();i.top-t.top<50&&n.panBy(0,-50)}},500)},gInitMap:function(){var p,l,n,i,v,y,c;if(document.getElementById("GMapRender")){p=document.getElementsByName("realestateDetails");l=document.getElementById("GMapRender");l.style.height=window.innerHeight-380+"px";t=new google.maps.Map(l,{zoom:10});GoogleMap.createControlBar(t);GoogleMap.openDrawTools();var u=new google.maps.LatLngBounds,f=new google.maps.InfoWindow({content:"{MORE_DETAILS}",maxWidth:400});for(o=document.getElementById("RealestateListResults").getAttribute("data-nopic-url"),n=document.getElementById("hVisibleObjIDs").value.split(","),i=0;i<n.length;i++){var r=document.getElementById(n[i]),e=null,h=null,a=null;r!=null&&(e=r.childNodes[19].defaultValue,h=r.childNodes[21].defaultValue,a=r.childNodes[3].defaultValue);e!=0&&h!=0&&r!=null&&(u.extend(new google.maps.LatLng(e,h)),v=document.getElementById("marker-img").value,y=new google.maps.Marker({animation:google.maps.Animation.DROP,position:{lat:Number(e),lng:Number(h)},map:t,title:""+a+"",id:""+n[i]+"",icon:v}),y.addListener("click",function(){var n=document.getElementById(this.id),i=n.querySelector("#reference").value,a=n.querySelector("#address").value,r=n.querySelector("#price").value,u=n.querySelector("#nature").value,v=n.querySelector("#description").value,e=n.querySelector("#image").value,o=n.querySelector("#url").value,h=n.querySelector("#location").value,c=n.querySelector("#id").value,l=s(n,e,u,i,h,r,c,o);f.setContent(l.outerHTML);f.open(t,this);GoogleMap.panMap(t)}));t.fitBounds(u)}c=document.querySelectorAll("input[id^=repeatedLoc_]");c&&c.length>0&&c.forEach(function(i){var a,e,o,p,v,w;if(n=i.value.split(","),n.length>=1){for(a="",e="",o=0;o<n.length;o++){var r=document.getElementById(n[o]),y=r.querySelector("#reference").value,tt=r.querySelector("#address").value,b=r.querySelector("#price").value,k=r.querySelector("#nature").value,it=r.querySelector("#description").value,v=r.querySelector("#image").value,d=r.querySelector("#url").value,g=r.querySelector("#location").value,nt=r.querySelector("#id").value;e+=y+",";p=s(r,v,k,y,g,b,nt,d);a+=p.outerHTML}var h=document.getElementById(n[0]),c=null,l=null;h!=null&&(c=h.childNodes[19].defaultValue,l=h.childNodes[21].defaultValue);c!=0&&l!=0&&h!=null&&(u.extend(new google.maps.LatLng(c,l)),v=document.getElementById("marker-img").value,w=new google.maps.Marker({animation:google.maps.Animation.DROP,position:{lat:Number(c),lng:Number(l)},map:t,title:""+e.slice(0,e.length-1)+"",id:""+n[0]+"",icon:v}),w.addListener("click",function(){f.setContent(a);f.open(t,this);GoogleMap.panMap(t)}));t.fitBounds(u)}})}},searchByPolygon:function(n,t){Search.fullSearch(n,t)}}}(),GoogleSync=function(){return{popup:function(n,t,i,r){if(r)ajaxRequest(n,t,"GET",i,function(){switch(parseInt(r,10)){case 1:$.getScript("https://apis.google.com/js/platform.js?onload=renderBtnContacts");break;case 2:$.getScript("https://apis.google.com/js/platform.js?onload=renderBtnCalendar")}$.getScript("https://apis.google.com/js/api.js")});else return},loadYoutube:function(){$.getScript("https://apis.google.com/js/platform.js?onload=renderBtnYouTube")},getAccessToken:function(){var i,r,u,n,f,e,t,o;if(gapi&&gapi.auth2){if(i=gapi.auth2.getAuthInstance().currentUser.get(),r="",i)for(u=Object.values(i),n=0;n<u.length;n++)for(f=u[n],e=Object.keys(f),t=0;t<e.length;t++)if(o=e[t],o=="access_token"){r=f[o];break}return r}},getIdToken:function(){var i,r,u,n,f,e,t,o;if(gapi&&gapi.auth2){if(i=gapi.auth2.getAuthInstance().currentUser.get(),r="",i)for(u=Object.values(i),n=0;n<u.length;n++)for(f=u[n],e=Object.keys(f),t=0;t<e.length;t++)if(o=e[t],o=="id_token"){r=f[o];break}return r}},getConnectionsSpecificGroup:function(n,t){var i=$("#grpid").val(),r;gapi&&gapi.auth2&&i!=null&&i!=undefined&&(r=GoogleSync.getAccessToken(),ajaxRequest(n,t,"POST",Requests.get(Requests.keys.GoogleResourceName)+"="+i+"&"+Requests.get(Requests.keys.GoogleAccessToken)+"="+r))},googleSignOut:function(){var n=gapi.auth2.getAuthInstance();n.signOut().then(function(){Popup.close()})},youtubeSignOut:function(){var n=gapi.auth2.getAuthInstance();n.signOut().then(function(){n.disconnect()})},syncTasks:function(n,t,i){var u,r;gapi&&gapi.auth2&&(u=GoogleSync.getAccessToken(),u&&(r=$("#googleAuth").find("*").serializeAll(),i&&(r+="&"+i),r+="&"+Requests.get(Requests.keys.GoogleAccessToken)+"="+u,ajaxRequest(n,t,"POST",r)))}}}();var Visits=function(){var n=null;return{edit:function(n,t,i){ajaxRequest(n,t,"GET",i)},contactEditMode:function(n){var t=n.up(".col-3");n.hide();$(t).find(".visitReviewDisplay").length==1&&$(t).find(".visitReviewDisplay").hide();$(t).find(".visitReviewEdit").each(function(){$(t).find(".visitReviewEdit").show()})},save:function(n,t,i){var r=document.getElementById("RefreshListUrl").value,u=document.getElementById("RefreshListParameters").value;ajaxRequest(n,t,"POST",$("#popupMediaExporter :input").serializeAll()+"&"+i,function(n){n.status==1&&(n.data&&n.data.html&&n.data.preview&&n.data.preview==1?EgoPrinter.printHtml(n.data.html,{inheritCSS:!1}):n.data&&n.data.email&&n.data.email==1?Email.popup(null,n.data.actionUrl,n.data.parameters):n.data&&n.data.justSave&&n.data.justSave==1&&Popup.close(),Visits.refreshList(r,u))})},addSummary:function(n){n.style.display="none";n.up(".contentHeader").querySelector(".addCheckBoxLine").style.display="block"},saveSummary:function(n,t,i){var r=$(n.up(".contentHeader")).find("input, select").serializeAll();ajaxRequest(n,t,"POST",r+"&"+i,function(){})},cancelSummary:function(n){n.up(".addCheckBoxLine").querySelector("#inputSummaryName").value="";n.up(".addCheckBoxLine").style.display="none";n.up(".contentHeader").querySelector(".addCheckBoxLineBtn").style.display=""},openSignaturePopup:function(n,t,i,r){ajaxRequest(n,t,"GET",Requests.get(Requests.keys.VisitFileID)+"="+i+"&"+Requests.get(Requests.keys.TypeID)+"="+r,function(){Visits.renderSignaturePad()})},renderSignaturePad:function(){var t=document.getElementById("SignaturePad");n=new SignaturePad(t,{backgroundColor:"rgba(255, 255, 255, 0)",penColor:"rgb(0, 0, 0)"});Visits.resizeSignaturePad();EventHandler.addListener(window,"resize",Visits.resizeSignaturePad)},resizeSignaturePad:function(){var t=document.getElementById("SignaturePad"),i=Math.max(window.devicePixelRatio||1,1);t.width=t.offsetWidth*i;t.height=t.offsetHeight*i;t.getContext("2d").scale(i,i);n.clear()},clearSignaturePad:function(){n.clear()},saveSignaturePad:function(t,i,r,u,f){n.isEmpty()?alert(f):ajaxRequest(t,i,"POST",Requests.get(Requests.keys.VisitFileID)+"="+r+"&"+Requests.get(Requests.keys.TypeID)+"="+u+"&base64="+encodeURIComponent(n.toDataURL()),function(){Popup.close()})},removeSignature:function(n,t,i,r){ajaxRequest(n,t,"POST",Requests.get(Requests.keys.VisitFileID)+"="+i+"&"+Requests.get(Requests.keys.TypeID)+"="+r,function(){})},setVisitFileStatus:function(n,t){var i=document.getElementById("statusArea");i.querySelectorAll(".visitStatus").forEach(function(t){n!=t&&(t.classList.remove("active"),t.innerHTML=t.getAttribute("data-inactive"))});n.classList.contains("active")?(n.classList.remove("active"),i.querySelector("#hVisitStatus").value="0",n.innerHTML=n.getAttribute("data-inactive")):(n.classList.add("active"),i.querySelector("#hVisitStatus").value=t,n.innerHTML=n.getAttribute("data-active"))},refreshList:function(n,t){ajaxRequest(null,n,"GET",t,function(){})},toggleFooterActions:function(){var n=$("#footerActions");n&&(n.is(":visible")?n.hide():n.show())},sendVisits:function(n,t,i){ajaxRequest(n,t,"GET",i,function(n){n.status==1&&isObject(n.data)&&n.data.url&&n.data.parameters&&Email.popup("",n.data.url,n.data.parameters)})},printVisitFile:function(n,t,i){ajaxRequest(n,t,"GET",Requests.getPair(Requests.keys.VisitFileID,i),function(n){n.status==ajaxRequest.StatusType.Success&&n.data&&n.data.html&&n.data.preview&&n.data.preview==1&&EgoPrinter.printHtml(n.data.html,{inheritCSS:!0})})}}}(),RoadMap=function(){return{editPopup:function(n,t,i){ajaxRequest(n,t,"GET",i,function(n){var r,u,t,i;n.status==ajaxRequest.StatusType.Success&&n.popupContent&&(r=Popup.current(),u=r.querySelector("#RoadMapDate").up(".CalendarDate"),u.querySelector(".CalendarBtn").click(),u.show(),t=$(r.querySelector(".chooseTime")),i=$(t[0].querySelector(".NewEvent")),i.is(":visible")&&t.scrollTop(t.scrollTop()+i.position().top-t.height()/2+i.height()/2))})},otherRealestatesPopup:function(n,t,i,r,u){var o=document.getElementById("RoadMapEditPopup"),e=[],f;$("#ListRealestatesToVisit").find(".contentListItem").each(function(n,t){e.push(t.id)});f=[];f.push(Requests.get(Requests.keys.ObjectID)+"="+o.querySelector("#ObjAssociatedID").value);f.push(Requests.get(Requests.keys.SimplifiedContext)+"="+i);f.push(Requests.get(Requests.keys.SelectedIDs)+"="+e.join(","));u&&f.push(u);Search.Simplified.open(n,t,f.join("&"),null,"POST",{popupOptions:new Popup.LayerOptions(null,null,null,function(){var n=Search.Simplified.getCurrentSelected(),t=appendStringParams($("#RoadMapEditPopup .PrivateData *").serializeAll(),Requests.getPair(Requests.keys.ObjectIDs,n.join(",")));ajaxRequest(null,r,"GET",t)})})},cancelSelection:function(n){var i=n.up(".contentListItem"),t=$(i).clone(),r=n.up("#ListRealestatesToVisit"),u=n.up("#ListAssociatedRealestates");return $(i).fadeOut("slow",function(){$(i).remove();r?($(t).hide(),$(t).find(".activateBtn").removeClass("active"),$("#ListAssociatedRealestates").append(t),$(t).fadeIn("slow")):u&&($(t).hide(),$(t).find(".activateBtn").addClass("active"),$("#ListRealestatesToVisit").append(t),$(t).fadeIn("slow"));$("#ListRealestatesToVisit").find(".contentListItem ").length==0?$(".NoRoadMapRealestates").show():$(".NoRoadMapRealestates").hide();RoadMap.updateInputSelectedItems()}),!1},updateInputSelectedItems:function(){var t=$("#ListRealestatesToVisit").find(".contentListItem"),n=[];t&&t.length>0&&t.each(function(t,i){n.push($(i).attr("id"))});n&&n.length>0?$("#SelectedIDs").val(n.join(",")):$("#SelectedIDs").val("")},toggleAssociateAndVisit:function(n,t){n&&!n.classList.contains("active")&&Search.Simplified.itemClick(n,t)},contactEditMode:function(n){var t=n.up(".col-3");n.hide();$(t).find("#defaultResponsibleView").hide();$(t).find("#editableResponsibleView").show()},getSelectedEstates:function(n){var t=[];return n.querySelector(".RoadMapRealestates").querySelectorAll(".contentListItem").forEach(function(n){t.push(n.getAttribute("id"))}),t.join(",")},updatePopupItem:function(n){var r=document.getElementById("RoadMapItemPopup"),t,i;r&&(t=r.querySelector(".RoadMapItem"),i=n.querySelector(".RoadMapItem[id="+t.getAttribute("id")+"]"),i?(t.innerHTML=i.innerHTML,t.querySelector("#roadMapActions").hide()):Popup.close())},updateSummary:function(){var n=document.getElementById("VisitSummary"),t;n&&(t=$(n).find("*").serializeAll(),ajaxRequest(n,n.getAttribute("data-actionurl"),t))},save:function(n,t){var i=n.up(".PopupContext"),r=$(n.up("#RoadMapEditPopup")).find("*").serializeArray(),u,f,e;if(updateParams(r,Requests.get(Requests.keys.DateEndHour),i.querySelector("#taskEndHour").value),updateParams(r,Requests.get(Requests.keys.DateEndMin),i.querySelector("#taskEndMin").value),u=RoadMap.getSelectedEstates(i),u.trim().length<=0)return MessageBox.confirm(Translations.get(Translations.keys.RoadMapNoSelection),Translations.get(Translations.keys.SolveProblem),null,Translations.get(Translations.keys.ErrorSavingRoadMap),Translations.get(Translations.keys.Cancel),null,!0),!1;updateParams(r,Requests.get(Requests.keys.CurrentSelection),u);f=document.getElementById("RefreshListUrl").value;e=document.getElementById("RefreshListParameters").value;ajaxRequest(n,t,"POST",r,function(n){var r=i.querySelector("#PopupNotifyURL").value,u=i.querySelector("#ObjAssociatedID").value,t=parseInt(i.querySelector("#ObjRoadMapID").value),o=i.querySelector("#NotifyPopupContext").value;t||(t=i.querySelector("#ObjRoadMapID").value=n.status===ajaxRequest.StatusType.Success&&isObject(n.data)&&n.data.savedRoadMapID||0);Popup.registerCallbacks(new Popup.LayerOptions(null,null,null,function(){var s=document.getElementById("taskTab"),i;s&&(Tabs.ajaxReset(s),Associated.Task.initializePage(),Associated.Task.updateSummary());i=document.getElementById("visitsTab");i&&(RoadMap.updatePopupItem(i),RoadMap.updateSummary());Visits.refreshList(f,e);document.querySelector("[id^=ContentVisits_]")&&isObject(n.data)&&n.data.url!==""&&Realestate.loadCustomObjects(n.data.url);RoadMap.notifyPopUp(r,u,t,o)}),0);Popup.close()})},notifyPopUp:function(n,t,i,r){var u={};u[Requests.get(Requests.keys.LeadID)]=t;u[Requests.get(Requests.keys.RoadMapID)]=i;u[Requests.get(Requests.keys.CheckAppConfiguration)]=0;u[Requests.get(Requests.keys.Context)]=r;ajaxRequest(null,n,"GET",u)},sendNotifyEmail:function(n,t){var i=$(n.up("#RoadMapNotifyPopup")).find("*").serializeAll();ajaxRequest(n,t,"POST",i)},openDelete:function(n,t,i){ajaxRequest(n,t,"POST",Requests.getPair(Requests.keys.RoadMapID,i))},"delete":function(n,t,i){ajaxRequest(n,t,"POST",Requests.getPair(Requests.keys.RoadMapID,i));var r=document.getElementById("taskTab");r&&Tabs.ajaxReset(r)}}}(),DailyTask=function(){return{setCalendarTime:function(n,t,i,r){var e=t+1,v=i,y=-1,o=-1,s=-1,h="",u,f,p,c,l,a;(r&&(y=r.indexOf(":"),o=r.indexOf("a"),s=r.indexOf("p"),o>-1?h=" "+r.substring(o):s>-1&&(h=" "+r.substring(s))),(o>-1||s>-1)&&t==12&&(e=1),t==23&&(e=0),u=n.up(".PopupContext"),u)&&(f=n.up(".DailyTaskContainer").querySelector(".NewEvent"),f&&n==f.up(".timeDiv")?(c=$("#templateClone").clone(),l=c[0].innerHTML.replace(/\[hour]/g,0).replace(/\[minute]/g,0).replace(/\[timeOfDay]/g,"00:00"),$(f).remove(),e=1,v=0,p=$(".timeDiv:first"),$(p).replaceWith(l),a=h==""?"00:00":r,$("#editableHour").html(", "+a)):(c=$("#templateClone").clone(),l=c[0].innerHTML.replace(/\[hour]/g,t).replace(/\[minute]/g,i).replace(/\[timeOfDay]/g,r),$(f).remove(),$(n).replaceWith(l),a=i==0?r:r.substring(0,y+1)+""+i+h,$("#editableHour").html(", "+a)),u.querySelector("#RoadMapStartHour").value=t,u.querySelector("#RoadMapStartMinute").value=i,u.querySelector("#taskEndHour").value=e,u.querySelector("#taskEndMin").value=v,u.querySelectorAll("input[type=hidden].CalendarDateVal").forEach(function(n){n.CalendarDate&&n.CalendarDate.setTime(t,i)}),u.querySelector("#dropdownsEndTime").show())},openTask:function(n,t){window.open(t);stopEventPropagation(n)},lastDailyTaskDate:"",refresh:function(n,t){var f=t.up(".PopupContext"),i=null,r,e,o,u;(f&&(i=f.querySelector(".DailyTaskContainer")),i)&&(r=n.toString("yyyy-MM-dd"),e=i.querySelector(".chooseTime").scrollTop,r!=DailyTask.lastDailyTaskDate&&("RoadMap"in window&&(RoadMap.lastDailyTaskDate=r),DailyTask.lastDailyTaskDate=r,o=i.getAttribute("data-reloadActionUrl"),u=$(i).find(".PrivateData *").serializeArray(),u=updateParams(u,Requests.get(Requests.keys.Date),n.toString("yyyy-MM-dd hh:mm")),ajaxRequest(null,o,"GET",u,function(n){if(n.status==ajaxRequest.StatusType.Success){var t=f.querySelector(".DailyTaskContainer .chooseTime");t&&(t.scrollTop=e)}})))},setAssignedUser:function(n,t){var r,i,u,f,e;t&&(r=n.up(".popupBox"),i=null,r&&(i=r.querySelector(".DailyTaskContainer")),i)&&(u=i.querySelector(".PrivateData"),u.querySelector("#UserID").value=t,f=i.getAttribute("data-reloadActionUrl"),e=$(u).find("*").serializeAll(),ajaxRequest(i,f,"GET",e))}}}(),Brochure=function(){return{openPopup:function(n,t,i,r){var u=r?r+"":Search.GenericList.getSelectedIDs(!0);if(!u){MessageBox.alert(Translations.get(Translations.keys.NoRealestateSelected));return}if(u.split(",").length>1){MessageBox.alert(Translations.get(Translations.keys.SelectOnePropertyOnly));return}ajaxRequest(n,t,"GET",Requests.get(Requests.keys.ObjectIDs)+"="+u+"&ForPrint="+(i?"1":"0"))},chooseImage:function(n){var t=$(n).closest(".popupContent"),r=$(n).closest(".templateItem"),i=t.find(".actionBtn");t.find(".templateItem").each(function(){$(this)[r.is(this)?"toggleClass":"removeClass"]("active")});t.find(".templateItem.active").length?i.removeClass("disabled"):i.addClass("disabled")},chooseTemplate:function(n){if(n)if($(n).parent().toggleClass("active"),$(".singleImageSelect > .templateItem").not($(n).parent()).removeClass("active"),$(".singleImageSelect").find(".active").length==0)$("#PersonalizeBrochure").hasClass("disabled")||$("#PersonalizeBrochure").addClass("disabled"),$("#secondary_lng").hide();else{var t=$(n).parent().attr("id");t.match(/[\w\d]+ML$/g)?$("#secondary_lng").show():$("#secondary_lng").hide();$("#PersonalizeBrochure").removeClass("disabled")}},getTemplates:function(n,t,i){if(!$(n).hasClass("disabled")){if($(".multipleImageSelect > .active").length==0&&!i){MessageBox.alert(Translations.get(Translations.keys.FacebookNoImageSelected));return}var u=$(n).closest("#popupMediaExporter"),r=u.find("input").serializeAll();r+="&selectedTemplate="+i;r+="&categoryid="+u.find(".templateItem.active").data("value");ajaxRequest(n,t,"GET",r)}},backToFirstStep:function(n,t,i){ajaxRequest(n,t,"GET",i,function(){})},rasterize:function(n,t,i){Loading.show();i||(i=$(n).closest(".popupContent").find(":input").serializeAll());ajaxRequest(n,t,"GET",i+"&"+dataSerializer(".singleImageSelect",".active","data-name","data-value"),function(n){$("#popupMediaExporter .SaveBtn").length&&($("#popupMediaExporter .SaveBtn, #popupMediaExporter .CancelBtn").show(),$("#popupMediaExporter .CloseBtn").hide());n.data&&(Brochure.Editor.ignoreMLS=n.data.ignoreMLS);setTimeout(Brochure.Editor.loadCanvas,1)})},changeTemplate:function(n,t,i){var r=$(n).closest("#popupMediaExporter"),u=r.find("input").serializeAll();ajaxRequest(n,t,"GET",u,function(){i&&r.find("#"+i+"> a").trigger("click");r.find(".SaveBtn, .CancelBtn").hide();r.find(".CloseBtn").show()})},chooseBrochureToDownload:function(n){var t=$(n).closest(".popupBox"),r=$(n).closest(".templateItem"),i=t.find(".next");t.find(".templateItem").each(function(){$(this)[r.is(this)?"toggleClass":"removeClass"]("active")});t.find(".templateItem.active").length?i.removeClass("disabled"):i.addClass("disabled")}}}();Brochure.Editor=function(){var n=null,t=null,u=function(){Brochure.Editor._oRasterize=null;var n=$("#popupMediaExporter"),t=n.find("input").serializeAll();t+=Brochure.Editor.ignoreMLS?"&action=9":"&action=4";$.ajax(n.find(".flyerEditor").data("grabber-endpoint"),{data:t,method:"POST",async:!1,success:function(n){n&&(n.success&&(eval("Brochure.Editor._oRasterize = "+n.renderAreas),r()),n.message&&MessageBox.alert(n.message))},error:function(n){n&&n.status==0||MessageBox.alert(Translations.get(Translations.keys.GenericError))},complete:function(){Loading.hide()}})},r=function(){var r,e,i,t,o;if(n=[],r=$("#oCanvas"),r.find(".ui-draggable").draggable("destroy"),r.children().remove(),!Brochure.Editor._oRasterize||!Brochure.Editor._oRasterize.items)return!1;var u=Brochure.Editor._oRasterize.items.sort(function(n,t){return t.layer-n.layer}),f=u.find(function(n){return n.background}),s=r.width();for(nRat=s/f.size.width,e=f.size.height*nRat,r.css({height:e+"px"}),r.append('<img src="'+f.src+'" style="width:'+s+"px;height:"+e+'px;position:absolute;top:0px;left:0px" />'),i=0;i<u.length;i++)if(oArea=u[i],!oArea.background){var c=parseInt(oArea.size.width*nRat),h=parseInt(oArea.size.height*nRat),l=parseInt(oArea.position.y*nRat),a=parseInt(oArea.position.x*nRat);if(oArea.id=oArea.id!=null&&oArea.id!=""?" -ego-id-"+oArea.id:"",oArea.classaction=oArea.classaction!=null&&oArea.classaction!=""?" -egoaction-"+oArea.classaction:"",t=$('<div id="Asset_'+i+'" binder="'+oArea.name+'" class="BRenderAsset'+oArea.id+oArea.classaction+'"><\/div>'),t.css({width:c+"px",height:h+"px",top:l+"px",left:a+"px",zIndex:(i+1)*10}),oArea.resizable?(t.attr("data-ratio",Math.round(oArea.size.width/oArea.size.height*100)/100),t.html('<img id="img_'+i+'" src="'+oArea.src+'"/><span class="BrBox tl" data-coord-type="tl"><\/span><span class="BrBox l" data-coord-type="l"><\/span><span class="BrBox bl" data-coord-type="bl"><\/span><span class="BrBox tr" data-coord-type="tr"><\/span><span class="BrBox r" data-coord-type="r"><\/span><span class="BrBox br"><\/span><span class="BrBox t" data-coord-type="t"><\/span><span class="BrBox b" data-coord-type="b"><\/span>')):t.html('<img id="img_'+i+'" src="'+oArea.src+'"/>'),oArea.text){t.attr("istext","true");t.append('<span class="img edit" style="cursor:pointer;float:right;display:none;position:relative;top:-'+h+'px"><\/span>');t.find("span.img.edit").on("click",function(){var t=$(this).closest(".BRenderAsset").attr("binder"),n=Brochure.Editor._oRasterize.items.find(function(n){return n.name==t});n&&Brochure.StringEditor.show(n)})}n.push(t);r.append(t);t.off("mouseover").on("mouseover",function(){var n=$(this).closest(".BRenderAsset");n.addClass("BRenderAssetHover");n.find("span.edit").show()});t.off("mouseout").on("mouseout",function(){var n=$(this).closest(".BRenderAsset");n.removeClass("BRenderAssetHover");n.find("span.edit").hide()});o=t.find("img")[0];oArea.borderRadius>0&&(o.style.borderRadius=oArea.borderRadius+"px");$(o).draggable({start:function(){var n=$(this).closest(".BRenderAsset");n.removeClass("BRenderAssetHover").addClass("Dragging");n.find("span.edit").hide()},stop:function(){var s=$("#oCanvas"),t=$(this),n=t.closest(".BRenderAsset"),i=parseInt(t.css("top")),r=parseInt(t.css("left")),u=parseInt(n.css("top")),f=parseInt(n.css("left")),e=u+i,o=f+r;n.css({top:e+"px",left:o+"px"});t.css({top:"0px",left:"0px"});n.addClass("BRenderAssetHover").removeClass("Dragging");n.find("span.edit").show()}});oArea.resizable&&Brochure.Editor.resizeAsset.bind($("#img_"+i)[0])()}$(document.body).off("mousedown").on("mousedown",function(n){var i=$(n.target);if(i.hasClass("BrBox")){var t=i.closest(".BRenderAsset"),r=parseInt(t.width()),u=parseInt(t.height());t.addClass("Resizing");t.attr("data-ratio",Math.round(r/u*100)/100);Brochure.Editor.__mousePos={x:n.clientX,y:n.clientY};Brochure.Editor.__activeCoord=i.attr("data-coord-type");$(document.body).on("mousemove",Brochure.Editor.resizeAsset.bind(n.target))}});$(document.body).on("mouseup",function(){$(document.body).off("mousemove");$(".Resizing").removeClass("Resizing");Brochure.Editor.__activeCoord=null});$(document.body).on("keydown",function(n){n.shiftKey&&(!Brochure.Editor.__activeCoord||Brochure.Editor.__activeCoord=="tl"||Brochure.Editor.__activeCoord=="tr"||Brochure.Editor.__activeCoord=="bl"||Brochure.Editor.__activeCoord=="br")&&(Brochure.Editor._resizeWithRatio=!0,$("#oCanvas").addClass("RatioResize"))});$(document.body).on("keyup",function(){Brochure.Editor._resizeWithRatio=!1;$("#oCanvas").removeClass("RatioResize")});document.documentElement.onselectstart=function(){return!1}},f=function(n){var o=$(this),i=o.closest(".BRenderAsset"),y,f;n&&i.length&&i.attr("istext")&&(i.addClass("loadingLarge"),i.find("span.edit").hide(),i.find("img").css("opacity",0),clearTimeout(Brochure.Editor._timerFunc));var w=$("#oCanvas"),b=w.position(),h=i.offset(),c=parseInt(i.width()),e=parseInt(i.height()),p=parseInt(i.css("top")),v=parseInt(i.css("left")),s=c,r=e,l=p,a=v,f=s,u=r,t;Brochure.Editor._resizeWithRatio&&i.attr("data-ratio")?(y=parseFloat(i.attr("data-ratio")),o.hasClass("tl")?(t=n.clientY-Brochure.Editor.__mousePos.y,l=p+t,u=e-t,f=Math.round(e*y),a=v-(f-s)):o.hasClass("br")?(r=r+h.top,u=e+(n.clientY-r),f=Math.round(u*y)):o.hasClass("tr")?(r=e,t=n.clientY-Brochure.Editor.__mousePos.y,u=e-t,l=parseInt(i[0].style.top)+t,f=Math.round(u*y)):o.hasClass("bl")&&(r=r+h.top,u=e+(n.clientY-r),f=Math.round(u*y),a=v-(f-s))):o.hasClass("tl")?(t=n.clientX-Brochure.Editor.__mousePos.x,a=v+t,f=c-t,t=n.clientY-Brochure.Editor.__mousePos.y,l=p+t,u=e-t):o.hasClass("l")?(t=n.clientX-Brochure.Editor.__mousePos.x,a=v+t,f=c-t):o.hasClass("t")?(t=n.clientY-Brochure.Editor.__mousePos.y,l=p+t,u=e-t):o.hasClass("b")?(r=r+h.top,u=e+(n.clientY-r)):o.hasClass("r")?(s=h.left+s,f=c+(n.clientX-s)):o.hasClass("br")?(r=r+h.top,s=s+h.left,f=c+(n.clientX-s),u=e+(n.clientY-r)):o.hasClass("tr")?(r=e,t=n.clientY-Brochure.Editor.__mousePos.y,s=s+h.left,f=c+(n.clientX-s),l=parseInt(i[0].style.top)+t,u=e-t):o.hasClass("bl")&&(s=c,t=n.clientX-Brochure.Editor.__mousePos.x,a=parseInt(i[0].style.left)+t,f=c-t,r=r+h.top,u=e+(n.clientY-r));f=Math.max(10,f);u=Math.max(10,u);i.css({width:f+"px",height:u+"px",top:l+"px",left:a+"px"});n&&(Brochure.Editor.__mousePos={x:n.clientX,y:n.clientY},i.attr("istext")&&(Brochure.Editor._timerFunc=setTimeout(Brochure.Editor.redrawTextString.bind(null,i[0]),500)))},e=function(n){i(n).then(function(n){n.url&&(t.url=n.url,window.open(n.url,null,"width="+$(window).width()+", height="+$(window).height()))})},o=function(n){i(n,"&print=true").then(function(i){var e;if(i.url){t.url=i.url;var r=$(n).closest("#popupMediaExporter").find("input[name=template]").val(),s=i.url,l="293mm",a="416mm",h="206mm",c="293mm",o=0,u=h,f=c;r&&((r.match(/A3H/ig)||r.match(/A4H/ig))&&(o=1),r.match(/A3H/ig)||r.match(/A3V/ig)?(u=l,f=a):r.match(/A4H/ig)||r.match(/A4V/ig)?(u=h,f=c):s&&(e=new Image,e.src=s,e.onload=function(){switch(e.naturalWidth+"x"+e.naturalHeight){case"1490x1054":case"4961x3508":o=1;case"1754x2480":case"2540x3508":u=l;f=a;break;case"1754x1270":case"3508x2400":o=1;case"1240x1754":case"2480x3508":u=h;f=c;break;default:u=h;f=c;e.width>e.height&&(o=1)}EgoPrinter.printHtml('<img src="'+s+'" style="height:100%; width:100%;" />',{paperSize:{width:u,height:f},orientation:o})}),EgoPrinter.printHtml('<img src="'+s+'" style="height:100%; width:100%;" />',{paperSize:{width:u,height:f},orientation:o}))}})},i=function(i,r){var o=$.Deferred(),f,u,e;if(i.getAttribute("ajaxRequest")=="true"){MessageBox.alert(Translations.get(Translations.keys.CurrentlyUploadingFile));return}return!n||n.length==0?(MessageBox.alert(Translations.get(Translations.keys.BrochureNoRasterize)),!1):(f=$("#popupMediaExporter"),u=f.find("input").serializeAll(),u+="&action=5",t&&t.url&&(u+="&oldpreview="+t.url),e=[],n.forEach(function(n){var t=parseInt(n.width()),i=parseInt(n.height()),r=parseInt(n[0].style.left),u=parseInt(n[0].style.top),f=n.attr("binder")+":"+t/nRat+"x"+i/nRat+"|"+r/nRat+"x"+u/nRat;e.push(f)}),Brochure.Editor._oRasterize.items.forEach(function(n){u+="&"+n.name+"_text="+(n.text?encodeURIComponent(encodeURIComponent(n.text)):"");u+="&"+n.name+"_format="+(n.textFormat?JSON.stringify(n.textFormat):"")}),u+="&sOldRast="+Brochure.Editor._oRasterize.id,u+="&updates="+e.join(";"),r&&(u+=r),$.ajax(f.find(".flyerEditor").data("grabber-endpoint"),{data:u,method:"POST",async:!1,success:function(n){n&&(n.success==1&&(t={url:n.url},o.resolve(n)),n.message&&MessageBox.alert(n.message))},error:function(n){n&&n.status==0||MessageBox.alert(Translations.get(Translations.keys.GenericError))},complete:function(){}}),o)},s=function(t){var u=Brochure.Editor._oRasterize.items.find(function(n){return n.name==t.getAttribute("binder")}),r=$(t),f=r.width(),e=r.height(),o=parseInt(t.style.left),s=parseInt(t.style.top),c=u.text,h=$("#popupMediaExporter"),i=h.find("input").serializeAll();i+="&action=6";i+="&text="+encodeURIComponent(c);i+="&asset="+/\/([^/]+)\.\w+$/ig.exec(u.src)[1];i+="&curr_rast="+Brochure.Editor._oRasterize.id;i+="&key="+u.name;i+="&text_format="+JSON.stringify(u.textFormat);i+="&size="+f/nRat+"x"+e/nRat;i+="&location="+o/nRat+"x"+s/nRat;$.ajax(h.find(".flyerEditor").data("grabber-endpoint"),{data:i,method:"POST",async:!1,success:function(i){if(i&&(i.message&&MessageBox.alert(i.message),i.success)){var u=n.find(function(n){return n.attr("binder")==t.getAttribute("binder")}).find("img:first");u.on("load",function(){$(this).off("load");$(this).off("error");$(this).closest(".BRenderAsset").find("span.edit:first").css({top:"-"+$(this).height()+"px"})});u.on("error",function(){$(this).off("load");$(this).off("error")});u.attr("src",u.attr("src").replace(/\?+.?$/ig,"")+"?r="+(new Date).valueOf());r.css({width:f+"px",height:e+"px",top:s+"px",left:o+"px"});r.removeClass("loadingLarge");r.find("span.edit").show();r.find("img").css("opacity",1)}},error:function(n){n&&n.status==0||MessageBox.alert(Translations.get(Translations.keys.GenericError))},complete:function(){}})},h=function(n,t){i(n,"&save=true").then(function(i){var u=$(n).closest("#popupMediaExporter"),r=u.find("input").serializeAll();r+="&"+Requests.get(Requests.keys.MediaJSON)+"="+encodeURIComponent(JSON.stringify(i.media));i.media?ajaxRequest(n,t,"POST",r,function(n){n.status==1&&(Realestate.loadSlideShowDetail(),Popup.close())}):i.message&&MessageBox.alert(i.message)})};return{__activeCoord:null,__mousePos:null,_resizeWithRatio:!1,_timerFunc:0,loadCanvas:u,resizeAsset:f,refreshEditor:r,preview:e,print:o,redrawTextString:s,save:h,_oRasterize:null,getAssets:function(){return n}}}();Brochure.StringEditor=function(){var n=function(n){var t,r,i;this.currEditObj=n;t=$("#oStringEditor");r=t.find("textarea:first");r[0].value=n.text;i=this;t.find(".toolbar>.tecontrol").each(function(){var t=$(this),r=t.attr("formatprop"),u=t.attr("formatval");r!="align"&&n.textFormat[r]||r=="align"&&u==n.textFormat[r]?t.css({backgroundColor:"#FFF"}):t.css({backgroundColor:""});t.off("click").on("click",Brochure.StringEditor.setFormat.bind(i))});t.find(".toolbar>select").each(function(){var t=$(this),r=t.attr("formatprop");t.val(n.textFormat[r]);t.off("change").on("change",Brochure.StringEditor.setFormat.bind(i))});t.find(".toolbar>.tecustomcontrol").each(function(){var n=$(this),u=n.attr("formatprop"),f=n.attr("formatval"),t,r;u=="foreColor"&&(t=i.currEditObj.textFormat.foreColor,r=[t.r.toString(16),t.g.toString(16),t.b.toString(16)],r="#"+r.map(function(n){return n.length==1?"0"+n:n}).join(""),n.find("#oColorPicker").off("change").on("change",function(){var t=this.value,n={r:0,g:0,b:0};/^#([A-Fa-f0-9]{3}){1,2}$/.test(t)&&(n=t.substring(1).split(""),n.length==3&&(n=[n[0],n[0],n[1],n[1],n[2],n[2]]),n="0x"+n.join(""),n={r:n>>16&255,g:n>>8&255,b:n&255});i.currEditObj.textFormat.foreColor=n;i.previewFormat()}).val(r));n.off("click").on("click",Brochure.StringEditor.setFormat.bind(i))});this.previewFormat();t.css({top:window.innerHeight/2-100});t.show();r.focus()},t=function(n){var t=$(n.target),i=t.attr("formatprop");t[0].tagName=="DIV"?i=="align"?(t.parent().find(".tecontrol[formatprop=align]").css({backgroundColor:""}),t.css({backgroundColor:"#FFF"}),this.currEditObj.textFormat[i]=t.attr("formatval")):i=="foreColor"&&this.__cp_Handle?$("oEditPick").trigger("click"):(this.currEditObj.textFormat[i]=!this.currEditObj.textFormat[i],this.currEditObj.textFormat[i]?t.css({backgroundColor:"#FFF"}):t.css({backgroundColor:""})):this.currEditObj.textFormat[i]=t.val();this.previewFormat()},i=function(){var t=this.currEditObj.textFormat,n={},r,i;n.textAlign=t.align;n.fontSize=t.fontSize+"pt";n.fontFamily=t.fontName;r=this.currEditObj.textFormat.foreColor;i=[r.r.toString(16),r.g.toString(16),r.b.toString(16)].map(function(n){return n.length==1?"0"+n:n}).join("");i="#"+i;n.color=i;n.backgroundColor=i.match(/FFFFFF/i)?"#ECECEC":"#FFFFFF";n.fontWeight=t.bold?"bold":"normal";n.fontStyle=t.italic?"italic":"normal";n.textDecoration="";t.strike&&(n.textDecoration="line-through");t.underline&&(n.textDecoration+=" underline");$("#oStringEditor").find("textarea:first").css(n);$("#oStringEditor").find("textarea:first").parent().css({backgroundColor:n.backgroundColor})},r=function(n){var e=$(n).closest("#popupMediaExporter"),r=$('div[Binder="'+this.currEditObj.name+'"]')[0],o=parseInt($(r).width()),s=parseInt($(r).height()),h=parseInt(r.style.left),c=parseInt(r.style.top),f=$("#oStringEditor").find("textarea:first")[0].value,t={},u,i;t.action=6;t.text=encodeURIComponent(f);t.asset=/\/([^/]+)\.\w+$/ig.exec(this.currEditObj.src)[1];t.curr_rast=Brochure.Editor._oRasterize.id;t.key=this.currEditObj.name;t.text_format=JSON.stringify(this.currEditObj.textFormat);t.size=o/nRat+"x"+s/nRat;t.location=h/nRat+"x"+c/nRat;t.secTkn=$("input[name=secTkn]").val();t.appid=$("input[name=appid]").val();t.BrochureID=$("input[name=BrochureID]").val();Brochure._nBrochureID!=null?t.nEditBrochureID=Brochure._nBrochureID:(t.categoryID=$("input[name=CategoryID]").val(),t.template=$("input[name=template]").val(),t.lng=$("input[name=lng]").val(),t.sec_lng=$("input[name=sec_lng]").val());$.ajax(e.find(".flyerEditor").data("grabber-endpoint"),{data:t,method:"POST",async:!1,success:function(n){if(n){if(n.message&&MessageBox.alert(n.message),n.success){Brochure.StringEditor.currEditObj.text=f;Brochure.StringEditor.currEditObj.textFormat.clientEdited=!0;var t=Brochure.Editor.getAssets().find(function(n){return n.attr("binder")==Brochure.StringEditor.currEditObj.name}).find("img:first");t.on("load",function(){$(this).off("load");$(this).off("error");$(this).parent().find("span.edit:first").css({top:"-"+$(this).height()+"px"})});t.on("error",function(){$(this).off("load");$(this).off("error")});t.css({height:"auto"});t.attr("src",t.attr("src").replace(/\?+.?$/ig,"")+"?r="+(new Date).valueOf())}Brochure.StringEditor.close()}},error:function(n){n&&n.status==0||MessageBox.alert(Translations.get(Translations.keys.GenericError))},complete:function(){}});r.className.indexOf("-egoaction-hideidifnull-")!==-1&&(u=r.className.match(/-egoaction-hideidifnull-(.{8})/),u[1]!=null&&$$(".-egoaction-id-"+u[1]).length>0&&(i=$(".-egoaction-id-"+u[1]),height=i.attr("data-egosave-height"),width=i.attr("data-egosave-width"),t.text==""&&((height!=="0px"||width!=="0px")&&(i.attr("data-egosave-height",i.height()),i.attr("data-egosave-width",i.width())),i.css({height:"0px"}),i.css({width:"0px"})),t.text!==""&&(height!==null||width!==null)&&(i.css({height:height}),i.css({width:width}))))},u=function(){$("#oStringEditor").find("textarea:first")[0].value="";this.currEditObj=null;this.__cp_Handle&&(this.__cp_Handle.hidePicker(),this.__cp_Handle=null);$("#oStringEditor").hide()};return{close:u,save:r,previewFormat:i,setFormat:t,show:n}}();Brochure.Print=function(){return{open:function(n,t,i){n&&t&&ajaxRequest(n,t,"GET",i)},printSelected:function(n){var u=n.up(".popupBox"),i,t,r;u&&(i=u.querySelector(".singleImageSelect"),i&&(t=i.querySelector(".templateItem.active"),t&&(r=t.getAttribute("data-download"),r&&Brochure.Print.print(r,t.getAttribute("data-templateName")))))},print:function(n,t){var s="293mm",h="416mm",e="206mm",o="293mm",f=0,i=e,r=o,u;t&&((t.match(/A3H/ig)||t.match(/A4H/ig))&&(f=1),t.match(/A3H/ig)||t.match(/A3V/ig)?(i=s,r=h):t.match(/A4H/ig)||t.match(/A4V/ig)?(i=e,r=o):n&&(u=new Image,u.src=n,u.onload=function(){switch(u.naturalWidth+"x"+u.naturalHeight){case"1490x1054":case"4961x3508":f=1;case"1754x2480":case"2540x3508":i=s;r=h;break;case"1754x1270":case"3508x2400":f=1;case"1240x1754":case"2480x3508":i=e;r=o;break;default:i=e;r=o;u.width>u.height&&(f=1)}EgoPrinter.printHtml('<img src="'+n+'" style="height:100%; width:100%;" />',{paperSize:{width:i,height:r},orientation:f})}),EgoPrinter.printHtml('<img src="'+n+'" style="height:100%; width:100%;" />',{paperSize:{width:i,height:r},orientation:f}))},downloadSelected:function(n){var t,i,r,u;n&&(t=n.up(".popupBox"),t&&(i=t.querySelector(".singleImageSelect"),i&&(r=i.querySelector(".templateItem.active"),r&&(u=r.getAttribute("data-download"),u&&window.open(u)))))}}}();Reports=function(){function r(n,t){var i="";return n&&"Search"in window&&isObject(Search.GenericList)&&(i=Search.GenericList.getAllIDs(n,t)),i}function u(n,t){var r=$(n.up(".ReportsContext")).find("#fObjectIDs *").serializeAll(),i;if(Array.isArray(t)&&t.length>0)for(i=0;i<t.length;i++)t[i]&&(r+=(r?"&":"")+t[i]);return r}function e(n){var r=document.getElementById("ReportsPopup"),i;r&&(i=r.querySelector("#ReportWizardBtn"),n?Element.addClassName(i,"disabled"):t<1&&Element.removeClassName(i,"disabled"))}function n(n){n?t++:(t--,t<0&&(t=0));e(n)}function i(t){if(t.status==ajaxRequest.StatusType.Success){var i=t.data||"";typeof i=="string"&&i.length>0&&(window.open(i),n(!1))}}var t=0,f={_isWarningActiveExport:!1,popup:function(n,t,i){ajaxRequest(n,t,"GET",i)},chooseType:function(n){n.up(".ReportOptions").querySelectorAll("label.checked").invoke("removeClassName","checked");n.up("label").addClassName("checked")},exec:function(t,f,e,o,s,h){var a=t.up(".ReportsContext"),v=a.querySelector("#rObjectIDs"),l,c,y,p;if(v.getAttribute("ajaxrequest"))return!1;l=a.querySelector('[id="delete_rep_'+s+'"]');c=a.querySelector('[id="load_rep_'+s+'"]');c||(c=Loading.ensureInline(t,"load_rep_"+s));y=r(e,o);Element.hide(l);Element.show(c);n(!0);v.value=y;p=u(t,[Requests.get(Requests.keys.ReportID)+"="+s,h]);ajaxRequest(v,f,"POST",p,function(n){Element.hide(c);Element.show(l);i(n)},{hideLoading:!0,messageBoxCallback:function(){n(!1)},onError:function(){Element.hide(c);Element.show(l);n(!1)}})},execInstant:function(t,f,e,o,s,h){var y,p;if(t.up("#ReportsPopup").getAttribute("ajaxrequest"))return!1;var a=!1,v="",w=t.up(".ReportsContext").querySelector("#rObjectIDs"),c,l=Loading.ensureInline(t);l?(l.show(),c=function(n){l.hide();i(n)}):(a=!0,c=i);n(!0);v=r(e,o);w.value=v;y=u(t,[s]);p=t.up("#ReportsPopup")||t.up("#sideContentList");ajaxRequest(p,f,"POST",y,function(t){typeof c=="function"&&c(t);t.status==ajaxRequest.StatusType.Success&&typeof h=="function"&&h();n(!1)},{hideLoading:!a,messageBoxCallback:function(){n(!1)},onError:function(){var i=Loading.ensureInline(t);Element.hide(i);n(!1)}})},execFromDateTime:function(t,r,u,f,e){var s=t.up(".ReportDateIntervalContext"),h=s.querySelector("#ReportStartDate"),c=s.querySelector("#ReportEndDate"),l,v;if(f||h&&h.value.trim().length>0&&c&&c.value.trim().length>0){if(e){var w=CalendarDate.parse(h.value,h.getAttribute("data-dateformat")),o=CalendarDate.parse(c.value,c.getAttribute("data-dateformat")),b=new CalendarDate(o.year-1,o.month,o.day,o.hour,o.minute,o.second,o.PM);if(w<b){MessageBox.alert(e);return}}l=Loading.ensureInline(t);l&&(l.show(),v=function(n){l.hide();i(n)});n(!0);var a=$(s).find("*").serializeAll()||"",y=[$("#fObjectIDs *").serializeAll()],p=s.querySelector("#PaymentsSearchType");p&&y.push($(p).serializeAll());a=appendStringParams(a,y);ajaxRequest(t,r,"POST",a,v,{messageBoxCallback:function(){n(!1)},onError:function(){var n=Loading.ensureInline(t);n&&n.hide()}})}else MessageBox.alert(u)},wizard:function(n,t,i,r,u){if(n.up("#ReportsPopup").getAttribute("ajaxrequest")||n.classList.contains("disabled"))return!1;Popup.close();Reports.execInstant(n,t,i,r,u,function(){Popup.current().querySelector("#ReportName").focus()})},toggleAssociated:function(n,t,i){var r=n.up(".ReportAssociatedObj");Tabs.CollapsingPane.toggle(n,t,i,function(){var n=null;r&&(n=r.querySelectorAll("select"));n&&n.length>0&&n.forEach(function(n){n.classList.contains("LocDD")&&n.setAttribute("data-is-single","true");n.hasAttribute("multiple")&&n.removeAttribute("multiple")})},"POST")},validate:function(n,t){var i=n.up("#ReportWizardPopup"),r=i.querySelector("#ReportObjectName").value.toLowerCase(),u=0,f=i.querySelector('[id="tbl_'+r+'_col"]');return(f&&f.querySelectorAll("input[type=hidden][name*="+r+"_columns]").forEach(function(n){n.value!=""&&u++}),u<=0)?(MessageBox.alert(t),!1):!0},validateSave:function(n,t){var i=n.up("#ReportWizardPopup").querySelector("#ReportName"),r=i.value.trim(),u=i.getAttribute("data-overlay");return r.length==0||r==u?(MessageBox.alert(t,function(n){n.focus()}.bind(this,i)),!1):!0},setType:function(n,t){n.up("#ReportWizardPopup").querySelector("#ReportType").value=t},"export":function(t,r){var u=t.up("#ReportWizardPopup"),f=$(u).find("*").serializeArray();u.querySelector(".WizardHeaderInfo").querySelectorAll("input").forEach(function(n){var t=n.value;if(!n.hasAttribute("name"))return!1;n.hasAttribute("data-overlay")&&n.value==n.getAttribute("data-overlay")&&(t="");updateParams(f,n.getAttribute("name"),t)});u.querySelectorAll("div.SearchCategory").forEach(function(n){n.querySelectorAll("input,textarea").forEach(function(n){var t=n.value,i;if(!n.hasAttribute("name")||n.hasAttribute("calendar"))return!1;(n.hasAttribute("data-overlay")&&n.value==n.getAttribute("data-overlay")||n.hasAttribute("multipleoverlay")&&n.value==n.getAttribute("multipleoverlay")||n.getAttribute("type")=="checkbox"&&n.checked==!1)&&(t="");n.hasAttribute("datatype")&&n.getAttribute("datatype")=="number"&&(i=inputNumberValue(n),(isNaN(i)||t==0&&!n.hasAttribute("allowZero"))&&(t=""));updateParams(f,n.getAttribute("name"),t)});n.querySelectorAll("select").forEach(function(n){var t=n.value;if(!n.hasAttribute("name"))return!1;n.selectedIndex==0&&(t="");updateParams(f,n.getAttribute("name"),t)})});n(!0);ajaxRequest(u,r,"POST",f,i,{async:!1,onError:function(){n(!1)}})},save:function(n,t){var f=n.up("#ReportWizardPopup"),r=[],i,e,u;if(f.querySelectorAll("input.greyText").forEach(function(n){n.value.length>0&&n.getAttribute("data-overlay")==n.value&&r.indexOf(n.getAttribute("name"))==-1&&r.push(n.getAttribute("name"))}),i=$(f).find("*").serializeArray(),e=r.length,i&&i.length>0&&e>0)for(u=0;u<e;)updateParams(i,r[u],""),u++;ajaxRequest(f,t,"POST",i,function(n){n.status!=ajaxRequest.StatusType.Success||!isObject(n.data)||isBlank(n.data.url)||isBlank(n.data.requestParams)||(Popup.close(),Reports.popup(null,n.data.url,n.data.requestParams))})},"delete":function(n,t,i,r){MessageBox.confirm(r,Translations.get(Translations.keys.Delete),function(){ajaxRequest(n,t,"POST",i,function(t){t.status==ajaxRequest.StatusType.Success&&n.up().remove()})},"",Translations.get(Translations.keys.Cancel))},toggleMobileSaveMenu:function(n){var t=n.next(".WizardSaveMenu");t&&($(t).is(":visible")?t.removeAttribute("style"):t.show(),t.getAttribute("data-dom-click-bound")!="1"&&(EventHandler.addListener(document.body,"click",function(n){var r=document.getElementById("ReportWizardPopup"),t=null,i;if(r&&(t=r.querySelector("#ReportsWizardSaveMenu")),t){if(n.target&&(t.contains(n.target)||n.target.up("#ReportsWizardSaveMenu")))return;i=t.querySelector(".WizardSaveMenu");i&&i.hide()}}),t.setAttribute("data-dom-click-bound","1")))}};return f.Columns=function(){function t(n,t,i){var u=n.up(".ReportColumnContext"),r=u.up(".collapsingLine").querySelector('[id="'+t+'_count"]');i=i||u.querySelectorAll("label.Checked").length;r.innerHTML=i;i>0?r.show():r.hide()}function i(t,i,r){for(var f,e=t.querySelectorAll("input"),a=e?e.length:0,h=!1,c=t.up(".ReportColumnContext"),l=t.querySelector("input[type=checkbox]"),o=0,u,s=0;s<a;s++)f=e[s],f&&f.name==i&&(f.value=r,h=!0);return h||t.appendChild(createHtmlElement("input",{type:"hidden",name:i,value:r})),t.classList.add("Checked"),l.checked||(l.checked=!0),r.endsWith("_business")&&(u=c.querySelector("[id$=_business_exported]"),u&&u.classList.contains("Checked")&&(n(u,i),u.classList.contains("Checked")||o++)),r.endsWith("_business_exported")&&(u=c.querySelector("[id$=_business]"),u&&u.classList.contains("Checked")&&(n(u,i),u.classList.contains("Checked")||o++)),o}function n(n,t){for(var i,r=n.querySelectorAll("input"),f=r?r.length:0,e=n.querySelector("input[type=checkbox]"),u=0;u<f;u++)i=r[u],i&&i.name==t&&(i.value="");n.classList.remove("Checked");e.checked=!1}return{selectAll:function(n,r){var u=n.up(".ReportColumnContext"),e=r+"_columns",f=0,o=0;u.querySelectorAll(".checkBoxLabel").forEach(function(n){var t=n.getAttribute("columnname");t&&(n.classList.contains("Checked")||(o+=i(n,e,t),n.classList.contains("Checked")&&f++))});u.querySelector('[id="'+r+'_selectnone"]').show();u.querySelector('[id="'+r+'_selectall"]').hide();f-=o;t(n,e,f)},selectNone:function(i,r){var u=i.up(".ReportColumnContext"),f=r+"_columns",e=0;u.querySelectorAll(".checkBoxLabel").forEach(function(t){var i=t.getAttribute("columnname");i&&(n(t,f),t.classList.contains("Checked")&&e++)});u.querySelector('[id="'+r+'_selectall"]').show();u.querySelector('[id="'+r+'_selectnone"]').hide();t(i,f,e)},onClick:function(r,u,f){if(r){var o=r.up(".ReportColumnContext"),e=r.up(),s=u.replace("_columns","");e.classList.contains("Checked")?n(e,u,f):i(e,u,f);o.querySelector('[id="'+s+'_selectall"]').show();o.querySelector('[id="'+s+'_selectnone"]').hide();t(r,u)}}}}(),f}();
/*!
 * Signature Pad v2.3.2
 * https://github.com/szimek/signature_pad
 *
 * Copyright 2017 Szymon Nowak
 * Released under the MIT license
 *
 * The main idea and some parts of the code (e.g. drawing variable width Bézier curve) are taken from:
 * http://corner.squareup.com/2012/07/smoother-signatures.html
 *
 * Implementation of interpolation using cubic Bézier curves is taken from:
 * http://benknowscode.wordpress.com/2012/09/14/path-interpolation-using-cubic-bezier-and-control-point-estimation-in-javascript
 *
 * Algorithm for approximated length of a Bézier curve is taken from:
 * http://www.lemoda.net/maths/bezier-length/index.html
 *
 */
(function(n,t){typeof exports=="object"&&typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define(t):n.SignaturePad=t()})(this,function(){"use strict";function t(n,t,i){this.x=n;this.y=t;this.time=i||(new Date).getTime()}function i(n,t,i,r){this.startPoint=n;this.control1=t;this.control2=i;this.endPoint=r}function r(n,t,i){var u,f,o,r=null,e=0,s;return i||(i={}),s=function(){e=i.leading===!1?0:Date.now();r=null;o=n.apply(u,f);r||(u=f=null)},function(){var c=Date.now(),h;return e||i.leading!==!1||(e=c),h=t-(c-e),u=this,f=arguments,h<=0||h>t?(r&&(clearTimeout(r),r=null),e=c,o=n.apply(u,f),r||(u=f=null)):r||i.trailing===!1||(r=setTimeout(s,h)),o}}function n(t,i){var f=this,u=i||{};this.velocityFilterWeight=u.velocityFilterWeight||.7;this.minWidth=u.minWidth||.5;this.maxWidth=u.maxWidth||2.5;this.throttle="throttle"in u?u.throttle:16;this.minDistance="minDistance"in u?u.minDistance:5;this._strokeMoveUpdate=this.throttle?r(n.prototype._strokeUpdate,this.throttle):n.prototype._strokeUpdate;this.dotSize=u.dotSize||function(){return(this.minWidth+this.maxWidth)/2};this.penColor=u.penColor||"black";this.backgroundColor=u.backgroundColor||"rgba(0,0,0,0)";this.onBegin=u.onBegin;this.onEnd=u.onEnd;this._canvas=t;this._ctx=t.getContext("2d");this.clear();this._handleMouseDown=function(n){n.which===1&&(f._mouseButtonDown=!0,f._strokeBegin(n))};this._handleMouseMove=function(n){f._mouseButtonDown&&f._strokeMoveUpdate(n)};this._handleMouseUp=function(n){n.which===1&&f._mouseButtonDown&&(f._mouseButtonDown=!1,f._strokeEnd(n))};this._handleTouchStart=function(n){if(n.targetTouches.length===1){var t=n.changedTouches[0];f._strokeBegin(t)}};this._handleTouchMove=function(n){n.preventDefault();var t=n.targetTouches[0];f._strokeMoveUpdate(t)};this._handleTouchEnd=function(n){var t=n.target===f._canvas;t&&(n.preventDefault(),f._strokeEnd(n))};this.on()}return t.prototype.velocityFrom=function(n){return this.time!==n.time?this.distanceTo(n)/(this.time-n.time):1},t.prototype.distanceTo=function(n){return Math.sqrt(Math.pow(this.x-n.x,2)+Math.pow(this.y-n.y,2))},t.prototype.equals=function(n){return this.x===n.x&&this.y===n.y&&this.time===n.time},i.prototype.length=function(){for(var t,i,r=10,u=0,f=void 0,e=void 0,n=0;n<=r;n+=1){var o=n/r,s=this._point(o,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),h=this._point(o,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);n>0&&(t=s-f,i=h-e,u+=Math.sqrt(t*t+i*i));f=s;e=h}return u},i.prototype._point=function(n,t,i,r,u){return t*(1-n)*(1-n)*(1-n)+3*i*(1-n)*(1-n)*n+3*r*(1-n)*n*n+u*n*n*n},n.prototype.clear=function(){var t=this._ctx,n=this._canvas;t.fillStyle=this.backgroundColor;t.clearRect(0,0,n.width,n.height);t.fillRect(0,0,n.width,n.height);this._data=[];this._reset();this._isEmpty=!0},n.prototype.fromDataURL=function(n){var u=this,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},i=new Image,r=t.ratio||window.devicePixelRatio||1,f=t.width||this._canvas.width/r,e=t.height||this._canvas.height/r;this._reset();i.src=n;i.onload=function(){u._ctx.drawImage(i,0,0,f,e)};this._isEmpty=!1},n.prototype.toDataURL=function(n){var r;switch(n){case"image/svg+xml":return this._toSVG();default:for(var i=arguments.length,u=Array(i>1?i-1:0),t=1;t<i;t++)u[t-1]=arguments[t];return(r=this._canvas).toDataURL.apply(r,[n].concat(u))}},n.prototype.on=function(){this._handleMouseEvents();this._handleTouchEvents()},n.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown);this._canvas.removeEventListener("mousemove",this._handleMouseMove);document.removeEventListener("mouseup",this._handleMouseUp);this._canvas.removeEventListener("touchstart",this._handleTouchStart);this._canvas.removeEventListener("touchmove",this._handleTouchMove);this._canvas.removeEventListener("touchend",this._handleTouchEnd)},n.prototype.isEmpty=function(){return this._isEmpty},n.prototype._strokeBegin=function(n){if(this._data.push([]),this._reset(),this._strokeUpdate(n),typeof this.onBegin=="function")this.onBegin(n)},n.prototype._strokeUpdate=function(n){var o=n.clientX,s=n.clientY,t=this._createPoint(o,s),i=this._data[this._data.length-1],r=i&&i[i.length-1],h=r&&t.distanceTo(r)<this.minDistance;if(!(r&&h)){var f=this._addPoint(t),e=f.curve,u=f.widths;e&&u&&this._drawCurve(e,u.start,u.end);this._data[this._data.length-1].push({x:t.x,y:t.y,time:t.time,color:this.penColor})}},n.prototype._strokeEnd=function(n){var u=this.points.length>2,t=this.points[0],i,r;if(!u&&t&&this._drawDot(t),t&&(i=this._data[this._data.length-1],r=i[i.length-1],t.equals(r)||i.push({x:t.x,y:t.y,time:t.time,color:this.penColor})),typeof this.onEnd=="function")this.onEnd(n)},n.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1;this._canvas.addEventListener("mousedown",this._handleMouseDown);this._canvas.addEventListener("mousemove",this._handleMouseMove);document.addEventListener("mouseup",this._handleMouseUp)},n.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none";this._canvas.style.touchAction="none";this._canvas.addEventListener("touchstart",this._handleTouchStart);this._canvas.addEventListener("touchmove",this._handleTouchMove);this._canvas.addEventListener("touchend",this._handleTouchEnd)},n.prototype._reset=function(){this.points=[];this._lastVelocity=0;this._lastWidth=(this.minWidth+this.maxWidth)/2;this._ctx.fillStyle=this.penColor},n.prototype._createPoint=function(n,i,r){var u=this._canvas.getBoundingClientRect();return new t(n-u.left,i-u.top,r||(new Date).getTime())},n.prototype._addPoint=function(n){var t=this.points,r=void 0,u;if(t.push(n),t.length>2){t.length===3&&t.unshift(t[0]);r=this._calculateCurveControlPoints(t[0],t[1],t[2]);u=r.c2;r=this._calculateCurveControlPoints(t[1],t[2],t[3]);var e=r.c1,f=new i(t[1],u,e,t[2]),o=this._calculateCurveWidths(f);return t.shift(),{curve:f,widths:o}}return{}},n.prototype._calculateCurveControlPoints=function(n,i,r){var e=n.x-i.x,o=n.y-i.y,s=i.x-r.x,h=i.y-r.y,f={x:(n.x+i.x)/2,y:(n.y+i.y)/2},u={x:(i.x+r.x)/2,y:(i.y+r.y)/2},p=Math.sqrt(e*e+o*o),c=Math.sqrt(s*s+h*h),w=f.x-u.x,b=f.y-u.y,l=c/(p+c),a={x:u.x+w*l,y:u.y+b*l},v=i.x-a.x,y=i.y-a.y;return{c1:new t(f.x+v,f.y+y),c2:new t(u.x+v,u.y+y)}},n.prototype._calculateCurveWidths=function(n){var u=n.startPoint,f=n.endPoint,t={start:null,end:null},i=this.velocityFilterWeight*f.velocityFrom(u)+(1-this.velocityFilterWeight)*this._lastVelocity,r=this._strokeWidth(i);return t.start=this._lastWidth,t.end=r,this._lastVelocity=i,this._lastWidth=r,t},n.prototype._strokeWidth=function(n){return Math.max(this.maxWidth/(n+1),this.minWidth)},n.prototype._drawPoint=function(n,t,i){var r=this._ctx;r.moveTo(n,t);r.arc(n,t,i,0,2*Math.PI,!1);this._isEmpty=!1},n.prototype._drawCurve=function(n,t,i){var s=this._ctx,p=i-t,a=Math.floor(n.length()),e,f,y;for(s.beginPath(),e=0;e<a;e+=1){var r=e/a,h=r*r,c=h*r,u=1-r,l=u*u,v=l*u,o=v*n.startPoint.x;o+=3*l*r*n.control1.x;o+=3*u*h*n.control2.x;o+=c*n.endPoint.x;f=v*n.startPoint.y;f+=3*l*r*n.control1.y;f+=3*u*h*n.control2.y;f+=c*n.endPoint.y;y=t+c*p;this._drawPoint(o,f,y)}s.closePath();s.fill()},n.prototype._drawDot=function(n){var t=this._ctx,i=typeof this.dotSize=="function"?this.dotSize():this.dotSize;t.beginPath();this._drawPoint(n.x,n.y,i);t.closePath();t.fill()},n.prototype._fromData=function(n,i,r){for(var u,f,v,e=0;e<n.length;e+=1)if(u=n[e],u.length>1)for(f=0;f<u.length;f+=1){var o=u[f],s=new t(o.x,o.y,o.time),h=o.color;if(f===0)this.penColor=h,this._reset(),this._addPoint(s);else if(f!==u.length-1){var c=this._addPoint(s),l=c.curve,a=c.widths;l&&a&&i(l,a,h)}}else this._reset(),v=u[0],r(v)},n.prototype._toSVG=function(){var u=this,a=this._data,t=this._canvas,o=Math.max(window.devicePixelRatio||1,1),s=t.width/o,h=t.height/o,n=document.createElementNS("http://www.w3.org/2000/svg","svg"),i,e,r,c,l;n.setAttributeNS(null,"width",t.width);n.setAttributeNS(null,"height",t.height);this._fromData(a,function(t,i,r){var u=document.createElement("path"),f;isNaN(t.control1.x)||isNaN(t.control1.y)||isNaN(t.control2.x)||isNaN(t.control2.y)||(f="M "+t.startPoint.x.toFixed(3)+","+t.startPoint.y.toFixed(3)+" "+("C "+t.control1.x.toFixed(3)+","+t.control1.y.toFixed(3)+" ")+(t.control2.x.toFixed(3)+","+t.control2.y.toFixed(3)+" ")+(t.endPoint.x.toFixed(3)+","+t.endPoint.y.toFixed(3)),u.setAttribute("d",f),u.setAttribute("stroke-width",(i.end*2.25).toFixed(3)),u.setAttribute("stroke",r),u.setAttribute("fill","none"),u.setAttribute("stroke-linecap","round"),n.appendChild(u))},function(t){var i=document.createElement("circle"),r=typeof u.dotSize=="function"?u.dotSize():u.dotSize;i.setAttribute("r",r);i.setAttribute("cx",t.x);i.setAttribute("cy",t.y);i.setAttribute("fill",t.color);n.appendChild(i)});var v='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"'+(' viewBox="0 0 '+s+" "+h+'"')+(' width="'+s+'"')+(' height="'+h+'"')+">",f=n.innerHTML;if(f===undefined){for(i=document.createElement("dummy"),e=n.childNodes,i.innerHTML="",r=0;r<e.length;r+=1)i.appendChild(e[r].cloneNode(!0));f=i.innerHTML}return c="<\/svg>",l=v+f+c,"data:image/svg+xml;base64,"+btoa(l)},n.prototype.fromData=function(n){var t=this;this.clear();this._fromData(n,function(n,i){return t._drawCurve(n,i.start,i.end)},function(n){return t._drawDot(n)});this._data=n},n.prototype.toData=function(){return this._data},n});Permissions=function(){var n={},t=function(n,t,i){n&&n.checked===!0?t.push(i):t.remove(i)};return{init:function(t){n=JSON.parse(t)},setTargets:function(t){n=t},getTarget:function(t){return n[t]===undefined&&(n[t]={}),n[t]},getPermissions:function(n,t){var i=Permissions.getTarget(n);return i[t]===undefined&&(i[t]=[]),i[t]},returnAllPermissions:function(){return n},addNewTarget:function(t){t!=null&&n.push(t)},toggleSelected:function(n,i,r,u){if(!n||!i||!r||!u)return!1;t(n,Permissions.getPermissions(i,r),u)},toggleSelectedRole:function(n,t,i){if(n){var r,u=n.up(".AccessAssignRole").querySelectorAll('input[type=radio][name="'+n.name+'"]').filter(function(n){return n.checked});(u&&u.length==1&&u[0].value!="0"&&(r=Permissions.getPermissions(t,u[0].value),r.indexOf(i)!=-1&&r.remove(i)),n.value!="0")&&(r=Permissions.getPermissions(t,n.value),r.indexOf(i)==-1&&r.push(i))}},openPermissionsPopup:function(n,t,i,r,u,f,e){var o=[Requests.get(Requests.keys.AccessPermissionType)+"="+i,Requests.get(Requests.keys.BusinessObject)+"="+r,Requests.get(Requests.keys.Context)+"="+u,Requests.get(Requests.keys.TargetID)+"="+f,Requests.get(Requests.keys.Type)+"="+$(n).attr("data-team-value")],h=$(n).attr("data-value"),s=Permissions.getTarget(h);s[e]&&o.push(Requests.get(Requests.keys.SelectedIDs)+"="+s[e].join(","));ajaxRequest(n,t,"POST",o.join("&"))},openPopup:function(n,t,i,r,u,f,e,o){var s=[Requests.get(Requests.keys.AccessPermissionType)+"="+i,Requests.get(Requests.keys.BusinessObject)+"="+r,Requests.get(Requests.keys.Context)+"="+f,Requests.get(Requests.keys.BusinessObjectWorkOn)+"="+e,Requests.get(Requests.keys.TargetID)+"="+o];ajaxRequest(n,t,"POST",s.join("&"))}}}();User=function(){var n={};return n.Permissions=function(){var i,n=null,t={},r,u=function(n,t){n&&n.checked===!0?t.push(n.value):t.remove(n.value)};return{getPermissions:function(){return t},getPermissionsSerialized:function(){var i=[],r=[],n=[];for(var u in t)t.hasOwnProperty(u)&&t[u].length>0&&(u.match(/^(Access)/ig)?i.push(t[u]):r.push(t[u]));return i=i.join(","),i.length>0&&n.push("Access="+i),r=r.join(","),r.length>0&&n.push("Assign="+r),n=n.join("&"),n.length>0?n:""},init:function(t,u,f){n=t;i=f||"0";r=!1;var e={};e[i]=JSON.parse(u);Permissions.setTargets(e)},openPopup:function(t,i,r,u,f,e,o,s,h){o&&(n=t.up(".collapsingLine"));var c=[Requests.get(Requests.keys.AccessPermissionType)+"="+r,Requests.get(Requests.keys.BusinessObject)+"="+u,Requests.get(Requests.keys.Context)+"="+e,Requests.get(Requests.keys.BusinessObjectWorkOn)+"="+s,Requests.get(Requests.keys.TargetID)+"="+h];c.push(Requests.get(Requests.keys.SelectedIDs)+"="+Permissions.getPermissions(h,f).join(","));ajaxRequest(t,i,"POST",c.join("&"))},closeChooser:function(t,i){var f=n.querySelector('div[data-type="'+i+'"]'),u,o;if(f){var h=t.up(".popupBox"),e=h.querySelectorAll('input[type="checkbox"]'),s=0;for(u=0;u<e.length;u++)e[u].checked&&(o=e[u].next(),o&&(f.appendChild(o.cloneNode(!0)),s++));s>0&&f.show()}r=!0;Popup.close()},remove:function(t,u,f,e){if(Permissions.toggleSelected(t,i,f,u),e){if(n=t.up(".collapsingLine"),t.up(".userTeamCard").remove(),n){var o=n.querySelector('div[data-type="'+f+'"]');o&&$(o).has("div").length<=0&&o.hide()}}else t.up(".userTeamCard").remove();r=!0},usersToggle:function(n,t){var r;if(n){var i=n.up(".collapsingLine"),u=i.querySelector("#SeeUsers"),f=i.querySelector("#SeeGroups"),e=i.querySelector("#SeeApplications");t?(i.querySelector("#SeeAssignedUsersPop").show(),i.querySelector("#SeeAssignedTeamsPop").show(),r=i.querySelector("#SeeAssignedApplicationPop"),r&&r.show(),u&&$(u).has("div").length>0&&u.show(),f&&$(f).has("div").length>0&&f.show(),e&&$(e).has("div").length>0&&e.show()):(i.querySelector("#SeeAssignedUsersPop").hide(),i.querySelector("#SeeAssignedTeamsPop").hide(),r=i.querySelector("#SeeAssignedApplicationPop"),r&&r.hide(),u&&u.hide(),f&&f.hide(),e&&e.hide())}else return},hasChanges:function(){return r},save:function(n,t,r){var e=document.querySelectorAll("AccessAssignPermissionsContainer"),u,f;if(e){for(u=["Permissions="+JSON.stringify(Permissions.getTarget(i))],f=0;f<e.length;f++)u.push($(e[f]).find("*").serializeAll());console.log(u);r=appendStringParams(r,u);ajaxRequest(n,t,"POST",r)}}}}(),n}(),function(n){if(typeof exports=="object"&&typeof module!="undefined")module.exports=n();else if(typeof define=="function"&&define.amd)define([],n);else{var t;t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:this;t.StackTrace=n()}}(function(){var n;return function t(n,i,r){function u(f,o){var h,c,s;if(!i[f]){if(!n[f]){if(h=typeof require=="function"&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}s=i[f]={exports:{}};n[f][0].call(s.exports,function(t){var i=n[f][1][t];return u(i?i:t)},s,s.exports,t,n,i,r)}return i[f].exports}for(var e=typeof require=="function"&&require,f=0;f<r.length;f++)u(r[f]);return u}({1:[function(t,i,r){(function(u,f){"use strict";typeof n=="function"&&n.amd?n("error-stack-parser",["stackframe"],f):typeof r=="object"?i.exports=f(t("stackframe")):u.ErrorStackParser=f(u.StackFrame)})(this,function(n){"use strict";var i=/(^|@)\S+\:\d+/,t=/^\s*at .*(\S+\:\d+|\(native\))/m,r=/^(eval@)?(\[native code\])?$/;return{parse:function(n){if(typeof n.stacktrace!="undefined"||typeof n["opera#sourceloc"]!="undefined")return this.parseOpera(n);if(n.stack&&n.stack.match(t))return this.parseV8OrIE(n);if(n.stack)return this.parseFFOrSafari(n);throw new Error("Cannot parse given Error object");},extractLocation:function(n){if(n.indexOf(":")===-1)return[n];var t=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/.exec(n.replace(/[\(\)]/g,""));return[t[1],t[2]||undefined,t[3]||undefined]},parseV8OrIE:function(i){var r=i.stack.split("\n").filter(function(n){return!!n.match(t)},this);return r.map(function(t){t.indexOf("(eval ")>-1&&(t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var r=t.replace(/^\s+/,"").replace(/\(eval code/g,"(").split(/\s+/).slice(1),i=this.extractLocation(r.pop()),u=r.join(" ")||undefined,f=["eval","<anonymous>"].indexOf(i[0])>-1?undefined:i[0];return new n({functionName:u,fileName:f,lineNumber:i[1],columnNumber:i[2],source:t})},this)},parseFFOrSafari:function(t){var i=t.stack.split("\n").filter(function(n){return!n.match(r)},this);return i.map(function(t){if(t.indexOf(" > eval")>-1&&(t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),t.indexOf("@")===-1&&t.indexOf(":")===-1)return new n({functionName:t});var r=t.split("@"),i=this.extractLocation(r.pop()),u=r.join("@")||undefined;return new n({functionName:u,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:t})},this)},parseOpera:function(n){return!n.stacktrace||n.message.indexOf("\n")>-1&&n.message.split("\n").length>n.stacktrace.split("\n").length?this.parseOpera9(n):n.stack?this.parseOpera11(n):this.parseOpera10(n)},parseOpera9:function(t){for(var r,u=t.message.split("\n"),f=[],i=2,e=u.length;i<e;i+=2)r=/Line (\d+).*script (?:in )?(\S+)/i.exec(u[i]),r&&f.push(new n({fileName:r[2],lineNumber:r[1],source:u[i]}));return f},parseOpera10:function(t){for(var i,u=t.stacktrace.split("\n"),f=[],r=0,e=u.length;r<e;r+=2)i=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i.exec(u[r]),i&&f.push(new n({functionName:i[3]||undefined,fileName:i[2],lineNumber:i[1],source:u[r]}));return f},parseOpera11:function(t){var r=t.stack.split("\n").filter(function(n){return!!n.match(i)&&!n.match(/^Error created at/)},this);return r.map(function(t){var f=t.split("@"),r=this.extractLocation(f.pop()),u=f.shift()||"",o=u.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||undefined,i,e;return u.match(/\(([^\)]*)\)/)&&(i=u.replace(/^[^\(]+\(([^\)]*)\)$/,"$1")),e=i===undefined||i==="[arguments not available]"?undefined:i.split(","),new n({functionName:o,args:e,fileName:r[0],lineNumber:r[1],columnNumber:r[2],source:t})},this)}}})},{stackframe:10}],2:[function(n,t,i){function r(){this._array=[];this._set=Object.create(null)}var u=n("./util"),f=Object.prototype.hasOwnProperty;r.fromArray=function(n,t){for(var u=new r,i=0,f=n.length;i<f;i++)u.add(n[i],t);return u};r.prototype.size=function(){return Object.getOwnPropertyNames(this._set).length};r.prototype.add=function(n,t){var i=u.toSetString(n),r=f.call(this._set,i),e=this._array.length;(!r||t)&&this._array.push(n);r||(this._set[i]=e)};r.prototype.has=function(n){var t=u.toSetString(n);return f.call(this._set,t)};r.prototype.indexOf=function(n){var t=u.toSetString(n);if(f.call(this._set,t))return this._set[t];throw new Error('"'+n+'" is not in the set.');};r.prototype.at=function(n){if(n>=0&&n<this._array.length)return this._array[n];throw new Error("No element indexed by "+n);};r.prototype.toArray=function(){return this._array.slice()};i.ArraySet=r},{"./util":8}],3:[function(n,t,i){function s(n){return n<0?(-n<<1)+1:(n<<1)+0}function h(n){var i=(n&1)==1,t=n>>1;return i?-t:t}var u=n("./base64"),r=5,f=1<<r,e=f-1,o=f;i.encode=function(n){var f="",i,t=s(n);do i=t&e,t>>>=r,t>0&&(i|=o),f+=u.encode(i);while(t>0);return f};i.decode=function(n,t,i){var a=n.length,s=0,c=0,l,f;do{if(t>=a)throw new Error("Expected more digits in base 64 VLQ value.");if(f=u.decode(n.charCodeAt(t++)),f===-1)throw new Error("Invalid base64 digit: "+n.charAt(t-1));l=!!(f&o);f&=e;s=s+(f<<c);c+=r}while(l);i.value=h(s);i.rest=t}},{"./base64":4}],4:[function(n,t,i){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");i.encode=function(n){if(0<=n&&n<r.length)return r[n];throw new TypeError("Must be between 0 and 63: "+n);};i.decode=function(n){var t=65,i=97,r=48;return t<=n&&n<=90?n-t:i<=n&&n<=122?n-i+26:r<=n&&n<=57?n-r+52:n==43?62:n==47?63:-1}},{}],5:[function(n,t,i){function r(n,t,u,f,e,o){var s=Math.floor((t-n)/2)+n,h=e(u,f[s],!0);return h===0?s:h>0?t-s>1?r(s,t,u,f,e,o):o==i.LEAST_UPPER_BOUND?t<f.length?t:-1:s:s-n>1?r(n,s,u,f,e,o):o==i.LEAST_UPPER_BOUND?s:n<0?-1:n}i.GREATEST_LOWER_BOUND=1;i.LEAST_UPPER_BOUND=2;i.search=function(n,t,u,f){if(t.length===0)return-1;var e=r(-1,t.length,n,t,u,f||i.GREATEST_LOWER_BOUND);if(e<0)return-1;while(e-1>=0){if(u(t[e],t[e-1],!0)!==0)break;--e}return e}},{}],6:[function(n,t,i){function r(n,t,i){var r=n[t];n[t]=n[i];n[i]=r}function f(n,t){return Math.round(n+Math.random()*(t-n))}function u(n,t,i,e){var c,s,l,o,h;if(i<e){for(c=f(i,e),s=i-1,r(n,c,e),l=n[e],o=i;o<e;o++)t(n[o],l)<=0&&(s+=1,r(n,s,o));r(n,s+1,o);h=s+1;u(n,t,i,h-1);u(n,t,h+1,e)}}i.quickSort=function(n,t){u(n,t,0,n.length-1)}},{}],7:[function(n,t,i){function u(n){var t=n;return typeof n=="string"&&(t=JSON.parse(n.replace(/^\)\]\}'/,""))),t.sections!=null?new e(t):new f(t)}function f(n){var t=n;typeof n=="string"&&(t=JSON.parse(n.replace(/^\)\]\}'/,"")));var f=r.getArg(t,"version"),u=r.getArg(t,"sources"),e=r.getArg(t,"names",[]),i=r.getArg(t,"sourceRoot",null),s=r.getArg(t,"sourcesContent",null),h=r.getArg(t,"mappings"),c=r.getArg(t,"file",null);if(f!=this._version)throw new Error("Unsupported version: "+f);u=u.map(String).map(r.normalize).map(function(n){return i&&r.isAbsolute(i)&&r.isAbsolute(n)?r.relative(i,n):n});this._names=o.fromArray(e.map(String),!0);this._sources=o.fromArray(u,!0);this.sourceRoot=i;this.sourcesContent=s;this._mappings=h;this.file=c}function c(){this.generatedLine=0;this.generatedColumn=0;this.source=null;this.originalLine=null;this.originalColumn=null;this.name=null}function e(n){var i=n,f,e,t;if(typeof n=="string"&&(i=JSON.parse(n.replace(/^\)\]\}'/,""))),f=r.getArg(i,"version"),e=r.getArg(i,"sections"),f!=this._version)throw new Error("Unsupported version: "+f);this._sources=new o;this._names=new o;t={line:-1,column:0};this._sections=e.map(function(n){if(n.url)throw new Error("Support for url field in sections not implemented.");var i=r.getArg(n,"offset"),f=r.getArg(i,"line"),e=r.getArg(i,"column");if(f<t.line||f===t.line&&e<t.column)throw new Error("Section offsets must be ordered and non-overlapping.");return t=i,{generatedOffset:{generatedLine:f+1,generatedColumn:e+1},consumer:new u(r.getArg(n,"map"))}})}var r=n("./util"),h=n("./binary-search"),o=n("./array-set").ArraySet,l=n("./base64-vlq"),s=n("./quick-sort").quickSort;u.fromSourceMap=function(n){return f.fromSourceMap(n)};u.prototype._version=3;u.prototype.__generatedMappings=null;Object.defineProperty(u.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}});u.prototype.__originalMappings=null;Object.defineProperty(u.prototype,"_originalMappings",{get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}});u.prototype._charIsMappingSeparator=function(n,t){var i=n.charAt(t);return i===";"||i===","};u.prototype._parseMappings=function(){throw new Error("Subclasses must implement _parseMappings");};u.GENERATED_ORDER=1;u.ORIGINAL_ORDER=2;u.GREATEST_LOWER_BOUND=1;u.LEAST_UPPER_BOUND=2;u.prototype.eachMapping=function(n,t,i){var o=t||null,s=i||u.GENERATED_ORDER,f,e;switch(s){case u.GENERATED_ORDER:f=this._generatedMappings;break;case u.ORIGINAL_ORDER:f=this._originalMappings;break;default:throw new Error("Unknown order of iteration.");}e=this.sourceRoot;f.map(function(n){var t=n.source===null?null:this._sources.at(n.source);return t!=null&&e!=null&&(t=r.join(e,t)),{source:t,generatedLine:n.generatedLine,generatedColumn:n.generatedColumn,originalLine:n.originalLine,originalColumn:n.originalColumn,name:n.name===null?null:this._names.at(n.name)}},this).forEach(n,o)};u.prototype.allGeneratedPositionsFor=function(n){var e=r.getArg(n,"line"),i={source:r.getArg(n,"source"),originalLine:e,originalColumn:r.getArg(n,"column",0)},f,u,t,o,s;if(this.sourceRoot!=null&&(i.source=r.relative(this.sourceRoot,i.source)),!this._sources.has(i.source))return[];if(i.source=this._sources.indexOf(i.source),f=[],u=this._findMapping(i,this._originalMappings,"originalLine","originalColumn",r.compareByOriginalPositions,h.LEAST_UPPER_BOUND),u>=0)if(t=this._originalMappings[u],n.column===undefined)for(o=t.originalLine;t&&t.originalLine===o;)f.push({line:r.getArg(t,"generatedLine",null),column:r.getArg(t,"generatedColumn",null),lastColumn:r.getArg(t,"lastGeneratedColumn",null)}),t=this._originalMappings[++u];else for(s=t.originalColumn;t&&t.originalLine===e&&t.originalColumn==s;)f.push({line:r.getArg(t,"generatedLine",null),column:r.getArg(t,"generatedColumn",null),lastColumn:r.getArg(t,"lastGeneratedColumn",null)}),t=this._originalMappings[++u];return f};i.SourceMapConsumer=u;f.prototype=Object.create(u.prototype);f.prototype.consumer=u;f.fromSourceMap=function(n){var t=Object.create(f.prototype),a=t._names=o.fromArray(n._names.toArray(),!0),v=t._sources=o.fromArray(n._sources.toArray(),!0),e,l,i,u;t.sourceRoot=n._sourceRoot;t.sourcesContent=n._generateSourcesContent(t._sources.toArray(),t.sourceRoot);t.file=n._file;var h=n._mappings.toArray().slice(),y=t.__generatedMappings=[],p=t.__originalMappings=[];for(e=0,l=h.length;e<l;e++)i=h[e],u=new c,u.generatedLine=i.generatedLine,u.generatedColumn=i.generatedColumn,i.source&&(u.source=v.indexOf(i.source),u.originalLine=i.originalLine,u.originalColumn=i.originalColumn,i.name&&(u.name=a.indexOf(i.name)),p.push(u)),y.push(u);return s(t.__originalMappings,r.compareByOriginalPositions),t};f.prototype._version=3;Object.defineProperty(f.prototype,"sources",{get:function(){return this._sources.toArray().map(function(n){return this.sourceRoot!=null?r.join(this.sourceRoot,n):n},this)}});f.prototype._parseMappings=function(n){for(var y=1,o=0,p=0,w=0,b=0,k=0,d=n.length,u=0,g={},h={},a=[],v=[],i,e,t,f,nt;u<d;)if(n.charAt(u)===";")y++,u++,o=0;else if(n.charAt(u)===",")u++;else{for(i=new c,i.generatedLine=y,f=u;f<d;f++)if(this._charIsMappingSeparator(n,f))break;if(e=n.slice(u,f),t=g[e],t)u+=e.length;else{for(t=[];u<f;)l.decode(n,u,h),nt=h.value,u=h.rest,t.push(nt);if(t.length===2)throw new Error("Found a source, but no line and column");if(t.length===3)throw new Error("Found a source and line, but no column");g[e]=t}i.generatedColumn=o+t[0];o=i.generatedColumn;t.length>1&&(i.source=b+t[1],b+=t[1],i.originalLine=p+t[2],p=i.originalLine,i.originalLine+=1,i.originalColumn=w+t[3],w=i.originalColumn,t.length>4&&(i.name=k+t[4],k+=t[4]));v.push(i);typeof i.originalLine=="number"&&a.push(i)}s(v,r.compareByGeneratedPositionsDeflated);this.__generatedMappings=v;s(a,r.compareByOriginalPositions);this.__originalMappings=a};f.prototype._findMapping=function(n,t,i,r,u,f){if(n[i]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+n[i]);if(n[r]<0)throw new TypeError("Column must be greater than or equal to 0, got "+n[r]);return h.search(n,t,u,f)};f.prototype.computeColumnSpans=function(){for(var t,i,n=0;n<this._generatedMappings.length;++n){if(t=this._generatedMappings[n],n+1<this._generatedMappings.length&&(i=this._generatedMappings[n+1],t.generatedLine===i.generatedLine)){t.lastGeneratedColumn=i.generatedColumn-1;continue}t.lastGeneratedColumn=Infinity}};f.prototype.originalPositionFor=function(n){var e={generatedLine:r.getArg(n,"line"),generatedColumn:r.getArg(n,"column")},o=this._findMapping(e,this._generatedMappings,"generatedLine","generatedColumn",r.compareByGeneratedPositionsDeflated,r.getArg(n,"bias",u.GREATEST_LOWER_BOUND)),i,t,f;return o>=0&&(i=this._generatedMappings[o],i.generatedLine===e.generatedLine)?(t=r.getArg(i,"source",null),t!==null&&(t=this._sources.at(t),this.sourceRoot!=null&&(t=r.join(this.sourceRoot,t))),f=r.getArg(i,"name",null),f!==null&&(f=this._names.at(f)),{source:t,line:r.getArg(i,"originalLine",null),column:r.getArg(i,"originalColumn",null),name:f}):{source:null,line:null,column:null,name:null}};f.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(n){return n==null}):!1};f.prototype.sourceContentFor=function(n,t){var i,u;if(!this.sourcesContent)return null;if(this.sourceRoot!=null&&(n=r.relative(this.sourceRoot,n)),this._sources.has(n))return this.sourcesContent[this._sources.indexOf(n)];if(this.sourceRoot!=null&&(i=r.urlParse(this.sourceRoot))){if(u=n.replace(/^file:\/\//,""),i.scheme=="file"&&this._sources.has(u))return this.sourcesContent[this._sources.indexOf(u)];if((!i.path||i.path=="/")&&this._sources.has("/"+n))return this.sourcesContent[this._sources.indexOf("/"+n)]}if(t)return null;throw new Error('"'+n+'" is not in the SourceMap.');};f.prototype.generatedPositionFor=function(n){var t=r.getArg(n,"source"),f,e,i;return(this.sourceRoot!=null&&(t=r.relative(this.sourceRoot,t)),!this._sources.has(t))?{line:null,column:null,lastColumn:null}:(t=this._sources.indexOf(t),f={source:t,originalLine:r.getArg(n,"line"),originalColumn:r.getArg(n,"column")},e=this._findMapping(f,this._originalMappings,"originalLine","originalColumn",r.compareByOriginalPositions,r.getArg(n,"bias",u.GREATEST_LOWER_BOUND)),e>=0&&(i=this._originalMappings[e],i.source===f.source))?{line:r.getArg(i,"generatedLine",null),column:r.getArg(i,"generatedColumn",null),lastColumn:r.getArg(i,"lastGeneratedColumn",null)}:{line:null,column:null,lastColumn:null}};i.BasicSourceMapConsumer=f;e.prototype=Object.create(u.prototype);e.prototype.constructor=u;e.prototype._version=3;Object.defineProperty(e.prototype,"sources",{get:function(){for(var t,i=[],n=0;n<this._sections.length;n++)for(t=0;t<this._sections[n].consumer.sources.length;t++)i.push(this._sections[n].consumer.sources[t]);return i}});e.prototype.originalPositionFor=function(n){var i={generatedLine:r.getArg(n,"line"),generatedColumn:r.getArg(n,"column")},u=h.search(i,this._sections,function(n,t){var i=n.generatedLine-t.generatedOffset.generatedLine;return i?i:n.generatedColumn-t.generatedOffset.generatedColumn}),t=this._sections[u];return t?t.consumer.originalPositionFor({line:i.generatedLine-(t.generatedOffset.generatedLine-1),column:i.generatedColumn-(t.generatedOffset.generatedLine===i.generatedLine?t.generatedOffset.generatedColumn-1:0),bias:n.bias}):{source:null,line:null,column:null,name:null}};e.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(n){return n.consumer.hasContentsOfAllSources()})};e.prototype.sourceContentFor=function(n,t){for(var u,r,i=0;i<this._sections.length;i++)if(u=this._sections[i],r=u.consumer.sourceContentFor(n,!0),r)return r;if(t)return null;throw new Error('"'+n+'" is not in the SourceMap.');};e.prototype.generatedPositionFor=function(n){for(var t,i,u=0;u<this._sections.length;u++)if((t=this._sections[u],t.consumer.sources.indexOf(r.getArg(n,"source"))!==-1)&&(i=t.consumer.generatedPositionFor(n),i))return{line:i.line+(t.generatedOffset.generatedLine-1),column:i.column+(t.generatedOffset.generatedLine===i.line?t.generatedOffset.generatedColumn-1:0)};return{line:null,column:null}};e.prototype._parseMappings=function(){var f,n,h,e,t,i,u,o;for(this.__generatedMappings=[],this.__originalMappings=[],f=0;f<this._sections.length;f++)for(n=this._sections[f],h=n.consumer._generatedMappings,e=0;e<h.length;e++)t=h[e],i=n.consumer._sources.at(t.source),n.consumer.sourceRoot!==null&&(i=r.join(n.consumer.sourceRoot,i)),this._sources.add(i),i=this._sources.indexOf(i),u=n.consumer._names.at(t.name),this._names.add(u),u=this._names.indexOf(u),o={source:i,generatedLine:t.generatedLine+(n.generatedOffset.generatedLine-1),generatedColumn:t.generatedColumn+(n.generatedOffset.generatedLine===t.generatedLine?n.generatedOffset.generatedColumn-1:0),originalLine:t.originalLine,originalColumn:t.originalColumn,name:u},this.__generatedMappings.push(o),typeof o.originalLine=="number"&&this.__originalMappings.push(o);s(this.__generatedMappings,r.compareByGeneratedPositionsDeflated);s(this.__originalMappings,r.compareByOriginalPositions)};i.IndexedSourceMapConsumer=e},{"./array-set":2,"./base64-vlq":3,"./binary-search":5,"./quick-sort":6,"./util":8}],8:[function(n,t,i){function a(n,t,i){if(t in n)return n[t];if(arguments.length===3)return i;throw new Error('"'+t+'" is a required argument.');}function u(n){var t=n.match(f);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function r(n){var t="";return n.scheme&&(t+=n.scheme+":"),t+="//",n.auth&&(t+=n.auth+"@"),n.host&&(t+=n.host),n.port&&(t+=":"+n.port),n.path&&(t+=n.path),t}function s(n){var t=n,o=u(n),c,f,h,s,e;if(o){if(!o.path)return n;t=o.path}for(c=i.isAbsolute(t),f=t.split(/\/+/),s=0,e=f.length-1;e>=0;e--)h=f[e],h==="."?f.splice(e,1):h===".."?s++:s>0&&(h===""?(f.splice(e+1,s),s=0):(f.splice(e,2),s--));return(t=f.join("/"),t===""&&(t=c?"/":"."),o)?(o.path=t,r(o)):t}function v(n,t){var f,i,e;return(n===""&&(n="."),t===""&&(t="."),f=u(t),i=u(n),i&&(n=i.path||"/"),f&&!f.scheme)?(i&&(f.scheme=i.scheme),r(f)):f||t.match(o)?t:i&&!i.host&&!i.path?(i.host=t,r(i)):(e=t.charAt(0)==="/"?t:s(n.replace(/\/+$/,"")+"/"+t),i)?(i.path=e,r(i)):e}function y(n,t){var i,r;for(n===""&&(n="."),n=n.replace(/\/$/,""),i=0;t.indexOf(n+"/")!==0;){if((r=n.lastIndexOf("/"),r<0)||(n=n.slice(0,r),n.match(/^([^\/]+:\/)?\/*$/)))return t;++i}return Array(i+1).join("../")+t.substr(n.length+1)}function h(n){return n}function p(n){return c(n)?"$"+n:n}function w(n){return c(n)?n.slice(1):n}function c(n){var t,i;if(!n||(t=n.length,t<9)||n.charCodeAt(t-1)!==95||n.charCodeAt(t-2)!==95||n.charCodeAt(t-3)!==111||n.charCodeAt(t-4)!==116||n.charCodeAt(t-5)!==111||n.charCodeAt(t-6)!==114||n.charCodeAt(t-7)!==112||n.charCodeAt(t-8)!==95||n.charCodeAt(t-9)!==95)return!1;for(i=t-10;i>=0;i--)if(n.charCodeAt(i)!==36)return!1;return!0}function b(n,t,i){var r=n.source-t.source;return r!==0?r:(r=n.originalLine-t.originalLine,r!==0)?r:(r=n.originalColumn-t.originalColumn,r!==0||i)?r:(r=n.generatedColumn-t.generatedColumn,r!==0)?r:(r=n.generatedLine-t.generatedLine,r!==0)?r:n.name-t.name}function k(n,t,i){var r=n.generatedLine-t.generatedLine;return r!==0?r:(r=n.generatedColumn-t.generatedColumn,r!==0||i)?r:(r=n.source-t.source,r!==0)?r:(r=n.originalLine-t.originalLine,r!==0)?r:(r=n.originalColumn-t.originalColumn,r!==0)?r:n.name-t.name}function l(n,t){return n===t?0:n>t?1:-1}function d(n,t){var i=n.generatedLine-t.generatedLine;return i!==0?i:(i=n.generatedColumn-t.generatedColumn,i!==0)?i:(i=l(n.source,t.source),i!==0)?i:(i=n.originalLine-t.originalLine,i!==0)?i:(i=n.originalColumn-t.originalColumn,i!==0)?i:l(n.name,t.name)}var f,o,e;i.getArg=a;f=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/;o=/^data:.+\,.+$/;i.urlParse=u;i.urlGenerate=r;i.normalize=s;i.join=v;i.isAbsolute=function(n){return n.charAt(0)==="/"||!!n.match(f)};i.relative=y;e=function(){var n=Object.create(null);return!("__proto__"in n)}();i.toSetString=e?h:p;i.fromSetString=e?h:w;i.compareByOriginalPositions=b;i.compareByGeneratedPositionsDeflated=k;i.compareByGeneratedPositionsInflated=d},{}],9:[function(t,i,r){(function(u,f){"use strict";typeof n=="function"&&n.amd?n("stack-generator",["stackframe"],f):typeof r=="object"?i.exports=f(t("stackframe")):u.StackGenerator=f(u.StackFrame)})(this,function(n){return{backtrace:function(t){var f=[],e=10,i,r,u;for(typeof t=="object"&&typeof t.maxStackSize=="number"&&(e=t.maxStackSize),i=arguments.callee;i&&f.length<e;){for(r=new Array(i.arguments.length),u=0;u<r.length;++u)r[u]=i.arguments[u];/function(?:\s+([\w$]+))+\s*\(/.test(i.toString())?f.push(new n({functionName:RegExp.$1||undefined,args:r})):f.push(new n({args:r}));try{i=i.caller}catch(o){break}}return f}}})},{stackframe:10}],10:[function(t,i,r){(function(t,u){"use strict";typeof n=="function"&&n.amd?n("stackframe",[],u):typeof r=="object"?i.exports=u():t.StackFrame=u()})(this,function(){"use strict";function s(n){return!isNaN(parseFloat(n))&&isFinite(n)}function t(n){return n[0].toUpperCase()+n.substring(1)}function h(n){return function(){return this[n]}}function n(n){var r,i;if(n instanceof Object)for(r=f.concat(e.concat(o.concat(c))),i=0;i<r.length;i++)n.hasOwnProperty(r[i])&&n[r[i]]!==undefined&&this["set"+t(r[i])](n[r[i]])}var f=["isConstructor","isEval","isNative","isToplevel"],e=["columnNumber","lineNumber"],o=["fileName","functionName","source"],c=["args"],i,r,u;for(n.prototype={getArgs:function(){return this.args},setArgs:function(n){if(Object.prototype.toString.call(n)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=n},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(t){if(t instanceof n)this.evalOrigin=t;else if(t instanceof Object)this.evalOrigin=new n(t);else throw new TypeError("Eval Origin must be an Object or StackFrame");},toString:function(){var n=this.getFunctionName()||"{anonymous}",t="("+(this.getArgs()||[]).join(",")+")",i=this.getFileName()?"@"+this.getFileName():"",r=s(this.getLineNumber())?":"+this.getLineNumber():"",u=s(this.getColumnNumber())?":"+this.getColumnNumber():"";return n+t+i+r+u}},i=0;i<f.length;i++)n.prototype["get"+t(f[i])]=h(f[i]),n.prototype["set"+t(f[i])]=function(n){return function(t){this[n]=Boolean(t)}}(f[i]);for(r=0;r<e.length;r++)n.prototype["get"+t(e[r])]=h(e[r]),n.prototype["set"+t(e[r])]=function(n){return function(t){if(!s(t))throw new TypeError(n+" must be a Number");this[n]=Number(t)}}(e[r]);for(u=0;u<o.length;u++)n.prototype["get"+t(o[u])]=h(o[u]),n.prototype["set"+t(o[u])]=function(n){return function(t){this[n]=String(t)}}(o[u]);return n})},{}],11:[function(t,i,r){(function(u,f){"use strict";typeof n=="function"&&n.amd?n("stacktrace-gps",["source-map","stackframe"],f):typeof r=="object"?i.exports=f(t("source-map/lib/source-map-consumer"),t("stackframe")):u.StackTraceGPS=f(u.SourceMap||u.sourceMap,u.StackFrame)})(this,function(n,t){"use strict";function u(n){return new Promise(function(t,i){var r=new XMLHttpRequest;r.open("get",n);r.onerror=i;r.onreadystatechange=function(){r.readyState===4&&(r.status>=200&&r.status<300||n.substr(0,7)==="file://"&&r.responseText?t(r.responseText):i(new Error("HTTP status: "+r.status+" retrieving "+n)))};r.send()})}function f(n){if(typeof window!="undefined"&&window.atob)return window.atob(n);throw new Error("You must supply a polyfill for window.atob in this environment");}function e(n){if(typeof JSON!="undefined"&&JSON.parse)return JSON.parse(n);throw new Error("You must supply a polyfill for JSON.parse in this environment");}function o(n,t){for(var i,o,h,r,u,s=[/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,/function\s+([^('"`]*?)\s*\(([^)]*)\)/,/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,/\b(?!(?:if|for|switch|while|with|catch)\b)(?:(?:static)\s+)?(\S+)\s*\(.*?\)\s*\{/,/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*\(.*?\)\s*=>/],c=n.split("\n"),f="",l=Math.min(t,20),e=0;e<l;++e)if(i=c[t-e-1],o=i.indexOf("//"),o>=0&&(i=i.substr(0,o)),i)for(f=i+f,h=s.length,r=0;r<h;r++)if(u=s[r].exec(f),u&&u[1])return u[1];return undefined}function s(){if(typeof Object.defineProperty!="function"||typeof Object.create!="function")throw new Error("Unable to consume source maps in older browsers");}function i(n){if(typeof n!="object")throw new TypeError("Given StackFrame is not an object");else if(typeof n.fileName!="string")throw new TypeError("Given file name is not a String");else if(typeof n.lineNumber!="number"||n.lineNumber%1!=0||n.lineNumber<1)throw new TypeError("Given line number must be a positive integer");else if(typeof n.columnNumber!="number"||n.columnNumber%1!=0||n.columnNumber<0)throw new TypeError("Given column number must be a non-negative integer");return!0}function h(n){var t=/\/\/[#@] ?sourceMappingURL=([^\s'"]+)\s*$/m.exec(n);if(t&&t[1])return t[1];throw new Error("sourceMappingURL not found");}function c(n,i,r){return new Promise(function(u,f){var e=i.originalPositionFor({line:n.lineNumber,column:n.columnNumber}),o;e.source?(o=i.sourceContentFor(e.source),o&&(r[e.source]=o),u(new t({functionName:e.name||n.functionName,args:n.args,fileName:e.source,lineNumber:e.line,columnNumber:e.column}))):f(new Error("Could not get original source for given stackframe and source map"))})}return function r(l){if(!(this instanceof r))return new r(l);l=l||{};this.sourceCache=l.sourceCache||{};this.sourceMapConsumerCache=l.sourceMapConsumerCache||{};this.ajax=l.ajax||u;this._atob=l.atob||f;this._get=function(n){return new Promise(function(t,i){var f=n.substr(0,5)==="data:",e,r,u;if(this.sourceCache[n])t(this.sourceCache[n]);else if(l.offline&&!f)i(new Error("Cannot make network requests in offline mode"));else if(f)if(e=/^data:application\/json;([\w=:"-]+;)*base64,/,r=n.match(e),r){var s=r[0].length,h=n.substr(s),o=this._atob(h);this.sourceCache[n]=o;t(o)}else i(new Error("The encoding of the inline sourcemap is not supported"));else u=this.ajax(n,{method:"get"}),this.sourceCache[n]=u,u.then(t,i)}.bind(this))};this._getSourceMapConsumer=function(t,i){return new Promise(function(r){if(this.sourceMapConsumerCache[t])r(this.sourceMapConsumerCache[t]);else{var u=new Promise(function(r,u){return this._get(t).then(function(t){typeof t=="string"&&(t=e(t.replace(/^\)\]\}'/,"")));typeof t.sourceRoot=="undefined"&&(t.sourceRoot=i);r(new n.SourceMapConsumer(t))},u)}.bind(this));this.sourceMapConsumerCache[t]=u;r(u)}}.bind(this))};this.pinpoint=function(n){return new Promise(function(t,i){this.getMappedLocation(n).then(function(n){function i(){t(n)}this.findFunctionName(n).then(t,i)["catch"](i)}.bind(this),i)}.bind(this))};this.findFunctionName=function(n){return new Promise(function(r,u){i(n);this._get(n.fileName).then(function(i){var u=n.lineNumber,f=n.columnNumber,e=o(i,u,f);e?r(new t({functionName:e,args:n.args,fileName:n.fileName,lineNumber:u,columnNumber:f})):r(n)},u)["catch"](u)}.bind(this))};this.getMappedLocation=function(n){return new Promise(function(t,r){s();i(n);var f=this.sourceCache,u=n.fileName;this._get(u).then(function(i){var r=h(i),o=r.substr(0,5)==="data:",e=u.substring(0,u.lastIndexOf("/")+1);return r[0]==="/"||o||/^https?:\/\/|^\/\//i.test(r)||(r=e+r),this._getSourceMapConsumer(r,e).then(function(i){return c(n,i,f).then(t)["catch"](function(){t(n)})})}.bind(this),r)["catch"](r)}.bind(this))}}})},{"source-map/lib/source-map-consumer":7,stackframe:10}],12:[function(t,i,r){(function(u,f){"use strict";typeof n=="function"&&n.amd?n("stacktrace",["error-stack-parser","stack-generator","stacktrace-gps"],f):typeof r=="object"?i.exports=f(t("error-stack-parser"),t("stack-generator"),t("stacktrace-gps")):u.StackTrace=f(u.ErrorStackParser,u.StackGenerator,u.StackTraceGPS)})(this,function(n,t,i){function u(n,t){var i={};return[n,t].forEach(function(n){for(var t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i}),i}function f(n){return n.stack||n["opera#sourceloc"]}function o(n,t){return typeof t=="function"?n.filter(t):n}var r={filter:function(n){return(n.functionName||"").indexOf("StackTrace$$")===-1&&(n.functionName||"").indexOf("ErrorStackParser$$")===-1&&(n.functionName||"").indexOf("StackTraceGPS$$")===-1&&(n.functionName||"").indexOf("StackGenerator$$")===-1},sourceCache:{}},e=function(){try{throw new Error;}catch(n){return n}};return{get:function(n){var t=e();return f(t)?this.fromError(t,n):this.generateArtificially(n)},getSync:function(i){i=u(r,i);var s=e(),h=f(s)?n.parse(s):t.backtrace(i);return o(h,i.filter)},fromError:function(t,f){f=u(r,f);var e=new i(f);return new Promise(function(i){var r=o(n.parse(t),f.filter);i(Promise.all(r.map(function(n){return new Promise(function(t){function i(){t(n)}e.pinpoint(n).then(t,i)["catch"](i)})})))}.bind(this))},generateArtificially:function(n){n=u(r,n);var i=t.backtrace(n);return typeof n.filter=="function"&&(i=i.filter(n.filter)),Promise.resolve(i)},instrument:function(n,t,i,r){if(typeof n!="function")throw new Error("Cannot instrument non-function object");else if(typeof n.__stacktraceOriginalFn=="function")return n;var u=function(){try{return this.get().then(t,i)["catch"](i),n.apply(r||this,arguments)}catch(u){f(u)&&this.fromError(u).then(t,i)["catch"](i);throw u;}}.bind(this);return u.__stacktraceOriginalFn=n,u},deinstrument:function(n){if(typeof n!="function")throw new Error("Cannot de-instrument non-function object");else return typeof n.__stacktraceOriginalFn=="function"?n.__stacktraceOriginalFn:n},report:function(n,t,i,r){return new Promise(function(u,f){var e=new XMLHttpRequest,o,s,h;if(e.onerror=f,e.onreadystatechange=function(){e.readyState===4&&(e.status>=200&&e.status<400?u(e.responseText):f(new Error("POST to "+t+" failed with status: "+e.status)))},e.open("post",t),e.setRequestHeader("Content-Type","application/json"),r&&typeof r.headers=="object"){o=r.headers;for(s in o)o.hasOwnProperty(s)&&e.setRequestHeader(s,o[s])}h={stack:n};i!==undefined&&i!==null&&(h.message=i);e.send(JSON.stringify(h))})}}})},{"error-stack-parser":1,"stack-generator":9,"stacktrace-gps":11}]},{},[12])(12)});window.location.hostname!=="localhost"&&(__errorPool=[],window.onerror=function(n,t,i,r,u){var f,e;if(t!="https://www.findizer.fr/partners/js/analytics.js.php?app=imccalcular")return("Loading"in window&&"hide"in Loading&&typeof Loading.hide=="function"&&Loading.hide(),f=[""],n&&n.toString&&(f=n.toString().split("[innerscript]")),__errorPool[f[0]]&&__errorPool[f[0]]>1e3)?void 0:(__errorPool[f[0]]&&__errorPool[f[0]]%100!=0?++__errorPool[f[0]]:(__errorPool[f[0]]?(++__errorPool[f[0]],f[0]+="::EXCEPTION_HITS="+__errorPool[f[0]]):__errorPool[f[0]]=1,e=function(n){var e=n.map(function(n){return n.toString()}).join("\n"),u={};u.data=navigator.userAgent+"|"+navigator.vendor+"|"+navigator.platform;u.lineNumber=i;u.columnNumber=r;u.url=t;u.page=escape(window.location.href);u.message=f[0].replace(/</g,"&lt;").replace(/>/g,"&gt;");u.docState=document.readyState;u.stackTrace=e;f.length>1&&(u.script=escape(f[1]));$.ajax("/EgoCore/Global/LogJavaScriptError",{method:"POST",data:HttpUtility.objectToQuery(u)})},StackTrace.fromError(u).then(e)),!0)});var Extranet=function(){var n=function(n,t){for(var r=document.querySelectorAll(".extranet_actions_"+n),i=r.length-1;i>=0;i--)r[i].style.display=t&&r[i].classList.contains("activated")||!t&&r[i].classList.contains("deactivated")?"none":""};return{openPopup:function(n,t,i){ajaxRequest(n,t,"GET",Requests.get(Requests.keys.ObjectID)+"="+i)},activate:function(t,i,r){var u=t.up(".popupBox");u&&ajaxRequest(t,i,"POST",$(u).find("input, select").serializeAll(),function(t){t.status==1&&n(r)})},serializeRequest:function(n,t,i){if(n){var r=$("#ContentOwner_"+i);r&&ajaxRequest(n,t,"POST",$(r).find("input, select").serializeAll())}},reloadExtranetSettings:function(n,t,i,r){ajaxRequest(n,t,"GET",i,function(n){if(n.replaces||n.updates){var t=$("#"+r);t&&t.slideDown()}})},deactivate:function(t,i,r,u){MessageBox.confirm(u,Translations.get(Translations.keys.Yes),function(){ajaxRequest(t,i,"GET",Requests.get(Requests.keys.ObjectID)+"="+r,function(t){t.status==1&&n(r,!0)})},"",Translations.get(Translations.keys.No))},deactivateWContent:function(n,t,i,r,u,f){MessageBox.confirm(f,Translations.get(Translations.keys.Yes),function(){ajaxRequest(n,t,"GET",r,function(n){n.status==1&&Extranet.reloadExtranetSettings(null,i,r,u)})},"",Translations.get(Translations.keys.No))},togglePasswordEdit:function(n){if(n){var t=n.up(".ItemContext");t&&($(t.querySelector(".DisplayItem")).hide(),$(t.querySelector(".EditButton")).hide(),$(t.querySelector(".EditItem")).show())}},quickSavePassword:function(n,t,i){var r,u;n&&(r=n.up(".ItemContext"),r&&(u=$(r.querySelector(".EditItem")).val(),i=appendStringParams($(r).find("*").serializeAll(),i),ajaxRequest(n,t,"POST",i,function(n){n.status==ajaxRequest.StatusType.Success&&($(r.querySelector(".DisplayItem")).text(u),$(r.querySelector(".DisplayItem")).show(),$(r.querySelector(".EditButton")).show(),$(r.querySelector(".EditItem")).hide())})))},createExternalAccess:function(n,t,i,r){if(n){var u=n.up(".popupBox");u&&(i=appendStringParams(i,$(u).find(":input").serializeAll()),i=appendStringParams(i,Media.serializeTarget(r)),ajaxRequest(n,t,"POST",i))}}}}(),Media=function(){function c(){return s||(s={typeError:Translations.get(Translations.keys.UNSUPPORTED_FILE_TYPE),sizeError:Translations.get(Translations.keys.ERROR_FILE_SIZE),minSizeError:"",emptyError:"",onLeave:"",notSupported:Translations.get(Translations.keys.UPLOAD_NOT_ALLOWED)}),s}function i(n,t,i,r,u,f){var e={button:n,request:{endpoint:t},multiple:i?!0:!1,preventDefault:!0,messages:c(),callbacks:r,text:{fileInputTitle:n.getAttribute("data-input-title")}};return isObject(u)&&(e.request.params=u),isObject(f)&&(e.validation=f),e}function u(n){return n.getAttribute("data-multiple")!=null}function l(n){function r(n){return t.push(n),!0}function i(n){for(var r=typeof n,i=0;i<t.length;i++)if(t[i].UID==n)return t[i];return null}function u(n){var t=i(n.toString());return t?(t.Deleted=!0,!0):!1}function f(n){if(t.length==0)return"";var i=JSON.stringify(t);return n?encodeURIComponent(i):i}function e(){for(var n=0;n<t.length;n++)if(t[n].Deleted==!1&&t[n].IsTemp||t[n].Deleted&&t[n].IsTemp==!1)return!0;return!1}var t=n;return{addItem:r,getItem:i,deleteItem:u,IsUploading:!1,serialize:f,ItemList:t,hasNewMedia:e}}function f(n,t,i,r,u){typeof i=="string"&&(i=document.querySelector(i));var f,e;return(n.MyMedia=l(ensureArray(t)),r||(r=n.parentNode),f=r.querySelector(".EgoUpload"),!f&&i&&(f=i.querySelector(".EgoUpload")),!f)?null:(i?i.id?e=i.id:(e=guid(),i.setAttribute("id",e)):e=n.id,f.setAttribute("data-lock-id",e),f.setAttribute("data-attach-ctx-id",n.id),EventHandler.addListener(f,"click",function(n){var t=document.getElementById(this.getAttribute("data-attach-ctx-id"));return t?t.MyMedia.IsUploading?(MessageBox.alert(Translations.get(Translations.keys.CurrentlyUploadingFile)),stopEventPropagation(n,!0),!1):!u&&!Limit.withinLimit(Limit.LimitType.AddMedia)?(n.preventDefault(),stopEventPropagation(n,!0),!1):void 0:!1}),f)}function p(n,t,i){var r;return t.MyMedia=l([]),i?i.id?r=i.id:(r=guid(),i.setAttribute("id",r)):r=t.id,n.setAttribute("data-lock-id",r),n.setAttribute("data-attach-ctx-id",t.id),EventHandler.addListener(n,"click",function(n){var t=document.getElementById(this.getAttribute("data-attach-ctx-id"));return t?t.MyMedia.IsUploading?(MessageBox.alert(Translations.get(Translations.keys.CurrentlyUploadingFile)),stopEventPropagation(n,!0),!1):Limit.withinLimit(Limit.LimitType.AddMedia)?void 0:(stopEventPropagation(n,!0),!1):!1}),n}function a(n){var i=n.getAttribute("data-loading-uid"),t=n.up().querySelector("."+i);return t||(t=createHtmlElement("div",{id:"attachLoading","class":"loading "+i},[createHtmlElement("i",{"class":"icon-loading"})]),n.getAttribute("data-loading-position")=="before"?n.up().insertBefore(t,n):n.tryAddAfter(t)),t}function e(n){var t=n?document.getElementById(n.getAttribute("data-attach-ctx-id")):null;t&&(t.MyMedia.IsUploading=!0,Element.show(a(n)))}function t(n,t){var i=n?document.getElementById(n.getAttribute("data-lock-id")):null;i&&(t?i.removeAttribute("ajaxRequest"):i.setAttribute("ajaxRequest","true"))}function w(n,t,i){var e,o,u,f,r;return t=t||"",i=i||"",e=createHtmlElement("a",{href:"javascript:void(0);","class":"blueOutlineBtn",onclick:'Media.removeMedia(this, "'+t+'", "'+i+'");',title:Translations.get(Translations.keys.Delete)}),e.appendChild(createHtmlElement("i",{"class":"icon-fechar"})),o=createHtmlElement("div",{"class":"clearContent"}),o.appendChild(e),u=createHtmlElement("a",{href:n.Src,"class":"grayLink",download:n.Name,target:"_blank",title:n.Name}),u.appendChild(createHtmlElement("i",{"class":"icon-doc"})),u.appendChild(document.createTextNode(" "+n.Name)),f=createHtmlElement("div",{"class":"userTeamCard"}),f.appendChild(o),f.appendChild(u),r=createHtmlElement("div",{id:"AttachAsset_"+n.UID,"class":"col-4 AttachAsset"}),r.setAttribute("data-id",n.ID),r.setAttribute("data-uid",n.UID),r.appendChild(f),r}function b(t){switch(t){case n.AttachmentsOnProposalList:return!1;default:return!0}}function o(t,i,r,u){var f,c,l,e,v;if(t){f=document.getElementById(t.getAttribute("data-attach-ctx-id"));Element.hide(a(t));var h="",o=!1,s=null;if(typeof r!="number"&&(r=parseInt(t.getAttribute("data-upload-type"))||n.Attachments),i)switch(r){case n.FileArchive:i.status==ajaxRequest.StatusType.Success&&isObject(i.data)&&i.data.mediaHtml&&(Element.hide(f.querySelector(".NoContentMessage")),e=htmlStringToElement(i.data.mediaHtml),e.style.display="none",c=f.querySelector(".SubLevelContext"),c?c.up().insertBefore(e,c):f.appendChild(e),$(e).fadeIn(),o=!0);break;case n.AgencyNews:i.status==ajaxRequest.StatusType.Success&&isObject(i.data)&&i.data.mediaHtml&&i.data.isAgencyNewsUpload?i.data.mediaList&&i.data.mediaList.length>0&&(s=[],JSON.parse(i.data.mediaList).forEach(function(n){f.MyMedia.addItem(n);s.push(n)}),i.data.isDocument?document.querySelector(".agencyNewsFileContainer").innerHTML+=i.data.mediaHtml:document.querySelector(".contentPhotos").innerHTML+=i.data.mediaHtml,o=!0):i.status==ajaxRequest.StatusType.Success&&isObject(i.data)&&i.data.mediaHtml&&i.data.isVideo&&(i.data.mediaList&&i.data.mediaList.length>0&&(f.MyMedia.addItem(JSON.parse(i.data.mediaList)),document.querySelector(".contentVideos").innerHTML+=i.data.mediaHtml,o=!0,s=f.MyMedia.ItemList.last()),Popup.close());break;case n.EntityBlacklist:i.status==ajaxRequest.StatusType.Success&&isObject(i.data)&&i.data.mediaHtml&&i.data.mediaItem&&(f.MyMedia.addItem(i.data.mediaItem)&&(e=htmlStringToElement(i.data.mediaHtml),f.appendChild(e),o=!0,s=f.MyMedia.ItemList.last()),o||(h=i.error));break;case n.UploadRemaxImport:if(i.status==ajaxRequest.StatusType.Success){if(i.updates&&$(i.updates).length>0)for(key in i.updates)content=i.updates[key],content&&document.querySelectorAll(key).forEach(function(n){$(n).html(content)});o=!0}o||(h=i.error);break;case n.TimelineFile:i.status==ajaxRequest.StatusType.Success&&isObject(i.data)&&i.data.mediaHtml&&(e=htmlStringToElement(i.data.mediaHtml),e.style.display="none",f.hide(),t.hide(),f.up().appendChild(e),$(e).fadeIn(),o=!0);break;case n.ContractTemplate:i&&i.status===ajaxRequest.StatusType.Success&&(o=!0);break;case n.CompanyImages:case n.EntityAvatar:case n.AttachmentsOnProposalList:case n.AttachmentsOnProposalPopup:case n.Attachments:default:i&&(i.success&&(l=i.MediaItem||i.Media,f.MyMedia.addItem(l)&&(b(r)&&(e=w(l,f.getAttribute("data-delete-url"),f.getAttribute("data-delete-params")),e.style.display="none",f.appendChild(e),$(e).fadeIn()),o=!0,s=f.MyMedia.ItemList.last())),o||(h=i.error||i.message))}return o?typeof u==typeof Function&&u(f,t,s):MessageBox.alert(h||Translations.get(Translations.keys.ErrorUploadingFile)),t._uplHandler?(v=t._uplHandler.getRemainingAllowedItems(),f.MyMedia.IsUploading=v&&v.length>0):f.MyMedia.IsUploading=!1,f}}function r(n){n.MyMedia.hasNewMedia()?n.querySelector(".newMedia")||n.appendChild(createHtmlElement("input",{type:"hidden",name:"_mediaChk","class":"newMedia",value:"1"})):n.querySelectorAll(".newMedia").invoke("remove")}function k(n){return n?parseInt(n.getAttribute("data-size-limit"))||0:0}function d(n){if(!n)return[];var t=n.getAttribute("data-formats");return t?(t=t.replace(/[\*\.]/g,""),t.split(",")):[]}function v(n,t){var i,r;return n?(i=n.getAttribute("data-formats"),i=="")?!0:(r=","+t.substring(t.lastIndexOf(".")).toLowerCase()+",",(","+i.replace(/\*/g,"")+",").indexOf(r)==-1)?(MessageBox.alert(Translations.get(Translations.keys.UnsupportedFileType)),!1):!0:!0}function y(n,s,h,l,a,v,y,p){var g=typeof n=="string"?document.querySelector(n):n,w,b,nt,tt;if(g&&(w=g.querySelector(".AttachList"),w)){if(w.id||(w.id="AttachList_"+shortGuid()),g.setAttribute("data-attach-list",w.id),b=f(w,h,l,null,p),!b){console.warn("Media[_setupUpload]: button not found. execution has stopped for the following target:");console.log(n);return}nt={onSubmit:function(){e(this._options.button);t(this._options.button,!1)},onComplete:function(n,i,u){var f=o(this._options.button,u,a,y);r(f);t(this._options.button,!0)},onError:function(n,t,i){if(i){var r=!1;forEachProp(c(),function(n,t){if(t[n]===i)return r=!0,!1});r&&MessageBox.alert(i)}}};tt={sizeLimit:k(w),allowedExtensions:d(w)};b._uplHandler=new qq.FineUploaderBasic(i(b,s,u(w),nt,v,tt))}}function h(n){return n.classList.contains("AttachList")?n:n.hasAttribute("data-attach-list")?n.querySelector("#"+n.getAttribute("data-attach-list")):null}var n=Object.freeze({Attachments:0,FileArchive:1,AgencyNews:2,EntityBlacklist:3,Video:4,UploadRemaxImport:5,TimelineFile:6,AttachmentsOnProposalList:7,AttachmentsOnProposalPopup:8,ExtranetMessage:9,ContractTemplate:10,CompanyImages:11,EntityAvatar:12}),s=null;return{UploadHandlerType:n,removeMedia:function(n,t,i,u){var f=n.classList.contains("AttachAsset")&&n||n.up(".AttachAsset")||$(n).parents(".userTeamCard:first").parent().get(),e,s,o;if(!f){console.error("Media.removeMedia: caller invalido.");console.log(n);return}if(e=f.getAttribute("data-uid"),s=f.getAttribute("data-id"),!e){console.error("Media.removeMedia: UID nao encontrado.");console.log(n);console.log(f);return}o=function(n,t){var i=n.up(".AttachList"),u;i?(i.MyMedia.deleteItem(t)&&Element.remove(i.querySelector('[id="AttachAsset_'+t+'"]')),r(i),u=i.querySelector(".EgoUpload"),u&&u.style.display=="none"&&u.show()):n.up(".inputInfoContent")&&(i=n.up(".inputInfoContent").querySelector(".AttachList"),i.MyMedia.deleteItem(t)&&Element.remove(i.querySelector('[id="AttachAsset_'+t+'"]')),r(i))};t&&i?(u=u||"POST",i=appendStringParams(i,Requests.getPair(Requests.keys.MediaID,s)),ajaxRequest(n,t,u,i,function(t){t.status===ajaxRequest.StatusType.Success&&o(n,e)})):o(n,e)},markChanges:r,getBasicOptions:i,setupUpload:y,setupUploadWebSites:function(r,s,h,c,l){var y=r.querySelector(".AttachList"),a;if(y){if(a=f(y,h,l),!a){console.warn("Media.setupUploadWebSites: button not found. execution has stopped for the following target:");console.log(r);return}a._uplHandler=new qq.FineUploaderBasic(i(a,s,u(y),{onSubmit:function(n,i){if(v(r,i)===!1)return!1;var u=this._options.button.up("#contentPlugin");u;e(this._options.button);t(this._options.button,!1)},onComplete:function(i,r,u){o(this._options.button,u,n.Attachments);c&&WebSiteTemplate.SetChanges(c);t(this._options.button,!0)}}))}},setupUploadFileArchive:function(r,s,h,c,l){var v=r.querySelectorAll(".AttachList"),a,y,d,b,p,g,w,k;if(v&&v.length!=0)for(w=0;w<v.length;w++)(a=v[w],y=a.getAttribute("data-upload-map-key"),a&&y)&&(d=h[y]||[],b=a.up(".ArchiveBox"),p=f(a,d,b,b),p&&(g={onSubmit:function(){e(this._options.button);t(this._options.button,!1)},onComplete:function(i,r,u){var f=o(this._options.button,u,n.FileArchive,l);t(this._options.button,!0)}},k=HttpUtility.queryToObject(c),k[Requests.get(Requests.keys.CategoryID)]=y,p._uplHandler=new qq.FineUploaderBasic(i(p,s,u(a),g,k))))},setupUploadContactByFile:function(n,f,o,s,h){var c=n.querySelector(".AttachList"),v,y,w,l,b,a;if(c){if(v=[],y=n.getAttribute("data-allowedExtensions").split(".").join(""),y!=null)for(w=y.split(","),l=0;l<w.length;l++)v.push(w[l]);if(b={allowedExtensions:v},a=p(n,c,o),!a){console.warn("Media.setupUploadContactByFile: button not found. execution has stopped for the following target:");console.log(n);return}a._uplHandler=new qq.FineUploaderBasic(i(a,f,u(c),{onSubmit:function(i,r){if(n.getAttribute("data-allowedextensions")!=""){var u=","+r.substring(r.lastIndexOf(".")).toLowerCase()+",";if((","+n.getAttribute("data-allowedextensions").replace(/\*/g,"")+",").indexOf(u)==-1)return MessageBox.alert(Translations.get(Translations.keys.UNSUPPORTED_FILE_TYPE)),!1}e(this._options.button);t(this._options.button,!1);Loading.show()},onComplete:function(n,i,u){if(Loading.hide(),u.success){var f=[];f.push(Requests.get(Requests.keys.FileName)+"="+i);f.push(Requests.get(Requests.keys.FilePath)+"="+encodeURIComponent(u.MediaItem.PhysicalPath+u.MediaItem.File));f.push(Requests.get(Requests.keys.FileFormat)+"="+h);f=f.filter(function(n){return n.length}).join("&");Entity.openImportEntityByFilePopup("",s,f)}r(c);t(this._options.button,!0)},onError:function(n,t,i){console.log(i);MessageBox.alert(Translations.get(Translations.keys.GenericError))}},null,b))}},setupUploadBlacklist:function(s,h,c){var a=s.querySelector(".AttachList"),l,v;if(a){if(l=f(a,[],c),!l){console.warn("Media.setupUploadBlacklist: button not found. execution has stopped for the following target:");console.log(s);return}v={onSubmit:function(){e(this._options.button);t(this._options.button,!1)},onComplete:function(i,u,f){var e=o(this._options.button,f,n.EntityBlacklist);r(e);t(this._options.button,!0)}};l&&(l._uplHandler=new qq.FineUploaderBasic(i(l,h,u(a),v)))}},replaceUploaderHtml:function(n,t){var i,r;n&&typeof t=="string"&&(i=n.querySelector(".AttachList"),i)&&(r=i.parentNode,i.remove(),n.querySelector(".EgoUpload").remove(),Element.remove(n.querySelector("#attachLoading")),r)&&(r.innerHTML+=t)},setupUploadAgencyNewsVideo:function(n,e,s,h,c,l){var a=n.querySelector(".AttachList"),v;if(a){if(v=f(a,h,c),!v){console.warn("Media.setupUploadAgencyNewsVideo: button not found. execution has stopped for the following target:");console.log(n);return}YoutubeExporter.directUploadHandler&&YoutubeExporter.directUploadHandler._button._input.remove();YoutubeExporter.directUploadHandler=new qq.FineUploaderBasic(i(v,e,u(a),{onSubmit:function(n){if($("#galleryInfo").length){var t=$("#galleryInfo").find("*").serializeAll();this.setParams(JSON.parse('{"'+t.replace(/&/g,'","').replace(/=/g,'":"')+'"}',function(n,t){return n===""?t:decodeURIComponent(t)}),n)}else return s(n),!1},onUpload:function(n){if(Loading.show(),$("#galleryInfo").length){var t=$("#galleryInfo").find("*").serializeAll();this.setParams(JSON.parse('{"'+t.replace(/&/g,'","').replace(/=/g,'":"')+'"}',function(n,t){return n===""?t:decodeURIComponent(t)}),n)}},onComplete:function(n,i,u){Loading.hide();var f=o(this._options.button,u,l);r(f);t(this._options.button,!0)}}))}},setupUploadRemaxImport:function(s,h,c,l){var y=s.querySelector(".AttachList"),a;if(y){if(a=f(y,c,l),!a){console.warn("Media.setupUploadRemaxImport: button not found. execution has stopped for the following target:");console.log(s);return}a._uplHandler=new qq.FineUploaderBasic(i(a,h,u(y),{onSubmit:function(n,i){if(a.getAttribute("data-attach-ctx-id")!=""&&v(document.getElementById(a.getAttribute("data-attach-ctx-id")),i)===!1)return!1;e(this._options.button);t(this._options.button,!1)},onComplete:function(i,u,f){var e=o(this._options.button,f,n.UploadRemaxImport);r(e);t(this._options.button,!0)}}))}},setupUploadTimelineFile:function(t,i){t&&t.querySelectorAll(".RelatedMedia:not(.UploadSetupFinished)").forEach(function(t){if(t.querySelector(".EgoUpload")){var r=HttpUtility.queryToObject(decodeURIComponent(t.getAttribute("data-parameters")));y(t,t.getAttribute("data-upload-url"),[],t,n.TimelineFile,r,i);t.addClassName("UploadSetupFinished")}})},bulkMoveAction:function(n,t){if(n){var i=[];$("#FileArchiveCategories input[type='checkbox']").each(function(){this.checked&&i.push(this.getAttribute("data-object-id"))});i&&i.length>0&&ajaxRequest(n,t,"POST",Requests.get(Requests.keys.ObjectIDs)+"="+i)}},bulkDeleteMediasAction:function(n,t,i){if(n){var r=[],u=[];if($("#FileArchiveCategories input[type='checkbox']").each(function(){this.checked&&(r.push(this.getAttribute("data-object-id")),u.push(this))}),r.length>0)MessageBox.confirm(i.format(r.length),Translations.get(Translations.keys.Yes),function(){ajaxRequest(n,t,"POST",Requests.get(Requests.keys.ObjectIDs)+"="+r,function(n){n.status==ajaxRequest.StatusType.Success&&u&&u.length>0&&u.forEach(function(n){if(n){var t=n.up(".dashboardBoxLine");t&&t.remove()}})})},"",Translations.get(Translations.keys.Cancel));else return}},sendAllByEmail:function(n,t,i){var r,u;n&&(r=[],$("#FileArchiveCategories input[type='checkbox']").each(function(){this.checked&&r.push(this.getAttribute("data-object-id"))}),u=i,u+="&"+Requests.get(Requests.keys.ObjectIDs)+"="+r,Email.popup(n,t,u))},serializeTarget:function(n,t){var i,r;return n?(t||(console.warn("Media.serializeTarget: requestKey invalida ou nao fornecida. Será usada a seguinte:"),console.log(Requests.get(Requests.keys.Medias)),t=Requests.get(Requests.keys.Medias)),i=h(n),!i)?(console.error("Media.serializeTarget: contentor de media nao encontrado para o target fornecido."),console.log(n),""):(r=i.MyMedia&&i.MyMedia.ItemList&&i.MyMedia.ItemList.length?i.MyMedia.serialize(!0):"[]",t+"="+r):(console.error("Media.serializeTarget: target invalido ou nao fornecido."),console.log(n),"")},hasMedia:function(n){if(!n)return console.error("Media.hasMedia: target invalido ou nao fornecido."),console.log(n),!1;var t=h(n);return t?t.MyMedia&&t.MyMedia.ItemList&&t.MyMedia.ItemList.length&&t.MyMedia.ItemList.find(function(n){return n.Deleted!=!0})?!0:!1:(console.error("Media.hasMedia: contentor de anexos nao encontrado para o target fornecido."),console.log(n),!1)},getMediaAssets:function(n){if(!n)return console.error("Media.getMediaAssets: target invalido ou nao fornecido."),console.log(n),[];var t=h(n);return t?t.querySelectorAll(".AttachAsset").map(function(n){return n}):(console.error("Media.getMediaAssets: contentor de media nao encontrado para o target fornecido."),console.log(n),[])},contractNextStep:function(n,t,i){var e=n.up(".popupBox"),f=$("#maxStep").val(),r=$("#currentStep").val(),u=parseInt(r,10)+1;i=appendStringParams(i,"step="+u);i=appendStringParams(i,$(e).find("*").serializeAll());ajaxRequest(n,t,"POST",i,function(n){n.status==ajaxRequest.StatusType.Success&&(r>=1&&$("#previousButton").show(),r==parseInt(f,10)-1&&($("#finishButton").show(),$("#nextButton").hide(),$("#cancelButton").hide()),r<f&&($("#contractStep_"+r).hide(),$("#contractStep_"+u).show(),$("#currentStep").val(u)))})},contractPreviousStep:function(){var t=$("#maxStep").val(),n=$("#currentStep").val();n==2&&$("#previousButton").hide();n==t&&($("#finishButton").hide(),$("#nextButton").show(),$("#cancelButton").show());n>1&&($("#contractStep_"+n).hide(),$("#contractStep_"+(parseInt(n,10)-1)).show(),$("#currentStep").val(parseInt(n,10)-1))},contractToggleSearchBox:function(n,t){$("#display_"+n).hide();$("#edit_"+n).show();t&&($("#display_"+n).show(),$("#edit_"+n).hide())},toogleCustomContract:function(n,t){if(n.checked)$("#items").show();else{n.checked=!0;var i=function(){n.checked=!1;$("#items").hide();$("#input.WordTag").each(function(n){n.value=n.readAttribute("defaultValue")});Media.contractIsContentChanged=!1};Media.contractIsContentChanged==!0?MessageBox.confirm(t,Translations.get(Translations.keys.Yes),i,null,Translations.get(Translations.keys.No)):i()}},contractChangeInputSelection:function(n,t,i){var r=[],u=$(n).val();$('input[name^="'+n.name.split("_")[2]+'."]').each(function(n){r.push(n.name);n.name.toLowerCase().includes("signature")||(n.value="")});i=appendStringParams(i,"val="+u+"&type=entity");u>0?ajaxRequest(n,t,"POST",i,function(n){n.status==ajaxRequest.StatusType.Success&&n.data.keys&&forEachProp(data.keys,function(n){n.toLowerCase().includes("signature")||$('input[name="'+n+'"]').each(function(t){t.value=data.keys[n];t.setAttribute("defaultValue",data.keys[n])})})}):r.each(function(n){$$('input[name="'+n+'"]').each(function(n){n.name.toLowerCase().includes("signature")||(n.value="",n.setAttribute("defaultValue",""))})})},contractIsContentChanged:!1,contractCustomContentChanged:function(){Media.contractIsContentChanged=!0},contractUpdateFieldEdit:function(n){var t=n.name;$('#input[name="'+t+'"]').each(function(t){t.value=n.value})}}}(),EgoSms=function(){function t(t,i){var r,u,f=i==n.charLimits.complete;n.hasSpecialChars!=f&&(n.lengthBySms=i,r="0",u=t.querySelector(".CountDisplay"),u&&(r=u.innerText),t.innerHTML='<span class="CountDisplay">'+r+"<\/span>/"+n.lengthBySms,n.hasSpecialChars=f)}function i(i){var s,u,p,k,l,a,o,h,c,e,w,r,b,v,f=i,y;if(!f&&(n.smsBodyID&&(f=document.getElementById(n.bodyID)),!f)){console.warn("EgoSms.updateCharCounter: nao � possivel atualizar o contador de caracteres sem target");return}if("jQuery"in window&&f instanceof jQuery&&(f=f.get(0)),s=f.up().querySelector("#SmsCountHolder"),s&&(u=s.querySelector(".SmsCharCount"),k=s.querySelector(".SmsCount")),!u||!k){console.warn("impossivel atualizar contador de caracteres da SMS. elementos nao encontrados");return}if(l=f.value||"",r=l,a=r.length,o=s.querySelector(".ContactInfoWarning"),b=!1,o){if(h=/\[\[([a-zA-Z àèìòùáéíóú]*)\]\]/img,c=[],l.length>0)do e=h.exec(l),e&&e.length==2&&e[1]&&(w='"'+e[1].toTitleCase()+'"',c.indexOf(w)==-1&&(c.push(w),r=r.replace(h,"")));while(e&&e.length==2);c.length>0?(o.innerText=n.warningTemplate.format(c.join(", ")),o.show(),t(u,n.charLimits.complete),b=!0):(o.hide(),o.innerText="",t(u,n.charLimits.basic))}if(r.length>0)if(h=new RegExp("^[A-Za-z0-9 \\r\\n@£$¥èéùìòÇØøÅåΔ_ΦΓΛΩΠΨΣΘΞÆæßÉ!\"#$%&'()*+,\\-./:;<=>?¡ÄÖÑÜ§¿äöñüà^{}\\\\\\[~\\]|€]*$"),h.test(r)){if(!b)for(t(u,n.charLimits.basic),v=0,y=0;y<r.length;y++)n.basicDoubledChars.indexOf(r[y])>-1&&v++}else t(u,n.charLimits.complete);a=r.length;v&&(a+=v);u&&(p=u.querySelector(".CountDisplay"));p&&(p.innerHTML=a)}function r(n,t){return forEachProp(t,function(i){t[i]&&i in n&&(n[i]=isObject(t[i])?r(n[i],t[i]):t[i])}),n}var n={bodyID:"",min:1,max:5,lengthBySms:0,hasSpecialChars:!1,warningTemplate:"",charLimits:{basic:160,complete:69},basicDoubledChars:Object.freeze(["|","^","{","}","[","]","~","\\","�"])};return{popupBulk:function(n,t,i){var r=Search.GenericList.getSelectedIDs(!0);if(!r){MessageBox.alert(n.getAttribute("data-no-items-msg"));return}i=appendStringParams(i,Requests.get(Requests.keys.ObjectIDs)+"="+encodeURIComponent(r));ajaxRequest(n,t,"POST",i)},send:function(n,t,i){var u=n.up('[id="'+i+'"]'),f=(u.querySelector('[id="SMSText"]').value||"").trim(),r;if(f.length==0){MessageBox.alert(Translations.get(Translations.keys.MandatoryFields));return}r=$(n.up('[id="'+i+'"]')).find("*").serializeAll()||"";ajaxRequest(n,t,"POST",r,function(n){n.status==ajaxRequest.StatusType.Success&&Popup.close()})},initChartCounter:function(t){if(isObject(t)&&(n=r(n,t)),n.lengthBySms||(n.lengthBySms=n.charLimits.basic),!n.bodyID){console.error("EgoSms.initChartCounter: SMS bodyID invalido ou nao fornecido.");console.log(t);return}var u=$("#"+n.bodyID);u.putCursorAtEnd();i(u)},updateCharCounter:i}}(),Export=function(){return{popup:function(n,t,i,r){var u=[],f;if(!r&&"Search"in window&&"GenericList"in Search?u=Search.GenericList.getSelectedIDs():r>0&&u.push(r),u.length==0){MessageBox.alert(Translations.get(Translations.keys.NoItemsSelected));return}f=appendStringParams(i,Requests.get(Requests.keys.ObjectIDs)+"="+u.join(","));ajaxRequest(n,t,"POST",f)},getFile:function(n,t){var i=n.up(".ExportData"),r=appendStringParams($(i.querySelector(".PrivateData")).find("*").serializeAll(),Requests.get(Requests.keys.Format)+"="+t);ajaxRequest(n,i.getAttribute("data-export-url"),"POST",r,function(n){var r,u;n.status==1&&(Popup.removeLayer(-1),t!="html"&&(i.querySelector(".Step1").hide(),i.querySelector(".Step2").show()),isObject(n.data)&&(n.data.url?(r=i.querySelector(".ExportLink"),r.textContent=n.data.name,r.setAttribute("href",n.data.url)):n.data.content&&(u=window.open(),u.document.write(n.data.content),u.document.close())))})},showDocumentsContainer:function(n){if(!n.getAttribute("ajaxrequest")){var t=n.up(".ExportData");t.querySelector(".DocumentsToExport").show();t.querySelector(".Step1").hide()}},hideDocumentsContainer:function(n){if(!n.getAttribute("ajaxrequest")){var t=n.up(".ExportData");t.down(".DocumentsToExport").hide();t.down(".Step1").show()}},getFileDoc:function(n,t,i){var r=n.up(".ExportData"),u=appendStringParams($(r.querySelector(".PrivateData")).find("*").serializeAll(),[Requests.get(Requests.keys.Format)+"="+t,Requests.get(Requests.keys.Template)+"="+i]);ajaxRequest(n,r.getAttribute("data-export-url"),"POST",u,function(n){if(n.status==1&&(Popup.removeLayer(-1),r.querySelector(".DocumentsToExport").hide(),r.querySelector(".Step2").show(),isObject(n.data)&&n.data.url)){var t=r.querySelector(".ExportLink");t.textContent=n.data.name;t.setAttribute("href",n.data.url)}})}}}(),VirtualTourEditor=function(){function n(n,t){var i=n.coord.split("x"),r=parseInt(i[0]),u=parseInt(i[1]);this.obj=n;this.isCore=n.isCore==1;this.x=this.isCore?r:r*100/t.clientWidth;this.y=this.isCore?u:u*100/t.clientHeight}function o(){function n(){$(".VRPhotoSet").each(function(n,t){var i=$(t).outerWidth(),r=$(t).find(".VRPhotoSetContent > div").width();r>i?($(t).addClass("largeNav"),$(t).prev(".VRPhotoSetNav").show()):($(t).removeClass("largeNav"),$(t).prev(".VRPhotoSetNav").hide())})}this._updatePhotoNavBar=n;this.goLeft=function(n){$(n).closest(".VRPhotos").find(".VRPhotoSetContent").stop().animate({scrollLeft:"-=350"})};this.goRight=function(n){$(n).closest(".VRPhotos").find(".VRPhotoSetContent").stop().animate({scrollLeft:"+=350"})};this.updateHandles=function(){var t=document.getElementById("VTMediaRender");t.querySelector(".VRPhoto")||($(t.parentNode).find(".VRPhoto").hide(),document.getElementById("MessageDiv").innerHTML=Translations.get(Translations.keys.VirtualTourNotImages));n();$(window).on("resize",function(){VirtualTourEditor.MediaStrip._updatePhotoNavBar()})}}function s(){EventHandler.addListener(document.body,"click",function(n){if(n&&n.target&&(n.target.classList.contains("MultiLanguageDropContext")||n.target.up(".MultiLanguageDropContext")))return!1;document.querySelectorAll(".MultiLanguageDropContext.active").forEach(function(n){MultiCultureControl.toggleDrop(n.querySelector(".SelectedLanguage > a.FlagSelector"),!0)})})}function h(n){var t=n.target.querySelector("div.VRPhotoPinClose.Remove");t&&t.hide();n.target.removeAttribute("onclick")}function c(n,r){var p=document.getElementById("TourDiv"),ft,et,l,y,h,g,c,s,a;if($(p).is(":visible")){var w=document.getElementById("VTImage"),it=w.viewportOffset(),v=n.clientX-it.left-document.body.scrollLeft,o=n.clientY-it.top-document.body.scrollTop,b=v,k=o,rt=w.offsetWidth,ut=w.offsetHeight;if(o=ut-o,v=v*360/rt,ft=ut/2,o=o-ft,et=rt/2,o=o*180/et,o+=90,VirtualTourEditor.coordX=v,VirtualTourEditor.coordY=o,VirtualTourEditor.coords=b+"x"+k,l=r.draggable.get(0),y=l.getAttribute("data-vtype"),y=="i")h=createHtmlElement("div",{"class":"VRPhotoPin DragHandle","data-coord":VirtualTourEditor.coords,onclick:"VirtualTourEditor.setDescription(this, '"+VirtualTourEditor.medUID+"', '"+VirtualTourEditor.coords+"');"}),h.style.left=b-16+"px",h.style.top=k-16+"px",h.appendChild(createHtmlElement("div",{"class":"VRPhotoInfoPinIcon",innerHTML:'<i class="icon-info-path"><\/i>'})),h.appendChild(createHtmlElement("div",{"class":"VRPhotoPinClose Remove","data-coord":VirtualTourEditor.coords,onclick:"VirtualTourEditor.deletePoint(this, '"+VirtualTourEditor.medUID+"', '"+VirtualTourEditor.coords+"', true);stopEventPropagation(event);return false;",innerHTML:'<i class="icon-fechar"><\/i>'})),f(h),h.classList.add("active"),p.appendChild(h),t(p,!1),e(h.querySelector(".DescriptionBox"),w);else if(y=="p")p.style.display="none",g=document.getElementById("MessageDiv"),g.style.display="block",g.innerHTML=Translations.get(Translations.keys.VirtualTourSelectNextImage),VirtualTourEditor.state=i.WaitingDoorwayImage;else{var nt=l.getAttribute("data-uid"),d=l.getAttribute("data-coord"),tt=VirtualTourEditor.mediaItems.find(function(n){return n.imageUID==nt});tt&&(y=="w"?(c=tt.waypoints.find(function(n){return n.coord==d}),c&&(c.x=v,c.y=o,c.coord=b+"x"+k,l.setAttribute("data-coord",c.coord),function(){this.setAttribute("onclick","VirtualTourEditor.setDescription(this, this.getAttribute('data-uid'), this.getAttribute('data-coord'));")}.bind(l).defer(),a=c.querySelector("div.Remove[data-coord~="+d+"]"),a.setAttribute("data-coord",c.coord),a.setAttribute("onclick","VirtualTourEditor.deletePoint(this, '"+nt+"', '"+c.coord+"', true);stopEventPropagation(event);return false;"),a.style.display="block")):y=="d"&&(s=tt.doorways.find(function(n){return n.coord==d}),s&&(s.x=v,s.y=o,s.coord=b+"x"+k,l.setAttribute("data-coord",s.coord),function(n){this.setAttribute("onclick","VirtualTourEditor.setImage(this, '"+n+"');")}.bind(l).defer(u(s.link)),a=s.querySelector("div.Remove[data-coord~="+d+"]"),a.setAttribute("data-coord",s.coord),a.setAttribute("onclick","VirtualTourEditor.deletePoint(this, '"+nt+"', '"+s.coord+"', false);stopEventPropagation(event);return false;"),a.style.display="block")))}}}function u(n){var t=n.substring(n.lastIndexOf("/")+1),i=t.startsWith("ID")?2:0,r=t.indexOf(".");return t.substring(i,r)}function l(t,i){var o=createHtmlElement("img",{id:"mockImg",src:t.imageSrc}),e,r;o.style.width="100%";o.onload=function(i){var e=document.getElementById("mockImg"),o=i.querySelector("#VTImage"),r="";t.waypoints.forEach(function(i){var u=new n(i,e),s=createHtmlElement("div",{id:"w_"+t.imageUID+"_"+u,"class":"VRPhotoPin DragHandle","data-vtype":"w","data-uid":t.imageUID,"data-coord":u,onclick:"VirtualTourEditor.setDescription(this, '"+t.imageUID+"', '"+u+"');"});u.set(s,o);s.appendChild(createHtmlElement("div",{"class":"VRPhotoInfoPinIcon",innerHTML:'<i class="icon-info-path"><\/i>'}));s.appendChild(createHtmlElement("div",{"class":"VRPhotoPinClose Remove","data-coord":u,onclick:"VirtualTourEditor.deletePoint(this, '"+t.imageUID+"', '"+u+"', true);stopEventPropagation(event);return false;",innerHTML:'<i class="icon-fechar"><\/i>'}));f(s);r+=s.outerHTML});t.doorways.forEach(function(i){var f=new n(i,e),s=createHtmlElement("div",{id:"d_"+t.imageUID+"_"+f,"class":"VRPhotoPin DragHandle","data-vtype":"d","data-uid":t.imageUID,"data-coord":f,onclick:"VirtualTourEditor.setImage(this, '"+u(i.link)+"');"});f.set(s,o);s.appendChild(createHtmlElement("div",{"class":"VRPhotoInfoPinIcon",innerHTML:'<i class="icon-visit-path"><\/i>'}));s.appendChild(createHtmlElement("div",{"class":"VRPhotoPinClose Remove","data-coord":f,onclick:"VirtualTourEditor.deletePoint(this, '"+t.imageUID+"', '"+f+"', false);stopEventPropagation(event);return false;",innerHTML:'<i class="icon-fechar"><\/i>'}));r+=s.outerHTML});i.innerHTML+=r;document.getElementById("mock").remove()}.bind(VirtualTourEditor,i);e=document.createElement("div");e.style.position="relative";e.style.display="block";e.appendChild(o);r=createHtmlElement("div",{id:"mock"});r.style.width="824px";r.style.minHeight="245px";r.style.opacity="0";r.appendChild(e);document.body.appendChild(r)}function r(n,t){if(n){var i=n.querySelector("i").outerHTML;n.innerHTML=i+" "+(t||0)}}function f(n){var t=document.getElementById("DescriptionBoxTpl"),i;t&&t.children.length==1&&(i=t.children[0].cloneNode(!0),n.appendChild(i))}function e(n,t){n.classList.remove("right","bottom");var i=$(n).offset(),u=i.left+$(n).width(),f=i.top+$(n).height(),r=$(t).offset(),e=r.left+$(t).width()-20,o=r.top+$(t).height()-20;u>e&&n.classList.add("right");f>o&&n.classList.add("bottom")}function t(n,t){n=n||document.getElementById("TourDiv");n&&(n.style.overflow=t?"hidden":"visible")}var i=Object.freeze({Regular:1,WaitingDoorwayImage:2});return n.prototype.set=function(n,t){var i=this,r,u,f,e;i.isCore?(n.style.left=i.x-16+"px",n.style.top=i.y-16+"px"):(r=t.clientWidth*i.x/100,u=t.clientHeight*i.y/100,n.style.left=r-18+"px",n.style.top=u-18+"px",f=parseInt(r),e=parseInt(u),i.obj.coord=f+"x"+e,i.obj.x=f,i.obj.y=e)},n.prototype.toString=function(){var n=this;return n.x+"x"+n.y},{mediaItems:[],state:null,_estateID:null,_LC:n,open:function(n,t,i,r){if(Limit.withinLimit(Limit.LimitType.AddMedia)){var u=Requests.get(Requests.keys.ObjectID)+"="+i;ajaxRequest(n,t,"GET",u,function(n){n.status==ajaxRequest.StatusType.Success&&(VirtualTourEditor.mediaItems=isObject(n.data)?ensureArray(n.data.mediaArray):[],VirtualTourEditor.init.bind(VirtualTourEditor).defer(i),Translations.initAvailableLanguages(null,r),s())})}},init:function(n){var r=document.getElementById("MessageDiv"),t;r.style.display="block";r.innerHTML=Translations.get(Translations.keys.VirtualTourSelectFirstImage);t=document.getElementById("TourDiv");t.style.display="none";t.querySelectorAll("div.VRPhotoPin").forEach(function(n){n.remove()});VirtualTourEditor.state=i.Regular;VirtualTourEditor._estateID=n;VirtualTourEditor.MediaStrip.updateHandles();ensureDraggableBeforeStart();$("#InfoDiv,#PortDiv").draggable({containment:$(".VRPhotoStage"),handle:".drag",revert:!0,beforeStart:function(n){$(n.target.queryChildren(".drag").first()).hide();$(n.target.queryChildren("i").first()).css({margin:"0"});$(n.target).css({"font-size":"0","border-radius":"24px",height:"36px","line-height":"24px",padding:"6px",width:"36px"});$(n.target.up(".popupContent")).css("overflow-x","hidden")},stop:function(n){$(n.target.queryChildren(".drag").first()).show();$(n.target.queryChildren("i").first()).css({margin:""});$(n.target).css({"font-size":"","border-radius":"",height:"","line-height":"",padding:"",width:""});$(n.target.up(".popupContent")).css("overflow-x","")}});$(t).droppable({accept:".DragHandle",drop:c})},setImage:function(n,r){var e=n.up(".PhotoItems")||document.getElementById("VTMediaRender").querySelector(".PhotoItems"),f,u;e&&e.querySelectorAll(".VRPhoto.active").forEach(function(n){n.classList.remove("active")});f=VirtualTourEditor.mediaItems.find(function(n){return n.imageUID==r});f&&(e&&e.querySelector('.VRPhoto[id="VirtualTourFrame_'+r+'"]').classList.add("active"),VirtualTourEditor.state==i.WaitingDoorwayImage&&VirtualTourEditor.addPoint(n,!1,f.linkSrc),VirtualTourEditor.state=i.Regular,VirtualTourEditor.medUID=r,document.getElementById("MessageDiv").style.display="none",document.getElementById("VTImage").setAttribute("src",f.imageSrc),u=document.getElementById("TourDiv"),u.querySelectorAll(".DescriptionBox").forEach(function(n){n.up(".VRPhotoPin").classList.remove("active");n.querySelectorAll("textarea").forEach(function(n){n.value=""})}),t(u,!0),u.querySelectorAll("div.VRPhotoPin").forEach(function(n){n.remove()}),$(u).fadeIn("fast"),l(f,u),$(u).find("div.DragHandle").draggable({revert:"failure",containment:u.querySelector(".VRPhotoStage"),start:h}))},setDescription:function(n,i,r){var l=VirtualTourEditor.mediaItems.find(function(n){return n.imageUID==i}),u,h,a,c,o,f,s;if(l&&(u=l.waypoints.find(function(n){return n.coord==r}),u)){if(h=n.querySelector(".DescriptionBox"),a=h.querySelectorAll("textarea"),u.description.length>=0)for(c=u.description.split("],["),o=0;o<c.length;o++)f=new RegExp("^\\[?([\\w-]+)\\](.*?)\\[[\\w\\-/]+\\]?$","ig").exec(c[o]),f&&f.length>2&&(s=null,a.forEach(function(n){n.id.toLowerCase().indexOf(f[1].toLowerCase())>-1&&(s=n)}),s&&(s.value=f[2]));VirtualTourEditor.medUID=i;VirtualTourEditor.coordX=u.x;VirtualTourEditor.coordY=u.y;VirtualTourEditor.coords=u.coord;n.classList.add("active");t(null,!1);e(h,document.getElementById("VTImage"))}},addPoint:function(n,i,u){var f=VirtualTourEditor.mediaItems.find(function(n){return n.imageUID==VirtualTourEditor.medUID}),e,h,o,s;f&&(e=[],i?(h=n.up(".DescriptionBox"),h.querySelectorAll("textarea").forEach(function(n){var t=new RegExp("_([\\w-]+)$","ig").exec(n.id);t&&t.length>1&&n.value!=""&&e.push("["+t[1].toUpperCase()+"]"+n.value+"[/"+t[1].toUpperCase()+"]")}),n.up(".VRPhotoPin").classList.remove("active"),t(null,!0),o=f.waypoints.find(function(n){return n.coord==VirtualTourEditor.coords}),o?o.description=e.toString():f.waypoints.push({x:VirtualTourEditor.coordX,y:VirtualTourEditor.coordY,coord:VirtualTourEditor.coords,description:e.toString(),link:u,isCore:1})):f.doorways.push({x:VirtualTourEditor.coordX,y:VirtualTourEditor.coordY,coord:VirtualTourEditor.coords,description:e.toString(),link:u,isCore:1}),s=document.getElementById("VTMediaRender").querySelector("[id^=VirtualTourFrame_"+f.imageUID+"]"),r($(s).find(".Counter[data-vtype^=p]:first").get(0),f.doorways.length),r($(s).find(".Counter[data-vtype^=i]:last").get(0),f.waypoints.length))},deletePoint:function(n,t,i,u){MessageBox.confirm(Translations.get(Translations.keys.VirtualTourDeletePointConfirm),Translations.get(Translations.keys.Yes),function(){var f=VirtualTourEditor.mediaItems.find(function(n){return n.imageUID==t}),s,o,h,e,c;if(f){if(u){for(s=f.waypoints.length,o=-1,e=0;e<s;e++)if(h=f.waypoints[e],h.coord==i){o=e;break}o!=-1&&f.waypoints.splice(o,1)}else{for(s=f.doorways.length,o=-1,e=0;e<s;e++)if(h=f.doorways[e],h.coord==i){o=e;break}o!=-1&&f.doorways.splice(o,1)}n.up(".VRPhotoPin").remove();c=document.getElementById("VTMediaRender").querySelector("[id^=VirtualTourFrame_"+f.imageUID+"]");r($(c).find(".Counter[data-vtype^=p]:first").get(0),f.doorways.length);r($(c).find(".Counter[data-vtype^=i]:last").get(0),f.waypoints.length)}},"",Translations.get(Translations.keys.No))},closeMultiText:function(n){var i=n.up(".VRPhotoPin"),r,u,f;i&&(i.classList.remove("active"),t(null,!0),r=n.up(".DescriptionBox"),r&&r.querySelectorAll("textarea").forEach(function(n){n.value=""}),u=VirtualTourEditor.mediaItems.find(function(n){return n.imageUID==VirtualTourEditor.medUID}),u&&(f=u.waypoints.find(function(n){return n.coord==VirtualTourEditor.coords}),f||i.remove()))},save:function(n){var t=n.up(".popupBox"),i=t.getAttribute("data-save-url"),r=Requests.get(Requests.keys.ObjectID)+"="+VirtualTourEditor._estateID+"&"+Requests.get(Requests.keys.TourItems)+"="+JSON.stringify(VirtualTourEditor.mediaItems);ajaxRequest(n,i,"POST",r,function(n){n.status==ajaxRequest.StatusType.Success&&(Popup.close(),Realestate.Detail.updateMediaRender())})},limitDragEffect:function(n){if(n&&n.target&&(!n.target.classList.contains("ui-draggable-handle")||!n.target.up(".ui-draggable-handle")))return n.preventDefault(),!1},MediaStrip:new o}}(),VideoCreator=function(){function a(n){var t,i,u,f,r;if((n=n||document.getElementById("oTimeline"),n)&&(t=n.querySelectorAll("td"),t&&t.length>1))for(r=t.length-1;r>=0;r--)if(i=t[r],i.classList.contains("SceneItem"))i.querySelector(".SceneBck > .MediaFrame")||(i.remove(),t.slice(r,1));else if(i.classList.contains("SceneTran")){while((u=r-1)>-1&&(f=t[u])!=null&&f.classList.contains("SceneTran"))f.remove(),t.slice(u,1);i.next()||i.remove()}}function v(n){var t=n&&n.querySelector(".timeDisplay");return t?VideoCreator.getTime(t.innerHTML):0}function y(n){var t={minutes:0,seconds:0,totalSeconds:0,scenesLength:0},n=n||document.getElementById("VideoRenderPopup"),f,i,r,u;return n?(f=n.querySelector("#oTimeline"),i=f&&f.querySelectorAll(".SceneItem"),i&&i.length>0&&(r=0,i.forEach(function(n){var t=v(n),i=v(n.next("td.SceneTran"));r+=t+i}),u=new Date(0),u.setUTCSeconds(r),t.minutes=u.getUTCMinutes(),t.seconds=u.getUTCSeconds(),t.totalSeconds=r,t.scenesLength=i.length),t):(console.error("VideoCreator[_getScenesTime]: context nao encontrado."),t)}function b(n,t,i){if(n&&n.containsNode(t)){var r=i||i===0?t+' input[type=radio][value="'+i+'"]':t+" input[type=radio]";Element.changeCheckState(n.querySelector(r),!0)}}function k(){function n(n,t){var i=n&&n.querySelector(".Video_Slideshow .MediaRegular");Element.toggleClassName(i,"Dragging",t)}function t(){n(document.getElementById("VideoRenderPopup"),!0)}function i(n){var t=n.target;t.trueParent=t.up("td");t.setAttribute("data-inside","false")}function r(t){var f=document.getElementById("VideoRenderPopup"),i=t.target,e=f.querySelector('[id="'+i.getAttribute("data-holder")+'"]'),r,u;i.getAttribute("data-inside")==="false"?(e.appendChild(i),r=i.trueParent,r&&r.classList.contains("SceneItem")&&(u=r.next(),u&&u.nodeType===1&&u.remove(),r.remove()),a(f.querySelector("#oTimeline")),e.classList.remove("MediaAssetEmpty")):e.classList.add("MediaAssetEmpty");n(document.getElementById("VideoRenderPopup"),!1);VideoCreator.calcVideoTime();i.getAttribute("data-warn-time-limit")==="true"&&(MessageBox.alert(f.getAttribute("data-time-limit-warning")),i.removeAttribute("data-warn-time-limit"))}return ensureDraggableBeforeStart(),{getInitObj:function(){return{revert:!1,helper:"clone",zIndex:1e6,containment:document.getElementById("#oCats"),beforeStart:t,start:i,stop:r}}}}function d(){function n(n){n.target.trueParent=n.target.parentNode;n.target.setAttribute("inside","false")}function t(n){n.target.getAttribute("inside")=="false"&&(n.target.getAttribute("data-activeTrans")?VideoCreator.destroyDragHandle.defer(n.target):n.target.style.position="relative");VideoCreator.calcVideoTime.bind(VideoCreator).defer()}return{getInitObj:function(){return{revert:!1,helper:"clone",zIndex:1e6,start:n,stop:t}}}}function g(){function n(n,t,i){var r=t&&t.next(),u=r?function(t){n.insertBefore(t,r)}:function(t){n.appendChild(t)};ensureArray(i).forEach(u)}function f(n,t){n+="_tran";var i=createHtmlElement("div",{"class":"TransBck",title:t.getAttribute("data-enc-helper-title")});return createHtmlElement("td",{id:n,"class":"SceneTran"},i)}function e(n){var t=createHtmlElement("div",{"class":"SceneBck"});return createHtmlElement("td",{id:n,"class":"SceneItem"},t)}function o(n,t){n+="_time";var i=[];return i.push(createHtmlElement("span",{"class":"timeDisplay",innerText:t})),i.push(createHtmlElement("span",{"class":"spr sprite SprLimitDrag timeScroll"})),createHtmlElement("div",{id:n,"class":"SceneTime"},i)}function s(t,i,s){var b,k,it,c,h,ut,et,ot,g,nt,st,v,w,tt,y,ft;if(!t){console.error("VideoCreator.Timeline[_executeDrop]: context invalido ou nao fornecido.");return}if(!i){console.error("VideoCreator.Timeline[_executeDrop]: drag invalido ou nao fornecido.");return}if(!s){console.error("VideoCreator.Timeline[_executeDrop]: drop invalido ou nao fornecido.");return}if(b=s.getMatchedCssClass("MovieStrip|SceneItem|SceneTran",!0),!b){console.error("VideoCreator.Timeline[_executeDrop]: dropType invalido ou nao encontrado.");console.log(s);return}if(i.classList.contains("TransItem"))i.trueParent&&b=="SceneTran"&&(k=s.querySelectorAll("div:not(.TransBck)"),k.length==0||k[0]!=i?(it=k.first(),it&&VideoCreator.destroyDragHandle(it),i.setAttribute("data-inside","true"),i.getAttribute("data-activeTrans")?i.trueParent.querySelectorAll(".TransItem,.SceneTime").forEach(function(n){s.querySelector("div").appendChild(n)}):(c=i.cloneNode(!0),y="Tran"+(new Date).valueOf(),c.id=y,c.setAttribute("data-activeTrans",!0),s.querySelector(".TransBck").appendChild(c),c.trueParent=c.parentNode,$(c).draggable(VideoCreator.Transition.getInitObj()))):i.trueParent.classList.contains("TransBck")&&i.setAttribute("data-inside","true"));else{if(h=t.querySelector("#oTimeline"),!i.trueParent||i.trueParent!=s){var d="Sc_"+(new Date).valueOf(),rt="",l=[],ht=h.querySelectorAll(".SceneItem");ht.length>0&&(rt=d+"_tran",l.push(f(d,t)));l.push(e(d));ut=!1;b=="SceneItem"?(et=parseInt(s.getAttribute("data-timeorder"),10),ot=parseInt(i.trueParent.getAttribute("data-timeorder"),10),et>ot?n(s.parentNode,s,l):(g=s.previous("td.SceneTran"),g?l.forEach(function(n){g.parentNode.insertBefore(n,g)}):(nt=s.next("td.SceneTran"),nt?l.forEach(function(n){nt.parentNode.insertBefore(n,nt)}):n(h,h.querySelectorLast("td"),l)))):(st=VideoCreator.SceneLength.getAllScenesSeconds(r),st>u?ut=!0:n(h,h.querySelectorLast("td"),l));ut?i.setAttribute("data-warn-time-limit","true"):(i.setAttribute("data-inside","true"),v=h.querySelector('[id="'+d+'"]'),w=i.trueParent,w&&w.classList.contains("SceneItem")&&(tt=w.next(),tt&&tt.nodeType==1&&tt.remove(),w.remove()),v.querySelector(".SceneBck").appendChild(i),y="Anim"+(new Date).valueOf(),n(v,v.children.length>0?v.children[0]:null,o(y,p)),VideoCreator.SceneLength.setHandle.defer(y+"_time"),$(v).droppable(VideoCreator.Timeline.getInitObj()),rt&&(ft=document.getElementById(rt),ft&&$(ft).droppable(VideoCreator.Timeline.getInitObj())));a(h)}h.querySelectorAll(".SceneItem").forEach(function(n,t){n.setAttribute("data-timeorder",t)})}VideoCreator.calcVideoTime.bind(VideoCreator).defer()}function i(n,t,i){var r=n.offset(),i=i||$(t).offset(),u,f;r&&i&&(u=i.left-r.left,f=i.top-r.top,n.simulate("drag",{dx:u,dy:f}))}var t=function(){var t=null,i=-1,n=0;return{collect:function(r){return t=$(r).find("#TransitionItems").find(".TransItem.DragElem.ui-draggable.ui-draggable-handle").get(),i=t.length-1,n=0,t.length},getNextTransition:function(){n>i&&(n=0);var r=t[n];return n++,r}}}();return{getInitObj:function(){return{drop:VideoCreator.Timeline.drop,greedy:!0}},drop:function(n,t){var i=document.getElementById("VideoRenderPopup"),r=t.draggable.get(0),u=n.target;s(i,r,u)},moveMany:function(n){var r,e,u,o,f;if(n=n||document.getElementById("VideoRenderPopup"),!n){console.error("VideoCreator.Timeline.moveMany: context nao fornecido e nao encontrado.");return}if(r=n.querySelector("#MovieStrip"),!r){console.error("VideoCreator.Timeline.moveMany: movieStrip nao encontrada.");console.log(n);return}if(e=$(r).offset(),!e){console.error("VideoCreator.Timeline.moveMany: nao foi possivel determinar localizacao do movieStrip.");console.log(n);console.log(r);return}if(u=$(n.querySelector(".Video_Slideshow")).find(".MediaAsset").get().map(function(n){return n.querySelector(".MediaFrame.DragElem.ui-draggable.ui-draggable-handle")}),!u.length){console.warn("VideoCreator.Timeline.moveMany: sem mediaAssets disponiveis.");console.log(n);return}for(o=Math.min(l,u.length),f=0;f<o;f++)i($(u[f]),null,e);if(!t.collect(n)){console.log("VideoCreator.Timeline.moveMany: no transitions found.");console.log(n);return}r.querySelectorAll(".SceneTran").forEach(function(n){i($(t.getNextTransition()),n)})}}}function nt(){function n(n){return n=n||1,parseInt(n*o,10)}function t(n){return n=n||r,(y().totalSeconds+n)*f}function i(i,r){var f=this,l=f.up("#oTimeline"),o,e,c;if(l&&(o=l.querySelectorAll(".SceneTime"),e=r&&o.length>1?o.find(function(n){return n!=f&&!n.containsNode(f)}):f.classList.contains("SceneTime")&&f||f.up(".SceneTime"),e)){var s=i?Math.max(50,i.clientX-e.viewportOffset().left):$(e).width(),h=n(s),a=parseInt(e.style.width.replace("px","")),p=t(h);if(s<a&&h<w||s>a&&h&&p>u){stopEventPropagation(i,!0);return}c=new Date(0);c.setUTCSeconds(h);var v=c.getUTCMinutes(),y=c.getUTCSeconds(),b=(v>9?"":"0")+v+":"+(y>9?"":"0")+y;o.forEach(function(n){$(n).animate({width:s+"px"},10);n.querySelector(".timeDisplay").innerHTML=b})}}function e(){$(document).off("mousemove").off("mouseup");VideoCreator.calcVideoTime()}var o=1/f;return{setHandle:function(n){var t=document.getElementById("VideoRenderPopup").querySelector('[id="'+n+'"]');if(t){$(t).on("mousedown",function(n){$(n.target).off("mouseup").on("mouseup",e);$(document).off("mouseup").off("mousemove").on("mouseup",e).on("mousemove",i.bind(n.target))});i.bind(t,null,!0).defer();VideoCreator.calcVideoTime.defer()}},getSceneSeconds:n,getAllScenesSeconds:t}}var o=6175,s=30,h="00:01",p="00:04",c=8,r=4,u=o,f=s,l=c,w=r,e=0,n="",i="",t=!1;return{open:function(n,t,i){Limit.withinLimit(Limit.LimitType.AddMedia)&&ajaxRequest(n,t,"GET",i)},init:function(r,h,a,v){var y=document.getElementById("VideoRenderPopup"),p=y&&y.querySelector("#MediaRender"),w=p&&p.querySelectorAll(".MediaAsset:not(.Unavailable)");w&&w.length>0&&(VideoCreator.setDragBehavior(),e=r);n="";i="";t=!1;u=h||o;f=a||s;l=v||c},setDragBehavior:function(){var n=document.getElementById("VideoRenderPopup");$(n).find(".ui-draggable").draggable("destroy");$(n).find(".ui-droppable").droppable("destroy");$(n).find("#MediaRender .MediaAsset:not(.Unavailable) .MediaFrame").draggable(VideoCreator.MediaFrame.getInitObj());$(n).find("#TransitionItems .TransItem").draggable(VideoCreator.Transition.getInitObj());$(n).find("#MovieStrip").droppable(VideoCreator.Timeline.getInitObj())},calcVideoTime:function(){var r=document.getElementById("VideoRenderPopup"),i,t,u;if(!r){console.error("VideoCreator.calcVideoTime: context nao encontrado.");return}i=r.querySelector("#MovieTime");i&&(t=y(),u=t.scenesLength>0?(t.minutes>9?"":"0")+t.minutes+":"+(t.seconds>9?"":"0")+t.seconds:"00:00",i.innerHTML=u);n=""},getTime:function(n){var t=n.split(":"),i=parseInt(t[0],10)*60,r=parseInt(t[1],10);return i+r},checkAudio:function(){n=""},buildVideo:function(r,u,f){var s;if(r&&!r.getAttribute("busy")){r.setAttribute("busy","busy");var e=document.getElementById("VideoRenderPopup"),c=e.querySelector("#oTimeline"),o=c.querySelectorAll(".SceneItem");if(t)r.removeAttribute("busy"),MessageBox.alert(Translations.get(Translations.keys.VideoEncoderCurrentlyRendering));else if(o.length==0)r.removeAttribute("busy"),MessageBox.alert(Translations.get(Translations.keys.VideoEncoderNoScene));else if(!n)return u?($(e).find("#oVidPlayer").html(""),$(e).find("#PreviewSection").hide(),s=o.map(function(n){var i=n.next("td.SceneTran"),r=i&&i.querySelector(".TransItem"),t;return r?(t=r.getAttribute("data-trantype"),t+="|"+n.querySelector("a").getAttribute("href"),t+="|"+VideoCreator.getTime(n.querySelector(".timeDisplay").innerHTML),t+="|"+VideoCreator.getTime(h)):(t="0",t+="|"+n.querySelector("a").getAttribute("href"),t+="|"+VideoCreator.getTime(n.querySelector(".timeDisplay").innerHTML),t+="|"+VideoCreator.getTime(h)),t}),t=!0,f=appendStringParams(f,Requests.getPair(Requests.keys.Scenes,encodeURIComponent(s.join(";")))),f=appendStringParams(f,$(e).find("#Sounds,#SubtitleOptions").find(":input:checked").serializeAll()),i&&(f=appendStringParams(f,Requests.getPair(Requests.keys.LastVideo,encodeURIComponent(i)))),r.removeAttribute("busy"),ajaxRequest(r,u,"POST",f,null,{onError:function(){t=!1}}),!0):(r.removeAttribute("busy"),!1)}},continueBuild:function(n,i,r,u,f){n&&i&&r&&u&&f&&ajaxRequest(null,n,"POST",i,function(n){t=!1;n.status==ajaxRequest.StatusType.Success&&isObject(n.data)&&n.data.src&&n.data.id&&(VideoCreator._continueVideoID=n.data.id,VideoCreator._continueVideoSrc=n.data.src,ajaxRequest(null,r,"GET",u,function(n){if(n.status==ajaxRequest.StatusType.Success){var t,i;n.data&&n.data.src&&n.data.id?(t=n.data.src,i=n.data.id):(t=VideoCreator._continueVideoSrc,i=VideoCreator._continueVideoID);t&&i&&(e=f,VideoCreator.showRenderedVideo(t,i))}}))})},showRenderedVideo:function(t,r){var u=document.getElementById("VideoRenderPopup");Flash.setIn(u.querySelector("#oVidPlayer"),"oPreview","/Scripts/Players/FLVPlayer.swf?autostart=true&file="+t,"480px","300px");n=t;i=t;VideoCreator.videoID=r},exportVideo:function(t,i,r){if(!n){MessageBox.alert(Translations.get(Translations.keys.VideoEncoderNoScene));return}r=appendStringParams(r,Requests.getPair(Requests.keys.Video,n));r=appendStringParams(r,Requests.getPair(Requests.keys.ObjectID,e));r=appendStringParams(r,Requests.getPair(Requests.keys.MediaID,VideoCreator.videoID));r=appendStringParams(r,Requests.getPair(Requests.keys.IsFromBuilder,"1"));ajaxRequest(t,i,"GET",r,function(n){n.status==ajaxRequest.StatusType.Success&&n.popupContent&&Popup.registerCallbacks(new Popup.LayerOptions(null,function(){if(YoutubeExporter.published==!0){Popup.close(!0);var n=window.location.href;n=n.replace(window.location.search,"");window.location.href=n}}),-1)})},destroyDragHandle:function(n){var t=n.next(".SceneTime");t?t.remove():n.trueParent&&n.trueParent.querySelectorAll(".SceneTime").invoke("remove");n.classList.contains("ui-draggable")&&n.remove()},close:function(){n?MessageBox.alert(Translations.get(Translations.keys.VideoEncoderLeavingWarn),function(){Popup.close()}):Popup.close()},useAutomaticBuild:function(n){var t=document.getElementById("VideoRenderPopup");if(!t){console.error("VideoCreator.useAutomaticBuild: context nao encontrado.");return}VideoCreator.Timeline.moveMany(t);n&&b(t.querySelector("#SubtitleOptions"),".SubtitleOption",n)},MediaFrame:k(),Transition:d(),Timeline:g(),SceneLength:nt()}}(),ExternalMaps=function(){function n(){this.circles={};this.markers={};this.polygons={};this.clusters={};this.settings=null;this.latitude=null;this.longitude=null;this.objects=null}function f(n){var f,o,t,h,c,l,i,s;return r==""&&document.getElementById("RealestateListResults")&&(r=document.getElementById("RealestateListResults").getAttribute("data-nopic-url")),f=createHtmlElement("div",{id:"bodyContent"}),o=createHtmlElement("p"),o.appendChild(createHtmlElement("label",{style:"font-weight: bold;",innerHTML:n.Nature})),o.append(", "+n.Reference),f.appendChild(o),f.appendChild(createHtmlElement("p",{innerHTML:n.Location})),f.appendChild(createHtmlElement("p",{innerHTML:n.Price})),t=createHtmlElement("div",{style:"float: left; width: 190px; margin-left: 10px;"}),t.appendChild(f),n.DevelopmentName&&(h=createHtmlElement("div",{"class":"listItemDevelopment"}),c=createHtmlElement("a",{href:n.DevelopmentUrl,target:"_blank",innerText:n.DevelopmentDescription+" "}),c.appendChild(createHtmlElement("strong",{innerText:n.DevelopmentName})),h.appendChild(c),t.appendChild(h)),n.AvailabilityCSS&&t.appendChild(createHtmlElement("div",{"class":"listItemStatus "+n.AvailabilityCSS,innerHTML:'<span class="dot"><\/span> '+n.Availability})),n.Area&&t.appendChild(createHtmlElement("div",{"class":"listItemDataSection",innerHTML:u+"<strong>"+n.Area+"<\/strong> "})),l=createHtmlElement("input",{type:"checkbox",id:"ChkRealestate_"+n.RealestateID,"data-object-id":n.RealestateID,value:n.RealestateID,onclick:"Search.GenericList.updateSelectedMapItems(this);"}),i=createHtmlElement("p",{"class":"balloon"}),i.appendChild(l),i.appendChild(createHtmlElement("label",{"for":"ChkRealestate_"+n.RealestateID,innerHTML:"&nbsp;"+Translations.get(Translations.keys.ToSelect)})),i.append(" | "),i.appendChild(createHtmlElement("a",{href:n.Url,target:"_blank","class":"blueLink",innerText:Translations.get(Translations.keys.SeeRealestate)})),s=createHtmlElement("div",{"class":"mapViewBalloon",style:"padding:0"}),s.appendChild(createHtmlElement("img",{src:n.Image,onerror:'this.src = "'+r+'"',style:"position: unset; float: left; margin-top: 3px;"})),t.appendChild(i),s.appendChild(t),e(n.RealestateID),s}function t(t,i,r,e){var at,s,a,w,c,l,ni,ti,vt,b,ii,ft,g,ot,tt,yt;n.call(this);var p=this,it=null,h=null,st=!1,ht=!1,ct=[],rt=!0,ut=[];t=JSON.parse(t);this.settings=t;this.latitude=i;this.longitude=r;this.objects=e;var pt=function(n){wt();n.target.enableEdit(s)},wt=function(){for(var n=0;n<ut.length;n++)ut[n].disableEdit()},bt=function(){p.polygons=[];s.eachLayer(function(n){var t,r,i,u;if(n instanceof L.Polygon)for(t=0;t<n._latlngs.length;t++)if(n._latlngs[t].length>0){for(r=[],i=0;i<n._latlngs[t].length;i++)r.push([n._latlngs[t][i].lat,n._latlngs[t][i].lng]);u=n._latlngs[t].length-1;n._latlngs[t][u].lat!=n._latlngs[t][0].lat&&n._latlngs[t][u].lng!=n._latlngs[t][0].lng&&r.push([n._latlngs[t][0].lat,n._latlngs[t][0].lng]);p.polygons.push(r)}})},k=L.Icon.extend({options:{shadowUrl:t.IconsFolder+"marker-shadow.png",iconSize:[22,41],shadowSize:[41,41],iconAnchor:[11,33],shadowAnchor:[13,40],popupAnchor:[0,-35]}}),ui=new k({iconUrl:t.IconsFolder+"marker-icon-green.png"}),fi=new k({iconUrl:t.IconsFolder+"marker-icon-orange.png"}),ei=new k({iconUrl:t.IconsFolder+"marker-icon-red.png"}),d=new k({iconUrl:t.IconsFolder+"marker-icon-blue.png"}),oi=new k({iconUrl:t.IconsFolder+"marker-icon-yellow.png"}),kt=function(){if(ht)return!1;setTimeout(function(){var i=[],n=s.getZoom(),t=0,r=!0;n>4&&(n<=6?t=0:n<=8?t=2:n<=12?t=3:n>12?t=4:r=!1,r&&(h.eachLayer(function(n){n instanceof L.Marker&&s.getBounds().contains(n.getLatLng())&&n.LocationLevel>-1&&n.LocationLevel<=t&&i.push(n)}),i.length>0&&lt(i,it,!1)));ht=!1},700);ht=!0},lt=function(n,t,i,r){var s,h,c,f;if(st)return!1;st=!0;var l=[],o=[],e=[],u=null;for(sectionBounds=[],f=0;f<n.length;f++)u=n[f],u.Definitive==!1&&u.LocationID>-1&&ct.indexOf(u.LocationID)==-1&&(l.indexOf(u.LocationLevel)==-1&&(l.push(u.LocationLevel),s={},s.Level=u.LocationLevel,s.Locations=[],s.Clusters=[],e[u.LocationLevel]=s),h=e[u.LocationLevel],o.indexOf(u.LocationID)==-1&&(o.push(u.LocationID),c={},c.LocationID=u.LocationID,c.LocationLevel=u.LocationLevel,c.Count=u.Count,h.Locations.push(c)),h.Clusters[u.LocationID]||(h.Clusters[u.LocationID]=[]),h.Clusters[u.LocationID].push(u));for(f=0;f<o.length;f++)ct.push(o[f]);for(f=0;f<e.length;f++)e[f]&&si(e[f].Clusters,e[f].Locations,t,i,r);return st=!1,o.length>0},dt=function(n){switch(n){case"available":return ui;case"sold":return ei;case"evaluation":return oi;case"availability":return fi;default:return d}},si=function(n,i,r,u,f){var e=null,o=Search.buildRequestParameters(!1);o=appendStringParams(o,"loadClusters="+JSON.stringify(i));ajaxRequest(null,r,"POST",o,function(i){var v,b,k,g,a,c,w;if(i.data){if(e=JSON.parse(i.data),v=null,document.getElementById("leaflet-loading").show(),e){for(v=[],b=0;b<e.length;b++){var l=e[b],tt=l.LocationID,o=null,r=null,p=[],nt=n[tt],y;if(l.Clusters&&l.Clusters.length>0)for(k=0;k<l.Clusters.length;k++)for(o=l.Clusters[k],g=0;g<o.Count;g++)o&&o.Latitude<=90&&o.Latitude>=-90&&o.Longitude<=180&&o.Longitude>=-180&&v.push([o.Latitude,o.Longitude]),a=L.marker([o.Latitude,o.Longitude],{title:g,icon:d}),y=guid(),a.LocationID=o.LocationID,a.LocationLevel=o.LocationLevel,a.Count=o.Count,a.Definitive=!1,a.PopupLoaded=!1,a.EgoID=y,a.bindPopup('<div id="'+y+'">'+t.TextLoading+"...<\/div>"),p.push(a);if(c=null,l.Markers&&l.Markers.length>0)for(w=0;w<l.Markers.length;w++)r=l.Markers[w],y=guid(),r&&r.Latitude<=90&&r.Latitude>=-90&&r.Longitude<=180&&r.Longitude>=-180&&v.push([r.Latitude,r.Longitude]),c=r.Info?L.marker([r.Latitude,r.Longitude],{title:r.Info.Reference,icon:dt(r.Info.AvailabilityCSS)}):L.marker([r.Latitude,r.Longitude],{title:w,icon:d}),c.LocationID=-1,c.LocationLevel=-1,c.Count=-1,c.Definitive=!0,c.PopupLoaded=!1,c.EgoID=y,c.Info=r.Info,c.bindPopup('<div id="'+y+'">'+t.TextLoading+"...<\/div>"),p.push(c);p&&p.length>0&&h.addLayers(p);nt&&nt.length>0&&h.removeLayers(nt);f&&setTimeout(gt(c),1e3);ct.pop(tt)}h.refreshClusters()}rt?(rt=!1,s.fitBounds(h.getBounds(),{maxZoom:14})):v&&v.length>0&&u&&s.fitBounds(v);document.getElementById("leaflet-loading").hide()}},{hideLoading:!0})},gt=function(n){n.unbindPopup();n.bindPopup(f(n.Info));n.PopupLoaded=!0;n._popup.update();n.openPopup()};if(e=(typeof e=="string"||e instanceof String?JSON.parse(e):e)||{},L.drawLocal.draw.toolbar.buttons.polygon=t.TextCreatePolygon,L.drawLocal.edit.toolbar.buttons.edit=t.TextRedrawPolygon,L.drawLocal.edit.toolbar.buttons.remove=t.TextDeleteAll,L.drawLocal.edit.toolbar.actions.cancel.title=t.TextCancelPolygon,L.drawLocal.edit.toolbar.actions.cancel.text=t.TextCancelPolygon,L.drawLocal.edit.toolbar.actions.clearAll.title=t.TextDeleteAll,L.drawLocal.edit.toolbar.actions.clearAll.text=t.TextDeleteAll,L.drawLocal.edit.toolbar.actions.save.title=t.TextSavePolygon,L.drawLocal.edit.toolbar.actions.save.text=t.TextSavePolygon,L.drawLocal.edit.toolbar.actions.save.text=t.TextSavePolygon,L.drawLocal.draw.toolbar.finish.text=t.TextFinish,L.drawLocal.draw.toolbar.finish.title=t.TextFinishDrawing,L.drawLocal.draw.toolbar.undo.text=t.TextDeleteLastPoint,L.drawLocal.draw.toolbar.undo.title=t.TextDeleteLastPointDrawn,L.drawLocal.draw.toolbar.actions.text=t.TextCancelPolygon,L.drawLocal.draw.toolbar.actions.title=t.TextCancelDrawning,L.drawLocal.draw.handlers.polygon.tooltip.cont=t.TextClickDraw,L.drawLocal.draw.handlers.polygon.tooltip.end=t.TextCloseDraw,L.drawLocal.draw.handlers.polygon.tooltip.start=t.TextStartDraw,L.drawLocal.edit.handlers.edit.tooltip.text=t.TextUndoChanges,L.drawLocal.edit.handlers.edit.tooltip.subtext=t.TextDragPoly,L.drawLocal.edit.handlers.remove.tooltip.text=t.TextClickRemove,u=t.TextArea,at=t.AllowCircleDraw||t.AllowMarkerDraw||t.AllowPolygonDraw,s=L.map(t.MapID,{editable:at,zoomControl:!1}),i&&r&&s.setView([i,r],12),L.tileLayer(t.OpenStreetMapTileUrl,{attribution:HtmlUtility.toText(t.OpenStreetMapAttribution),maxZoom:18}).addTo(s),a=new L.FeatureGroup,w=new L.FeatureGroup,s.addLayer(a),s.addLayer(w),at)if(c=$("#map_latitude_"+t.MapGuid),l=$("#map_longitude_"+t.MapGuid),t.PolygonSearch)ft=new L.Control.Draw({position:"topleft",draw:{circle:t.AllowCircleDraw,marker:t.AllowMarkerDraw,polygon:t.AllowPolygonDraw,polyline:!1,rectangle:!1,circlemarker:!1}}),s.addControl(ft),ni=L.Control.extend({options:{position:"topleft"},onAdd:function(){var u=L.DomUtil.create("div","leaflet-control leaflet-draw-toolbar leaflet-bar"),n,i,r;return t.PolygonSearch&&e.Polygons&&e.Polygons.length>0&&(n=L.DomUtil.create("a","leaflet-draw-edit-edit",u),n.title=t.TextRedrawPlygons,n.setAttribute("href","#"),L.DomEvent.addListener(n,"click",L.DomEvent.stopPropagation).addListener(n,"click",L.DomEvent.preventDefault).addListener(n,"click",function(){a.clearLayers();yt()})),i=L.DomUtil.create("a","leaflet-draw-edit-remove",u),i.title=t.TextDeleteAll,i.setAttribute("href","#"),L.DomEvent.addListener(i,"click",L.DomEvent.stopPropagation).addListener(i,"click",L.DomEvent.preventDefault).addListener(i,"click",function(){a.clearLayers()}),r=L.DomUtil.create("a","leaflet-control-c-search",u),r.title=t.TextSearch,r.setAttribute("href","#"),r.innerHTML='<i class="icon-pesquisa"><\/i>',r.onclick=function(){var i=document.getElementById("g-url").value,n;if(bt(),o(p.getFormattedPolygons()),n=document.getElementById("polygon"),n&&n.value!=""){Search.fullSearch(this,i);return}MessageBox.alert(t.TextPolygonSearch)},u}}),s.addControl(new ni),ti=L.Control.extend({options:{position:"bottomleft"},onAdd:function(){var i=L.DomUtil.create("div",""),n=L.DomUtil.create("span","leaflet-control-loading",i);return n.title="loading...",n.setAttribute("id","leaflet-loading"),n.innerHTML=t.TextLoading+" ...",i}}),s.addControl(new ti);else if(t.AllowMarkerDraw&&c&&l){b=function(n,t){w&&w.clearLayers();h&&h.clearLayers();vt&&s.removeLayer(vt);c.val(n);l.val(t);vt=L.marker([n,t]).addTo(s);s.flyTo([n,t])};ii=function(n){$.ajax({url:"https://nominatim.openstreetmap.org/search/",data:{q:n,format:"json"},method:"GET",async:!0,beforeSend:function(){$("#map_location_text_"+t.MapGuid).parent().find(".input-value").addClass("loading");$("#map_location_text_"+t.MapGuid).parent().find(".input-value .icon-pesquisa").removeClass("icon-pesquisa").addClass("icon-loading")},success:function(n){n&&($("#map_search_location_results_"+t.MapGuid).empty(),$.each(n,function(n,i){$("#map_search_location_results_"+t.MapGuid).parent().show();$("#map_search_location_results_"+t.MapGuid).append($('<a href="javascript:void(0)" class="contactSearchDropLine"><span class="contactSearchDropColumn">'+i.display_name+"<\/span><\/a>").on("click",function(){b(i.lat,i.lon);$("#map_search_location_results_"+t.MapGuid).parent().hide();$("#map_location_text_"+t.MapGuid).val(i.display_name)}))}))},complete:function(){$("#map_location_text_"+t.MapGuid).parent().find(".input-value").removeClass("loading");$("#map_location_text_"+t.MapGuid).parent().find(".input-value .icon-loading").removeClass("icon-loading").addClass("icon-pesquisa")}})};e.Markers.length>0&&(c.val(e.Markers[0].Latitude),l.val(e.Markers[0].Longitude));c.data("val",c.val());l.data("val",l.val());$("#map_latitude_"+t.MapGuid+", #map_longitude_"+t.MapGuid).on("input",function(){b(c.val(),l.val())});$("#map_popup_close_"+t.MapGuid).on("click",function(){c.val(c.data("val"));l.val(l.data("val"));b(c.val(),l.val())});$("#map_popup_submit_"+t.MapGuid).on("click",function(){c.data("val",c.val());l.data("val",l.val());t.Callback&&eval(t.Callback+"('"+t.MapGuid+"','"+c.val()+"','"+l.val()+"')")});if(navigator.geolocation)$("#use_my_coords_"+t.MapGuid).show().on("click",function(){navigator.geolocation.getCurrentPosition(function(n){b(n.coords.latitude,n.coords.longitude)})});$("#map_location_text_"+t.MapGuid).on("input",function(){ii($("#map_location_text_"+t.MapGuid).val())});s.on("click",function(n){b(n.latlng.lat,n.latlng.lng)})}else ft=new L.Control.Draw({position:"topleft",draw:{circle:t.AllowCircleDraw,marker:t.AllowMarkerDraw,polygon:t.AllowPolygonDraw,polyline:!1,rectangle:!1,circlemarker:!1},edit:{featureGroup:a}}),s.addControl(ft);s.addControl(new L.Control.Fullscreen({position:"topright",pseudoFullscreen:!0,title:{"false":t.TextViewFullscreen,"true":t.TextExitFullscreen}}));L.control.zoom({position:"bottomright",zoomInTitle:t.TextZoomIn,zoomOutTitle:t.TextZoomOut}).addTo(s);s.on("draw:drawstart",function(){});s.on("draw:drawstop",function(){isDrawing=!1});s.on("draw:created",function(n){var t=n.layer;ut.push(t);a.addLayer(t);w.addLayer(t);t.on("click",L.DomEvent.stop).on("click",pt);bt()});s.on("draw:edited",function(){});s.on("draw:deleted",function(n){var t=n.layers.getLayers();forEachProp(t,function(n,t){t.EgoID&&p.polygons[t.EgoID]&&delete p.polygons[t.EgoID]})});s.on("click",function(){y=null;v=null;wt()});if(e.Circles&&(this.setFormattedCircles(e.Circles),g=[],forEachProp(this.circles,function(n,t){var i=L.circle([t[n][0],t[n][1]],{radius:t[n][2]}).addTo(w);i.EgoID=n;g.push(t[n])}),g.length!=1?s.fitBounds(g):s.fitBounds(g).setZoom(14)),e.Clusters||t.ShowClusters){var ri=!1,et,nt,v=null,y=null;it=document.getElementById("map-loadCluster").value;h=L.markerClusterGroup({spiderfyOnMaxZoom:!1,showCoverageOnHover:!1,zoomToBoundsOnClick:!1,chunkedLoading:!0,animate:!1,animateAddingMarkers:!1});e.Clusters&&(this.setFormattedClusters(e.Clusters),markersToAddIn=[],forEachProp(this.clusters,function(n,i){for(var r,u=0;u<i[n].Count;u++)r=L.marker(i[n].Coordinates,{title:u,icon:d}),r.LocationID=i[n].LocationID,r.LocationLevel=i[n].LocationLevel,r.Count=i[n].Count,r.Definitive=!1,r.PopupLoaded=!1,r.EgoID=n,r.bindPopup('<div id="'+n+'">'+t.TextLoading+"...<\/div>"),markersToAddIn.push(r)}),h.addLayers(markersToAddIn));ot=function(){et&&(et.setOpacity(1),et=null);ri&&nt&&(s.removeLayer(nt),nt=null)};h.on("click",function(n){if(rt=!1,n.layer.LocationLevel>-1){var t=[];t[0]=n.layer;lt(t,it,!0,!0)}else n.layer.PopupLoaded||gt(n.layer)});h.on("clustermouseover",function(n){ot();n.layer.setOpacity(.8);et=n.layer;ri&&(nt=L.polygon(n.layer.getConvexHull()),s.addLayer(nt))});h.on("clusterclick",function(n){var i,u,t,r;if(rt=!1,s.getZoom()==s.getMaxZoom()&&y!=null)y.unspiderfy(),y=null;else if(ot(),i=n.layer.getAllChildMarkers(),u=lt(i,it,!0),!u){for(t=[],r=0;r<i.length;r++)t.push(i[r].getLatLng());t&&t.length>0&&(s.getZoom()==s.getMaxZoom()?(v=null,n.layer.spiderfy(),y=n.layer):(s.flyToBounds(t,{duration:.5}),v=n.layer,y=v))}});h.on("spiderfied",function(){v=null});h.on("unspiderfied",function(){y=null});h.on("animationend",function(){v!=null&&s.getZoom()==s.getMaxZoom()&&(v.spiderfy(),y=v)});h.on("clustermouseout",ot);s.on("zoomend",function(){kt()});s.on("zoomout",function(){v=null;y=null});s.on("moveend",function(){kt()});s.addLayer(h);document.getElementById("leaflet-loading").hide();e.Clusters&&!e.Markers&&setTimeout(function(){s.fitBounds(h.getBounds(),{maxZoom:14})},1e3)}e.Markers&&(this.setFormattedMarkers(e.Markers),tt=[],forEachProp(this.markers,function(n,i){var r=L.marker(i[n].Coordinates,{title:"Realestate",icon:d}).addTo(t.ShowClusters?h:w);i[n].Info&&(r.bindPopup(f(i[n].Info)),r.options.title=i[n].Info.Reference,r.setIcon(dt(i[n].Info.AvailabilityCSS)),r.Info=i[n].Info,r.PopupLoaded=!0,r.Definitive=!0);r.EgoID=n;tt.push(i[n].Coordinates)}),t.ShowClusters?s.fitBounds(h.getBounds(),{maxZoom:14}):tt.length!=1?s.fitBounds(tt):s.fitBounds(tt).setZoom(14));e.Polygons&&(yt=function(){p.setFormattedPolygons(e.Polygons);var n=!1;forEachProp(p.polygons,function(t,i){var r=L.polygon(i[t]).addTo(a);r.on("click",L.DomEvent.stop).on("click",pt);r.EgoID=t;ut.push(r);n=!0});n&&s.fitBounds(a.getBounds())},yt(),t.PolygonSearch&&a.clearLayers())}var i={},r="",u="",e=function(n){if(!document.getElementById(n)){var i=document.getElementById("RealestateListResults"),t=createHtmlElement("div",{id:n,style:"display: none;",name:"realestateDetails","map-checked":"0"});t.appendChild(createHtmlElement("input",{type:"hidden",id:"id",value:n}));i.appendChild(t)}},o=function(n){var t=document.getElementById("polygon"),i;t?t.value=n:(i=document.getElementById("PrivateData"),i.appendChild(createHtmlElement("input",{type:"hidden",id:"polygon",name:"polygon",value:n})))};return n.prototype.getFormattedPolygons=function(){for(var n,t,r="",i=0;i<this.polygons.length;i++){for(n="",t=0;t<this.polygons[i].length;t++)n+=this.polygons[i][t][0]+" "+this.polygons[i][t][1]+",",t==0&&(first=n);n=n.replace(/,$/,"");n&&(r+=n+"|")}return r.replace(/\|$/,"")},n.prototype.setFormattedPolygons=function(n){var r=n.split("|"),u,t,f,e,i;if(r&&r.length>0)for(this.polygons={},u=0;u<r.length;u++)if(t=r[u].split(","),t&&t.length>0){for(f=[],e=0;e<t.length;e++)i=t[e].split(" "),i&&i.length==2&&f.push([i[0],i[1]]);f.length>0&&(this.polygons[guid()]=f)}},n.prototype.setFormattedMarkers=function(n){if(this.markers={},n&&n.length>0)for(var t=0;t<n.length;t++)this.markers[guid()]={Coordinates:[n[t].Latitude,n[t].Longitude],Info:n[t].Info}},n.prototype.setFormattedCircles=function(n){if(this.circles={},n&&n.length>0)for(var t=0;t<n.length;t++)this.circles[guid()]=[n[t].Latitude,n[t].Longitude,n[t].Radius]},n.prototype.setFormattedClusters=function(n){if(this.clusters={},n&&n.length>0)for(var t=0;t<n.length;t++)this.clusters[guid()]={Coordinates:[n[t].Latitude,n[t].Longitude],LocationID:n[t].LocationID,Count:n[t].Count,LocationLevel:n[t].LocationLevel}},t.prototype=Object.create(n.prototype),t.prototype.constructor=t,{openPopup:function(n,t,i,r,u,f,e,o,s,h){Popup.openPersistent(n,t,"POST",Requests.get(Requests.keys.Context)+"="+i+"&"+Requests.get(Requests.keys.MapGuid)+"="+r,"map_popup_"+r,function(n){n.status==1&&ExternalMaps.initialize(r,u,f,e,o,s,h)})},initialize:function(n,r,u,f,e,o,s){if(!document.head.querySelector("#LeafletCss")){var h=document.createElement("link");h.id="LeafletCss";h.rel="stylesheet";h.href=r;document.head.appendChild(h)}"L"in window&&window.L?i[n]=new t(f,e,o,s):$.ajax(u,{data:null,dataType:"script",method:"POST",async:!0,success:function(){i[n]=new t(f,e,o,s)}})},getMap:function(n){return i[n]},updateCoordinates:function(n,t,i){var r="#companyGPSLatitude",u="#companyGPSLongitude";n&&(r+="_"+n,u+="_"+n);$(r).val(t);$(u).val(i)}}}(),RealestateModel=function(){return{"delete":function(n,t,i,r){if(!r||!n)return!1;var u=n.up(".detailPropertyListItem");MessageBox.confirm(r,Translations.get(Translations.keys.Delete),function(){ajaxRequest(n,t,"POST",i,null,{hideLoading:!0})})}}}();requireClass("Associated");var Lead=function(){var n=function(n,t,i){var r=$(n).css(t).replace("px","");return parseInt(r)||i},i,t={onlyPinnedToggle:function(n,t){Search.onlyPinnedToggle(n,t)},loadCustomObjects:function(n){var t=document.getElementById("hVisibleObjIDs");!t||t.value.length<=0||ajaxRequest(null,n,"POST",Requests.get(Requests.keys.ObjectIDs)+"="+encodeURIComponent(t.value),null,{hideLoading:!0})},filterAction:function(n,t,i){n.up().classList.toggle("active");var r=n.getAttribute("data-v")==0?2:0;Cookie.set(i,r,365);n.setAttribute("data-v",r);Search.fullSearch(n,t,null,!0)},printLeadsPopup:function(n,t){var i=Search.GenericList.getSelectedIDs();if(!Array.isArray(i)||i.length==0)return MessageBox.alert(n.getAttribute("data-no-items-msg")),!1;ajaxRequest(n,t,"POST",Requests.get(Requests.keys.ObjectIDs)+"="+i.join(","))},printLeads:function(){var n=document.getElementById("BoxLeadsPrint"),t;n&&(t=createHtmlElement("div",null,n.cloneNode(!0)),EgoPrinter.printHtml(t.innerHTML,{inheritCSS:!0,bodyClassOverride:"BodyClass"}))},deleteLeadsPopup:function(n,t,i,r){var u=[];if(r)u.push(r);else if(u=Search.GenericList.getSelectedIDs(),!Array.isArray(u)||u.length==0)return MessageBox.alert(n.getAttribute("data-no-items-msg")),!1;ajaxRequest(n,t,"POST",appendStringParams(i,Requests.get(Requests.keys.ObjectIDs)+"="+u.join(",")))},deleteLeads:function(n,t,i){ajaxRequest(n,t,"POST",i,function(n){n.status==1&&isObject(n.data)&&(n.data.searchUrl?(Search.GenericList.deselectAll(!0),Search.fullSearch(null,n.data.searchUrl)):n.data.redirectUrl?window.location=n.data.redirectUrl:window.location.reload(!0))})},initIframesFromResponse:function(n){var u=n?n.data:null,r=isObject(u)?u.list:"",t,i;if(typeof r=="string"&&r.length>0)try{t=JSON.parse(r)}catch(f){return}if(Array.isArray(t)&&t.length!=0){for(IframeManager.registerIframes=[],i=0;i<t.length;i++)IframeManager.register(t[i].ID,t[i].Description);IframeManager.build(!0)}},summaryTablePopup:function(n,t,i){ajaxRequest(n,t,"GET",i)},setMenuDimensions:function(t){var u;if(t){var a=$(t.up(".listHeader")).width(),f=t.querySelectorAll(".MenuBox"),h=f.length;if(h!=0){var v=$(window).width(),p=$(window).height(),r=t.querySelector(".GroupMenu"),y=r?r.viewportOffset():null,w=y?y.top||0:0;if(v>768)if(h==1){var e=f[0].querySelector(".MenuTitle"),c=0,l=parseInt($(t).width());if(e){f[0].querySelectorAll(".MenuOption").forEach(function(n){var t=$(n).width();t>c&&(c=t)});var o=n(e,"padding-left",0),s=n(e,"padding-right",0),b=n(e,"font-size",1),i=$(e).text().length*b-o-s;o=n(r,"padding-left",0);s=n(r,"padding-right",0);i=i-o-s;u=t.querySelector(".GroupMenuContent");u&&(o=n(u,"padding-left",0),s=n(u,"padding-right",0),i=i-o-s);i<c&&(i=c);l&&i<l&&(i=l);r.style.width=i+"px"}}else h==2?(r.style.width=a*.66+"px",f.forEach(function(n){n.style.width="50%"})):h>2&&(r.style.width=a+"px",f.forEach(function(n){n.style.width="33.33%"}));else v<769&&(u=t.querySelector(".GroupMenuContent"),u&&(u.style.maxHeight=p-w-80+"px"))}}},preferencesPopup:function(n,t,r){var u="LeadPreferences",f=new Popup.LayerOptions(null,null,null,function(){Tabs.CollapsingPane.clearCallbacks(u)});ajaxRequest(n,t,"GET",r,function(){var n=Popup.current();i=applyDropdowns(n,{clickCallback:Lead.preferenceAddCustomLocation})[0];Tabs.CollapsingPane.registerNavHeaders(u,n,function(){return Popup.current()});Tabs.Items.onLoad(n)},{popupOptions:f})},preferenceAddCustomLocation:function(n){var t,i,e,r;if(console.log(n),n){var o=n.getAttribute("data-selected")==="true",u=n.getAttribute("data-value"),s=n.querySelector("span").innerText,f=n.up("#PreferenceCustomLocations");f&&(t=f.querySelector(".AddedLocations"),o&&t?(i=t.querySelector(".template"),i&&(e=htmlStringToElement(compressText(i.outerHTML).replace(/{id}/g,u).replace(/{name}/g,s)),t.appendChild(e))):t&&(r=t.querySelector("#CustomLocation_"+u),r&&r.remove()))}},preferenceDeleteCustomLocation:function(n,t){var r=n.up("#CustomLocation_"+t);r&&r.remove();i&&i.toggleValue(t,!1)},preferenceOpenMapPopup:function(n,t,i,r,u,f,e){var s=document.getElementById("preference_location_polygons"),o;s&&(o=Location.getCoordinatesFromDropdowns(n),ExternalMaps.openPopup(n,t,i,r,u,f,e,o.latitude,o.longitude,{Polygons:s.value}))},preferenceSaveMapPolygons:function(n){var i=document.getElementById("preference_location_polygons"),t;i&&(t=ExternalMaps.getMap(n),t&&(i.value=t.getFormattedPolygons()));Popup.close()},savePreference:function(n,t){var i=n.up("#PreferencesEditPopup");i&&ajaxRequest(n,t,"POST",$(i).find("input,select").serializeAll(),function(){Popup.close()})},sort:function(n,t,i){var r=document.getElementById("LeadSort");Search.setSort(r,i);Search.fullSearch(n,t,function(){for(var t=document.getElementById("LeadListResults").querySelector(".gridResultsTable"),r=t.querySelectorAll("th"),i=-1,n=0;n<r.length;n++)if(r[n].classList.contains("orderBy")){i=n;break}if(i>-1)for(n=1;n<t.rows.length;n++)t.rows[n].cells[i].classList.add("orderBy")})},editInTable:function(n,t,i,r){var u=function(){var t=n.up("td"),i=t.querySelector(".refEdit"),r=i.querySelector(".editValue");t.querySelector(".ref").hide();i.show();r.focus();r.moveCursorEnd()};t?(r=r||"GET",ajaxRequest(n,t,r,i,function(n){n.status===ajaxRequest.StatusType.Success&&u()})):u()},editInTableSave:function(n,t,i,r){r=r||"";var u=n.up("td"),f=u.querySelector(".editValue");if(f.value.trim()==f.getAttribute("data-og-value")){u.querySelector(".ref").show();u.querySelector(".refEdit").hide();return}i=appendStringParams(i,$(u).find(":input").serializeAll());ajaxRequest(u,t,"POST",i,function(n){var t,i;n.status==ajaxRequest.StatusType.Success&&(isObject(n.data)&&n.data.hasChanges===!0&&(t=u.querySelector(".toRefresh"),t?t.innerText=u.querySelector(".editValue").value:(i=u.querySelector(".editValue"),u.querySelector(".editMe").innerText=i[i.selectedIndex].innerText||r)),u.querySelector(".ref").show(),u.querySelector(".refEdit").hide())})},changeLeadProbability:function(n,t,i){var u=null,f=null,r=$("#probabilitySuccessHidden").val();u=appendStringParams(u,Requests.getPair(Requests.keys.LeadID,i));n.id=="highProbabilityButton"?f=r==3?0:3:n.id=="lowProbabilityButton"&&(f=r==1?0:1);u+="&leadProbabilityIDs="+f.toString();ajaxRequest(n,t,"POST",u,function(t){t.status==ajaxRequest.StatusType.Success&&(n.id=="highProbabilityButton"?(r=r==3?0:3,$("#highProbabilityButton").removeClass("active"),$("#lowProbabilityButton").removeClass("active"),r==3&&$("#highProbabilityButton").addClass("active")):n.id=="lowProbabilityButton"&&(r=r==1?0:1,$("#highProbabilityButton").removeClass("active"),$("#lowProbabilityButton").removeClass("active"),r==1&&$("#lowProbabilityButton").addClass("active")),$("#probabilitySuccessHidden").val(r))})},changeItemsPreferenceListTab:function(n,t,i){if(!$(n).hasClass("active")){var r=n.up(".detailMainHeader");r.querySelectorAll("a").forEach(function(n){$(n).removeClass("active")});ajaxRequest(n,t,"GET",i);$(n).addClass("active")}},openChoosePropertySlideShow:function(n,t,i){var r=ItemAssociation.getLeadObjectManagerContext(n),u=r.querySelectorAll(".contentListItem").map(function(n){return n.getAttribute("id")});i=appendStringParams(i,Requests.getPair(Requests.keys.ObjectIDs,u.join(",")));Slideshow.popupSlideshowBulk(n,t,i,"","",0,!0,Associated.Lead.Presentation.saveOnSlideshowClose)},setProperty:function(n,t,i){var r=$("#SetRealestatePopup");ajaxRequest(n,t,"POST",i,function(n){n.status==ajaxRequest.StatusType.Success&&r&&Popup.close()})},discardedRealestateRenderPage:function(n,t,i){var r=document.getElementById("LeadID").value;i="Page="+i+"&leadID="+r;ajaxRequest(n,t,"GET",i)},activateLead:function(n,t,i){var u=n.up(".PopupContext"),r,s,f,h;if(u){var o=0,e=0,c=u.querySelector("#model_number"),l=u.querySelector("#commission_perc");if(c&&l&&(o=parseFloat(c.value),e=parseInt(l.value)),r=[],r.push($(u).find("#RentalVacationContext *").serializeAll()),r.push($(u).find("#date_execution").serialize()),u.querySelectorAll(".CommissionItem").length&&o>0&&e>0&&(r.push($(u).find(".CommissionItem *").serializeAll()),r.push(Requests.getPair(Requests.keys.Commission,o)),r.push(Requests.getPair(Requests.keys.Percentage,e)),console.log(e)),s=document.getElementById("marketplace_currencyid"),s){if(f=document.getElementById("marketplace_bank_number"),h="",f){if(!f.value){MessageBox.alert(f.getAttribute("data-errormessage"));return}h=f[f.selectedIndex].getAttribute("data-bankid")}r.push("bankid="+h);r.push("marketplace_price="+document.getElementById("marketplace_price").value);r.push("marketplace_currencyid="+s.value)}else r.push($(u).find("#leadobject_price").serialize()),r.push($(u).find("#leadobject_currencyid").serialize());i=appendStringParams(i,r);ajaxRequest(n,t,"POST",i,function(n){var t;if(n.status==ajaxRequest.StatusType.Success)Popup.close();else if(n.status==ajaxRequest.StatusType.Handled){if(!n||!n.data)return;n.data.showPrice?(t=document.getElementById("LeadPrice"),t&&$(t).show()):n.data.showRentalVacation?(t=document.getElementById("RentalVacation"),t&&$(t).show()):n.data.hideBusyStage&&(t=document.getElementById("busyStage"),t&&$(t).hide())}})}},checkReference:function(n,t,i){var r,u=n.up(".opDetailSummarySectionEdit");clearTimeout(r);r=setTimeout(function(){i=appendStringParams(Requests.getPair(Requests.keys.SearchText,n.value),i);ajaxRequest(n,t,"POST",i,function(n){var t=u.querySelector("#warningReference");n.status==ajaxRequest.StatusType.Success&&n.data.exists==!0?t&&t.show():t&&t.hide()})},2e3)},leadSecuritySave:function(n,t,i){var r=document.getElementById("LeadSecuritySection"),u,f;r&&(u=document.getElementById("LeadID").value,f=$(r).find("*").serializeAll()+"&Permissions="+JSON.stringify(Permissions.getTarget("0"))+"&leadID="+u,i=appendStringParams(i,f),ajaxRequest(n,t,"POST",i))},getSecurityUserDropdown:function(n,t,i){i=appendStringParams(Requests.getPair(Requests.keys.KeyGroupID,n.value),i);ajaxRequest(n,t,"GET",i)},saveCallUser:function(n,t,i){var r=n.up(".popupBox"),u,f;r&&(u=document.getElementById("LeadID").value,f=$(r).find("*").serializeAll()+"&leadID="+u,i=appendStringParams(i,f),ajaxRequest(n,t,"POST",i),Popup.close())},generateRealestateOfficePDF:function(n,t,i){ajaxRequest(n,t,"GET",i,function(n){n.status==1&&isObject(n.data)&&n.data.url&&window.open(n.data.url)})},saveLeadMerge:function(n,t,i){var u=$("#leadToMerge").val(),r;if(!u){MessageBox.alert(n.getAttribute("data-no-items-msg"));return}r=n.up(".popupBox");r&&(i=appendStringParams($(r).find("*").serializeAll(),i),ajaxRequest(n,t,"POST",i))},removeDelay:function(n,t,i){ajaxRequest(n,t,"POST",i,function(t){t&&t.status==ajaxRequest.StatusType.Success&&n.remove()})},changeStatus:function(n,t,i,r){ajaxRequest(n,t,i,r,function(t){if(t.data&&t.data.electText&&t.data.electUrl&&t.data.electMethod&&t.data.electParams){var i=function(){ajaxRequest(n,t.data.electUrl,t.data.electMethod,t.data.electParams)};MessageBox.confirm(t.data.electText,t.data.electButton,i,null,Translations.get(Translations.keys.Cancel))}})},saveLost:function(n,t,i,r){var u,f=n.up("#LeadLostPopup");f==null&&(u=$(f).find("*").serialize());Lead.changeStatus(n,t,i,u&&u.length>0?r+"&"+u:r)},calcCommission:function(n,t){var e=$("."+n),u=0,r,i,f;$(t)&&(u=InputNumberValue($(t)));r=e.find(function(n){return n.hasClassName("agency_commission")});i=u;r&&(f=r.up().select("select").first(),f&&f.value==0?(i=u*(InputNumberValue(r.up().select("input").first())/100),i=Math.round(i*100)/100):i=InputNumberValue(r.up().select("input").first()));e.each(function(n){var r=$(n).up(),u=r.select("span")[1],f=u.up("td").select("[id*=calc_value]:first")[0],e=r.select("input").first(),o=r.select("select").first(),t=0;t=InputNumberValue(e);o.value!=0||n.hasClassName("agency_commission")?n.hasClassName("agency_commission")&&(t=i):(t=i*(t/100),t=Math.round(t*100)/100);u.update(t);f.setValue(t)})}};return t.List=function(){return{markAsUnread:function(n,t,i){var r=Search.GenericList.getSelectedIDs();if(!Array.isArray(r)||r.length==0)return MessageBox.alert(n.getAttribute("data-no-items-msg")),!1;ajaxRequest(n,t,"POST",appendStringParams(i,Requests.get(Requests.keys.ObjectIDs)+"="+r.join(",")),function(n){n.status==1&&(Search.GenericList.deselectAll(!0),isObject(n.data)&&n.data.searchUrl&&Search.fullSearch(null,n.data.searchUrl,null,!0))})},removeArchived:function(n,t,i){var r=Search.GenericList.getSelectedIDs(),u;if(!Array.isArray(r)||r.length==0)return MessageBox.alert(n.getAttribute("data-no-items-msg")),!1;u=Requests.get(Requests.keys.ObjectIDs)+"="+r.join(",");MessageBox.confirm(i,Translations.get(Translations.keys.Yes),function(){ajaxRequest(n,t,"POST",u,function(t){t.status==ajaxRequest.StatusType.Success&&(isObject(t.data)&&typeof t.data.searchUrl=="string"&&t.data.searchUrl.length>0?Search.fullSearch(n,t.data.searchUrl,null,!0):window.location.reload(!0))})},"",Translations.get(Translations.keys.No))}}}(),t.TableView=function(){return{init:function(n,t){new TableView(n,"Lead",t)}}}(),t.InternetLead=function(){function n(n,t,i){var r,u,f,e;if(!n){console.error("Lead.InternetLead[_updateSelectedContact]: popupBox invalido ou nao fornecido.");return}if(!t){console.error("Lead.InternetLead[_updateSelectedContact]: contactElem invalido ou nao fornecido.");return}t.querySelector(".contactCard").classList.remove("selectContact");t.querySelector(".contactCard").classList.add("suggestedContact");t.querySelector(".new").hide();t.querySelector(".cancel").show();n.querySelector(".suggestedEntities").hide();n.querySelector(".entityChosen").show();r=n.querySelector(".entityChosenContainer");r&&(r.innerHTML="",r.appendChild(t),u=n.querySelector(".leadEntitySaveBtn"),u&&(f=u.getAttribute("data-alternativeLabel"),f&&(u.innerHTML=f)));e=n.querySelector("[name=SelectedContact]");e&&(e.value=i)}return{showMoreSuggestedContacts:function(n){var t,i,r;n&&(t=n.parentElement,t&&(i=t.up(".promoteLeadBlockHalf"),i&&(r=i.querySelector("#extraContacts"),r&&($(r).fadeIn(1e3),t.remove()))))},chooseContact:function(t,i,r){var f=t.up(".popupBox"),e=t.up(".SuggestedContactItem").cloneNode(!0),u;n(f,e,i);r&&(u=[],u.push($(f).find("*").serializeAll()),u.push(Requests.get(Requests.keys.EntityID)+"="+i),ajaxRequest(t,r,"GET",u.join("&")))},cancelContact:function(n){var t=n.up(".popupBox"),i,r,f,u;t.querySelector(".suggestedEntities").show();t.querySelector(".entityChosen").hide();t.querySelector("[name=SelectedContact]").value="";i=t.querySelector("#suggestedContactsContainer");i.getAttribute("data-isLoaded")=="0"&&Lead.InternetLead.getSuggestedContacts(null,i.getAttribute("data-url"));r=t.querySelector("#LeadEntityChangesContainer");r&&(r.hide(),f=t.querySelector(".leadEntitySaveBtn"),leadEntitySaveBtn&&(u=leadEntitySaveBtn.getAttribute("data-defaultLabel"),u&&(leadEntitySaveBtn.innerHTML=u)))},getSuggestedContacts:function(n,t){var i=document.getElementById("PromotePopup");ajaxRequest(n,t,"GET",$(i).find("*").serializeAll())},usersToggle:function(n,t){if(n){var i=n.up(".collapsingLine"),r=i.querySelector("#SeeUsers"),u=i.querySelector("#SeeGroups"),f=i.querySelector("#SeeApplications");t?(i.querySelector("#SeeAssignedUsersPop").show(),i.querySelector("#SeeAssignedTeamsPop").show(),i.querySelector("#SeeAssignedApplicationPop").show(),r&&$(r).has("div").length>0&&r.show(),u&&$(u).has("div").length>0&&u.show(),f&&$(f).has("div").length>0&&f.show()):(i.querySelector("#SeeAssignedUsersPop").hide(),i.querySelector("#SeeAssignedTeamsPop").hide(),i.querySelector("#SeeAssignedApplicationPop").hide(),r&&r.hide(),u&&u.hide(),f&&f.hide())}else return},openProfilePopup:function(n,t,i){var f,r,e,u;n&&t&&i&&(f=document.getElementById(i))&&((r=f.getAttribute("href"))&&typeof r=="string"&&r.indexOf("javascript:void(0)")==-1?u=function(){window.location.href=r}:(e=f.getAttribute("onclick"))&&(u=new Function(e)),typeof u=="function"&&MessageBox.confirm(n,t,u))},openPromoteLeadPopup:function(n,t,i){ajaxRequest(n,t,"GET",i,function(t){if(t.status==1&&isObject(t.data)){t.data.permissions&&User.Permissions.init(Popup.current(),t.data.permissions,t.data.id);var i=n.up(".leadItem");i&&i.classList.contains("unreadItem")&&i.classList.remove("unreadItem")}})},promoteLead:function(n,t,i,r){var u=document.getElementById("PromotePopup"),f=$(u).find('input[name="SelectedContact"]:first').val();f&&f!="0"?Lead.InternetLead.getAssignUser(u,i,t,r):Lead.InternetLead.promoteLeadToOpportunity(n,t,null,r)},promoteLeadToOpportunity:function(n,t,i,r){var f=document.getElementById("PromotePopup"),u;i&&(f.querySelector("#assigned_user_id").value=i);u=$(f).find("*").serializeAll();u=appendStringParams(u,Requests.getPair(Requests.keys.Permissions,JSON.stringify(Permissions.getTarget(r))));ajaxRequest(n,t,"POST",u,function(n){n.status==1&&isObject(n.data)&&n.data.redirectUrl&&(Loading.show(),window.location=n.data.redirectUrl)})},getAssignUser:function(n,t,i,r){var u=$(n.querySelector(".PrivateData")).find("*").serializeAll();u+="&assigned_user_id="+n.querySelector("#assigned_user_id").value;ajaxRequest(n,t,"GET",u,function(t){t.status==1&&isObject(t.data)&&t.data.promote&&Lead.InternetLead.promoteLeadToOpportunity(null,i,n.querySelector("#assigned_user_id").value,r)})},openLeadEntityUpdatePopup:function(n,t,i){ajaxRequest(n,t,"GET",i,function(){})},openLeadEntityDeletePopup:function(n,t,i){ajaxRequest(n,t,"GET",i,function(){})},updateRecruitmentLead:function(n,t){var r=document.getElementById("PromotePopup"),i=[];i.push($(r).find("*").serializeAll());ajaxRequest(n,t,"POST",i.join("&"),function(n){n.status==1&&(Popup.close(),MessageBox.alert(n.alertMessage.message,function(){window.location.reload(!0)}))})},updateLeadEntity:function(n,t,i,r,u){MessageBox.confirm(r,u,function(){ajaxRequest(n,t,"POST",i,function(n){n.status==1&&(Search.GenericList.deselectAll(!0),isObject(n.data)&&n.data.searchUrl&&(Search.fullSearch(null,n.data.searchUrl,null,!0),Popup.close()))})})},createLeadEntity:function(n,t,i){var u,r,f,e,o;i||(u=n.up(".popupBox"),u&&(r=[],f=u.querySelector("#popupBoxPrivateData"),f&&r.push($(f).find("*").serializeAll()),e=$("#LeadEntityChangesContainer"),e.is(":visible")?r.push(e.find("*").serializeAll()):(o=$("#newContactPrivateData"),o&&r.push(o.find("*").serializeAll())),i=r.join("&")));ajaxRequest(n,t,"POST",i,function(n){n.status==1&&(Search.GenericList.deselectAll(!0),isObject(n.data)&&n.data.searchUrl&&(console.log("create -> "+n.data.create),console.log("update -> "+n.data.update),Popup.close(),Search.fullSearch(null,n.data.searchUrl,null,!0)))})},searchEntityFromPromotionPopup:function(t,i,r,u,f){Search.Simplified.open(t,r,u,function(){Popup.registerCallbacks(new Popup.LayerOptions(null,function(){var t=Search.Simplified.getCurrentSelected().first()||"",r;t&&(r=Requests.getPair(Requests.keys.EntityID,t),ajaxRequest(null,f,"GET",r,function(r){if(r.status===ajaxRequest.StatusType.Success&&isObject(r.data)&&r.data.item){var u=htmlStringToElement(r.data.item);n(i,u,t)}}))}),-1)})}}}(),t.Edit=function(){var n={},t={},i=!1;return{init:function(i){n=i.translations;t=i.searchBars},Files:[],putFilesOnPost:function(){var n=document.getElementById("uploader"),t=0;n&&n.querySelectorAll("[id^=AttachAsset_]").forEach(function(n){var i=Lead.Edit.Files.find(function(t){return t.UID===n.id.split("_")[1]});i.Priority=t;t++});document.getElementById("lead_files").value=JSON.stringify(Lead.Edit.Files)},saveLead:function(n,t){if(!this.validate())return!1;var r=n.up(".PageContext"),u=r.querySelector(".PrivateData"),f=r.querySelectorAll(".inputInfoContent"),i=$(u).find("*").serializeAll();i=appendStringParams(i,$(f).find("*").serializeAll());i=appendStringParams(i,Requests.getPair(Requests.keys.Permissions,JSON.stringify(Permissions.getTarget($("input[name='leadID']").val()))));ajaxRequest(n,t,"POST",i,function(n){n.status===ajaxRequest.StatusType.Success&&(location.href=n.data.redirecTo)})},validate:function(){var r,o=!0,l=$("#leadID").val()<=0,s,u,f;if($("#MasterLeadType").val()!=1&&$("#MasterLeadType").val()!=10&&$("#MasterLeadType").val()!=11&&$("#MasterLeadType").val()!=35){if(Search.Entity&&t.ownerBar&&(s=$("[name='contact_request_key']").map(function(){return $(this).val()}),t.ownerBar.required)){var a=$("#"+t.ownerBar.id),h=parseInt(Search.Entity.getEntityID(a[0])),e=s[0];if(!h&&$("[name='"+e+"_firstname']").is(":visible")){if(u=$("[name='"+e+"_firstname']"),!u.val()||!u.val().trim().length)return r=n.NAME_CANNOT_BE_EMPTY,oCallback=function(){u.focus()},MessageBox.alert(r,oCallback,n.ERROR_SAVING_LEAD,n.SOLVE_PROBLEM),!1;if(f=$("[name='"+e+"_email']"),!f.val()||!Email.isValid(f.val()))return r=n.EMAIL_CANNOT_BE_EMPTY,oCallback=function(){f.focus()},MessageBox.alert(r,oCallback,n.ERROR_SAVING_LEAD,n.SOLVE_PROBLEM),!1}}if(Search.Entity&&t.informerBar){var c=$("#"+t.informerBar.id),h=parseInt(Search.Entity.getEntityID(c[0])),e=s[1];if(t.informerBar.required)if(!h&&$("[name='"+e+"_firstname']").is(":visible")){if(u=$("[name='"+e+"_firstname']"),!u.val()||!u.val().trim().length)return r=n.NAME_CANNOT_BE_EMPTY,oCallback=function(){u.focus()},MessageBox.alert(r,oCallback,n.ERROR_SAVING_LEAD,n.SOLVE_PROBLEM),!1;if(f=$("[name='"+e+"_email']"),!f.val()||!Email.isValid(f.val()))return r=n.EMAIL_CANNOT_BE_EMPTY,oCallback=function(){f.focus()},MessageBox.alert(r,oCallback,n.ERROR_SAVING_LEAD,n.SOLVE_PROBLEM),!1}else if(!h)return r=n.WARNING_INFORMER_EMPTY,oCallback=function(){c.children("input").focus()},MessageBox.alert(r,oCallback,n.ERROR_SAVING_LEAD,n.SOLVE_PROBLEM),!1}}if(i)return oCallback=function(){$("#Reference").focus()},MessageBox.alert(r,oCallback,n.REFERENCE_ALREADY_EXISTS,n.SOLVE_PROBLEM),!1;if($("#IsInternetLead").val()=="0"){if($("#MasterLeadType").val()==""||$("#MasterLeadType").val()=="0")return r=$("#MasterLeadType").data("empty"),oCallback=function(){$("#MasterLeadType").focus()},MessageBox.alert(r,oCallback,n.ERROR_SAVING_LEAD,n.SOLVE_PROBLEM),!1;if(!$("#Reference").val()&&!l)return r=$("#Reference").data("empty"),oCallback=function(){$("#Reference").focus()},MessageBox.alert(r,oCallback,n.ERROR_SAVING_LEAD,n.SOLVE_PROBLEM),!1}return $("#lead_category_id").length&&$("#lead_category_id").data("isRequired")&&$("#lead_category_id").data("isRequired")=="1"?(r=$("#lead_category_id").data("empty"),oCallback=function(){$("#lead_category_id").focus()},MessageBox.alert(r,oCallback,n.ERROR_SAVING_LEAD,n.SOLVE_PROBLEM),!1):$("#originID").val()?$("[id^='realestate_bar']").is(":visible")&&!$("#RealestateID").val()?(r=n.PLEASE_PROVIDE_REALESTATE,oCallback=function(){$('input[class="RealestateInput"').focus()},MessageBox.alert(r,oCallback,n.ERROR_SAVING_LEAD,n.SOLVE_PROBLEM),!1):($("[id^='realestate_edit_'] [data-required]:visible").each(function(n,t){if(t.value)o=!0;else return r=$(t).data("message"),oCallback=function(){$(t).focus()},o=!1,!1}),!o)?(MessageBox.alert(r,oCallback,n.ERROR_SAVING_LEAD,n.SOLVE_PROBLEM),!1):($("#MasterLeadType").val()==35&&Lead.Edit.putFilesOnPost(),TinyMceEditor.post("teditor"),!0):(r=n.WITHOUT_ORIGIN,oCallback=function(){$("#originID").focus()},MessageBox.alert(r,oCallback,n.ERROR_SAVING_LEAD,n.SOLVE_PROBLEM),!1)},manage:function(n,t,i){ajaxRequest(n,t,"GET",i)},onChangeMasterLeadType:function(n,t){n.value&&(location.href=t.format(n.value)+"?fromReload=true")},getByTokenPopup:function(n,t){ajaxRequest(n,t,"GET")},checkReference:function(n,t,r){if(n.value){var u="&Reference="+n.value.trim()+"&leadID="+r;ajaxRequest(n,t,"GET",u,function(n){n.data.alreadyExits?($("#referenceStatusAvaliable").hide(),$("#referenceStatusUnavaliable").show()):($("#referenceStatusAvaliable").show(),$("#referenceStatusUnavaliable").hide());i=n.data.alreadyExits})}}}}(),t}(),Associated=function(){function r(n){var r=localStorage.getItem(t),u=new RegExp("(^|;)"+regexEscape(n)+i,"ig");return r&&r.match(u)?!1:!0}var t="ATabs",i=":c",n={initAjaxTabLoad:function(){EventHandler.addListener(window,"load",Associated.lazyLoad);EventHandler.addListener(document,"scroll",Associated.lazyLoad);EventHandler.addListener(window,"resize",Associated.lazyLoad)},lazyLoad:function(){var n=document.getElementsByClassName("AjaxSection"),t;if(n&&n.length>0)for(t=0;t<n.length;t++)isInViewport(n[t])&&r(n[t].getAttribute("data-tabname"))&&!n[t].getAttribute("data-status")&&$(n[t]).is(":visible")&&n[t].click()},setTabOpen:function(n){var u,f,r,e;n&&(u=n.getAttribute("data-tabname"),u&&(f=localStorage.getItem(t),f&&(r=f.split(";"),e=r.indexOf(u+i),e!=-1&&r.splice(e,1),localStorage.setItem(t,r.join(";")))))},setTabClose:function(n){var r,u,f;if(n&&(r=n.getAttribute("data-tabname"),r))if(u=localStorage.getItem(t),u){if(f=u.split(";"),f.indexOf(r+i)!=-1)return;localStorage.setItem(t,f.join(";")+";"+r+i)}else localStorage.setItem(t,r+i)}};return n.ProcessManagement=function(){return{get:function(n,t,i,r){if(n&&t){var u=[],f=n.up(".detailSection");f&&u.push($(f).find("*").serializeAll());i&&u.push(Requests.get(Requests.keys.Page)+"="+i);u=u.filter(function(n){return n.length}).join("&");r&&(u+="&"+r);ajaxRequest(n,t,"GET",u)}},getClients:function(n,t,i,r){if(r){var u=Search.GenericList.getSelectedIDs();if(!Array.isArray(u)||u.length==0)return MessageBox.alert(n.getAttribute("data-no-items-msg")),!1}ajaxRequest(n,t,"POST",i,function(n){n.status==ajaxRequest.StatusType.Success&&isObject(n.data)&&n.data.url&&n.data.param&&window.post(n.data.url,n.data.param,"_blank")})},openSimplifiedSearch:function(n,t,i,r,u){Search.Simplified.open(n,t,i,null,"POST",{popupOptions:new Popup.LayerOptions(null,null,null,function(){ajaxRequest(null,r,"GET",u)})})}}}(),n.Lead=function(){function n(){function f(n,t,i){n.up(".LeadObjectManager").querySelectorAll(".PresentedItem").invoke("classList.remove","active");n.up(".PresentedItem").classList.add("active");var r=function(){Popup.adjustOverflow(!n.classList.contains("active"),!1)};n.querySelector(".PresentationEdit")?r():ajaxRequest(n,t,"GET",i,function(n){n.status==ajaxRequest.StatusType.Success&&r()},{hideLoading:!0})}function e(){var t=Slideshow.getStarter(),n;return t&&(n=t.up(".PresentationContext"),n)?n.getAttribute("data-prescontextparams")||"":""}function r(n,i,r,u){Search.Simplified.open(n,i,r,function(){Popup.registerCallbacks(new Popup.LayerOptions(null,function(n){var r,i;typeof u=="function"&&u(n);r=Search.Simplified.getCurrentSelected();Array.isArray(r)&&r.length>0&&(t=0,i=n.querySelector(".RegisterPresentationContext"),i&&(i.clearChildren(),i.appendChild(createHtmlElement("div",{"class":"listItemLocation",innerHTML:i.getAttribute("data-reg-pres-msg")}))))}),-1)})}function u(n,t,i,r){Search.Simplified.open(n,t,i,function(){Popup.registerCallbacks(new Popup.LayerOptions(null,null,null,function(n){var t=Search.Simplified.getCurrentSelected();typeof r=="function"&&r(n,t)}),0)})}var n=Object.freeze({Undefined:0,Association:1,Slideshow:2,ObjectDetail:3}),t=0,i=[];return{getLeadIDs:function(){return i},onEditClick:function(n,t,i){return function(){f(n,t,i)}},setSummary:function(n,t,i){i=appendStringParams(i,$(n.up(".PresentationEdit")).find("*").serializeAll());ajaxRequest(n,t,"POST",i,function(t){if(t.status==ajaxRequest.StatusType.Success){var i=n.up(".PresentedItem"),r=isObject(t.data)&&t.data.evaluated===!0;i.classList.toggle("Done",r);i.classList.toggle("active",!r);i.click()}})},getAssignedLeadID:function(n){return n&&(t=0),t},adjustLayout:function(n){var i=n.up(".popupBox");if(i)if(isMobile(window))if(n.classList.contains("active")){var t=n.querySelector(".addedInfo"),r=$(t).offset().top,o=$(t).height(),u=$(t).parent().find(".listItemActionDrop").outerHeight(),f=$(t).closest(".popupContent").offset().top,s=r-f,h=r-f+o+u,c=$(t).closest(".popupContent").height();h>c&&s>u&&$(t).parent().addClass("bottom");var l=$(window).width(),a=$(t).offset().left,v=$(t).closest(".popupContent").offset().left,y=$(t).parent().find(".listItemActionDrop").outerWidth(),p=a-v;p<y&&l>768&&$(t).parent().addClass("left")}else n.classList.remove("left","bottom");else{var e=n.querySelector(".listItemActionDrop"),w=$(i).offset().top+$(i).height(),b=$(e).offset().top+$(e).height();if(w>b)return;Popup.adjustOverflow(!1);n.getAttribute("data-reg-close")!="1"&&(FloatMenu.registerCallback(n,new FloatMenu.Options(null,function(){Popup.adjustOverflow(!0)})),n.setAttribute("data-reg-close","1"))}},listLeads:function(f,o,s){var l=f.up(".RegisterPresentationContext"),h=l.querySelector("#oLeads"),a=parseInt(l.getAttribute("data-rendertype"))||0,c=a==n.Slideshow,v,y;if(a!=n.Slideshow&&a!=n.ObjectDetail||f.getAttribute("data-direct-open-popup")=="1"&&!f.checked)return!1;f.getAttribute("data-loaded")=="1"?f.checked?(h.show(),c&&(v=h.querySelector(".SPL"),v&&v.click())):(h.hide(),c&&(t=0)):f.checked&&(y=c?[Requests.getPair(Requests.keys.SelectedIDs,t>0?t.toString():""),e()]:Requests.getPair(Requests.keys.SelectedIDs,i?i.join(","):""),s=appendStringParams(s,y),ajaxRequest(f,o,"POST",s,function(n){var i;if(n.status==ajaxRequest.StatusType.Success&&isObject(n.data))if(n.data.url&&n.data.requestParams)f.checked&&(f.setAttribute("data-direct-open-popup","1"),c?r(null,n.data.url,n.data.requestParams,function(n){var t=null;n&&(t=n.querySelector(".RegisterPresentationContext label > input[type=checkbox]"));t&&t.checked&&(t.checked=!1)}):u(null,n.data.url,n.data.requestParams,function(n,t){var i=f;i&&(Array.isArray(t)&&t.length>0?(l&&MessageBox.alert(l.getAttribute("data-reg-pres-msg")),i.checked||(i.checked=!0)):i.checked&&(i.checked=!1))}));else if(n.data.elem){var e=htmlStringToElement(n.data.elem),o=e.cloneNode(!0),t=h.querySelector(".float-menu.active");t&&t.remove();t=o;h.appendChild(t);!t.querySelector(".triangle")&&t.querySelector(".PresentationLeads")&&t.classList.add("active");f.setAttribute("data-loaded","1");c&&(i=h.querySelector(".SPL"),i&&i.click())}}))},listMoreLeads:function(n,t,i){var u=n.up(".RegisterPresentationContext"),f=u.querySelector("#oLeads"),r=f.querySelector(".float-menu.active");ajaxRequest(n,t,"POST",i,function(t){if(t.status==ajaxRequest.StatusType.Success&&isObject(t.data)&&t.data.elem){var i=createHtmlElement("div",{innerHTML:t.data.elem}),u=r.querySelector(".PresentationLeads"),f=r.querySelector("#spl_other_leads"),e=f.cloneNode(!0);u?i.querySelectorAll("a.SPL").forEach(function(n){u.appendChild(n.cloneNode(!0))}):r.appendChild(i.querySelector(".listItemActionDrop").cloneNode(!0));f.remove();r.querySelector(".listItemActionDrop").appendChild(e);n.remove()}})},setLeadRelation:function(i,r){var s,h,c,u,l;if(i&&!i.classList.contains("selected")){var o=i.up(".RegisterPresentationContext"),f=null,e=n.Undefined;if(o&&(f=o.querySelector("#oLeads"),e=parseInt(o.getAttribute("data-rendertype"))||0),e!=n.Slideshow&&e!=n.ObjectDetail)return!1;(s=e==n.ObjectDetail,!s||(f&&(h=f.getAttribute("data-reg-pres-url"),c=appendStringParams(decodeURIComponent(f.getAttribute("data-reg-pres-params")),Requests.getPair(Requests.keys.SelectedIDs,r))),h&&c))&&(u=null,f&&(u=f.querySelector(".float-menu")),s?ajaxRequest(i,h,"POST",c,function(n){if(n.status==ajaxRequest.StatusType.Success){u||(u=f.querySelector(".float-menu"));u.querySelectorAll("a.SPL.selected").invoke("classList.remove","selected");var t=u.querySelector('[id="spl_'+r+'"]');t.classList.add("selected");u.querySelector("#CurrentTargetLead").textContent=t.textContent}}):(u&&(u.querySelectorAll("a.SPL.selected").invoke("classList.remove","selected"),l=u.querySelector('[id="spl_'+r+'"]'),l&&(u.querySelector("#CurrentTargetLead").textContent=l.textContent),u.click()),t=r))}},popupSimplifiedSearch:function(t,i,f,e){e==n.Slideshow?r(t,i,f):e==n.ObjectDetail&&u(t,i,f)},saveOnSlideshowClose:function(n){var i,r,u,t;if(n&&(i=Associated.Lead.Presentation.getAssignedLeadID(),i&&!(i<0))&&(r=n.querySelector(".RegisterPresentationContext"),r)&&(u=r.querySelector("label > input[type=checkbox]"),u&&u.checked)&&(t=r.querySelector("#oLeads"),t)){var f=[decodeURIComponent(t.getAttribute("data-reg-pres-params")),Requests.get(Requests.keys.SelectedIDs)+"="+i],e=appendStringParams($(t).find(".PrivateData :input").serializeAll(),f),o=t.getAttribute("data-reg-pres-url");ajaxRequest(null,o,"POST",e,function(n){n.status==ajaxRequest.StatusType.Success&&Associated.Lead.Presentation.getAssignedLeadID(!0)})}}}}return{get:function(n,t,i,r){if(n&&t){var u=[],f=n.up(".detailSection");f&&u.push($(f).find("*").serializeAll());i&&u.push(Requests.get(Requests.keys.Page)+"="+i);u=u.filter(function(n){return n.length}).join("&");r&&(u+="&"+r);ajaxRequest(n,t,"GET",u)}},"delete":function(n,t,i,r){n&&t&&MessageBox.confirm(i,Translations.get(Translations.keys.Delete),function(){var i,u=n.up(".detailSection");i=u?$(u).find("*").serializeAll()+"&"+r:r;ajaxRequest(n,t,"POST",i,null,{hideLoading:!0})})},add:function(n,t,i){if(n&&t){var r,u=n.up(".detailSection");u&&(r=$(u).find("*").serializeAll()+"&"+i);ajaxRequest(n,t,"POST",r)}},getPotsByAssociatedOpportunities:function(n,t,i,r){if(r){var u=Search.GenericList.getSelectedIDs();if(!Array.isArray(u)||u.length==0)return MessageBox.alert(n.getAttribute("data-no-items-msg")),!1}ajaxRequest(n,t,"POST",i,function(n){n.status==ajaxRequest.StatusType.Success&&isObject(n.data)&&n.data.url&&n.data.param&&window.post(n.data.url,n.data.param,"_blank")})},associationListBack:function(n){var t=n.up(".float-menu"),i=t.querySelector(".listItemActionDrop");n.up(".listItemActionDrop").hide();i.show();t.classList.add("active")},getAssociationLeads:function(n,t,i,r,u){var f=n.up(".float-menu.active"),e=null;u?(r=0,e=f.querySelector(".PresentationLeads")):(r=r||1,i=appendStringParams(i,Requests.getPair(Requests.keys.Page,r)),r==1&&(e=f.querySelector(".AssociateLeads")));e&&e.remove();ajaxRequest(n,t,"POST",i,function(t){if(t.status==ajaxRequest.StatusType.Success&&isObject(t.data)&&t.data.elem){var i=createHtmlElement("div",{innerHTML:t.data.elem}),e=null;u||(e=f.querySelector(".AssociateLeads"));r>1&&e?i.querySelectorAll("a:not(.cancelSelected)").forEach(function(n){e.appendChild(n.cloneNode(!0))}):f.appendChild(i.children[0].cloneNode(!0));f.querySelector(".listItemActionDrop").hide();f.classList.add("active");f.querySelector("[id='"+i.children[0].id+"']").show();!u&&r>1&&n.remove()}},{showLateLoading:!0})},associate:function(n,t,i,r,u,f){Search.Simplified.open(n,t,i,function(){Popup.registerCallbacks(new Popup.LayerOptions(null,null,null,function(){var n=Search.Simplified.getCurrentSelected();n&&n.length&&(f=appendStringParams(f,Requests.getPair(Requests.keys.SelectedIDs,n.join(","))),ajaxRequest(null,u,"POST",f,function(n){n.status===ajaxRequest.StatusType.Success&&Tabs.ajaxReset(r,!0)}))}),0)})},Presentation:n()}}(),n.Task=function(){return{selectedEventIDs:[],checkEvent:function(n){var r,u,t,i;n.checked&&(r=parseInt(n.value))>0?Associated.Task.selectedEventIDs.push(r):(u=Associated.Task.selectedEventIDs.indexOf(parseInt(n.value)||0))!=-1&&Associated.Task.selectedEventIDs.splice(u,1);t=n.up(".TaskList");i=!0;t.querySelectorAll(".ObjCheckBox").forEach(function(n){if(!n.checked){i=!1;return}});t.querySelector("#AssociatedTasksCheckAll").checked=i},checkVisibleEvent:function(n){var t=n.up(".TaskList");n.checked?t.querySelectorAll(".ObjCheckBox").forEach(function(n){if(!n.checked){var t=parseInt(n.value)||0;t>0&&(n.checked=!0,Associated.Task.selectedEventIDs.push(t))}}):t.querySelectorAll(".ObjCheckBox").forEach(function(n){var t,i;n.checked&&(n.checked=!1,t=parseInt(n.value),t>0&&(i=Associated.Task.selectedEventIDs.indexOf(t),i!=-1&&Associated.Task.selectedEventIDs.splice(i,1)))})},clearSelection:function(){var n=document.querySelector(".TaskList"),t;if(!n)return!1;n.querySelectorAll(".ObjCheckBox").forEach(function(n){n.checked=!1});t=n.querySelector("#AssociatedTasksCheckAll");t&&(t.checked=!1);Associated.Task.selectedEventIDs=[]},searchEvents:function(n,t,i){var r=n.up(".SectionContent"),u=appendStringParams($(r.querySelector(".PrivateData")).find("*").serializeAll(),Requests.get(Requests.keys.Page)+"="+i);ajaxRequest(n,t,"GET",u,function(n){if(n.status==ajaxRequest.StatusType.Success&&n.replaces){var t=document.getElementById("taskTab");t&&t.querySelector(".SectionContent").show()}})},editField:function(n){var t=n.next(".TaskFieldSwitcher"),i=$(t).find(":input").get(0);n.hide();t.show();i.focus();i._caller=n},editorFocus:function(n){var t=n&&n.value?HtmlUtility.sanitize(n.value.trim()):"";if(t==n.getAttribute("data-empty")){n.setAttribute("data-oldvalue","");n.value="";return}n.setAttribute("data-oldvalue",t);n.value=t},saveInPlace:function(n,t,i){var r=n.classList.contains(".TaskFieldEditor")?n:n.up(".TaskEditionContainer").querySelector(".TaskFieldEditor"),f,u;if(!r)return!1;if(f=n.classList.contains(".TaskFieldSwitcher")?n:n.up(".TaskEditionContainer").querySelector(".TaskFieldSwitcher"),r.value=r.value?HtmlUtility.sanitize(r.value.trim()):"",r.getAttribute("data-oldvalue")==r.value)return r._caller&&(f.hide(),r._caller.show()),!1;r.id?u=r.id:(u=guid(),r.id=u);i=appendStringParams(i,$(r).serializeAll());ajaxRequest(n,t,"POST",i,function(n){var t,i;n.status==ajaxRequest.StatusType.Success&&(t=document.getElementById(u),t&&(i=!1,t.value.trim().length==0&&t.hasAttribute("data-empty")&&(t.value=t.getAttribute("data-empty"),i=!0),t._caller&&(f.hide(),t._caller.textContent=t.nodeName=="SELECT"?t.options[t.selectedIndex].text:t.value,t._caller.classList.toggle("noText",i),t._caller.show())),EventHandler.removeListener(document.body,"click",Associated.Task.saveInPlace))})},changeTab:function(n,t,i){var r=n.up(".detailSection"),u=r.id||(r.id=guid());ajaxRequest(n,t,"GET",i,function(n){if(n.status==ajaxRequest.StatusType.Success&&n.replaces){var t=document.getElementById(u);t&&t.querySelector(".SectionContent").show()}})},showEventRatingPopup:function(n,t,i,r,u,f){var e=Requests.get(Requests.keys.EventID)+"="+t+"&"+Requests.get(Requests.keys.HistoricID)+"="+i+"&"+Requests.get(Requests.keys.ShowMsg)+"="+(r?1:0)+"&"+Requests.get(Requests.keys.Reload)+"="+(u?1:0)+"&"+Requests.get(Requests.keys.SearchUrl)+"="+encodeURI(f);ajaxRequest(null,n,"POST",e,null,{popupOptions:new Popup.LayerOptions(function(n){$(n).find(".TaskRateObs").focus()})})},initializePage:function(){var n=!1,i=document.getElementById("taskTab"),r=document.getElementById("AssociatedTasksCheckAll"),t;i&&(t=i.querySelectorAll(".ObjCheckBox.ObjectChecker"),t.length>0&&(n=!0,t.forEach(function(t){var i=parseInt(t.value);t.checked=Associated.Task.selectedEventIDs.indexOf(i)>-1?!0:!1;t.checked||(n=!1)})),r&&(r.checked=n))},editEventPopup:function(n,t,i,r){ajaxRequest(n,t,"GET",i,null,{popupOptions:new Popup.LayerOptions(function(n){var u=n.querySelector(".CalendarDate"),t,i,f,e,o,s;u&&(u.querySelector(".CalendarBtn").click(),u.show());t=n.querySelector(".chooseTime");i=t.querySelector(".NewEvent");i&&i.style.display!="none"?t.scrollTop=i.viewportOffset().top-t.viewportOffset().top-parseInt($(t).height()/2-35):(f=280,e=t.getAttribute("data-targettime"),e&&(o=t.querySelector("#hour_"+e),o&&(f=$(o).position().top)),t.scrollTop=f);n.querySelector("#EventSubject").focus();r&&n.querySelector(".timeItem.NewEvent")&&(s=n.querySelector("#dropdownsEndTime"),s&&s.show())})})},updateSummary:function(){document.querySelectorAll(".TaskSummary").forEach(function(n){var t=n.getAttribute("data-update-url"),i=$(n).find(".PrivateData:first *").serializeAll();ajaxRequest(n,t,"GET",i)})}}}(),n.Entity=function(){return{get:function(n,t,i){if(n&&t){var r=[],u=n.up(".detailSection");u&&r.push($(u).find("*").serializeAll());i&&r.push(Requests.get(Requests.keys.Page)+"="+i);r=r.filter(function(n){return n.length}).join("&");ajaxRequest(n,t,"GET",r)}},associateEntityPopup:function(n,t,i,r){var u=null;typeof r==typeof Function&&(u={popupOptions:new Popup.LayerOptions(null,null,null,function(){_changedAssociatedContact&&r()})});_changedAssociatedContact=!1;ajaxRequest(n,t,"GET",i,function(n){n.status===ajaxRequest.StatusType.Success&&n.popupContent&&focusFirstTextBox(Popup.current())},u)},saveRelatedEntity:function(n,t){n&&ajaxRequest(n,t,"POST",$(n.up(".AssociateRelatedEntityPopup")).find("*").serializeAll(),function(n){n.status===ajaxRequest.StatusType.Success&&(_changedAssociatedContact=!0,Popup.close(),isObject(n.data)&&n.data.forcePageReload===!0&&document.location.reload())})},deleteAssociated:function(n,t,i,r){r&&n&&t&&MessageBox.confirm(r,Translations.get(Translations.keys.Delete),function(){ajaxRequest(n,t,"POST",i,function(n){n.status===ajaxRequest.StatusType.Success&&isObject(n.data)&&n.data.forcePageReload===!0&&document.location.reload()},{hideLoading:!0})})},updateRelatedEntityRole:function(n,t,i){var r,u;n&&t&&(r=$(n).val(),r&&(i+="&"+Requests.get(Requests.keys.RoleID)+"="+r),u=n.getAttribute("oldroleid"),u&&(i+="&"+Requests.get(Requests.keys.OldRoleID)+"="+u),ajaxRequest(n,t,"POST",i,function(n){n.status===ajaxRequest.StatusType.Success&&isObject(n.data)&&n.data.forcePageReload===!0&&document.location.reload()}))},editInline:function(n){n.hide();var t=n.next(".roleSwitcher");t&&(t.classList.add("active"),t.querySelector("select").focus())},addFacebook:function(n,t,i,r,u){var f=document.getElementById(r);if(!f||!f.value||f.value==f.getAttribute("data-overlay"))return f.focus(),stopEventPropagation(u,!0),!1;i=appendStringParams(i,$(f).serializeAll());ajaxRequest(n,t,"GET",i)},onFacebookOpen:function(n,t){return function(){var i=document.getElementById(t);i&&n.classList.contains("active")&&i.focus()}}}}(),n.Media=function(){function n(n,t,i,r){var u=(i?document.getElementById(i):null)||(n?n.up(".RelatedMedia"):null);u&&isObject(t)&&typeof t.mediaUrl=="string"&&t.mediaMap&&Media.setupUploadFileArchive(u,t.mediaUrl,t.mediaMap,$(u).find(".PrivateData :input").serializeAll(),r)}function i(n){if(n){var i=!1,t=n.querySelector(".NoContentMessage");t?i=n.children.length<2:n.children.length<1&&(i=!0,t=createHtmlElement("div",{"class":"detailSectionNoContent NoContentMessage"}),t.textContent=Translations.get(Translations.keys.EmptyRecordsList),t.style.display="none",n.appendChild(t));i&&$(t).slideDown()}}function t(t,i,r,u,f){var e=t.up(".RelatedMedia"),o=e?e.id:"";AjaxQueue.click(t,i,$(e).find(".PrivateData :input").serializeAll(),function(i){i.status==ajaxRequest.StatusType.Success&&(n(t,i.data,o,f),typeof r=="function"&&r.call(u))})}return{loadMediaSection:t,sendAllMediaByEmail:function(n,i,r,u){var f=r&&r.classList.contains("RelatedMedia")?r:r.up(".RelatedMedia"),e=f.querySelector(".CatMediaList"),o=function(){var t=appendStringParams($(e).find(":input").serializeAll(),$(f).find(".PrivateData :input").serializeAll());ajaxRequest(n,i,"POST",t,function(n){n.status==ajaxRequest.StatusType.Success&&isObject(n.data)&&n.data.emailUrl&&n.data.emailParams&&Email.popupFromContext(null,n.data.emailUrl,n.data.emailParams)})};e.children.length==0?t(document.getElementById(n.getAttribute("data-ajaxsection-loader")),u,function(){setTimeout(o,50)},this):o()},loadNotesMedias:function(t,i,r){var u=t.up(".RelatedMedia"),f=u?u.id:"";r=appendStringParams(r,$(u).find(".PrivateData :input").serializeAll()||"");r=appendStringParams(r,$("#atLeadPC").serializeAll()||"");r=appendStringParams(r,$("#RealId").serializeAll()||"");ajaxRequest(t,i,"GET",r,function(i){i.status==ajaxRequest.StatusType.Success&&n(t,i.data,f)})},deleteFile:function(n,t,r,u,f,e){MessageBox.confirm(u,Translations.get(Translations.keys.Yes),function(){ajaxRequest(n,t,"POST",r,function(t){if(t.status==ajaxRequest.StatusType.Success){var r=n.up(".AttachList");n.up(".FileArchiveUploadItem").remove();f&&i(r);typeof e==typeof Function&&e()}})},"",Translations.get(Translations.keys.Cancel))},editFileName:function(n,t){$(n).hide();$("#input_attachment_name_"+t).show().focus()},changeFileName:function(n,t,i,r){var u=document.getElementById("attachment_name_"+i),s=u?u.textContent||"":"",f=HtmlUtility.sanitize(n.value)||"",o,e;f.length>0&&s!=f?(o=Requests.get(Requests.keys.Names)+"="+i+","+encodeURIComponent(f),ajaxRequest(n,t,"POST",o,function(t){if(t.status==ajaxRequest.StatusType.Success)if(isObject(t.data)&&t.data.text){n.value=t.data.text;n.hide();var u=document.getElementById("attachment_name_"+i),f=u?u.querySelector("span"):null;f&&(f.textContent=t.data.text,u.setAttribute("title",r.replace("#FILENAME#",t.data.text)),u.show())}else window.location.reload(!0)})):(e=document.getElementById("input_attachment_name_"+i),e&&e.hide(),u&&u.show())},openMoveToFolderPopupView:function(n,t,i){ajaxRequest(n,t,"POST",i)}}}(),n.Application=function(){return{loadInfoCard:function(n,t,i){if(n.getAttribute("data-loaded-app-info")=="1")return!1;ajaxRequest(n,t,"GET",i,function(t){t.status==ajaxRequest.StatusType.Success&&n.setAttribute("data-loaded-app-info","1")})}}}(),n.Newsletters=function(){return{MediaCollection:[],oHeaderEditor:null,preview:function(n,t,i,r){var u="",f,e,o;i&&(u="&buf=1");u+="&lpv=1";r&&(u+="&print=1");t?(Associated.Newsletters.oHeaderEditor!=null&&(Associated.Newsletters.oHeaderEditor.post(),u="{0}&{1}".format(u,Requests.getPair(Requests.keys.NewsletterHeader,document.getElementById("newsletter_header").value))),n&&(e=n.up("#sendNewsletterPopup"),e&&(u="{0}&{1}&{2}".format(u,$(e).find('[name="'+Requests.get(Requests.keys.NewsletterHeader)+'"]').serialize(),$(e).find('[name="'+Requests.get(Requests.keys.NewsletterSendDate)+'"]').serialize()))),o=HttpUtility.queryToObject("ID={0}{1}".format(t,u)),window.post("/egocore/newsletters/openpreview",o,"_blank")):(f=document.getElementById("oNewsletterForm"))?(f.action="/egocore/newsletters/openpreview?r="+(new Date).valueOf()+u,f.target="_blank",f.method="post",f.submit()):n&&n.hasAttribute("data-empty-msg")&&MessageBox.alert(n.getAttribute("data-empty-msg"))},renderNewsletterSendEditableContent:function(n,t,i){ajaxRequest(n,t,"GET",i,function(n){n.status==ajaxRequest.StatusType.Success&&Associated.Newsletters.showHeaderEditor()})},showHeaderEditor:function(){TinyMceEditor.loadByID("oHeaderEditor","newsletter_header")},showHelpPopup:function(n,t,i,r){r==1&&ajaxRequest(n,t,"GET",i)}}}(),n.Vehicle=function(){var n=function(n){var h=n.getAttribute("data-curr-level"),r=n.getAttribute("data-next-level"),u=n.getAttribute("data-levels"),c=n.getAttribute("data-action-type"),o=n.getAttribute("data-url"),f,t,i,s,e;if(!r||!u||!o)return!1;f=$.parseJSON(u);t=Requests.get(Requests.keys.ActionType)+"="+c+"&"+Requests.get(Requests.keys.Level)+"="+h+"&"+Requests.get(Requests.keys.NextLevel)+"="+r;n.getAttribute("data-dd-type")=="vehicle_type"&&(i=null,n.options&&typeof n.selectedIndex=="number"&&(i=n.options[n.selectedIndex]),i&&(s=i.getAttribute("data-master-id"),t+="&"+Requests.get(Requests.keys.TypeID)+"="+s));e=$(n).serialize()||"";e&&(t+="&"+e);forEachProp(f,function(n){if(n=parseInt(n),n>=r){var i=$("#"+f[n].Key).children("select");t+="&"+Requests.get(Requests.keys.Level)+"["+n+"]="+i.val()}});t+="&"+Requests.get(Requests.keys.Names)+"="+u;ajaxRequest(n,o,"POST",t)};return{getNextDropdown:function(t,i){i&&Search.Simplified.controlUpdated(t,i);n(t)}}}(),n.Survey=function(){var t=null,n=null;return{getDescription:function(n,t){var i=document.getElementById("sendSurveysPopup"),r;i&&(r=appendStringParams("",[$(i).find("#selectSurvey").serializeAll(),$(i).find("#surveyLanguage").serializeAll()]),ajaxRequest(n,t,"GET",r,function(n){if(n.status==ajaxRequest.StatusType.Success){var i,t;isObject(n.data)&&(Associated.Survey.updateBodyEditor(n.data.html||""),i=null,t=document.getElementById("surveySubject"),t&&n.data.subject&&(t.value=n.data.subject),i=document.getElementById("divSurveyFrom"),t=null,i&&(t=i.querySelector("#surveyFrom"),n.data.surveyFrom?(i.show(),t&&(t.innerText=n.data.surveyFrom)):(i.hide(),t&&(t.innerText=""))),i=document.getElementById("divSurveyLanguage"),t=null,i&&(n.data.showLanguage==!0?i.show():(i.hide(),t=i.querySelector("#surveyLanguage"),t&&(t.value=""))))}}))},updateBodyEditor:function(n){var t=document.getElementById("surveyBody");t&&(t.value=n||"",t.TinyEditor?t.TinyEditor.reloadFrame():TinyMceEditor.loadByID("SurveyBodyHolder","surveyBody",175,["surveylink","contactname"]))},openTimelineSurveyPopup:function(i,r,u,f,e){t=e?document.getElementById(e):i.up(".TimelineContext");f?(n=document.getElementById("TimelineSurveySummary"),n&&(u=appendStringParams(u,Requests.getPair(Requests.keys.RenderContainer,"1")))):n=null;ajaxRequest(i,r,"GET",u)},previewTimelineSurveyPopup:function(n,t,i){ajaxRequest(n,t,"GET",i)}}}(),n.Realestate=function(){return{getAddressInfo:function(n,t,i){var r=ensureElementID(n.up());ajaxRequest(n,t,"GET",i,function(t){var i;t.status==ajaxRequest.StatusType.Success&&isObject(t.data)&&!isBlank(t.data.address)&&(r?(i=document.getElementById(r),!i&&n&&(i=n.up(r))):n&&n.up()&&(i=n.up()),i&&(i.innerHTML=t.data.address))})},showMoreSeasons:function(n){n.up(".listItemPricingSection").querySelectorAll(".listItemPricingVacation").forEach(function(n){n.classList.contains("currentSeason")||$(n).is(":visible")||(n.style.display="block")});n.hide()},openSimplifiedSearch:function(n,t,i,r,u){Search.Simplified.open(n,t,i,null,"POST",{popupOptions:new Popup.LayerOptions(null,null,null,function(){ajaxRequest(null,r,"GET",u)})})},removeAssociated:function(n,t,i){ajaxRequest(n,t,"POST",i,function(n){n.status==ajaxRequest.StatusType.Success&&isObject(n.data)&&ajaxRequest(null,n.data.reloadAction,"GET",n.data.param)})}}}(),n.MarketAnalysis=function(){return{editCma:function(n,t){window.post(n,HttpUtility.queryToObject(t))},deleteCma:function(n,t,i){ajaxRequest(n,t,"POST",i,function(t){var i,r,u;t.status==ajaxRequest.StatusType.Success&&(i=n.up(".SectionContent"),n.up("tr").remove(),i.querySelectorAll(".CmaRow").length==0&&(r=i.querySelector(".NoContentElement"),u=i.querySelector(".CmaResults"),r&&u&&(u.remove(),r.show())))})}}}(),n.TheCollector=function(){return{createLeadInfocasa:function(n,t){if(n&&t){var i=new Popup.LayerOptions(null,null,null,function(){Popup.close(!0)});ajaxRequest(n,t,"POST",null,null,{popupOptions:i})}}}}(),n.Calls=function(){function n(n,t){var i=n.querySelector(".H_HasNewUsers");i&&(i.value=t)}return{setReadStatus:function(n,t,i){ajaxRequest(n,t,"POST",i,function(n){n.status==ajaxRequest.StatusType.Success&&Popup.close()})},openSavePopup:function(n,t,i,r){var u=null,f;r&&(f=document.getElementById("note_with_call"),f.setAttribute("data-shownedpopup","1"),u=new Popup.LayerOptions(null,null,null,function(){var n=document.getElementById("note_with_call"),t;n&&(t=document.getElementById("HistoricEditor").querySelector(".shortMessageSubmit"),Historic.save(t,n.getAttribute("data-savehistoric")))}));ajaxRequest(n,t,"GET",i,function(n){n.status==ajaxRequest.StatusType.Success||r},{popupOptions:u})},saveCall:function(n,t,i){var r=n.up(".PopupContext"),u;r&&(u=$(r).find(":input").serializeAll(),ajaxRequest(n,t,"POST",u,function(n){if(n.status==ajaxRequest.StatusType.Success&&(Popup.close(),!i&&n.data&&n.data.list)){var t=document.getElementsByClassName("NoteListType")[0];t.classList.remove("active");Historic.list(t,n.data.list,0,"1")}}))},saveHistoricCall:function(n,t,i){var r,u;i&&(r=[],$.each($("input[name='callUser']:checked"),function(){r.push($(this).val())}),u=r.join(),$("input[name=callUserList]").val(u));Popup.close()},setAutomaticCallCookie:function(n){var i=$(n),t;n.checked?(t=i.attr("data-cookiename"),Cookie.set(t,"1",365),console.log("Cookie set - "+t)):(t=i.attr("data-cookiename"),Cookie.remove(t),console.log("Cookie unset - "+t))},addNewUser:function(t){var r=t.up(".PopupContext"),u=r.querySelector(".TemplateCallContact"),i=u.cloneNode(!0);i.id=shortGuid();i.classList.remove("TemplateCallContact");i.show();u.up(".NewContacts").appendChild(i);n(r,1)},removeNewUser:function(t){var i=t.up(".PopupContext");t.up(".CallNewContacts").remove();i.querySelectorAll(".CallNewContacts:not(.TemplateCallContact)").length==0&&n(i,0)}}}(),n.Notification=function(){function t(){var t=Popup.current(),n=t?t.querySelector(".popupContent"):null;n&&n.scrollTo(0,n.scrollHeight)}var n=!1;return{openConversationPopup:function(i,r,u){n=!1;ajaxRequest(i,r,"POST",u,function(i){i.status===ajaxRequest.StatusType.Success&&(t(),i.data&&i.data.updatedReadStatus&&(n=!0))},{popupOptions:new Popup.LayerOptions(null,null,null,function(){n&&document.location.reload()},0)})},sendNotification:function(i,r){var u=i.up(".popupBox");u&&ajaxRequest(i,r,"POST",$(u).serializeAll("input,textarea"),function(r){var f=i.up(".shortMessageContent"),u;f&&(u=f.querySelector("textarea"),u&&(u.value=""));r.status===ajaxRequest.StatusType.Success&&(t(),n=!0)})},tabClick:function(n,t,i,r){ajaxRequest(n,t,"POST",i+"="+r);$(n).siblings().removeClass("active");$(n).addClass("active");var u=new URL(window.location);r!=="1"?u.searchParams.set(i,r):u.searchParams.delete(i);window.history.pushState(null,document.title,u.href)},contentTabClick:function(n,t,i,r){ajaxRequest(n,t,"POST",i);$(n).siblings().removeClass("active");$(n).addClass("active");var u=$("#notificationTabVal");u&&$("#notificationTabVal").val(r)},newMessage:function(n,t){ajaxRequest(n,t)}}}(),n.Commission=function(){function t(n){if(n){var t=n.querySelector("#context_perc");if(t&&t.value.replace(/,/g,".")>0)return parseFloat(t.value.replace(/,/g,"."))}return 100}function i(n,t){return n?t<100&&t>0?inputNumberValue(n)*t/100:inputNumberValue(n):0}function r(t,i,r,u){var f=r,s=t.querySelector("#span_commission_shared_application"),e,o;return s&&(f=parseFloat(s.getAttribute("data-basevalue"))),e=i.find(function(n){return n.classList.contains("ApplicationCommission")}),e&&(o=e.up(".CommissionLine").querySelector("select.CommissionUnit"),o&&o.value==n.Percentage?(f=f*(inputNumberValue(e)/100),f=Math.round(f*100)/100):(f=inputNumberValue(e),u<100&&u>0&&(f=f*u/100))),f}function f(t,i,r){r=r||0;i=i||0;var u=t.querySelector("select.CommissionUnit");return u&&u.value==n.Percentage?r*i/100:r}function u(n,t){if(n&&n.parentElement){var i=f(n.parentElement,t,n.value);return n.parentElement.querySelector(".CommValue").innerHTML=Money.format(i,!1),n.parentElement.querySelector("input[type=hidden].CalcValue").value=i,i}}var n=Object.freeze({Percentage:0,Currency:1});return{commissionPopup:function(n,t,i){ajaxRequest(n,t,"GET",i)},generateCommission:function(n,t,i,r){var f=n.up(".PopupContext"),h=$(f).find(":input").serializeAll(),e=f.querySelector("#context_perc"),c=f.querySelector("#commission_perc"),o=f.querySelector("#used_percentage"),u=e&&e.value?parseFloat(e.value.replace(/,/g,".")):null,s=agencyPercentageElem&&agencyPercentageElem.value?parseFloat(agencyPercentageElem.value.replace(/,/g,".")):null,l=o&&o.value?parseFloat(o.value.replace(/,/g,".")):null;if(c){if(isNaN(u)||u<=0||isNaN(s)||s<=0){MessageBox.alert(i);return}}else if(isNaN(u)||u<=0){MessageBox.alert(i);return}if(l+u>100){MessageBox.alert(r);return}ajaxRequest(n,t,"POST",h)},refreshCommissions:function(n,t,i){var u=n.up(".PopupContext").querySelector(".DistributionDisplayContext"),f,r;if(u&&(!n.hasAttribute("data-updatedfor")||n.getAttribute("data-updatedfor")!=n.value)&&$(u).is(":visible")){for(f=[],r=u.next(".CommissionLine.CommissionItem");r;)f.push(r),r=r.next(".CommissionLine.CommissionItem");i=appendStringParams(i,$(n).serialize());ajaxRequest(n,t,"GET",i,function(t){t.status==ajaxRequest.StatusType.Success&&t.insertAfter&&(n.setAttribute("data-updatedfor",n.value),f.forEach(function(n){n.remove()}))})}},onCurrencyDropdownChange:function(n){var t=n[n.selectedIndex].getAttribute("data-symbol");document.querySelectorAll(".CommissionDistributionCurrencySymbol").forEach(function(n){n.innerHTML=t})},liquidityCalculateCommissions:function(n){var r=n.up(".PopupContext").querySelector(".DistributionDisplayContext"),t,i;if(r){for(t=r.next(".CommissionLine.CommissionItem");t;){if(i=t.querySelector("input.CommissionValue"),i)break;t=t.next(".CommissionLine.CommissionItem")}i&&$(i).trigger("blur")}},showDistribution:function(n,t,i){var r=n.up(".PopupContext"),u=r.querySelector(".DistributionDisplayContext");Element.changeCheckState(u.querySelector("#distribute_commissions"),!0);ajaxRequest(n,t,"GET",i,function(t){if(t.status==ajaxRequest.StatusType.Success){n.up(".DistributionAccessorContext").hide();u.show();var i=r.querySelector("#context_perc");i&&Associated.Commission.liquidityCalculateCommissions(i)}})},calcCommission:function(u,f,e){var o=u.up(".MasterCommissionContext");if(o){var s=o.querySelectorAll("."+f),h=t(o),l=i(o.querySelector("#"+e),h),c=r(o,s,l,h);s.each(function(t){var r=t.up(".CommissionLine"),u=r.querySelector(".CommValue"),f=r.querySelector("input[type=hidden].CalcValue"),e=r.querySelector("input.commission_object"),o=r.querySelector("select.CommissionUnit"),i=inputNumberValue(e)||0;o.value!=n.Percentage||t.classList.contains("ApplicationCommission")?t.classList.contains("ApplicationCommission")&&(i=c):(i=c*(i/100),i=Math.round(i*100)/100);u.update(Money.format(i,!0));f.setValue(i)})}},calcCustomCommission:function(n,u,f){var e=n.up(".MasterCommissionContext");if(e){var o=e.querySelectorAll("."+u),s=t(e),h=i(e.querySelector("#"+f),s),c=r(e,o,h,s);o.forEach(function(n){var o=n.name.indexOf("parent")>-1,i=n.name.indexOf("child")>-1,t;if(o&&!i){t=n.getAttribute("data-uid");t&&Associated.Commission.calcCustomParentCommission(n,u,f,t);return}if(!i){var r=n.up(".CommissionLine"),s=r.querySelector(".CommValue"),h=r.querySelector("input[type=hidden].CalcValue"),e=c||0;s.update(Money.format(e,!0));h.setValue(e)}})}},calcCustomParentCommission:function(n,f,e,o){var s=n.up(".MasterCommissionContext"),c;if(s){var l=s.querySelectorAll("."+f),h=t(s),a=i(s.querySelector("#"+e),h),v=r(s,l,a,h);n.parentElement&&u(n,v);c=parseInt(n.getAttribute("data-lvl"))+1;s.querySelectorAll('input.ChildElem[type=text][data-parent="'+o+'"][data-lvl="'+c+'"]').forEach(function(n){Associated.Commission.calcCustomChildCommission(n,o)})}},calcCustomChildCommission:function(n,t){var i=n.up(".MasterCommissionContext"),r,f,e;i&&(r=i.querySelector("input[type=hidden].calc_value_parent_"+t).value,n.getAttribute("data-lvl")==2&&(f=i.querySelector('input.ChildElem.ParentElem[type=text][data-parent="'+t+'"]'),f&&(r=f.parentElement.querySelector("input[type=hidden].calc_value_child_"+t).value)),r&&(e=u(n,r),n.getAttribute("data-lvl")==1&&i.querySelectorAll('input[data-parent="'+t+'"][data-lvl="2"]').forEach(function(n){u(n,e)})))},changeCalcInputs:function(n,t,i){var r,u;n&&(r=n.up(".CommissionLine"),r)&&(Element.setValue(r.querySelector(".ApplicationCommission"),n.value),u=r.querySelector(".CommissionUnit"),u&&(u.value=n.options[n.selectedIndex].getAttribute("data-unit-key"),Associated.Commission.calcCommission(n,t,i)))},openEditPopup:function(n,t,i,r){var u=n.id;u||(u=n.id="ctx_"+shortGuid());ajaxRequest(n,t,"GET",i,null,{popupOptions:new Popup.LayerOptions(null,null,null,function(){var n=document.getElementById(u);n?typeof r==typeof Function&&r(n):document.location.reload()})})},addNewFromTemplate:function(n,t){var i,r,u;n&&(i=n.querySelector(".TemplateItem"),i)&&(r=i.innerHTML.replace(new RegExp(t,"ig"),"m_"+guid()),u=htmlStringToElement(r),n.appendChild(u),SearchBar.showTemplated(n))},saveEditionPopup:function(n,t,i){var r=$(i).find("*").serializeAll();ajaxRequest(n,t,"POST",r,function(n){n.status===ajaxRequest.StatusType.Success&&Popup.close()})}}}(),n.Realestate.Mortgage=function(){var n=function(n){n.getAttribute("maxlength")||n.setAttribute("maxlength",2)};return{popup:function(n,t,i){ajaxRequest(n,t,"GET",i,function(n){if(n.status==1&&n.popupContent){var i=Popup.current(),t;i&&(t=i.querySelector("input[type=text]"),t&&t.focus())}})},simulate:function(t,i,r){var u=t.up(".PopupContext"),f;if(!inputNumberValue(u.querySelector("#realestate_loan_amount"))>0||!inputNumberValue(u.querySelector("#realestate_time"))>0||!inputNumberValue(u.querySelector("#realestate_interest_rate"))>0){MessageBox.alert(r);return}f=$(u).find("*").serializeAll();ajaxRequest(t,i,"POST",f,function(t){var r,i;t.status==ajaxRequest.StatusType.Success&&isObject(t.data)&&t.data.newYearsTime>0&&(r=u.querySelector("#realestate_time"),r.value=t.data.newYearsTime.toString(),n(r),i=r.getAttribute("onblur")||"",i&&i.indexOf("Realestate.Mortgage.limitYears")!=-1||(i=i.trim(),i+=(i.endsWith(";")?"":";")+"Realestate.Mortgage.limitYears(this);",r.setAttribute("onblur",i)))})},toggleLackMonths:function(n){n.selectedIndex==0?n.up(".inputInfoContent").querySelector("#LackMonths").show():n.up(".inputInfoContent").querySelector("#LackMonths").hide()},toggleResults:function(n,t){var i=document.getElementById("monthSim_"+t);i&&n.busy!=!0&&(n.busy=!0,$(i).is(":visible")?($(i).stop().slideUp({duration:300,complete:function(){n.busy=!1}}),n.classList.remove("active")):($(i).stop().slideDown({duration:300,complete:function(){n.busy=!1}}).css("display","table-row-group"),n.classList.add("active")))},printSimulation:function(n){var i=n.up(".PopupContext"),t=i.querySelector(".popupContent").cloneNode(!0);t.querySelectorAll(".creditHiddenLine").forEach(function(n){n.style.display="table-row-group"});t.querySelectorAll(".GroupHand").forEach(function(n){n.remove()});EgoPrinter.printHtml(t,{inheritCSS:!0})},limitYears:function(t){n(t);t.value&&parseInt(t.value)>99&&(t.value="99")}}}(),n}(),HolidayHomes=function(){var n={searchBySelectorDate:function(n,t,i){var r=appendStringParams($(".list").find("*").serializeAll(),i);ajaxRequest(n,t,"POST",r)},manageModelClick:function(n,t,i){var r=$(n),u,f;if(r&&!r.hasClass("active")){if(u=$(".blueOutlineBtn.singleSelectionBtn.active"),u&&u.length>0)for(f=0;f<u.length;f++)$(u[f]).removeClass("active"),$(u[f]).html('<i class="icon-check"><\/i> '+t);r.addClass("active");r.html('<i class="icon-check"><\/i> '+i)}else r.removeClass("active"),r.html('<i class="icon-check"><\/i> '+t)},removeSeasonTemplate:function(n,t,i){var r=$("#seasonTemplate_"+i);r&&ajaxRequest(n,t,"POST",Requests.get(Requests.keys.ObjectID)+"="+i,function(n){n.status==1&&r[0].remove()})},addContainer:function(){var t=$("#seasonPricesContainer"),n;if(t&&t.length>0&&(t=t[0],n=$("#seasonPricesTemplate"),n&&n.length>0&&(n=n.find(".vacationPricingTable"),n))){var r="x"+Math.floor(Math.random(4294967295)*4294967295).toString(16)+(new Date).getTime().toString(16),u=n.html().replace(/\{#safeid\}/ig,r),i=document.createElement("div");i.className="vacationPricingTable";i.innerHTML=u;t.append(i)}},removeContainer:function(n){n&&n.up(".vacationPricingTable").remove()},saveSeasonTemplateTranslate:function(n){if(n){var t=n.getAttribute("data-safe-id"),r=n.getAttribute("data-default-lang"),i=$("#contentwcPriceDescription"+t+"_"+r);i&&($("#realestate_season_priceName_"+t)[0].value=i[0].value)}},seasonTemplateTranslateUpdate:function(n){if(n){var t=n.getAttribute("data-safe-id"),r=n.getAttribute("data-default-lang"),i=$("#contentwcPriceDescription"+t+"_"+r);i&&(i[0].value=$("#realestate_season_priceName_"+t)[0].value)}},saveTemplateData:function(n,t){n&&ajaxRequest(n,t,"POST",$(".popupContent").find("*").serializeAll(),function(n){n.status==1&&Popup.close()})}};return n.OccupationMap=function(){var n=null;return{click:function(t){var r=t.up("td"),u,f,i;return r?(u=r.up(".infoOportunidadeTemporadaCalendario"),u||(u=$(".infoOportunidadeTemporadaCalendario")[0]),f=parseInt(r.getAttribute("data-occupation")),f&&f>0)?(i=[],i.push(Requests.get(Requests.keys.ObjectID)+"="+r.getAttribute("data-realestate")),i.push(Requests.get(Requests.keys.Date)+"="+r.getAttribute("data-date")),ajaxRequest(t,u.getAttribute("data-day-occupation"),"POST",i.join("&")),!0):n!=null?(i=[],i.push(Requests.get(Requests.keys.ObjectID)+"="+r.getAttribute("data-realestate")),i.push(Requests.get(Requests.keys.DateEnd)+"="+r.getAttribute("data-date")),i.push(Requests.get(Requests.keys.DateStart)+"="+n),ajaxRequest(t,u.getAttribute("data-create-occupation"),"POST",i.join("&")),n=null,!0):(n=r.getAttribute("data-date"),!0):!1},monthlyTClick:function(t){var i,r,u;if(n!=null){if(i=$(".vacationCalBtn"),i&&i.length>0)for(r=0;r<i.length;r++)u=$(i[r]),u&&u.hasClass("selected")&&u.removeClass("selected")}else t.addClassName("selected");return HolidayHomes.OccupationMap.click(t),!0}}}(),n.CreateOccupation=function(){var n=function(n){return $(n.up(".CreateOccupationPopup")).find("input, select, textarea").serialize()};return{open:function(n,t,i,r){Popup.close();var u=[];u.push(Requests.get(Requests.keys.ObjectID)+"="+i);u.push(Requests.get(Requests.keys.DateStart)+"="+r);ajaxRequest(n,t,"POST",u.join("&"))},edit:function(n,t,i){Popup.close();ajaxRequest(n,t,"POST",i)},"delete":function(n,t,i){MessageBox.confirm(n.getAttribute("data-delete-message"),Translations.get(Translations.keys.Yes),function(){Popup.close();ajaxRequest(n,t,"POST",Requests.get(Requests.keys.OccupationID)+"="+i)},null,Translations.get(Translations.keys.No))},changeStatus:function(t,i){MessageBox.confirm(t.getAttribute("data-warning-message"),Translations.get(Translations.keys.Yes),function(){var r=n(t);Popup.close();ajaxRequest(t,i,"POST",r)},null,Translations.get(Translations.keys.No))},toggleCleaning:function(n){var t=n.up(".inputInfoContent").querySelector(".CleaningDate");return t?(t.style.display=n.checked?"inline-block":"none",!0):!1},save:function(t,i){ajaxRequest(t,i,"POST",n(t),function(n){n.status==1&&Popup.close()})}}}(),n}();Realestate.Rating=function(){return{editRealestateRating:function(n,t,i){ajaxRequest(n,t,"GET",i)},saveRealestateRating:function(n,t,i,r){var o=$(".popupContent").find("*").serializeAll(),u=[],f,e;u.push(Requests.get(Requests.keys.RealestateID)+"="+i);u.push(Requests.get(Requests.keys.ObjectID)+"="+r);o&&u.push(o);f="";$("#RatingsClassLvl")!=null&&$("#RatingsClassLvl")!=undefined&&$("#RatingsClassLvl input").each(function(){this.checked&&(f=this.getAttribute("id"))});f&&f.length>0&&u.push(Requests.get(Requests.keys.AppraisalClassLevel)+"="+f);e=[];$("#RatingsDeValues")!=null&&$("#RatingsDeValues")!=undefined&&$("#RatingsDeValues input").each(function(){this.checked&&e.push(this.getAttribute("id"))});u.push(Requests.get(Requests.keys.AppraisalFeatureDeValues)+"="+e.join(","));ajaxRequest(n,t,"POST",u.join("&"),function(n){n&&n.status==1&&Popup.close()})}}}();CurrentAccount=function(){return function(){return{saveRecord:function(n,t,i,r){var u=$(n.up("#popupEditCurrentAccount")).find("*").serialize();u=u+"&"+Requests.get(Requests.keys.BusinessObject)+"="+i+"&"+Requests.get(Requests.keys.ObjectID)+"="+r;ajaxRequest(n,t,"GET",u,function(n){n&&n.status==1&&Popup.close()})},deleteRecord:function(n,t,i,r,u,f){MessageBox.confirm(f,Translations.get(Translations.keys.Yes),function(){ajaxRequest(n,t,"GET",Requests.get(Requests.keys.SelectedID)+"="+r+"&"+Requests.get(Requests.keys.ObjectID)+"="+u+"&"+Requests.get(Requests.keys.BusinessObject)+"="+i)},"",Translations.get(Translations.keys.Cancel))},byAdvanced:function(n){var t=n.up(".Intervenients");t&&($(t).hide(),$(t.nextElementSibling).show())},print:function(n,t,i){ajaxRequest(n,t,"POST",i,function(n){if(n.status==1&&isObject(n.data)&&n.data.html){var t=window.open();t.document.write(n.data.html);t.document.close()}})}}}()}();var EgoChart=function(){function n(n){var t={display:n.Display,position:n.Position,gridLines:{color:n.GridLinesColor,display:n.GridLinesDisplay,drawOnChartArea:n.GridLinesDrawOnChartArea},scaleLabel:{display:n.ScaleLabelDisplay},ticks:{callback:function(n){return n.toLocaleString()}}};return n.TicksDisplay!=null&&n.TicksDisplay!=undefined&&(t.ticks.display=n.TicksDisplay),n.TicksBeginAtZero!=null&&n.TicksBeginAtZero!=undefined&&(t.ticks.beginAtZero=n.TicksBeginAtZero),n.TicksMin!=null&&n.TicksMin!=undefined&&(t.ticks.min=n.TicksMin),n.TicksMax!=null&&n.TicksMax!=undefined&&(t.ticks.max=n.TicksMax),n.TicksStepSize!=null&&n.TicksStepSize!=undefined&&(t.ticks.stepSize=n.TicksStepSize),n.TicksMaxLimit!=null&&n.TicksMaxLimit!=undefined&&(t.ticks.maxTicksLimit=n.TicksMaxLimit),n.TicksPadding!=null&&n.TicksPadding!=undefined&&(t.ticks.padding=n.TicksPadding),n.TicksMaxRotation!=null&&n.TicksMaxRotation!=undefined&&(t.ticks.maxRotation=n.TicksMaxRotation),n.TicksMinRotation!=null&&n.TicksMinRotation!=undefined&&(t.ticks.minRotation=n.TicksMinRotation),n.ScaleLabelString!=null&&n.ScaleLabelString!=undefined&&(t.scaleLabel.labelString=n.ScaleLabelString),n.GridDrawBorder!=null&&n.GridDrawBorder!=undefined&&(t.gridLines.drawBorder=n.GridDrawBorder),n.Offset!=null&&n.Offset!=undefined&&(t.offset=n.Offset),n.GridZeroLineColor!=null&&n.GridZeroLineColor!=undefined&&n.GridZeroLineColor!=""&&(t.gridLines.zeroLineColor=n.GridZeroLineColor),n.Stacked!=null&&n.Stacked!=undefined&&(t.stacked=n.Stacked),n.ID!=null&&n.ID!=undefined&&n.ID!=""&&(t.id=n.ID),t}function o(t){return t.map(function(t){var i=n(t);return t.TicksBeginAtZero!=null&&t.TicksBeginAtZero!=undefined&&(i.ticks.beginAtZero=t.TicksBeginAtZero),t.TicksMin!=null&&t.TicksMin!=undefined&&(i.ticks.min=t.TicksMin),t.TicksMax!=null&&t.TicksMax!=undefined&&(i.ticks.max=t.TicksMax),t.TicksStepSize!=null&&t.TicksStepSize!=undefined&&(i.ticks.stepSize=t.TicksStepSize),t.TicksPadding!=null&&t.TicksPadding!=undefined&&(i.ticks.padding=t.TicksPadding),t.TicksMaxRotation!=null&&t.TicksMaxRotation!=undefined&&(i.ticks.maxRotation=t.TicksMaxRotation),t.TicksMinRotation!=null&&t.TicksMinRotation!=undefined&&(i.ticks.minRotation=t.TicksMinRotation),t.ScaleLabelString!=null&&t.ScaleLabelString!=undefined&&(i.scaleLabel.labelString=t.ScaleLabelString),t.GridDrawBorder!=null&&t.GridDrawBorder!=undefined&&(i.gridLines.drawBorder=t.GridDrawBorder),t.TicksCallbackCultureFormat&&t.TicksCallbackCultureFormat!=""&&(i.ticks.callback=function(n){var i=n.toLocaleString();return t.TicksCallbackCultureFormat&&t.TicksCallbackCultureFormat!=""&&(i=n.toLocaleString(t.TicksCallbackCultureFormat)),t.TicksCallbackCurrency&&t.TicksCallbackCurrency!=""&&(i+=t.TicksCallbackCurrency),i}),i})}function f(n,t){var i=t.OptionsLayoutPaddingTop||t.OptionsLayoutPaddingTop===0?!0:!1,r=t.OptionsLayoutPaddingRight||t.OptionsLayoutPaddingRight===0?!0:!1,u=t.OptionsLayoutPaddingBottom||t.OptionsLayoutPaddingBottom===0?!0:!1,f=t.OptionsLayoutPaddingLeft||t.OptionsLayoutPaddingLeft===0?!0:!1;return(i||r||u||f)&&(n.options.layout?n.options.layout.padding||(n.options.layout.padding={}):n.options.layout={padding:{}},i&&(n.options.layout.padding.top=t.OptionsLayoutPaddingTop),r&&(n.options.layout.padding.right=t.OptionsLayoutPaddingRight),u&&(n.options.layout.padding.bottom=t.OptionsLayoutPaddingBottom),f&&(n.options.layout.padding.left=t.OptionsLayoutPaddingLeft)),n}function h(n,t){return!n||!t.OptionsAnnotation?n:ensureObjectStructure(n,"options.annotation.annotations",[t.OptionsAnnotation])}function i(n,t,i){i.OptionsLegendDisplay&&e.applyCustomServerLegends(t,i);t=s.setup(t,i);t.options._ChartDto=i;t=ensureObjectStructure(t,"options.hover",{});t.options.hover.onHover||(t.options.hover.onHover=function(n){var t=this.getElementAtEvent(n);n.target.style.cursor=l(t,i)?"pointer":"default"});var r=new Chart(n,t);return i.OptionsLegendDisplay||e.updateLegendExternalElement(r),r}function c(n){return!n||!n._chart||!n._chart.config||!n._chart.config.options?null:n._chart.config.options._ChartDto}function l(n){var t;return Array.isArray(n)&&(n=n.length?n[0]:null),n&&(t=c(n)),n&&t&&t.OptionsClickEventHandlerArgs&&Array.isArray(t.OptionsClickEventHandlerArgs.requestParameters)&&t.OptionsClickEventHandlerArgs.requestParameters[n._index]}function a(u,e){var s=e.OptionsScalesXAxes.map(n),h=e.OptionsScalesYAxes.map(n),o={type:"line",data:{labels:e.DataLabels,datasets:e.DataDatasets},options:{maintainAspectRatio:e.OptionsMaintainAspectRatio,title:{display:e.OptionsTitleDisplay,text:e.Title},scales:{xAxes:s,yAxes:h},legend:{display:e.OptionsLegendDisplay,position:e.OptionsLegendPosition,align:e.OptionsLegendAlign,labels:{fontColor:e.OptionsLegendLabelsFontColor,usePointStyle:e.OptionsLegendLabelsUsePointStyle,padding:e.OptionsLegendLabelsPadding}},tooltips:{enabled:e.OptionsTooltipsEnabled,mode:e.OptionsTooltipsMode,intersect:e.OptionsTooltipsIntersect,custom:function(n){n&&(n.displayColors=e.OptionsTooltipsCustomDisplayColors)},callbacks:{label:function(n,i){return t.formatLabelForXYAxisCharts(n,i,e)}}}}};return e.OptionsTooltipsDisplayTitle||(o.options.tooltips.callbacks.title=function(){return}),o=f(o,e),o=r.Datalabels.setup(o,e,function(n){return n.dataset.pointBackgroundColor}),i(u,o,e)}function v(u,e){var s=e.OptionsScalesXAxes.map(n),c=e.OptionsScalesYAxes.map(n),o;return e&&e.HighlightIndex&&parseInt(e.HighlightIndex)>0&&(e.DataDatasets[0].backgroundColor[e.HighlightIndex]="rgba(0, 190, 201, .8)",e.DataDatasets[0].hoverBackgroundColor[e.HighlightIndex]="rgba(0, 190, 201, .8)"),o={type:e.IsHorizontalBar?"horizontalBar":"bar",data:{labels:e.DataLabels,datasets:e.DataDatasets},options:{maintainAspectRatio:e.OptionsMaintainAspectRatio,responsive:e.OptionsResponsive,title:{display:e.OptionsTitleDisplay,text:e.Title},scaleShowValues:e.OptionsScaleShowValues,scales:{xAxes:s,yAxes:c},legend:{display:e.OptionsLegendDisplay,position:e.OptionsLegendPosition,align:e.OptionsLegendAlign,padding:20,labels:{fontColor:e.OptionsLegendLabelsFontColor,usePointStyle:e.OptionsLegendLabelsUsePointStyle,padding:e.OptionsLegendLabelsPadding}},tooltips:{enabled:e.OptionsTooltipsEnabled,mode:e.OptionsTooltipsMode,intersect:e.OptionsTooltipsIntersect,filter:function(n,t){var r=parseInt(t.datasets[0].data[n.index]),i=0;return t.datasets.length>1&&(i=parseInt(t.datasets[1].data[n.index])),r==0&&i==0?!1:!0},custom:function(n){n&&(n.displayColors=e.OptionsTooltipsCustomDisplayColors)},callbacks:{label:function(n,i){return t.formatLabelForXYAxisCharts(n,i,e)}}}}},o=f(o,e),o=r.Datalabels.setup(o,e,function(n){return n.dataset.backgroundColor}),o=h(o,e),i(u,o,e)}function y(n,u){var f={type:"doughnut",data:{labels:u.DataLabels,datasets:u.DataDatasets},options:{responsive:u.OptionsResponsive,animation:{animateScale:u.OptionsAminationAnimateScale},cutoutPercentage:u.OptionsCutoutPercentage,legend:{display:u.OptionsLegendDisplay,position:u.OptionsLegendPosition,align:u.OptionsLegendAlign,padding:20,labels:{fontColor:u.OptionsLegendLabelsFontColor,usePointStyle:u.OptionsLegendLabelsUsePointStyle,padding:u.OptionsLegendLabelsPadding}},tooltips:{enabled:u.OptionsTooltipsEnabled,mode:u.OptionsTooltipsMode,intersect:u.OptionsTooltipsIntersect,filter:function(n,t){var i=parseInt(t.datasets[0].data[n.index]);return i==0?!1:!0},callbacks:{label:function(n,i){return t.formatLabelForRoundCharts(n,i,u)}}}}};return f=r.Datalabels.setup(f,u,function(n){return n.dataset.backgroundColor[n.dataIndex]}),f.options.cutoutPercentage&&u.OptionsElementsCenterChart&&(f.options.elements||(f.options.elements={}),f.options.elements.centerChart=!0,Chart.pluginService.register({beforeDraw:function(n){var t,i,r;n.config.options.elements.centerChart&&(t=document.getElementById("CenterChart_"+n.ctx.canvas.id),t)&&(i=(n.chartArea.left+n.chartArea.right)/2,r=(n.chartArea.top+n.chartArea.bottom)/2,t.style.left=i+"px",t.style.top=r+"px")}})),i(n,f,u)}function p(n,i){var r=o(i.OptionsScalesXAxes),u=o(i.OptionsScalesYAxes);return new Chart(n,{type:"scatter",data:{datasets:[{label:i.DataDatasets[0].LabelToolTip,radius:6,pointHoverRadius:6,backgroundColor:i.DataDatasets[0].backgroundColor,data:i.DataDatasets[0].DataValues}]},options:{maintainAspectRatio:!1,responsive:!0,legend:{display:i.OptionsLegendDisplay,position:i.OptionsLegendPosition,labels:{fontColor:i.OptionsLegendLabelsFontColor,usePointStyle:i.OptionsLegendLabelsUsePointStyle,padding:i.OptionsLegendLabelsPadding}},title:{display:!0,text:i.Title},scales:{xAxes:r,yAxes:u},tooltips:{enabled:i.OptionsTooltipsEnabled,custom:function(n){n&&(n.displayColors=!1)},callbacks:{label:function(n,r){return t.formatLabelForXYAxisCharts(n,r,i)},afterLabel:function(n){if(i.OptionsTooltipsCallbackAfterLabel&&i.OptionsTooltipsCallbackAfterLabel.length>0)return i.OptionsTooltipsCallbackAfterLabel[n.index]}}}}})}function w(n,u){var f={type:"pie",data:{labels:u.DataLabels,datasets:u.DataDatasets},options:{responsive:u.OptionsResponsive,animation:{animateScale:u.OptionsAminationAnimateScale},cutoutPercentage:u.OptionsCutoutPercentage,legend:{display:u.OptionsLegendDisplay,position:u.OptionsLegendPosition,align:u.OptionsLegendAlign,padding:20,labels:{fontColor:u.OptionsLegendLabelsFontColor,usePointStyle:u.OptionsLegendLabelsUsePointStyle,padding:u.OptionsLegendLabelsPadding}},tooltips:{enabled:u.OptionsTooltipsEnabled,mode:u.OptionsTooltipsMode,intersect:u.OptionsTooltipsIntersect,filter:function(n,t){var i=parseInt(t.datasets[0].data[n.index]);return i==0?!1:!0},callbacks:{label:function(n,i){return t.formatLabelForRoundCharts(n,i,u)}}}}};return f=r.Datalabels.setup(f,u,function(n){return n.dataset.backgroundColor[n.dataIndex]}),i(n,f,u)}function b(r,u){var o=u.OptionsScalesXAxes.map(n),s=u.OptionsScalesYAxes.map(n),e={type:"bubble",data:{labels:u.DataLabels,datasets:u.DataDatasets},options:{maintainAspectRatio:u.OptionsMaintainAspectRatio,title:{display:u.OptionsTitleDisplay,text:u.Title},scales:{xAxes:o,yAxes:s},legend:{display:u.OptionsLegendDisplay,position:u.OptionsLegendPosition,align:u.OptionsLegendAlign,labels:{fontColor:u.OptionsLegendLabelsFontColor,usePointStyle:u.OptionsLegendLabelsUsePointStyle,padding:u.OptionsLegendLabelsPadding}},tooltips:{enabled:u.OptionsTooltipsEnabled,mode:u.OptionsTooltipsMode,intersect:u.OptionsTooltipsIntersect,callbacks:{label:function(n,i){return t.formatLabelForXYAxisCharts(n,i,u)}}}}};return e=f(e,u),i(r,e,u)}var u=Object.freeze({Undefined:0,Currency:1,Percentage:2,FromCustomDatalabels:3}),t=function(){function t(n,t,i){var u,f,r;return t=t?" "+t.toLocaleString()+": ":" ",n&&(n.OptionsTooltipsCulture&&(u=typeof n.OptionsTooltipsNumberMinFractions=="number",f=typeof n.OptionsTooltipsNumberMaxFractions=="number",u||f?(r={},u&&(r.minimumFractionDigits=n.OptionsTooltipsNumberMinFractions),f&&(r.maximumFractionDigits=n.OptionsTooltipsNumberMaxFractions),i=parseFloat(i).toLocaleString(n.OptionsTooltipsCulture,r)):i=parseFloat(i).toLocaleString(n.OptionsTooltipsCulture)),n.OptionsTooltipsUseCurrencySymbol&&(i=Money.format(parseFloat(i)))),i=i.replace(/\n/igm,"<br>"),t+i}function n(n,i,r,u){return r&&r.OptionsTooltipsCallbackLabel&&r.OptionsTooltipsCallbackLabel.length>0&&r.OptionsTooltipsCallbackLabel[n.index]?r.OptionsTooltipsCallbackLabel[n.index]:t(r,u(),i.datasets[n.datasetIndex].data[n.index])}return{formatLabelForXYAxisCharts:function(t,i,r){return n(t,i,r,function(){return i.datasets[t.datasetIndex].label})},formatLabelForRoundCharts:function(t,i,r){return n(t,i,r,function(){return i.labels[t.index]})}}}(),e=function(){return{applyCustomServerLegends:function(n,t){t.OptionsLegendLabels&&t.OptionsLegendLabels.length&&(n=ensureObjectStructure(n,"options.legend.labels",{}),n.options.legend.labels.filter=function(n){return n&&"index"in n&&(n.text=t.OptionsLegendLabels[n.index]),!0})},updateLegendExternalElement:function(n){var t=document.getElementById("legend_"+n.ctx.canvas.id);t&&(t.innerHTML=n.generateLegend())}}}(),r=function(){function n(n,t){var i=n.OptionsPluginsDatalabels,f=n.PluginsCustomDatalabels,r={display:i.Display,align:i.Align,anchor:i.Anchor,color:function(n){return i.Color?i.Color:i.UseDatasetColor&&typeof t=="function"?t(n):"#666"},formatter:function(n,t){return i.SymbolType==u.Currency?Money.format(parseInt(t.dataset.data[t.dataIndex])):i.SymbolType==u.Percentage?t.dataset.data[t.dataIndex].toLocaleString()+" %":i.SymbolType==u.FromCustomDatalabels&&f!=null&&f!=undefined&&f.length>0&&t.dataIndex<f.length?f[t.dataIndex]:t.dataset.data[t.dataIndex].toLocaleString()}};return(i.Offset||i.Offset===0)&&(r.offset=i.Offset),i.TextAlign&&(r.textAlign=i.TextAlign),i.FontSize&&(r.font||(r.font={}),r.font.size=i.FontSize),i.FontWeight&&(r.font||(r.font={}),r.font.weight=i.FontWeight),r}return{Datalabels:{setup:function(t,i,r){return isObject(i.OptionsPluginsDatalabels)?(t=ensureObjectStructure(t,"options.plugins",{}),t.options.plugins.datalabels=n(i,r),t):ensureObjectStructure(t,"options.plugins.datalabels.display",!1)}}}}(),s=function(){function n(n,t,i){var f,u,r,e,o;if(!t||t.length==0||!isObject(i)||!i.url||!i.requestParameters){console.warn("cannot _searchFromChart with invalid activeElements or args");console.log("activeElements:");console.log(t);console.log("args:");console.log(i);return}if(f=t.find(function(n){return n&&"_index"in n&&"_datasetIndex"in n}),f&&(u=f._index,r=f._datasetIndex),typeof u!="number"||u<0||typeof r!="number"||r<0){console.warn("cannot _searchFromChart with invalid index and datasetIndex");console.log("index:"+u);console.log("datasetIndex:"+r);return}if(e=Array.isArray(i.requestParameters[0])&&r<i.requestParameters.length?i.requestParameters[r]:i.requestParameters,Array.isArray(e)&&e.length&&(o=e[u]||""),!o){console.warn("cannot _searchFromChart without request parameters");console.log("requestParams:"+o);return}window.post(i.url,HttpUtility.queryToObject(o),"_blank")}return{setup:function(t,i){return i.OptionsRemoveEvents?t.options.events=[]:i.OptionsClickEventHandlerArgs&&(t.options.onClick=function(t){var r=this.getElementAtEvent(t);r&&r.length&&n(t,r,i.OptionsClickEventHandlerArgs)}),t}}}();return{register:function(n,t){var i=document.getElementById(n);t.Type=="Line"?a(i,t):t.Type=="Bar"?v(i,t):t.Type=="Doughnut"?y(i,t):t.Type=="Scatter"?p(i,t):t.Type=="Pie"?w(i,t):t.Type=="Bubble"&&b(i,t)}}}(),CasaSapoCampaigns=function(){return{loadCustomObjects:function(n){var t=document.getElementById("hVisibleObjIDs"),i,r;!t||t.value.length<=0||(i=document.getElementById("IsMlsSearch"),r=i?$(i).serializeAll():"",ajaxRequest(null,n,"POST",Requests.get(Requests.keys.ObjectIDs)+"="+encodeURIComponent(t.value)+(r?"&"+r:""),null,{hideLoading:!0}))},getCampaigns:function(n,t,i){var r=appendStringParams($("#PrivateData *").serializeAll(),Requests.get(Requests.keys.Page)+"="+i);ajaxRequest(n,t,"POST",r)},reloadPage:function(){var n=document.getElementById("RealestateListResults"),t;n&&(t=n.getAttribute("data-reload-url"),Search.reload(n,t),Popup.close());n=document.getElementById("CampaignListResults");n&&(t=n.getAttribute("data-reload-url"),Search.reload(n,t),Popup.close());Search.GenericList.deselectAll(!0,!1)},cancelCampaign:function(n,t,i,r){var u=function(){var u=Requests.get(Requests.keys.ObjectID)+"="+i;ajaxRequest(n,t,"GET",u,function(){googleAnalyticsEvent(r);CasaSapoCampaigns.reloadPage()})};MessageBox.confirm(Translations.get(Translations.keys.CasaSapoConfirmCancelCampaign),Translations.get(Translations.keys.Yes),u,"",Translations.get(Translations.keys.No))},getPaymentUrl:function(n,t,i){var r=Requests.get(Requests.keys.ObjectID)+"="+i;ajaxRequest(n,t,"GET",r,function(n){n.status==1&&isObject(n.data)&&n.data.url&&window.open(n.data.url)})},getBuyBalancePopup:function(n,t,i,r,u,f){var e=Requests.get(Requests.keys.ObjectIDs)+"="+encodeURIComponent(i)+"&isrealestate="+r+"&minquant="+u;ajaxRequest(n,t,"POST",e,function(n){var t=document.querySelector("#CSBuyPopup"),r=t.getAttribute("data-subtotalaction");CasaSapoCampaigns.calcSubTotal(t,r);t.querySelectorAll("input[type=text]")[0].focus();f&&(f.Additional.event_category=f.Additional.event_category+"-"+i,googleAnalyticsEvent(f));n.status==1&&n.data&&googleAnalyticsEvent(JSON.parse(n.data.analytics))})},errorQuantBalancePopup:function(){var n=document.querySelector("#CSBuyPopup");n.querySelectorAll("input[type=text]").forEach(function(n){n.classList.add("RedAlert")});n.querySelectorAll("input[type=text]")[0].focus()},getAssignBalancePopup:function(n,t,i,r){var u=Search.GenericList.getSelectedIDs(),f=Requests.get(Requests.keys.ObjectIDs)+"="+encodeURIComponent(u)+"&isrealestate=true&"+Requests.get(Requests.keys.Page)+"="+encodeURIComponent(i);ajaxRequest(n,t,"POST",f,function(){googleAnalyticsEvent(r)})},getAssignBalancePopupByID:function(n,t,i,r,u){var f=Requests.get(Requests.keys.ObjectIDs)+"="+encodeURIComponent(i)+"&isrealestate=true&"+Requests.get(Requests.keys.Page)+"="+encodeURIComponent(r);ajaxRequest(n,t,"POST",f,function(){googleAnalyticsEvent(u)})},getAssignAgencyBalancePopup:function(n,t,i,r,u){CasaSapoCampaigns.locationsCount=1;var f="isrealestate=false&"+Requests.get(Requests.keys.ObjectIDs)+"="+encodeURIComponent(i)+"&"+Requests.get(Requests.keys.Page)+"="+encodeURIComponent(r);ajaxRequest(n,t,"POST",f,function(){googleAnalyticsEvent(u,1,i)})},csHighlight:function(n,t,i,r,u,f){var e="";e=i>0?Requests.get(Requests.keys.ObjectIDs)+"="+encodeURIComponent(i)+"&isrealestate=true&"+Requests.get(Requests.keys.Page)+"="+encodeURIComponent(u):"isrealestate=false&"+Requests.get(Requests.keys.Page)+"="+encodeURIComponent(u);r>0&&(e+="&type="+r);ajaxRequest(n,t,"POST",e,function(){googleAnalyticsEvent(f)})},buyBalance:function(n,t,i){ajaxRequest(n,t,"POST",$("#CSBuyPopup *").serializeAll(),function(n){googleAnalyticsEvent(i);n.status==1&&n.data&&(googleAnalyticsEvent(JSON.parse(n.data.analytics)),window.open(n.data.url))})},calcSubTotal:function(n,t){ajaxRequest(n,t,"POST",$("#CSBuyPopup *").serializeAll());var i=document.querySelector("#CSBuyPopup");i.querySelectorAll("input[type=text]").forEach(function(n){n.classList.remove("RedAlert")})},createCampaign:function(n,t,i,r,u){var f=Search.GenericList.getSelectedIDs(),e=$("#CSAssignPopup *").serializeAll()+(i?"&"+Requests.get(Requests.keys.ObjectIDs)+"="+encodeURIComponent(f):"")+"&"+Requests.get(Requests.keys.Page)+"="+encodeURIComponent(r);ajaxRequest(n,t,"POST",e,function(n){googleAnalyticsEvent(u);Popup.close();n.data&&(n.data.analytics&&googleAnalyticsMultipleEvent(JSON.parse(n.data.analytics)),n.data.loadUrl!=""&&Search.reload(null,n.data.loadUrl))})},increaseCampaign:function(n,t,i,r,u){var f=document.getElementById("CSAssignPopup"),e=f.querySelector("[name='rid']").value,o=$("#CSAssignPopup *").serializeAll()+(i?"&"+Requests.get(Requests.keys.ObjectIDs)+"="+encodeURIComponent(e):"")+"&"+Requests.get(Requests.keys.Page)+"="+encodeURIComponent(r);ajaxRequest(n,t,"POST",o,function(n){googleAnalyticsEvent(u);Popup.close();n.data&&(n.data.analytics&&googleAnalyticsMultipleEvent(JSON.parse(n.data.analytics)),n.data.loadUrl&&Search.reload(null,n.data.loadUrl))})},getIncreasePopup:function(n,t,i,r,u){var f=(i>0?Requests.get(Requests.keys.ObjectIDs)+"="+encodeURIComponent(i)+"&":"")+"campaignID="+r;ajaxRequest(n,t,"POST",f,function(){googleAnalyticsEvent(u)})},reloadData:function(){window.location.reload(!0)},disableViews:function(n,t){n.checked?($("#cs_product_"+t).attr("disabled","disabled"),$("#cs_product_"+t).value=0):$("#cs_product_"+t).removeAttr("disabled")},disablePacks:function(n,t){var i=parseInt(n.value);i>0?($("#cs_product_"+t).attr("disabled","disabled"),$("#cs_product_"+t).prop("checked",!1)):$("#cs_product_"+t).attr("data-balance")>0&&$("#cs_product_"+t).removeAttr("disabled")},locationsCount:0,addLocations:function(n){CasaSapoCampaigns.locationsCount<3&&(Location.addLine(n),CasaSapoCampaigns.locationsCount+=1)},removeLocations:function(n){Location.removeLine(n);CasaSapoCampaigns.locationsCount-=1},hidePayment:function(n,t,i){var r=Requests.get(Requests.keys.ObjectID)+"="+i;ajaxRequest(n,t,"GET",r,function(n){var t=$("#CSPendingPopup").attr("data-reload-url"),i=$("#CSPendingPopup").attr("data-type");r=Requests.get(Requests.keys.ObjectID)+"="+i;n.status==1&&n.data&&googleAnalyticsEvent(JSON.parse(n.data.analytics));Popup.close();ajaxRequest(null,t,"GET",r)})},leadOnClick:function(n,t){ajaxRequest(n,t,"GET",null,function(n){n.status==1&&n.data&&googleAnalyticsEvent(JSON.parse(n.data.analytics))})},showProductType:function(n,t,i){$("#CSProductType_"+t).show();n.hide();googleAnalyticsEvent(i)}}}(),SupportTickets=function(){function t(n){$("#"+n).find(".listItemExpandContent .ContentBoxLine").animate({scrollTop:$("#"+n).find(".listItemExpandContent .ContentBoxLine").prop("scrollHeight")},500)}var n=!1;return{openTicketCreationPopup:function(t,i,r,u){n=!1;var f=new Popup.LayerOptions(null,null,null,function(){n&&document.location.reload()});ajaxRequest(t,i,"GET",r,function(n){if(n.status==ajaxRequest.StatusType.Success){var t=Popup.current();t&&(focusFirstTextBox(t),isObject(n.data)&&n.data.mediaUrl&&Media.setupUpload(t.querySelector("#MediaAttachment"),n.data.mediaUrl,[],t),typeof u=="function"&&u())}},{popupOptions:f})},createTicket:function(t,i){var r=t.up("#CreateSupportTicketPopup"),u=appendStringParams($(r).find(":input").serializeAll(),Media.serializeTarget(r.querySelector("#MediaAttachment")));ajaxRequest(t,i,"POST",u,function(t){t.status==ajaxRequest.StatusType.Success&&(n=!0,Popup.close())})},renderTickets:function(n,t,i){ajaxRequest(n,t,"GET",i)},addTicketMessage:function(n,i,r,u,f){c;ajaxRequest(n,i,"POST",r,function(n){n.status===ajaxRequest.StatusType.Success&&(document.getElementById(f).querySelector("textarea").value="",t(f))})},closeTicket:function(n,t,i){ajaxRequest(n,t,"GET",i)},openMsg:function(n,i){var u=n.up(".supportItem"),r=document.getElementById("DivTicketList");Tabs.toggleActive(n,".listItemExpandBox",function(){if(t(i),Element.removeClassName(u,"unreadItem"),r&&!r.querySelectorAll(".unreadItem").length){var n=r&&r.querySelector(".TicketTab.active.notify");Element.removeClassName(n,"notify")}})}}}();